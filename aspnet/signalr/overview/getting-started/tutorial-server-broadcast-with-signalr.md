---
uid: signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
title: "Kurz: Server všesměrového vysílání pomocí nástroje SignalR 2 | Microsoft Docs"
author: tdykstra
description: "Tento kurz ukazuje, jak vytvořit webovou aplikaci, která používá ASP.NET SignalR 2 k poskytnutí všesměrového vysílání funkce serveru. Všesměrové vysílání serveru znamená, že commun..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/13/2014
ms.topic: article
ms.assetid: 1568247f-60b5-4eca-96e0-e661fbb2b273
ms.technology: dotnet-signalr
ms.prod: .net-framework
msc.legacyurl: /signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
msc.type: authoredcontent
ms.openlocfilehash: 98a7ce4991d58181177cf56976888e9fd1526987
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/24/2018
---
<a name="tutorial-server-broadcast-with-signalr-2"></a><span data-ttu-id="b47d0-104">Kurz: Server všesměrového vysílání pomocí nástroje SignalR 2</span><span class="sxs-lookup"><span data-stu-id="b47d0-104">Tutorial: Server Broadcast with SignalR 2</span></span>
====================
<span data-ttu-id="b47d0-105">podle [tní Dykstra](https://github.com/tdykstra), [tní FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="b47d0-105">by [Tom Dykstra](https://github.com/tdykstra), [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="b47d0-106">Tento kurz ukazuje, jak vytvořit webovou aplikaci, která používá ASP.NET SignalR 2 k poskytnutí všesměrového vysílání funkce serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-106">This tutorial shows how to create a web application that uses ASP.NET SignalR 2 to provide server broadcast functionality.</span></span> <span data-ttu-id="b47d0-107">Všesměrové vysílání serveru znamená, že komunikace se odešle klientům zahájili serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-107">Server broadcast means that communications sent to clients are initiated by the server.</span></span> <span data-ttu-id="b47d0-108">Tento scénář vyžaduje jiný programovací přístup než peer-to-peer scénáře, jako jsou například aplikace chat, ve kterých se spouští komunikace odeslaných klientům jednu nebo více klientů.</span><span class="sxs-lookup"><span data-stu-id="b47d0-108">This scenario requires a different programming approach than peer-to-peer scenarios such as chat applications, in which communications sent to clients are initiated by one or more of the clients.</span></span>
> 
> <span data-ttu-id="b47d0-109">Aplikace, která v tomto kurzu vytvoříte simuluje běžícími Typický scénář v nástroji všesměrového vysílání funkce serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-109">The application that you'll create in this tutorial simulates a stock ticker, a typical scenario for server broadcast functionality.</span></span>
> 
> <span data-ttu-id="b47d0-110">Toto téma byl původně zapsán pomocí Patrik Fletcher.</span><span class="sxs-lookup"><span data-stu-id="b47d0-110">This topic was originally written by Patrick Fletcher.</span></span>
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="b47d0-111">V tomto kurzu použili verze softwaru</span><span class="sxs-lookup"><span data-stu-id="b47d0-111">Software versions used in the tutorial</span></span>
> 
> 
> - [<span data-ttu-id="b47d0-112">Visual Studio 2013</span><span class="sxs-lookup"><span data-stu-id="b47d0-112">Visual Studio 2013</span></span>](https://www.microsoft.com/visualstudio/eng/2013-downloads)
> - <span data-ttu-id="b47d0-113">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="b47d0-113">.NET 4.5</span></span>
> - <span data-ttu-id="b47d0-114">SignalR verze 2</span><span class="sxs-lookup"><span data-stu-id="b47d0-114">SignalR version 2</span></span>
>   
> 
> 
> ## <a name="using-visual-studio-2012-with-this-tutorial"></a><span data-ttu-id="b47d0-115">Tento kurz pomocí sady Visual Studio 2012</span><span class="sxs-lookup"><span data-stu-id="b47d0-115">Using Visual Studio 2012 with this tutorial</span></span>
> 
> 
> <span data-ttu-id="b47d0-116">Pokud chcete používat Visual Studio 2012 v tomto kurzu, postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="b47d0-116">To use Visual Studio 2012 with this tutorial, do the following:</span></span>
> 
> - <span data-ttu-id="b47d0-117">Aktualizace vašeho [Správce balíčků](http://docs.nuget.org/docs/start-here/installing-nuget) na nejnovější verzi.</span><span class="sxs-lookup"><span data-stu-id="b47d0-117">Update your [Package Manager](http://docs.nuget.org/docs/start-here/installing-nuget) to the latest version.</span></span>
> - <span data-ttu-id="b47d0-118">Nainstalujte [webové platformy](https://www.microsoft.com/web/downloads/platform.aspx).</span><span class="sxs-lookup"><span data-stu-id="b47d0-118">Install the [Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx).</span></span>
> - <span data-ttu-id="b47d0-119">Ve webové platformy, vyhledání a instalace **ASP.NET a webové nástroje 2013.1 pro sadu Visual Studio 2012**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-119">In the Web Platform Installer, search for and install **ASP.NET and Web Tools 2013.1 for Visual Studio 2012**.</span></span> <span data-ttu-id="b47d0-120">Šablony sady Visual Studio pro třídy SignalR dojde k instalaci, jako **rozbočovače**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-120">This will install Visual Studio templates for SignalR classes such as **Hub**.</span></span>
> - <span data-ttu-id="b47d0-121">Některé šablony (jako například **třídy pro spuštění OWIN**) nebudou k dispozici; pro tyto třídy soubor použít místo.</span><span class="sxs-lookup"><span data-stu-id="b47d0-121">Some templates (such as **OWIN Startup Class**) will not be available; for these, use a Class file instead.</span></span>
> 
> 
> ## <a name="tutorial-versions"></a><span data-ttu-id="b47d0-122">Kurz verze</span><span class="sxs-lookup"><span data-stu-id="b47d0-122">Tutorial Versions</span></span>
> 
> <span data-ttu-id="b47d0-123">Informace o předchozích verzích SignalR najdete v tématu [starší verze funkce SignalR](../older-versions/index.md).</span><span class="sxs-lookup"><span data-stu-id="b47d0-123">For information about earlier versions of SignalR, see [SignalR Older Versions](../older-versions/index.md).</span></span>
> 
> ## <a name="questions-and-comments"></a><span data-ttu-id="b47d0-124">Dotazy a připomínky</span><span class="sxs-lookup"><span data-stu-id="b47d0-124">Questions and comments</span></span>
> 
> <span data-ttu-id="b47d0-125">Prosím sdělit svůj názor na tom, jak líbilo tohoto kurzu a co jsme může zlepšit v komentářích v dolní části stránky.</span><span class="sxs-lookup"><span data-stu-id="b47d0-125">Please leave feedback on how you liked this tutorial and what we could improve in the comments at the bottom of the page.</span></span> <span data-ttu-id="b47d0-126">Pokud máte otázky, které přímo nesouvisejí s kurz, můžete je do příspěvku [fórum pro ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) nebo [StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="b47d0-126">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com/).</span></span>


## <a name="overview"></a><span data-ttu-id="b47d0-127">Přehled</span><span class="sxs-lookup"><span data-stu-id="b47d0-127">Overview</span></span>

<span data-ttu-id="b47d0-128">V tomto kurzu budete vytvoření běžícími aplikace, který je typický pro aplikace v reálném čase, ve kterých chcete pravidelně "push" nebo všesměrového vysílání, chcete-li všechny připojené klienty upozornění ze serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-128">In this tutorial, you'll create a stock ticker application that is representative of real-time applications in which you want to periodically "push," or broadcast, notifications from the server to all connected clients.</span></span> <span data-ttu-id="b47d0-129">V první části tohoto kurzu vytvoříte zjednodušenou verzi aplikace od začátku.</span><span class="sxs-lookup"><span data-stu-id="b47d0-129">In the first part of this tutorial, you'll create a simplified version of that application from scratch.</span></span> <span data-ttu-id="b47d0-130">Ve zbývající části tohoto kurzu budete instalovat balíček NuGet, který obsahuje další funkce a zkontrolovat kód pro tyto funkce.</span><span class="sxs-lookup"><span data-stu-id="b47d0-130">In the remainder of the tutorial, you'll install a NuGet package that contains additional features, and review the code for those features.</span></span>

<span data-ttu-id="b47d0-131">Aplikace, která budete sestavení v první části tohoto kurzu zobrazí mřížku uložených daty.</span><span class="sxs-lookup"><span data-stu-id="b47d0-131">The application that you'll build in the first part of this tutorial displays a grid with stock data.</span></span>

![Počáteční verze StockTicker](tutorial-server-broadcast-with-signalr/_static/image1.png)

<span data-ttu-id="b47d0-133">Server pravidelně náhodně aktualizací uložených ceny a nabízených oznámení aktualizace pro všechny připojené klienty.</span><span class="sxs-lookup"><span data-stu-id="b47d0-133">Periodically the server randomly updates stock prices and pushes the updates to all connected clients.</span></span> <span data-ttu-id="b47d0-134">V prohlížeči čísla a symboly v **změnit** a  **%**  sloupců dynamicky měnit v reakci na oznámení ze serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-134">In the browser the numbers and symbols in the **Change** and **%** columns dynamically change in response to notifications from the server.</span></span> <span data-ttu-id="b47d0-135">Pokud můžete otevřít další prohlížeče na stejnou adresu URL, budou všechny zobrazit stejná data a stejné změny dat současně.</span><span class="sxs-lookup"><span data-stu-id="b47d0-135">If you open additional browsers to the same URL, they all show the same data and the same changes to the data simultaneously.</span></span>

<span data-ttu-id="b47d0-136">Tento kurz obsahuje následující části:</span><span class="sxs-lookup"><span data-stu-id="b47d0-136">This tutorial contains the following sections:</span></span>

- [<span data-ttu-id="b47d0-137">Požadavky</span><span class="sxs-lookup"><span data-stu-id="b47d0-137">Prerequisites</span></span>](#prerequisites)
- [<span data-ttu-id="b47d0-138">Vytvoření projektu</span><span class="sxs-lookup"><span data-stu-id="b47d0-138">Create the project</span></span>](#createproject)
- [<span data-ttu-id="b47d0-139">Nastavení kódu serveru</span><span class="sxs-lookup"><span data-stu-id="b47d0-139">Set up the server code</span></span>](#server)
- [<span data-ttu-id="b47d0-140">Nastavit kód klienta</span><span class="sxs-lookup"><span data-stu-id="b47d0-140">Set up the client code</span></span>](#client)
- [<span data-ttu-id="b47d0-141">Testování aplikace</span><span class="sxs-lookup"><span data-stu-id="b47d0-141">Test the application</span></span>](#test)
- [<span data-ttu-id="b47d0-142">Povolení protokolování</span><span class="sxs-lookup"><span data-stu-id="b47d0-142">Enable logging</span></span>](#enablelogging)
- [<span data-ttu-id="b47d0-143">Instalace a zkontrolovat v celé ukázce StockTicker</span><span class="sxs-lookup"><span data-stu-id="b47d0-143">Install and review the full StockTicker sample</span></span>](#fullsample)
- [<span data-ttu-id="b47d0-144">Další kroky</span><span class="sxs-lookup"><span data-stu-id="b47d0-144">Next steps</span></span>](#nextsteps)

<span data-ttu-id="b47d0-145">[Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) balíček NuGet nainstaluje ukázkové simulated běžícími aplikace v projektu sady Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b47d0-145">The [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package installs a sample simulated stock ticker application in a Visual Studio project.</span></span>

> [!NOTE]
> <span data-ttu-id="b47d0-146">Pokud nechcete, aby postup provede kroky vytváření aplikace, můžete nainstalovat balíček SignalR.Sample v nový projekt prázdný webové aplikace ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b47d0-146">If you don't want to work through the steps of building the application, you can install the SignalR.Sample package in a new Empty ASP.NET Web Application project.</span></span> <span data-ttu-id="b47d0-147">Je-li nainstalovat balíček NuGet bez kroky v tomto kurzu **musí podle pokynů v souboru readme.txt**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-147">If you install the NuGet package without performing the steps in this tutorial, **you must follow the instructions in the readme.txt file**.</span></span> <span data-ttu-id="b47d0-148">Spusťte balíček, je nutné přidat třídy pro spuštění OWIN, který volá metodu ConfigureSignalR ve s nainstalovaným balíčkem.</span><span class="sxs-lookup"><span data-stu-id="b47d0-148">To run the package you need to add an OWIN startup class which calls the ConfigureSignalR method in the installed package.</span></span> <span data-ttu-id="b47d0-149">Obdržíte chybu, pokud nepřidáte třídy pro spuštění OWIN.</span><span class="sxs-lookup"><span data-stu-id="b47d0-149">You will receive an error if you do not add the OWIN startup class.</span></span>


<a id="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="b47d0-150">Požadavky</span><span class="sxs-lookup"><span data-stu-id="b47d0-150">Prerequisites</span></span>

<span data-ttu-id="b47d0-151">Než začnete, ujistěte se, že máte Visual Studio 2013 v počítači nainstalována.</span><span class="sxs-lookup"><span data-stu-id="b47d0-151">Before you start, make sure that you have Visual Studio 2013 installed on your computer.</span></span> <span data-ttu-id="b47d0-152">Pokud nemáte Visual Studio, najdete v části [ASP.NET stáhne](https://www.asp.net/downloads) získat bezplatné sady Visual Studio 2013 Express.</span><span class="sxs-lookup"><span data-stu-id="b47d0-152">If you don't have Visual Studio, see [ASP.NET Downloads](https://www.asp.net/downloads) to get the free Visual Studio 2013 Express.</span></span>

<a id="createproject"></a>

## <a name="create-the-project"></a><span data-ttu-id="b47d0-153">Vytvoření projektu</span><span class="sxs-lookup"><span data-stu-id="b47d0-153">Create the project</span></span>

1. <span data-ttu-id="b47d0-154">Z **soubor** nabídky, klikněte na tlačítko **nový projekt**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-154">From the **File** menu, click **New Project**.</span></span>
2. <span data-ttu-id="b47d0-155">V **nový projekt** dialogové okno, rozbalte seznam **C#** pod **šablony** a vyberte **webové**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-155">In the **New Project** dialog box, expand **C#** under **Templates** and select **Web**.</span></span>
3. <span data-ttu-id="b47d0-156">Vyberte **prázdný webové aplikace ASP.NET** šablony, název projektu *SignalR.StockTicker*a klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-156">Select the **ASP.NET Empty Web Application** template, name the project *SignalR.StockTicker*, and click **OK**.</span></span>

    ![Dialogové okno Nový projekt](tutorial-server-broadcast-with-signalr/_static/image2.png)
4. <span data-ttu-id="b47d0-158">V **nové ASP.NET** okna projektu, ponechejte **prázdný** vybraný a klikněte na tlačítko **vytvořit projekt**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-158">In the **New ASP.NET** Project window, leave **Empty** selected and click **Create Project**.</span></span>

    ![Dialogové okno Nový projekt ASP](tutorial-server-broadcast-with-signalr/_static/image3.png)

<a id="server"></a>

## <a name="set-up-the-server-code"></a><span data-ttu-id="b47d0-160">Nastavení kódu serveru</span><span class="sxs-lookup"><span data-stu-id="b47d0-160">Set up the server code</span></span>

<span data-ttu-id="b47d0-161">V této části můžete nastavit kód, který běží na serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-161">In this section you set up the code that runs on the server.</span></span>

### <a name="create-the-stock-class"></a><span data-ttu-id="b47d0-162">Vytvořte třídu Stock</span><span class="sxs-lookup"><span data-stu-id="b47d0-162">Create the Stock class</span></span>

<span data-ttu-id="b47d0-163">Začněte vytvořením Stock třídu modelu, který budete používat k ukládání a přenášet informace o populace.</span><span class="sxs-lookup"><span data-stu-id="b47d0-163">You begin by creating the Stock model class that you'll use to store and transmit information about a stock.</span></span>

1. <span data-ttu-id="b47d0-164">Vytvořit nový soubor třídy ve složce projektu, pojmenujte ji *Stock.cs*a pak nahraďte kód šablony s následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="b47d0-164">Create a new class file in the project folder, name it *Stock.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample1.cs)]

    <span data-ttu-id="b47d0-165">Dvě vlastnosti, které budete nastavit při vytváření akcií jsou Symbol (například MSFT Microsoft) a cenu.</span><span class="sxs-lookup"><span data-stu-id="b47d0-165">The two properties that you'll set when you create stocks are the Symbol (for example, MSFT for Microsoft) and the Price.</span></span> <span data-ttu-id="b47d0-166">Ostatní vlastnosti závisí na tom, jak a kdy nastavíte ceny.</span><span class="sxs-lookup"><span data-stu-id="b47d0-166">The other properties depend on how and when you set Price.</span></span> <span data-ttu-id="b47d0-167">Při prvním nastavení ceny, je hodnota získá rozšířena do DayOpen.</span><span class="sxs-lookup"><span data-stu-id="b47d0-167">The first time you set Price, the value gets propagated to DayOpen.</span></span> <span data-ttu-id="b47d0-168">Následné časy, když jste nastavili ceníku, tato změna a hodnoty vlastností PercentChange jsou vypočítávány podle rozdíl mezi ceny a DayOpen.</span><span class="sxs-lookup"><span data-stu-id="b47d0-168">Subsequent times when you set Price, the Change and PercentChange property values are calculated based on the difference between Price and DayOpen.</span></span>

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a><span data-ttu-id="b47d0-169">Vytvoření třídy StockTicker a StockTickerHub</span><span class="sxs-lookup"><span data-stu-id="b47d0-169">Create the StockTicker and StockTickerHub classes</span></span>

<span data-ttu-id="b47d0-170">Rozhraní API rozbočovače SignalR budete používat pro zpracování interakce klienta a serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-170">You'll use the SignalR Hub API to handle server-to-client interaction.</span></span> <span data-ttu-id="b47d0-171">StockTickerHub třída odvozená z třídy rozbočovače SignalR bude zpracovávat přijímá připojení a volání metod od klientů.</span><span class="sxs-lookup"><span data-stu-id="b47d0-171">A StockTickerHub class that derives from the SignalR Hub class will handle receiving connections and method calls from clients.</span></span> <span data-ttu-id="b47d0-172">Musíte také k zachování uložených dat a spustit časovač objekt pravidelně spouštět aktualizaci cen, nezávisle na připojení klientů.</span><span class="sxs-lookup"><span data-stu-id="b47d0-172">You also need to maintain stock data and run a Timer object to periodically trigger price updates, independently of client connections.</span></span> <span data-ttu-id="b47d0-173">Tyto funkce nelze vložit do třídy rozbočovače, protože nejsou přechodné instance rozbočovače.</span><span class="sxs-lookup"><span data-stu-id="b47d0-173">You can't put these functions in a Hub class, because Hub instances are transient.</span></span> <span data-ttu-id="b47d0-174">Pro každou operaci na rozbočovači, jako je připojení a volání od klienta k serveru se vytvoří instance třídy rozbočovače.</span><span class="sxs-lookup"><span data-stu-id="b47d0-174">A Hub class instance is created for each operation on the hub, such as connections and calls from the client to the server.</span></span> <span data-ttu-id="b47d0-175">Takže mechanismus, který zajistí uložených dat, aktualizuje ceny a vysílá aktualizaci cen musí spustit v samostatné třídy, které budete název StockTicker.</span><span class="sxs-lookup"><span data-stu-id="b47d0-175">So the mechanism that keeps stock data, updates prices, and broadcasts the price updates has to run in a separate class, which you'll name StockTicker.</span></span>

![Všesměrové vysílání z StockTicker](tutorial-server-broadcast-with-signalr/_static/image5.png)

<span data-ttu-id="b47d0-177">Chcete pouze jedna instance třídy StockTicker ke spuštění na serveru, takže budete muset nastavit odkaz z každá instance StockTickerHub k StockTicker instanci typu singleton.</span><span class="sxs-lookup"><span data-stu-id="b47d0-177">You only want one instance of the StockTicker class to run on the server, so you'll need to set up a reference from each StockTickerHub instance to the singleton StockTicker instance.</span></span> <span data-ttu-id="b47d0-178">Třída StockTicker nemá být schopni všesměrové vysílání pro klienty, protože nemá na základě dat a aktivuje aktualizace, ale StockTicker není třídy rozbočovače.</span><span class="sxs-lookup"><span data-stu-id="b47d0-178">The StockTicker class has to be able to broadcast to clients because it has the stock data and triggers updates, but StockTicker is not a Hub class.</span></span> <span data-ttu-id="b47d0-179">Proto je třídu StockTicker získat odkaz na objekt kontextu připojení rozbočovače SignalR.</span><span class="sxs-lookup"><span data-stu-id="b47d0-179">Therefore, the StockTicker class has to get a reference to the SignalR Hub connection context object.</span></span> <span data-ttu-id="b47d0-180">Objekt kontextu připojení SignalR pak může použít k vysílání klientům.</span><span class="sxs-lookup"><span data-stu-id="b47d0-180">It can then use the SignalR connection context object to broadcast to clients.</span></span>

1. <span data-ttu-id="b47d0-181">V **Průzkumníku řešení**, klikněte pravým tlačítkem na projekt a klikněte na tlačítko **přidat | Třídy rozbočovače SignalR (v2)**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-181">In **Solution Explorer**, right-click the project and click **Add | SignalR Hub Class (v2)**.</span></span>
2. <span data-ttu-id="b47d0-182">Název nového centra *StockTickerHub.cs*a potom klikněte na **přidat**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-182">Name the new hub *StockTickerHub.cs*, and then click **Add**.</span></span> <span data-ttu-id="b47d0-183">Balíčky SignalR NuGet přidá do projektu.</span><span class="sxs-lookup"><span data-stu-id="b47d0-183">SignalR NuGet packages will be added to your project.</span></span>
3. <span data-ttu-id="b47d0-184">Kód šablony nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="b47d0-184">Replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample2.cs)]

    <span data-ttu-id="b47d0-185">[Rozbočovače](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) třída se používá k definování metody klienty můžete volat na serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-185">The [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) class is used to define methods the clients can call on the server.</span></span> <span data-ttu-id="b47d0-186">Definování jednu metodu: `GetAllStocks()`.</span><span class="sxs-lookup"><span data-stu-id="b47d0-186">You are defining one method: `GetAllStocks()`.</span></span> <span data-ttu-id="b47d0-187">Když se klient původně připojí k serveru, se bude volat tuto metodu za účelem získání seznamu všech sledovaných akcií s jejich aktuální ceny.</span><span class="sxs-lookup"><span data-stu-id="b47d0-187">When a client initially connects to the server, it will call this method to get a list of all of the stocks with their current prices.</span></span> <span data-ttu-id="b47d0-188">Můžete provést synchronně a vrátí metodu `IEnumerable<Stock>` vzhledem k tomu, že ji vrací data z paměti.</span><span class="sxs-lookup"><span data-stu-id="b47d0-188">The method can execute synchronously and return `IEnumerable<Stock>` because it is returning data from memory.</span></span> <span data-ttu-id="b47d0-189">Pokud metoda museli získat data pomocí tohoto postupu něco, co by zahrnovat čekání, jako je vyhledávání v databázi nebo volání webové služby, zadali byste `Task<IEnumerable<Stock>>` jako návratová hodnota Povolit asynchronní zpracování.</span><span class="sxs-lookup"><span data-stu-id="b47d0-189">If the method had to get the data by doing something that would involve waiting, such as a database lookup or a web service call, you would specify `Task<IEnumerable<Stock>>` as the return value to enable asynchronous processing.</span></span> <span data-ttu-id="b47d0-190">Další informace najdete v tématu [ASP.NET SignalR centra API Průvodce - Server - při spuštění asynchronně](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).</span><span class="sxs-lookup"><span data-stu-id="b47d0-190">For more information, see [ASP.NET SignalR Hubs API Guide - Server - When to execute asynchronously](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).</span></span>

    <span data-ttu-id="b47d0-191">HubName atribut určuje, jak se bude odkazovat rozbočovače v kódu jazyka JavaScript na straně klienta.</span><span class="sxs-lookup"><span data-stu-id="b47d0-191">The HubName attribute specifies how the Hub will be referenced in JavaScript code on the client.</span></span> <span data-ttu-id="b47d0-192">Výchozí název na straně klienta, pokud nepoužijete tento atribut je ve formátu camelCase verzi název třídy, které by v tomto případě stockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="b47d0-192">The default name on the client if you don't use this attribute is a camel-cased version of the class name, which in this case would be stockTickerHub.</span></span>

    <span data-ttu-id="b47d0-193">Jak uvidíte později při vytváření StockTicker třídy, se vytvoří instanci typu singleton této třídy v jeho statickou vlastnost Instance.</span><span class="sxs-lookup"><span data-stu-id="b47d0-193">As you'll see later when you create the StockTicker class, a singleton instance of that class is created in its static Instance property.</span></span> <span data-ttu-id="b47d0-194">Že instanci typu singleton daného StockTicker zůstane v paměti bez ohledu na to, kolik klientů připojení nebo odpojení a tato instance je metoda GetAllStocks používá k vrácení aktuální informací uložených.</span><span class="sxs-lookup"><span data-stu-id="b47d0-194">That singleton instance of StockTicker remains in memory no matter how many clients connect or disconnect, and that instance is what the GetAllStocks method uses to return current stock information.</span></span>
4. <span data-ttu-id="b47d0-195">Vytvořit nový soubor třídy ve složce projektu, pojmenujte ji *StockTicker.cs*a pak nahraďte kód šablony s následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="b47d0-195">Create a new class file in the project folder, name it *StockTicker.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample3.cs)]

    <span data-ttu-id="b47d0-196">Vzhledem k tomu, že více vláken bude používat stejnou instanci StockTicker kódu, musí být threadsafe StockTicker třídy.</span><span class="sxs-lookup"><span data-stu-id="b47d0-196">Since multiple threads will be running the same instance of StockTicker code, the StockTicker class has to be threadsafe.</span></span>

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a><span data-ttu-id="b47d0-197">Instanci typu singleton ukládání do statických polí</span><span class="sxs-lookup"><span data-stu-id="b47d0-197">Storing the singleton instance in a static field</span></span>

    <span data-ttu-id="b47d0-198">Kód inicializuje statických \_pole instance, která zálohuje vlastnost Instance s instancí třídy, a to je pouze instance třídy, která se dají vytvořit, protože konstruktoru je označen jako soukromé.</span><span class="sxs-lookup"><span data-stu-id="b47d0-198">The code initializes the static \_instance field that backs the Instance property with an instance of the class, and this is the only instance of the class that can be created, because the constructor is marked as private.</span></span> <span data-ttu-id="b47d0-199">[Opožděná inicializace](https://msdn.microsoft.com/library/dd997286.aspx) se používá pro \_pole instance, není z důvodů výkonu ale a zkontrolujte, zda je vytvoření instance threadsafe.</span><span class="sxs-lookup"><span data-stu-id="b47d0-199">[Lazy initialization](https://msdn.microsoft.com/library/dd997286.aspx) is used for the \_instance field, not for performance reasons but to ensure that the instance creation is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample4.cs)]

    <span data-ttu-id="b47d0-200">Pokaždé, když klient připojí k serveru, novou instanci třídy StockTickerHub spuštěna v samostatných podprocesu získá instanci typu singleton StockTicker z StockTicker.Instance statické vlastnosti, jako jste viděli dříve ve třídě StockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="b47d0-200">Each time a client connects to the server, a new instance of the StockTickerHub class running in a separate thread gets the StockTicker singleton instance from the StockTicker.Instance static property, as you saw earlier in the StockTickerHub class.</span></span>

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a><span data-ttu-id="b47d0-201">Ukládání dat uložených v ConcurrentDictionary</span><span class="sxs-lookup"><span data-stu-id="b47d0-201">Storing stock data in a ConcurrentDictionary</span></span>

    <span data-ttu-id="b47d0-202">Konstruktor inicializuje \_akcií kolekce s některými ukázkových uložených dat a GetAllStocks vrátí populací.</span><span class="sxs-lookup"><span data-stu-id="b47d0-202">The constructor initializes the \_stocks collection with some sample stock data, and GetAllStocks returns the stocks.</span></span> <span data-ttu-id="b47d0-203">Jak už jste viděli dříve, tato kolekce akcií zase vrácený StockTickerHub.GetAllStocks, což je metoda serveru ve třídě rozbočovače, které klienty můžete volat.</span><span class="sxs-lookup"><span data-stu-id="b47d0-203">As you saw earlier, this collection of stocks is in turn returned by StockTickerHub.GetAllStocks which is a server method in the Hub class that clients can call.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample5.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample6.cs)]

    <span data-ttu-id="b47d0-204">Kolekce akcií je definován jako [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) typ pro bezpečný přístup z více vláken.</span><span class="sxs-lookup"><span data-stu-id="b47d0-204">The stocks collection is defined as a [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) type for thread safety.</span></span> <span data-ttu-id="b47d0-205">Jako alternativu, můžete použít [slovník](https://msdn.microsoft.com/library/xfhwa508.aspx) objektu a explicitně zamknout slovníku, když provedete změny.</span><span class="sxs-lookup"><span data-stu-id="b47d0-205">As an alternative, you could use a [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) object and explicitly lock the dictionary when you make changes to it.</span></span>

    <span data-ttu-id="b47d0-206">Tato ukázková aplikace je OK pro uložení dat aplikace v paměti a ke ztrátě dat při zrušení StockTicker instance.</span><span class="sxs-lookup"><span data-stu-id="b47d0-206">For this sample application, it's OK to store application data in memory and to lose the data when the StockTicker instance is disposed.</span></span> <span data-ttu-id="b47d0-207">V reálné aplikaci byste pracovat s back-end data store například do databáze.</span><span class="sxs-lookup"><span data-stu-id="b47d0-207">In a real application you would work with a back-end data store such as a database.</span></span>

    ### <a name="periodically-updating-stock-prices"></a><span data-ttu-id="b47d0-208">Pravidelně aktualizuje uložených ceny</span><span class="sxs-lookup"><span data-stu-id="b47d0-208">Periodically updating stock prices</span></span>

    <span data-ttu-id="b47d0-209">Konstruktor spuštění časovače objekt, který pravidelně volá metody, které aktualizace uložených ceny náhodně.</span><span class="sxs-lookup"><span data-stu-id="b47d0-209">The constructor starts up a Timer object that periodically calls methods that update stock prices on a random basis.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample7.cs)]

    <span data-ttu-id="b47d0-210">UpdateStockPrices je volána službou časovač, která předá hodnotu null v parametru state.</span><span class="sxs-lookup"><span data-stu-id="b47d0-210">UpdateStockPrices is called by the Timer, which passes in null in the state parameter.</span></span> <span data-ttu-id="b47d0-211">Před aktualizací ceny, zámek pořízené \_updateStockPricesLock objektu.</span><span class="sxs-lookup"><span data-stu-id="b47d0-211">Before updating prices, a lock is taken on the \_updateStockPricesLock object.</span></span> <span data-ttu-id="b47d0-212">Kód zkontroluje, zda jiné vlákno je už aktualizace ceny, a pak zavolá TryUpdateStockPrice na každý stock v seznamu.</span><span class="sxs-lookup"><span data-stu-id="b47d0-212">The code checks if another thread is already updating prices, and then it calls TryUpdateStockPrice on each stock in the list.</span></span> <span data-ttu-id="b47d0-213">Metoda TryUpdateStockPrice rozhodne, zda se změní uložených cena a kolik ho změnit.</span><span class="sxs-lookup"><span data-stu-id="b47d0-213">The TryUpdateStockPrice method decides whether to change the stock price, and how much to change it.</span></span> <span data-ttu-id="b47d0-214">Pokud dojde ke změně cenu akcií, BroadcastStockPrice je volána pro všesměrové vysílání změna uložených ceny pro všechny připojené klienty.</span><span class="sxs-lookup"><span data-stu-id="b47d0-214">If the stock price is changed, BroadcastStockPrice is called to broadcast the stock price change to all connected clients.</span></span>

    <span data-ttu-id="b47d0-215">\_UpdatingStockPrices příznak je označena jako [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) zajistit, že je přístup k němu threadsafe.</span><span class="sxs-lookup"><span data-stu-id="b47d0-215">The \_updatingStockPrices flag is marked as [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) to ensure that access to it is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample8.cs)]

    <span data-ttu-id="b47d0-216">V reálné aplikaci byste metodu TryUpdateStockPrice volání webové služby k vyhledání cenu; v tento kód používá generátor náhodných čísel náhodně provádět změny.</span><span class="sxs-lookup"><span data-stu-id="b47d0-216">In a real application, the TryUpdateStockPrice method would call a web service to look up the price; in this code it uses a random number generator to make changes randomly.</span></span>

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a><span data-ttu-id="b47d0-217">Získávání kontext SignalR tak, aby klientům můžete vysílání StockTicker – třída</span><span class="sxs-lookup"><span data-stu-id="b47d0-217">Getting the SignalR context so that the StockTicker class can broadcast to clients</span></span>

    <span data-ttu-id="b47d0-218">Protože změny cen pocházejí zde v objektu StockTicker, to je objekt, který potřebuje volat metodu updateStockPrice na všech připojených klientů.</span><span class="sxs-lookup"><span data-stu-id="b47d0-218">Because the price changes originate here in the StockTicker object, this is the object that needs to call an updateStockPrice method on all connected clients.</span></span> <span data-ttu-id="b47d0-219">Ve třídě rozbočovače máte rozhraní API pro volání metody klienta, ale StockTicker není odvozena od třídy rozbočovače a nemá odkaz na objekt žádné rozbočovače.</span><span class="sxs-lookup"><span data-stu-id="b47d0-219">In a Hub class you have an API for calling client methods, but StockTicker does not derive from the Hub class and does not have a reference to any Hub object.</span></span> <span data-ttu-id="b47d0-220">Proto aby bylo možné všesměrové vysílání pro připojené klienty, třída StockTicker musí získat instance kontextu SignalR pro StockTickerHub třídu a použijte ho k volání metody na klientských počítačích.</span><span class="sxs-lookup"><span data-stu-id="b47d0-220">Therefore, in order to broadcast to connected clients, the StockTicker class has to get the SignalR context instance for the StockTickerHub class and use that to call methods on clients.</span></span>

    <span data-ttu-id="b47d0-221">Kód získá odkaz na kontext SignalR při vytváření instance třídy singleton, předává, které odkazují na do konstruktoru, a vloží ho konstruktoru vlastnost klientů.</span><span class="sxs-lookup"><span data-stu-id="b47d0-221">The code gets a reference to the SignalR context when it creates the singleton class instance, passes that reference to the constructor, and the constructor puts it in the Clients property.</span></span>

    <span data-ttu-id="b47d0-222">Existují dva důvody, proč chcete získat kontext pouze jednou: získávání kontextu je náročná operace a jednou pro spolupráci zajistíte zachování určený pořadí zprávy odeslané do klientů.</span><span class="sxs-lookup"><span data-stu-id="b47d0-222">There are two reasons why you want to get the context just once: getting the context is an expensive operation, and getting it once ensures that the intended order of messages sent to clients is preserved.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample9.cs)]

    <span data-ttu-id="b47d0-223">Získávání klienti vlastností kontextu a umístit ho do vlastnosti StockTickerClient umožňuje psát kód pro volání metod klienta, který vypadá stejně, jako by v třídy rozbočovače.</span><span class="sxs-lookup"><span data-stu-id="b47d0-223">Getting the Clients property of the context and putting it in the StockTickerClient property lets you write code to call client methods that looks the same as it would in a Hub class.</span></span> <span data-ttu-id="b47d0-224">Například všesměrové vysílání pro všechny klienty můžete napsat Clients.All.updateStockPrice(stock).</span><span class="sxs-lookup"><span data-stu-id="b47d0-224">For instance, to broadcast to all clients you can write Clients.All.updateStockPrice(stock).</span></span>

    <span data-ttu-id="b47d0-225">UpdateStockPrice metoda, která jsou volání v BroadcastStockPrice ještě; neexistuje přidáte ho později při psaní kódu, který běží na klientovi.</span><span class="sxs-lookup"><span data-stu-id="b47d0-225">The updateStockPrice method that you are calling in BroadcastStockPrice doesn't exist yet; you'll add it later when you write code that runs on the client.</span></span> <span data-ttu-id="b47d0-226">Najdete zde updateStockPrice protože Clients.All je dynamický, což znamená, že se vyhodnotí výraz v době běhu.</span><span class="sxs-lookup"><span data-stu-id="b47d0-226">You can refer to updateStockPrice here because Clients.All is dynamic, which means the expression will be evaluated at runtime.</span></span> <span data-ttu-id="b47d0-227">Při volání této metody se provede, bude SignalR posílat název metody a hodnota parametru do klienta a pokud má klient metodu s názvem updateStockPrice, volání této metody a hodnota parametru se předá ho.</span><span class="sxs-lookup"><span data-stu-id="b47d0-227">When this method call executes, SignalR will send the method name and the parameter value to the client, and if the client has a method named updateStockPrice, that method will be called and the parameter value will be passed to it.</span></span>

    <span data-ttu-id="b47d0-228">Clients.All znamená odeslat na všechny klienty.</span><span class="sxs-lookup"><span data-stu-id="b47d0-228">Clients.All means send to all clients.</span></span> <span data-ttu-id="b47d0-229">Funkce SignalR poskytuje dalších možností, které určují, které klienti nebo skupiny klientů k odeslání do.</span><span class="sxs-lookup"><span data-stu-id="b47d0-229">SignalR gives you other options to specify which clients or groups of clients to send to.</span></span> <span data-ttu-id="b47d0-230">Další informace najdete v tématu [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="b47d0-230">For more information, see [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span></span>

### <a name="register-the-signalr-route"></a><span data-ttu-id="b47d0-231">Zaregistrovat trasy SignalR</span><span class="sxs-lookup"><span data-stu-id="b47d0-231">Register the SignalR route</span></span>

<span data-ttu-id="b47d0-232">Server musí znát adresu URL, která je zachytí a přesměrování na SignalR.</span><span class="sxs-lookup"><span data-stu-id="b47d0-232">The server needs to know which URL to intercept and direct to SignalR.</span></span> <span data-ttu-id="b47d0-233">Chcete-li provést, přidáte a třídy pro spuštění OWIN.</span><span class="sxs-lookup"><span data-stu-id="b47d0-233">To do that you'll add and OWIN startup class.</span></span>

1. <span data-ttu-id="b47d0-234">V **Průzkumníku řešení**, klikněte pravým tlačítkem na projekt a pak klikněte na tlačítko **přidat | Třídy pro spuštění OWIN**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-234">In **Solution Explorer**, right-click the project, and then click **Add | OWIN Startup Class**.</span></span> <span data-ttu-id="b47d0-235">Název třídy **Startup.cs**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-235">Name the class **Startup.cs**.</span></span>
2. <span data-ttu-id="b47d0-236">Nahraďte kód v **Startup.cs** následujícím kódem.</span><span class="sxs-lookup"><span data-stu-id="b47d0-236">Replace the code in **Startup.cs** with the following.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample10.cs)]

<span data-ttu-id="b47d0-237">Teď jste dokončili nastavení kódu serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-237">You have now completed setting up the server code.</span></span> <span data-ttu-id="b47d0-238">V další části budete nastavení klienta.</span><span class="sxs-lookup"><span data-stu-id="b47d0-238">In the next section you'll set up the client.</span></span>

<a id="client"></a>

## <a name="set-up-the-client-code"></a><span data-ttu-id="b47d0-239">Nastavit kód klienta</span><span class="sxs-lookup"><span data-stu-id="b47d0-239">Set up the client code</span></span>

1. <span data-ttu-id="b47d0-240">Vytvořte nový soubor HTML ve složce projektu s názvem *StockTicker.html*.</span><span class="sxs-lookup"><span data-stu-id="b47d0-240">Create a new HTML file in the project folder, and name it *StockTicker.html*.</span></span>
2. <span data-ttu-id="b47d0-241">Kód šablony nahraďte následujícím kódem.</span><span class="sxs-lookup"><span data-stu-id="b47d0-241">Replace the template code with the following code.</span></span>

    [!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample11.html)]

    <span data-ttu-id="b47d0-242">HTML vytvoří tabulku se sloupci 5, řádek záhlaví a řádek dat s jedinou buňku, která zahrnuje všechny sloupce 5.</span><span class="sxs-lookup"><span data-stu-id="b47d0-242">The HTML creates a table with 5 columns, a header row, and a data row with a single cell that spans all 5 columns.</span></span> <span data-ttu-id="b47d0-243">Řádku dat zobrazí "načítání..." a se zobrazí pouze na okamžik při spuštění aplikace.</span><span class="sxs-lookup"><span data-stu-id="b47d0-243">The data row displays "loading..." and will only be shown momentarily when the application starts.</span></span> <span data-ttu-id="b47d0-244">Kód jazyka JavaScript odebere tento řádek a přidat v jeho místní řádky s uložených data načtená ze serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-244">JavaScript code will remove that row and add in its place rows with stock data retrieved from the server.</span></span>

    <span data-ttu-id="b47d0-245">Značky skriptu zadejte souboru skriptu jQuery, soubor skriptu SignalR core, soubor skriptu SignalR proxy servery a StockTicker soubor skriptu, který vytvoříte později.</span><span class="sxs-lookup"><span data-stu-id="b47d0-245">The script tags specify the jQuery script file, the SignalR core script file, the SignalR proxies script file, and a StockTicker script file that you'll create later.</span></span> <span data-ttu-id="b47d0-246">Soubor skriptu SignalR proxy, který určuje adresu URL, "/ signalr/hubs", se dynamicky vygeneruje a v takovém případě definuje proxy metody pro metody pro třídy rozbočovače pro StockTickerHub.GetAllStocks.</span><span class="sxs-lookup"><span data-stu-id="b47d0-246">The SignalR proxies script file, which specifies the "/signalr/hubs" URL, is dynamically generated and defines proxy methods for the methods on the Hub class, in this case for StockTickerHub.GetAllStocks.</span></span> <span data-ttu-id="b47d0-247">Pokud dáváte přednost, tento soubor JavaScript generování ručně pomocí [nástroje SignalR](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) a zakázat dynamické souboru vytvoření při volání metody MapHubs.</span><span class="sxs-lookup"><span data-stu-id="b47d0-247">If you prefer, you can generate this JavaScript file manually by using [SignalR Utilities](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) and disable dynamic file creation in the MapHubs method call.</span></span>
3. > [!IMPORTANT]
 > <span data-ttu-id="b47d0-248">Ujistěte se, zda soubor JavaScript odkazuje v *StockTicker.html* jsou správné.</span><span class="sxs-lookup"><span data-stu-id="b47d0-248">Make sure that the JavaScript file references in *StockTicker.html* are correct.</span></span> <span data-ttu-id="b47d0-249">To znamená, ujistěte se, že verze jQuery ve vaší značky script (1.10.2 v příkladu) je stejná jako verze jQuery ve vašem projektu *skripty* složku a ujistěte se, že verze SignalR ve vaší značky script je stejný jako funkce SignalR verze ve vašem projektu *skripty* složky.</span><span class="sxs-lookup"><span data-stu-id="b47d0-249">That is, make sure that the jQuery version in your script tag (1.10.2 in the example) is the same as the jQuery version in your project's *Scripts* folder, and make sure that the SignalR version in your script tag is the same as the SignalR version in your project's *Scripts* folder.</span></span> <span data-ttu-id="b47d0-250">V případě potřeby, změňte názvy souborů v značek skriptu.</span><span class="sxs-lookup"><span data-stu-id="b47d0-250">Change the file names in the script tags if necessary.</span></span>
4. <span data-ttu-id="b47d0-251">V **Průzkumníku řešení**, klikněte pravým tlačítkem na *StockTicker.html*a potom klikněte na **nastavit jako úvodní stránku**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-251">In **Solution Explorer**, right-click *StockTicker.html*, and then click **Set as Start Page**.</span></span>
5. <span data-ttu-id="b47d0-252">Vytvořte nový soubor JavaScript ve složce projektu s názvem *StockTicker.js*...</span><span class="sxs-lookup"><span data-stu-id="b47d0-252">Create a new JavaScript file in the project folder and name it *StockTicker.js*..</span></span>
6. <span data-ttu-id="b47d0-253">Kód šablony nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="b47d0-253">Replace the template code with the following code:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample12.js)]

    <span data-ttu-id="b47d0-254">$.connection odkazuje na proxy SignalR.</span><span class="sxs-lookup"><span data-stu-id="b47d0-254">$.connection refers to the SignalR proxies.</span></span> <span data-ttu-id="b47d0-255">Kód získá odkaz na proxy serveru pro třídu StockTickerHub a vloží ho burzovní proměnné.</span><span class="sxs-lookup"><span data-stu-id="b47d0-255">The code gets a reference to the proxy for the StockTickerHub class and puts it in the ticker variable.</span></span> <span data-ttu-id="b47d0-256">Název proxy serveru je název, který byl nastaven atribut [HubName]:</span><span class="sxs-lookup"><span data-stu-id="b47d0-256">The proxy name is the name that was set by the [HubName] attribute:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample13.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample14.cs)]

    <span data-ttu-id="b47d0-257">Jakmile jsou definovány všechny proměnné a funkce, poslední řádek kódu v souboru inicializuje připojení SignalR voláním funkce SignalR start.</span><span class="sxs-lookup"><span data-stu-id="b47d0-257">After all the variables and functions are defined, the last line of code in the file initializes the SignalR connection by calling the SignalR start function.</span></span> <span data-ttu-id="b47d0-258">Funkce start asynchronně provede a vrátí [jQuery odložené objekt](http://api.jquery.com/category/deferred-object/), což znamená, že můžete volat funkci done k určení funkce k volání při dokončení asynchronní operace...</span><span class="sxs-lookup"><span data-stu-id="b47d0-258">The start function executes asynchronously and returns a [jQuery Deferred object](http://api.jquery.com/category/deferred-object/), which means you can call the done function to specify the function to call when the asynchronous operation is completed..</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample15.js)]

    <span data-ttu-id="b47d0-259">Init – funkce volá funkci getAllStocks na serveru a používá informace, které server vrátí uložených tabulku aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="b47d0-259">The init function calls the getAllStocks function on the server and uses the information that the server returns to update the stock table.</span></span> <span data-ttu-id="b47d0-260">Všimněte si, že ve výchozím nastavení, budete muset použít formátu camelCase velká a malá písmena v klientovi sice název metody, pascal použita na serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-260">Notice that by default, you have to use camel casing on the client although the method name is pascal-cased on the server.</span></span> <span data-ttu-id="b47d0-261">Pravidlo formátu camelCase-velká a malá písmena platí jenom pro metody, ne objekty.</span><span class="sxs-lookup"><span data-stu-id="b47d0-261">The camel-casing rule only applies to methods, not objects.</span></span> <span data-ttu-id="b47d0-262">Například odkazujete stock. Symbol a stock. Ceny, není stock.symbol nebo stock.price.</span><span class="sxs-lookup"><span data-stu-id="b47d0-262">For example, you refer to stock.Symbol and stock.Price, not stock.symbol or stock.price.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample16.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample17.cs)]

    <span data-ttu-id="b47d0-263">Pokud jste chtěli v klientovi použít pascal velká a malá písmena, nebo pokud jste chtěli použít název úplně jinou metodu, vám může uspořádání metody rozbočovače s atributem HubMethodName stejným způsobem jako dekorované se třídy rozbočovače s atributem HubName.</span><span class="sxs-lookup"><span data-stu-id="b47d0-263">If you wanted to use pascal casing on the client, or if you wanted to use a completely different method name, you could decorate the Hub method with the HubMethodName attribute the same way you decorated the Hub class itself with the HubName attribute.</span></span>

    <span data-ttu-id="b47d0-264">V metodě init HTML pro řádek tabulky se vytvoří pro každý uložených objekt přijatých ze serveru volání formatStock formát vlastností uložených objektu, a potom pomocí volání mohla nahradit (která je definována v horní části *StockTicker.js*) pro nahrazení zástupných symbolů v proměnné rowTemplate hodnoty vlastností uložených objektu.</span><span class="sxs-lookup"><span data-stu-id="b47d0-264">In the init method, HTML for a table row is created for each stock object received from the server by calling formatStock to format properties of the stock object, and then by calling supplant (which is defined at the top of *StockTicker.js*) to replace placeholders in the rowTemplate variable with the stock object property values.</span></span> <span data-ttu-id="b47d0-265">Výsledný HTML je pak připojí k uložených tabulky.</span><span class="sxs-lookup"><span data-stu-id="b47d0-265">The resulting HTML is then appended to the stock table.</span></span>

    <span data-ttu-id="b47d0-266">Init – lze volat v předáním jako funkce zpětného volání, která spustí po dokončení asynchronního spuštění funkce.</span><span class="sxs-lookup"><span data-stu-id="b47d0-266">You call init by passing it in as a callback function that executes after the asynchronous start function completes.</span></span> <span data-ttu-id="b47d0-267">Pokud jste volali metodu init – jako samostatný příkaz JavaScript po volání metody spuštění funkce by nezdaří, protože by spustit okamžitě bez čekání na spuštění funkce ukončíte navazování připojení.</span><span class="sxs-lookup"><span data-stu-id="b47d0-267">If you called init as a separate JavaScript statement after calling start, the function would fail because it would execute immediately without waiting for the start function to finish establishing the connection.</span></span> <span data-ttu-id="b47d0-268">Init – funkce v takovém případě by se pokusil volat funkci getAllStocks předtím, než je vytvořeno připojení k serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-268">In that case, the init function would try to call the getAllStocks function before the server connection is established.</span></span>

    <span data-ttu-id="b47d0-269">Když se server změní cena stock, volání updateStockPrice na připojené klienty.</span><span class="sxs-lookup"><span data-stu-id="b47d0-269">When the server changes a stock's price, it calls the updateStockPrice on connected clients.</span></span> <span data-ttu-id="b47d0-270">Funkce se přidá do vlastnosti klienta stockTicker proxy serveru je k dispozici na volání ze serveru.</span><span class="sxs-lookup"><span data-stu-id="b47d0-270">The function is added to the client property of the stockTicker proxy in order to make it available to calls from the server.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample18.js)]

    <span data-ttu-id="b47d0-271">Funkce updateStockPrice naformátuje objekt uložených přijatých ze serveru do řádku tabulky na stejném principu jako init – funkce.</span><span class="sxs-lookup"><span data-stu-id="b47d0-271">The updateStockPrice function formats a stock object received from the server into a table row the same way as in the init function.</span></span> <span data-ttu-id="b47d0-272">Připojit řádek do tabulky, je však vyhledá stock aktuální řádek v tabulce a nahradí tento řádek s novým.</span><span class="sxs-lookup"><span data-stu-id="b47d0-272">However, instead of appending the row to the table, it finds the stock's current row in the table and replaces that row with the new one.</span></span>

<a id="test"></a>

## <a name="test-the-application"></a><span data-ttu-id="b47d0-273">Testování aplikace</span><span class="sxs-lookup"><span data-stu-id="b47d0-273">Test the application</span></span>

1. <span data-ttu-id="b47d0-274">Stisknutím klávesy F5 spusťte aplikaci v režimu ladění.</span><span class="sxs-lookup"><span data-stu-id="b47d0-274">Press F5 to run the application in debug mode.</span></span>

    <span data-ttu-id="b47d0-275">V uložených původně tabulce "načítání..." řádku, pak po chvíli trvat, které se zobrazí počáteční uložených dat a spusťte ceny akcií změnit.</span><span class="sxs-lookup"><span data-stu-id="b47d0-275">The stock table initially displays the "loading..." line, then after a short delay the initial stock data is displayed, and then the stock prices start to change.</span></span>

    ![Načítání](tutorial-server-broadcast-with-signalr/_static/image6.png)

    ![Počáteční uložených tabulky](tutorial-server-broadcast-with-signalr/_static/image7.png)

    ![Uložené tabulky přijímat změny ze serveru](tutorial-server-broadcast-with-signalr/_static/image8.png)
2. <span data-ttu-id="b47d0-279">Zkopírujte adresu URL z panelu Adresa prohlížeče a vložte ho do jednoho nebo více nových časových období prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="b47d0-279">Copy the URL from the browser address bar and paste it into one or more new browser window(s).</span></span>

    <span data-ttu-id="b47d0-280">Počáteční uložených zobrazení je stejný jako první prohlížeče a změny nastat současně.</span><span class="sxs-lookup"><span data-stu-id="b47d0-280">The initial stock display is the same as the first browser and changes happen simultaneously.</span></span>
3. <span data-ttu-id="b47d0-281">Zavřít všechny prohlížeče a otevřete nový prohlížeč a přejděte na stejnou adresu URL.</span><span class="sxs-lookup"><span data-stu-id="b47d0-281">Close all browsers and open a new browser, then go to the same URL.</span></span>

    <span data-ttu-id="b47d0-282">Objekt typu singleton StockTicker stále běží na serveru, takže zobrazení uložené tabulka ukazuje, že populací dál zlepšovalo, chcete-li změnit.</span><span class="sxs-lookup"><span data-stu-id="b47d0-282">The StockTicker singleton object has continued to run in the server, so the stock table display shows that the stocks have continued to change.</span></span> <span data-ttu-id="b47d0-283">(Nevidíte počáteční tabulku s nula, změňte následující obrázky.)</span><span class="sxs-lookup"><span data-stu-id="b47d0-283">(You don't see the initial table with zero change figures.)</span></span>
4. <span data-ttu-id="b47d0-284">Zavřete prohlížeč.</span><span class="sxs-lookup"><span data-stu-id="b47d0-284">Close the browser.</span></span>

<a id="enablelogging"></a>

## <a name="enable-logging"></a><span data-ttu-id="b47d0-285">Povolení protokolování</span><span class="sxs-lookup"><span data-stu-id="b47d0-285">Enable logging</span></span>

<span data-ttu-id="b47d0-286">SignalR obsahuje vestavěné protokolování funkci, která můžete povolit na klientovi, které pomáhají při řešení potíží s.</span><span class="sxs-lookup"><span data-stu-id="b47d0-286">SignalR has a built-in logging function that you can enable on the client to aid in troubleshooting.</span></span> <span data-ttu-id="b47d0-287">V této části Povolit protokolování a příklady, které ukazují, jak protokoly oznámením, která z těchto metod přenosu používá SignalR:</span><span class="sxs-lookup"><span data-stu-id="b47d0-287">In this section you enable logging and see examples that show how logs tell you which of the following transport methods SignalR is using:</span></span>

- <span data-ttu-id="b47d0-288">[Technologie WebSockets](http://en.wikipedia.org/wiki/WebSocket)podporovaný IIS 8 a aktuální prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="b47d0-288">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supported by IIS 8 and current browsers.</span></span>
- <span data-ttu-id="b47d0-289">[Server odeslal události](http://en.wikipedia.org/wiki/Server-sent_events)podporovaný prohlížeče než Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="b47d0-289">[Server-sent events](http://en.wikipedia.org/wiki/Server-sent_events), supported by browsers other than Internet Explorer.</span></span>
- <span data-ttu-id="b47d0-290">[Navždy rámce](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), Internet Explorer nepodporuje.</span><span class="sxs-lookup"><span data-stu-id="b47d0-290">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supported by Internet Explorer.</span></span>
- <span data-ttu-id="b47d0-291">[AJAX dlouhé dotazování](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), nepodporuje všechny prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="b47d0-291">[Ajax long polling](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supported by all browsers.</span></span>

<span data-ttu-id="b47d0-292">Funkce SignalR pro dané připojení, vybere nejlepší metody přenosu, který podporuje serveru a klienta.</span><span class="sxs-lookup"><span data-stu-id="b47d0-292">For any given connection, SignalR chooses the best transport method that both the server and the client support.</span></span>

1. <span data-ttu-id="b47d0-293">Otevřete *StockTicker.js* a řádek kódu povolení protokolování bezprostředně před kód, který inicializuje připojení na konci souboru:</span><span class="sxs-lookup"><span data-stu-id="b47d0-293">Open *StockTicker.js* and add a line of code to enable logging immediately before the code that initializes the connection at the end of the file:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample19.js)]
2. <span data-ttu-id="b47d0-294">Stisknutím klávesy F5 spusťte projekt.</span><span class="sxs-lookup"><span data-stu-id="b47d0-294">Press F5 to run the project.</span></span>
3. <span data-ttu-id="b47d0-295">Otevřete okno nástroje pro vývojáře v prohlížeči a vyberte v konzole pro najdete v souborech protokolů.</span><span class="sxs-lookup"><span data-stu-id="b47d0-295">Open your browser's developer tools window, and select the Console to see the logs.</span></span> <span data-ttu-id="b47d0-296">Bude pravděpodobně nutné aktualizovat stránku a najdete v protokolech vyjednávání metodu přenosu pro nové připojení Signalr.</span><span class="sxs-lookup"><span data-stu-id="b47d0-296">You might have to refresh the page to see the logs of Signalr negotiating the transport method for a new connection.</span></span>

    <span data-ttu-id="b47d0-297">Pokud používáte Internet Explorer 10 v systému Windows 8 (IIS 8), metodu přenosu je objekty WebSockets.</span><span class="sxs-lookup"><span data-stu-id="b47d0-297">If you are running Internet Explorer 10 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Konzole IE 10 IIS 8](tutorial-server-broadcast-with-signalr/_static/image9.png)

    <span data-ttu-id="b47d0-299">Pokud aplikace Internet Explorer 10 běží na systému Windows 7 (službu IIS 7.5), metodu přenosu je iframe.</span><span class="sxs-lookup"><span data-stu-id="b47d0-299">If you are running Internet Explorer 10 on Windows 7 (IIS 7.5), the transport method is iframe.</span></span>

    ![IE 10 konzoly, IIS 7.5](tutorial-server-broadcast-with-signalr/_static/image10.png)

    <span data-ttu-id="b47d0-301">Ve Firefoxu nainstalujte doplněk Firebug získat okna konzoly.</span><span class="sxs-lookup"><span data-stu-id="b47d0-301">In Firefox, install the Firebug add-in to get a Console window.</span></span> <span data-ttu-id="b47d0-302">Pokud používáte Firefox 19 v systému Windows 8 (IIS 8), metodu přenosu je objekty WebSockets.</span><span class="sxs-lookup"><span data-stu-id="b47d0-302">If you are running Firefox 19 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Firefox 19 IIS 8 objekty Websockets](tutorial-server-broadcast-with-signalr/_static/image11.png)

    <span data-ttu-id="b47d0-304">Pokud Firefox 19 běží na systému Windows 7 (službu IIS 7.5), je způsob přepravy události odeslané serverem.</span><span class="sxs-lookup"><span data-stu-id="b47d0-304">If you are running Firefox 19 on Windows 7 (IIS 7.5), the transport method is server-sent events.</span></span>

    ![Firefox 19 konzole služby IIS 7.5](tutorial-server-broadcast-with-signalr/_static/image12.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a><span data-ttu-id="b47d0-306">Instalace a zkontrolovat v celé ukázce StockTicker</span><span class="sxs-lookup"><span data-stu-id="b47d0-306">Install and review the full StockTicker sample</span></span>

<span data-ttu-id="b47d0-307">StockTicker aplikaci, která je nainstalována pomocí [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) balíček NuGet obsahuje více funkcí než zjednodušené verzi, kterou jste právě vytvořili od začátku.</span><span class="sxs-lookup"><span data-stu-id="b47d0-307">The StockTicker application that is installed by the [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package includes more features than the simplified version that you just created from scratch.</span></span> <span data-ttu-id="b47d0-308">V této části kurzu nainstalujte balíček NuGet a zkontrolujte nové funkce a kód, který je implementuje.</span><span class="sxs-lookup"><span data-stu-id="b47d0-308">In this section of the tutorial, you install the NuGet package and review the new features and the code that implements them.</span></span> <span data-ttu-id="b47d0-309">Je-li nainstalovat balíček bez předchozích kroků tohoto kurzu, je nutné přidat do projektu třídy pro spuštění OWIN.</span><span class="sxs-lookup"><span data-stu-id="b47d0-309">If you install the package without performing the earlier steps of this tutorial, you must add an OWIN startup class to your project.</span></span> <span data-ttu-id="b47d0-310">Tento krok je vysvětleno v souboru readme.txt pro balíček NuGet.</span><span class="sxs-lookup"><span data-stu-id="b47d0-310">This step is explained in the readme.txt file for the NuGet package.</span></span>

### <a name="install-the-signalrsample-nuget-package"></a><span data-ttu-id="b47d0-311">Nainstalujte balíček SignalR.Sample NuGet</span><span class="sxs-lookup"><span data-stu-id="b47d0-311">Install the SignalR.Sample NuGet package</span></span>

1. <span data-ttu-id="b47d0-312">V **Průzkumníku řešení**, klikněte pravým tlačítkem na projekt a klikněte na **spravovat balíčky NuGet**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-312">In **Solution Explorer**, right-click the project and click **Manage NuGet Packages**.</span></span>
2. <span data-ttu-id="b47d0-313">V **spravovat balíčky NuGet** dialogové okno, klikněte na tlačítko **Online**, zadejte *SignalR.Sample* v **Online hledání** pole a pak klikněte na tlačítko  **Nainstalujte** v **SignalR.Sample** balíčku.</span><span class="sxs-lookup"><span data-stu-id="b47d0-313">In the **Manage NuGet Packages** dialog box, click **Online**, enter *SignalR.Sample* in the **Search Online** box, and then click **Install** in the **SignalR.Sample** package.</span></span>

    ![Instalovat balíček SignalR.Sample](tutorial-server-broadcast-with-signalr/_static/image13.png)
3. <span data-ttu-id="b47d0-315">V **Průzkumníku řešení**, rozbalte *SignalR.Sample* složku, která byla vytvořená při instalaci balíčku SignalR.Sample.</span><span class="sxs-lookup"><span data-stu-id="b47d0-315">In **Solution Explorer**, expand the *SignalR.Sample* folder which was created by installing the SignalR.Sample package.</span></span>
4. <span data-ttu-id="b47d0-316">V *SignalR.Sample* složku, klikněte pravým tlačítkem na *StockTicker.html*a potom klikněte na **nastavit jako úvodní stránku**.</span><span class="sxs-lookup"><span data-stu-id="b47d0-316">In the *SignalR.Sample* folder, right-click *StockTicker.html*, and then click **Set As Start Page**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="b47d0-317">Instalace SignalR.Sample NuGet balíček mohou změnit verzi jQuery, který máte ve vaší *skripty* složky.</span><span class="sxs-lookup"><span data-stu-id="b47d0-317">Installing The SignalR.Sample NuGet package might change the version of jQuery that you have in your *Scripts* folder.</span></span> <span data-ttu-id="b47d0-318">Nové *StockTicker.html* soubor, který nainstaluje balíček *SignalR.Sample* složky budou synchronizována s jQuery verzi, která nainstaluje balíček, ale pokud chcete spustit původní *StockTicker.html* znovu, možná budete muset nejdřív aktualizovat odkaz na jQuery ve značce skriptu.</span><span class="sxs-lookup"><span data-stu-id="b47d0-318">The new *StockTicker.html* file that the package installs in the *SignalR.Sample* folder will be in sync with the jQuery version that the package installs, but if you want to run your original *StockTicker.html* file again, you might have to update the jQuery reference in the script tag first.</span></span>

### <a name="run-the-application"></a><span data-ttu-id="b47d0-319">Spuštění aplikace</span><span class="sxs-lookup"><span data-stu-id="b47d0-319">Run the application</span></span>

1. <span data-ttu-id="b47d0-320">Stisknutím klávesy F5 spusťte aplikaci.</span><span class="sxs-lookup"><span data-stu-id="b47d0-320">Press F5 to run the application.</span></span>

    <span data-ttu-id="b47d0-321">Kromě mřížky, které jste předtím viděli zobrazuje aplikace úplné běžícími vodorovně posouvání okno, které zobrazí stejné uložených data.</span><span class="sxs-lookup"><span data-stu-id="b47d0-321">In addition to the grid that you saw earlier, the full stock ticker application shows a horizontally scrolling window that displays the same stock data.</span></span> <span data-ttu-id="b47d0-322">Při spuštění aplikace pro první "trhu" je "Uzavřeno" a zobrazí statické mřížky a burzovní okno, které není posouvání.</span><span class="sxs-lookup"><span data-stu-id="b47d0-322">When you run the application for the first time, the "market" is "closed" and you see a static grid and a ticker window that isn't scrolling.</span></span>

    ![StockTicker obrazovky start](tutorial-server-broadcast-with-signalr/_static/image14.png)

    <span data-ttu-id="b47d0-324">Když kliknete na tlačítko **otevřete trhu**, **Live burzovní Stock** pole začne vodorovný posun a server se spustí k pravidelně vysílání uložených cena změny v náhodných intervalech.</span><span class="sxs-lookup"><span data-stu-id="b47d0-324">When you click **Open Market**, the **Live Stock Ticker** box starts to scroll horizontally, and the server starts to periodically broadcast stock price changes on a random basis.</span></span> <span data-ttu-id="b47d0-325">Pokaždé, když uložených cena změní, i **Live tabulky Stock** mřížky a **Live burzovní Stock** pole jsou aktualizovány.</span><span class="sxs-lookup"><span data-stu-id="b47d0-325">Each time a stock price changes, both the **Live Stock Table** grid and the **Live Stock Ticker** box are updated.</span></span> <span data-ttu-id="b47d0-326">Pokud je změna ceny stock kladné, stav se zobrazí s zelenou pozadí, když je změna záporná, stav se zobrazí s červeným pozadím.</span><span class="sxs-lookup"><span data-stu-id="b47d0-326">When a stock's price change is positive, the stock is shown with a green background, and when the change is negative, the stock is shown with a red background.</span></span>

    ![Otevřete aplikaci StockTicker trhu](tutorial-server-broadcast-with-signalr/_static/image15.png)

    <span data-ttu-id="b47d0-328">**Zavřít trhu** tlačítko přestane změny a posouvání burzovní, k dispozici a **resetovat** tlačítko obnoví všechny uložených dat do původního stavu před spuštěním cena změny.</span><span class="sxs-lookup"><span data-stu-id="b47d0-328">The **Close Market** button stops the changes and stops the ticker scrolling, and the **Reset** button resets all stock data to the initial state before price changes started.</span></span> <span data-ttu-id="b47d0-329">Pokud otevřete další okna prohlížeče a přejděte na stejnou adresu URL, zobrazí stejná data dynamicky aktualizuje ve stejnou dobu v každé prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="b47d0-329">If you open more browser windows and go to the same URL, you see the same data dynamically updated at the same time in each browser.</span></span> <span data-ttu-id="b47d0-330">Když kliknete na jedno z tlačítek, všechny prohlížeče reagovat stejným způsobem jako ve stejnou dobu.</span><span class="sxs-lookup"><span data-stu-id="b47d0-330">When you click one of the buttons, all browsers respond the same way at the same time.</span></span>

### <a name="live-stock-ticker-display"></a><span data-ttu-id="b47d0-331">Za provozu Stock burzovní zobrazení</span><span class="sxs-lookup"><span data-stu-id="b47d0-331">Live Stock Ticker display</span></span>

<span data-ttu-id="b47d0-332">**Live burzovní Stock** zobrazení je neuspořádaného seznamu v div elementu, který je naformátovaný do jednoho řádku pomocí stylů CSS.</span><span class="sxs-lookup"><span data-stu-id="b47d0-332">The **Live Stock Ticker** display is an unordered list in a div element that is formatted into a single line by CSS styles.</span></span> <span data-ttu-id="b47d0-333">Burzovní je inicializován a aktualizovat stejným způsobem jako v tabulce: nahrazení zástupných symbolů v &lt;li&gt; řetězec šablony a dynamicky přidání &lt;li&gt; elementů &lt;ul&gt; element.</span><span class="sxs-lookup"><span data-stu-id="b47d0-333">The ticker is initialized and updated the same way as the table: by replacing placeholders in a &lt;li&gt; template string and dynamically adding the &lt;li&gt; elements to the &lt;ul&gt; element.</span></span> <span data-ttu-id="b47d0-334">Posouvání se provádí pomocí funkce postupné animaci jQuery k odlišení okraj zprava doleva neuspořádaný seznam v rámci div.</span><span class="sxs-lookup"><span data-stu-id="b47d0-334">The scrolling is performed by using the jQuery animate function to vary the margin-left of the unordered list within the div.</span></span>

<span data-ttu-id="b47d0-335">Burzovní lístek HTML:</span><span class="sxs-lookup"><span data-stu-id="b47d0-335">The stock ticker HTML:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample20.html)]

<span data-ttu-id="b47d0-336">Burzovní lístek šablon stylů CSS:</span><span class="sxs-lookup"><span data-stu-id="b47d0-336">The stock ticker CSS:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample21.html)]

<span data-ttu-id="b47d0-337">Posuňte se jQuery kód, který umožňuje:</span><span class="sxs-lookup"><span data-stu-id="b47d0-337">The jQuery code that makes it scroll:</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample22.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a><span data-ttu-id="b47d0-338">Další metody na serveru, který klient může volat</span><span class="sxs-lookup"><span data-stu-id="b47d0-338">Additional methods on the server that the client can call</span></span>

<span data-ttu-id="b47d0-339">Třída StockTickerHub definuje čtyři další metody, které klient může volat:</span><span class="sxs-lookup"><span data-stu-id="b47d0-339">The StockTickerHub class defines four additional methods that the client can call:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample23.cs)]

<span data-ttu-id="b47d0-340">V reakci na tlačítka v horní části stránky se nazývají OpenMarket, CloseMarket a resetování.</span><span class="sxs-lookup"><span data-stu-id="b47d0-340">OpenMarket, CloseMarket, and Reset are called in response to the buttons at the top of the page.</span></span> <span data-ttu-id="b47d0-341">Vysvětlují vzor jeden klient aktivován změny ve stavu, který je okamžitě rozšířen na všechny klienty.</span><span class="sxs-lookup"><span data-stu-id="b47d0-341">They demonstrate the pattern of one client triggering a change in state that is immediately propagated to all clients.</span></span> <span data-ttu-id="b47d0-342">Každá z těchto metod volá metodu v třídě StockTicker této důsledky stavu trhu změnit a potom vysílá nový stav.</span><span class="sxs-lookup"><span data-stu-id="b47d0-342">Each of these methods calls a method in the StockTicker class that effects the market state change and then broadcasts the new state.</span></span>

<span data-ttu-id="b47d0-343">Ve třídě StockTicker stav na trhu je možný díky MarketState vlastnost, která vrátí hodnotu výčtu MarketState:</span><span class="sxs-lookup"><span data-stu-id="b47d0-343">In the StockTicker class, the state of the market is maintained by a MarketState property that returns a MarketState enum value:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample24.cs)]

<span data-ttu-id="b47d0-344">Každá z metod, které změní stav trhu učinit uvnitř blok zámku protože třída StockTicker musí být threadsafe:</span><span class="sxs-lookup"><span data-stu-id="b47d0-344">Each of the methods that change the market state do so inside a lock block because the StockTicker class has to be threadsafe:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample25.cs)]

<span data-ttu-id="b47d0-345">Pro zajištění threadsafe, tento kód \_marketState pole, která zálohuje vlastnost MarketState je označena jako volatile,</span><span class="sxs-lookup"><span data-stu-id="b47d0-345">To ensure that this code is threadsafe, the \_marketState field that backs the MarketState property is marked as volatile,</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample26.cs)]

<span data-ttu-id="b47d0-346">Metody BroadcastMarketStateChange a BroadcastMarketReset jsou podobné BroadcastStockPrice metoda, kterou jste už viděli, s výjimkou volání různé metody, které jsou definované na straně klienta:</span><span class="sxs-lookup"><span data-stu-id="b47d0-346">The BroadcastMarketStateChange and BroadcastMarketReset methods are similar to the BroadcastStockPrice method that you already saw, except they call different methods defined at the client:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample27.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a><span data-ttu-id="b47d0-347">Další funkce v klientovi, který server můžete volat.</span><span class="sxs-lookup"><span data-stu-id="b47d0-347">Additional functions on the client that the server can call</span></span>

<span data-ttu-id="b47d0-348">Funkce updateStockPrice teď zpracovává mřížky a zobrazení burzovní a používá jQuery.Color na flash červené a zelené barvy.</span><span class="sxs-lookup"><span data-stu-id="b47d0-348">The updateStockPrice function now handles both the grid and the ticker display, and it uses jQuery.Color to flash red and green colors.</span></span>

<span data-ttu-id="b47d0-349">Nové funkce v *SignalR.StockTicker.js* povolení a zákaz tlačítek na základě stavu na trhu, a jejich zastavení nebo spuštění burzovní okno vodorovného posouvání.</span><span class="sxs-lookup"><span data-stu-id="b47d0-349">New functions in *SignalR.StockTicker.js* enable and disable the buttons based on market state, and they stop or start the ticker window horizontal scrolling.</span></span> <span data-ttu-id="b47d0-350">Vzhledem k tomu, že víc funkcí přidávané do ticker.client, [jQuery rozšířit funkce](http://api.jquery.com/jQuery.extend/) se používá k přidání je.</span><span class="sxs-lookup"><span data-stu-id="b47d0-350">Since multiple functions are being added to ticker.client, the [jQuery extend function](http://api.jquery.com/jQuery.extend/) is used to add them.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample28.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a><span data-ttu-id="b47d0-351">Instalace dalších klientských po navázání připojení</span><span class="sxs-lookup"><span data-stu-id="b47d0-351">Additional client setup after establishing the connection</span></span>

<span data-ttu-id="b47d0-352">Po navázání připojení klienta, má některé další práci udělat: zjistíte, pokud je na trhu otevřené nebo uzavřené, aby bylo možné volat příslušné marketOpened nebo marketClosed funkce a volání metody server tlačítka připojit.</span><span class="sxs-lookup"><span data-stu-id="b47d0-352">After the client establishes the connection, it has some additional work to do: find out if the market is open or closed in order to call the appropriate marketOpened or marketClosed function, and attach the server method calls to the buttons.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample29.js)]

<span data-ttu-id="b47d0-353">Metody serveru nejsou svázanou tlačítka až po navázání připojení tak, aby kód nelze pokusit o volání metody server předtím, než jsou k dispozici.</span><span class="sxs-lookup"><span data-stu-id="b47d0-353">The server methods are not wired up to the buttons until after the connection is established, so that the code can't try to call the server methods before they are available.</span></span>

<a id="nextsteps"></a>

## <a name="next-steps"></a><span data-ttu-id="b47d0-354">Další kroky</span><span class="sxs-lookup"><span data-stu-id="b47d0-354">Next steps</span></span>

<span data-ttu-id="b47d0-355">V tomto kurzu jste zjistili, jak programovat aplikace SignalR, která odešle zprávy ze serveru pro všechny připojené klienty v pravidelných intervalech a v reakci na oznámení z jakéhokoli klienta.</span><span class="sxs-lookup"><span data-stu-id="b47d0-355">In this tutorial you've learned how to program a SignalR application that broadcasts messages from the server to all connected clients, both on a periodic basis and in response to notifications from any client.</span></span> <span data-ttu-id="b47d0-356">Vzor pomocí instance Vícevláknová singleton pro uchování stavu serveru také lze také v online herní scénáře více hráčů.</span><span class="sxs-lookup"><span data-stu-id="b47d0-356">The pattern of using a multi-threaded singleton instance to maintain server state can also be also used in multi-player online game scenarios.</span></span> <span data-ttu-id="b47d0-357">Příklad, naleznete v části [ShootR hra, který je založen na SignalR](https://github.com/NTaylorMullen/ShootR).</span><span class="sxs-lookup"><span data-stu-id="b47d0-357">For an example, see [the ShootR game that is based on SignalR](https://github.com/NTaylorMullen/ShootR).</span></span>

<span data-ttu-id="b47d0-358">Podrobné pokyny, které se zobrazí scénáře komunikace peer-to-peer, najdete v části [Začínáme s SignalR](introduction-to-signalr.md) a [aktualizace v reálném čase s SignalR](tutorial-high-frequency-realtime-with-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="b47d0-358">For tutorials that show peer-to-peer communication scenarios, see [Getting Started with SignalR](introduction-to-signalr.md) and [Real-Time Updating with SignalR](tutorial-high-frequency-realtime-with-signalr.md).</span></span>

<span data-ttu-id="b47d0-359">Informace o pokročilejší SignalR vývoj koncepty, najdete na následujících stránkách pro SignalR zdrojového kódu a prostředky:</span><span class="sxs-lookup"><span data-stu-id="b47d0-359">To learn more advanced SignalR development concepts, visit the following sites for SignalR source code and resources:</span></span>

- [<span data-ttu-id="b47d0-360">Funkce SignalR technologie ASP.NET</span><span class="sxs-lookup"><span data-stu-id="b47d0-360">ASP.NET SignalR</span></span>](../../index.md)
- [<span data-ttu-id="b47d0-361">Projekt SignalR</span><span class="sxs-lookup"><span data-stu-id="b47d0-361">SignalR Project</span></span>](http://signalr.net/)
- [<span data-ttu-id="b47d0-362">SignalR Githubu a ukázky</span><span class="sxs-lookup"><span data-stu-id="b47d0-362">SignalR Github and Samples</span></span>](https://github.com/SignalR/SignalR)
- [<span data-ttu-id="b47d0-363">SignalR Wiki</span><span class="sxs-lookup"><span data-stu-id="b47d0-363">SignalR Wiki</span></span>](https://github.com/SignalR/SignalR/wiki)

<span data-ttu-id="b47d0-364">Podrobný postup nasazení aplikace SignalR do Azure, najdete v části [pomocí SignalR s webovými aplikacemi ve službě Azure App Service](../deployment/using-signalr-with-azure-web-sites.md).</span><span class="sxs-lookup"><span data-stu-id="b47d0-364">For a walkthrough on how to deploy a SignalR application to Azure, see [Using SignalR with Web Apps in Azure App Service](../deployment/using-signalr-with-azure-web-sites.md).</span></span> <span data-ttu-id="b47d0-365">Podrobné informace o tom, jak nasadit webový projekt sady Visual Studio na webu systému Windows Azure najdete v tématu [vytvoření webové aplikace ASP.NET ve službě Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).</span><span class="sxs-lookup"><span data-stu-id="b47d0-365">For detailed information about how to deploy a Visual Studio web project to a Windows Azure Web Site, see [Create an ASP.NET web app in Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).</span></span>
