---
uid: signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
title: 'Kurz: Serverové vysílání s knihovnou SignalR 2 | Dokumentace Microsoftu'
author: tdykstra
description: Tento kurz ukazuje, jak vytvořit webovou aplikaci, která používá ASP.NET SignalR 2 pro zajištění všesměrového vysílání funkce serveru. Server vysílání znamená, že commun...
ms.author: riande
ms.date: 10/13/2014
ms.assetid: 1568247f-60b5-4eca-96e0-e661fbb2b273
msc.legacyurl: /signalr/overview/getting-started/tutorial-server-broadcast-with-signalr
msc.type: authoredcontent
ms.openlocfilehash: c2248e68b3c9411687ab6410f12ec85488fe0738
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/16/2018
ms.locfileid: "41755484"
---
<a name="tutorial-server-broadcast-with-signalr-2"></a><span data-ttu-id="68c42-104">Kurz: Serverové vysílání s knihovnou SignalR 2</span><span class="sxs-lookup"><span data-stu-id="68c42-104">Tutorial: Server Broadcast with SignalR 2</span></span>
====================
<span data-ttu-id="68c42-105">podle [Petr Dykstra](https://github.com/tdykstra), [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="68c42-105">by [Tom Dykstra](https://github.com/tdykstra), [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="68c42-106">Tento kurz ukazuje, jak vytvořit webovou aplikaci, která používá ASP.NET SignalR 2 pro zajištění všesměrového vysílání funkce serveru.</span><span class="sxs-lookup"><span data-stu-id="68c42-106">This tutorial shows how to create a web application that uses ASP.NET SignalR 2 to provide server broadcast functionality.</span></span> <span data-ttu-id="68c42-107">Server vysílání znamená, že komunikace klientů jsou spuštěné na serveru.</span><span class="sxs-lookup"><span data-stu-id="68c42-107">Server broadcast means that communications sent to clients are initiated by the server.</span></span> <span data-ttu-id="68c42-108">Tento scénář vyžaduje jiný přístup programovací než peer-to-peer scénářů, jako je chatovací aplikace, ve kterých lze inicializovat komunikace klientů pomocí jedné nebo více klientů.</span><span class="sxs-lookup"><span data-stu-id="68c42-108">This scenario requires a different programming approach than peer-to-peer scenarios such as chat applications, in which communications sent to clients are initiated by one or more of the clients.</span></span>
> 
> <span data-ttu-id="68c42-109">Aplikace, kterou vytvoříte v tomto kurzu simuluje akciích Typický scénář pro vysílání funkce serveru.</span><span class="sxs-lookup"><span data-stu-id="68c42-109">The application that you'll create in this tutorial simulates a stock ticker, a typical scenario for server broadcast functionality.</span></span>
> 
> <span data-ttu-id="68c42-110">Toto téma bylo napsáno původně podle Patrick Fletcher.</span><span class="sxs-lookup"><span data-stu-id="68c42-110">This topic was originally written by Patrick Fletcher.</span></span>
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="68c42-111">V tomto kurzu použili verze softwaru</span><span class="sxs-lookup"><span data-stu-id="68c42-111">Software versions used in the tutorial</span></span>
> 
> 
> - [<span data-ttu-id="68c42-112">Visual Studio 2013</span><span class="sxs-lookup"><span data-stu-id="68c42-112">Visual Studio 2013</span></span>](https://www.microsoft.com/visualstudio/eng/2013-downloads)
> - <span data-ttu-id="68c42-113">.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="68c42-113">.NET 4.5</span></span>
> - <span data-ttu-id="68c42-114">Funkce SignalR verze 2</span><span class="sxs-lookup"><span data-stu-id="68c42-114">SignalR version 2</span></span>
>   
> 
> 
> ## <a name="using-visual-studio-2012-with-this-tutorial"></a><span data-ttu-id="68c42-115">V tomto kurzu pomocí sady Visual Studio 2012</span><span class="sxs-lookup"><span data-stu-id="68c42-115">Using Visual Studio 2012 with this tutorial</span></span>
> 
> 
> <span data-ttu-id="68c42-116">Pokud chcete použít Visual Studio 2012 s tímto kurzem, postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="68c42-116">To use Visual Studio 2012 with this tutorial, do the following:</span></span>
> 
> - <span data-ttu-id="68c42-117">Aktualizace vašeho [Správce balíčků](http://docs.nuget.org/docs/start-here/installing-nuget) na nejnovější verzi.</span><span class="sxs-lookup"><span data-stu-id="68c42-117">Update your [Package Manager](http://docs.nuget.org/docs/start-here/installing-nuget) to the latest version.</span></span>
> - <span data-ttu-id="68c42-118">Nainstalujte [Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx).</span><span class="sxs-lookup"><span data-stu-id="68c42-118">Install the [Web Platform Installer](https://www.microsoft.com/web/downloads/platform.aspx).</span></span>
> - <span data-ttu-id="68c42-119">Instalace webové platformy, vyhledejte a nainstalujte **technologie ASP.NET a webové nástroje 2013.1 pro Visual Studio 2012**.</span><span class="sxs-lookup"><span data-stu-id="68c42-119">In the Web Platform Installer, search for and install **ASP.NET and Web Tools 2013.1 for Visual Studio 2012**.</span></span> <span data-ttu-id="68c42-120">Tím se nainstaluje šablony sady Visual Studio pro funkci SignalR třídy jako **centra**.</span><span class="sxs-lookup"><span data-stu-id="68c42-120">This will install Visual Studio templates for SignalR classes such as **Hub**.</span></span>
> - <span data-ttu-id="68c42-121">Některé šablony (jako například **třídy pro spuštění OWIN**) nebudou k dispozici; pro ty, použijte místo toho soubor třídy.</span><span class="sxs-lookup"><span data-stu-id="68c42-121">Some templates (such as **OWIN Startup Class**) will not be available; for these, use a Class file instead.</span></span>
> 
> 
> ## <a name="tutorial-versions"></a><span data-ttu-id="68c42-122">Kurz verze</span><span class="sxs-lookup"><span data-stu-id="68c42-122">Tutorial Versions</span></span>
> 
> <span data-ttu-id="68c42-123">Informace o předchozích verzích systému SignalR naleznete v tématu [starší verze funkce SignalR](../older-versions/index.md).</span><span class="sxs-lookup"><span data-stu-id="68c42-123">For information about earlier versions of SignalR, see [SignalR Older Versions](../older-versions/index.md).</span></span>
> 
> ## <a name="questions-and-comments"></a><span data-ttu-id="68c42-124">Otázky a komentáře</span><span class="sxs-lookup"><span data-stu-id="68c42-124">Questions and comments</span></span>
> 
> <span data-ttu-id="68c42-125">Napište prosím zpětnou vazbu o tom, jak vám líbilo v tomto kurzu a co můžeme zlepšit v komentářích v dolní části stránky.</span><span class="sxs-lookup"><span data-stu-id="68c42-125">Please leave feedback on how you liked this tutorial and what we could improve in the comments at the bottom of the page.</span></span> <span data-ttu-id="68c42-126">Pokud máte nějaké otázky, které přímo nesouvisejí, najdete v tomto kurzu, můžete je publikovat [fórum ASP.NET SignalR](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) nebo [StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="68c42-126">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com/).</span></span>


## <a name="overview"></a><span data-ttu-id="68c42-127">Přehled</span><span class="sxs-lookup"><span data-stu-id="68c42-127">Overview</span></span>

<span data-ttu-id="68c42-128">V tomto kurzu budete vytvořit akciích aplikace, která dobře vystihuje aplikací v reálném čase, ve kterých chcete pravidelně "push" nebo všesměrového vysílání, oznámení ze serveru na všechny připojené klienty.</span><span class="sxs-lookup"><span data-stu-id="68c42-128">In this tutorial, you'll create a stock ticker application that is representative of real-time applications in which you want to periodically "push," or broadcast, notifications from the server to all connected clients.</span></span> <span data-ttu-id="68c42-129">V první části tohoto kurzu vytvoříte zjednodušenou verzi této aplikace od začátku.</span><span class="sxs-lookup"><span data-stu-id="68c42-129">In the first part of this tutorial, you'll create a simplified version of that application from scratch.</span></span> <span data-ttu-id="68c42-130">Ve zbývající části tohoto kurzu budete instalaci balíčku NuGet, který obsahuje další funkce a prohlédněte si kód pro tyto funkce.</span><span class="sxs-lookup"><span data-stu-id="68c42-130">In the remainder of the tutorial, you'll install a NuGet package that contains additional features, and review the code for those features.</span></span>

<span data-ttu-id="68c42-131">Aplikace, na kterém budete stavět v první části tohoto kurzu zobrazí mřížku s uložených dat.</span><span class="sxs-lookup"><span data-stu-id="68c42-131">The application that you'll build in the first part of this tutorial displays a grid with stock data.</span></span>

![Počáteční verze StockTicker](tutorial-server-broadcast-with-signalr/_static/image1.png)

<span data-ttu-id="68c42-133">Server pravidelně náhodně aktualizuje ceny akcií a nabízených oznámení aktualizace na všechny připojené klienty.</span><span class="sxs-lookup"><span data-stu-id="68c42-133">Periodically the server randomly updates stock prices and pushes the updates to all connected clients.</span></span> <span data-ttu-id="68c42-134">V prohlížeči čísla a symboly **změnit** a **%** dynamicky měnit sloupce v reakci na oznámení ze serveru.</span><span class="sxs-lookup"><span data-stu-id="68c42-134">In the browser the numbers and symbols in the **Change** and **%** columns dynamically change in response to notifications from the server.</span></span> <span data-ttu-id="68c42-135">Pokud otevřete další prohlížeče pro stejnou adresu URL, všechny zobrazit stejná data a stejné změny dat současně.</span><span class="sxs-lookup"><span data-stu-id="68c42-135">If you open additional browsers to the same URL, they all show the same data and the same changes to the data simultaneously.</span></span>

<span data-ttu-id="68c42-136">Tento kurz obsahuje následující části:</span><span class="sxs-lookup"><span data-stu-id="68c42-136">This tutorial contains the following sections:</span></span>

- [<span data-ttu-id="68c42-137">Požadované součásti</span><span class="sxs-lookup"><span data-stu-id="68c42-137">Prerequisites</span></span>](#prerequisites)
- [<span data-ttu-id="68c42-138">Vytvoření projektu</span><span class="sxs-lookup"><span data-stu-id="68c42-138">Create the project</span></span>](#createproject)
- [<span data-ttu-id="68c42-139">Nastavte si do kódu serveru</span><span class="sxs-lookup"><span data-stu-id="68c42-139">Set up the server code</span></span>](#server)
- [<span data-ttu-id="68c42-140">Nastavit kód klienta</span><span class="sxs-lookup"><span data-stu-id="68c42-140">Set up the client code</span></span>](#client)
- [<span data-ttu-id="68c42-141">Testování aplikace</span><span class="sxs-lookup"><span data-stu-id="68c42-141">Test the application</span></span>](#test)
- [<span data-ttu-id="68c42-142">Povolení protokolování</span><span class="sxs-lookup"><span data-stu-id="68c42-142">Enable logging</span></span>](#enablelogging)
- [<span data-ttu-id="68c42-143">Instalace a zkontrolujte úplnou ukázku StockTicker</span><span class="sxs-lookup"><span data-stu-id="68c42-143">Install and review the full StockTicker sample</span></span>](#fullsample)
- [<span data-ttu-id="68c42-144">Další postup</span><span class="sxs-lookup"><span data-stu-id="68c42-144">Next steps</span></span>](#nextsteps)

<span data-ttu-id="68c42-145">[Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) nainstaluje balíček NuGet ukázkové simulované aplikace běžícími v projektu sady Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="68c42-145">The [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package installs a sample simulated stock ticker application in a Visual Studio project.</span></span>

> [!NOTE]
> <span data-ttu-id="68c42-146">Pokud nechcete, aby pro seznámení se základními kroky při vytváření aplikace, můžete nainstalovat balíček SignalR.Sample v novém projektu prázdná webová aplikace ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="68c42-146">If you don't want to work through the steps of building the application, you can install the SignalR.Sample package in a new Empty ASP.NET Web Application project.</span></span> <span data-ttu-id="68c42-147">Při instalaci balíčku NuGet bez provedení kroků v tomto kurzu **musí postupujte podle pokynů v souboru readme.txt**.</span><span class="sxs-lookup"><span data-stu-id="68c42-147">If you install the NuGet package without performing the steps in this tutorial, **you must follow the instructions in the readme.txt file**.</span></span> <span data-ttu-id="68c42-148">Spusťte balíček musíte přidat třídu pro spuštění OWIN, který volá metodu ConfigureSignalR v nainstalovaným balíčkem.</span><span class="sxs-lookup"><span data-stu-id="68c42-148">To run the package you need to add an OWIN startup class which calls the ConfigureSignalR method in the installed package.</span></span> <span data-ttu-id="68c42-149">Pokud nemůžete přidat třídu pro spuštění OWIN, dojde k chybě.</span><span class="sxs-lookup"><span data-stu-id="68c42-149">You will receive an error if you do not add the OWIN startup class.</span></span>


<a id="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="68c42-150">Požadavky</span><span class="sxs-lookup"><span data-stu-id="68c42-150">Prerequisites</span></span>

<span data-ttu-id="68c42-151">Než začnete, ujistěte se, že máte nainstalovanou sadu Visual Studio 2013 ve vašem počítači.</span><span class="sxs-lookup"><span data-stu-id="68c42-151">Before you start, make sure that you have Visual Studio 2013 installed on your computer.</span></span> <span data-ttu-id="68c42-152">Pokud nemáte Visual Studio, přečtěte si téma [ASP.NET stáhne](https://www.asp.net/downloads) zobrazíte na bezplatné sady Visual Studio 2013 Express.</span><span class="sxs-lookup"><span data-stu-id="68c42-152">If you don't have Visual Studio, see [ASP.NET Downloads](https://www.asp.net/downloads) to get the free Visual Studio 2013 Express.</span></span>

<a id="createproject"></a>

## <a name="create-the-project"></a><span data-ttu-id="68c42-153">Vytvoření projektu</span><span class="sxs-lookup"><span data-stu-id="68c42-153">Create the project</span></span>

1. <span data-ttu-id="68c42-154">Z **souboru** nabídky, klikněte na tlačítko **nový projekt**.</span><span class="sxs-lookup"><span data-stu-id="68c42-154">From the **File** menu, click **New Project**.</span></span>
2. <span data-ttu-id="68c42-155">V **nový projekt** dialogového okna rozbalte **jazyka C#** pod **šablony** a vyberte **webové**.</span><span class="sxs-lookup"><span data-stu-id="68c42-155">In the **New Project** dialog box, expand **C#** under **Templates** and select **Web**.</span></span>
3. <span data-ttu-id="68c42-156">Vyberte **prázdná webová aplikace ASP.NET** šablony, pojmenujte projekt *SignalR.StockTicker*a klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="68c42-156">Select the **ASP.NET Empty Web Application** template, name the project *SignalR.StockTicker*, and click **OK**.</span></span>

    ![Dialogové okno Nový projekt](tutorial-server-broadcast-with-signalr/_static/image2.png)
4. <span data-ttu-id="68c42-158">V **nové technologie ASP.NET** okno projektu, ponechejte tuto položku **prázdný** vybraný a klikněte na tlačítko **vytvořit projekt**.</span><span class="sxs-lookup"><span data-stu-id="68c42-158">In the **New ASP.NET** Project window, leave **Empty** selected and click **Create Project**.</span></span>

    ![Dialogové okno Nový projekt ASP](tutorial-server-broadcast-with-signalr/_static/image3.png)

<a id="server"></a>

## <a name="set-up-the-server-code"></a><span data-ttu-id="68c42-160">Nastavte si do kódu serveru</span><span class="sxs-lookup"><span data-stu-id="68c42-160">Set up the server code</span></span>

<span data-ttu-id="68c42-161">V této části můžete nastavit kód, který běží na serveru.</span><span class="sxs-lookup"><span data-stu-id="68c42-161">In this section you set up the code that runs on the server.</span></span>

### <a name="create-the-stock-class"></a><span data-ttu-id="68c42-162">Vytvořte třídu akcií</span><span class="sxs-lookup"><span data-stu-id="68c42-162">Create the Stock class</span></span>

<span data-ttu-id="68c42-163">Začnete vytvořením třídy akcie modelu, které budete používat k ukládání a přenášení informací o stejných akcií.</span><span class="sxs-lookup"><span data-stu-id="68c42-163">You begin by creating the Stock model class that you'll use to store and transmit information about a stock.</span></span>

1. <span data-ttu-id="68c42-164">Vytvořte nový soubor třídy do složky projektu, pojmenujte ho *Stock.cs*a potom nahraďte kód šablony následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="68c42-164">Create a new class file in the project folder, name it *Stock.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample1.cs)]

    <span data-ttu-id="68c42-165">Dvě vlastnosti, které nastavíte při vytváření akcie se symboly (například MSFT pro Microsoft) a ceny.</span><span class="sxs-lookup"><span data-stu-id="68c42-165">The two properties that you'll set when you create stocks are the Symbol (for example, MSFT for Microsoft) and the Price.</span></span> <span data-ttu-id="68c42-166">Ostatní vlastnosti závisí na kdy a jak nastavit cena.</span><span class="sxs-lookup"><span data-stu-id="68c42-166">The other properties depend on how and when you set Price.</span></span> <span data-ttu-id="68c42-167">Při prvním nastavení cen, hodnota získá rozšíří na DayOpen.</span><span class="sxs-lookup"><span data-stu-id="68c42-167">The first time you set Price, the value gets propagated to DayOpen.</span></span> <span data-ttu-id="68c42-168">Následující časy při nastavení cen, změny a PercentChange hodnoty vlastností se počítají podle rozdíl mezi cenou a DayOpen.</span><span class="sxs-lookup"><span data-stu-id="68c42-168">Subsequent times when you set Price, the Change and PercentChange property values are calculated based on the difference between Price and DayOpen.</span></span>

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a><span data-ttu-id="68c42-169">Vytvoření tříd StockTicker a StockTickerHub</span><span class="sxs-lookup"><span data-stu-id="68c42-169">Create the StockTicker and StockTickerHub classes</span></span>

<span data-ttu-id="68c42-170">Rozhraní API pro rozbočovače SignalR budete používat ke zpracování server klient interakce.</span><span class="sxs-lookup"><span data-stu-id="68c42-170">You'll use the SignalR Hub API to handle server-to-client interaction.</span></span> <span data-ttu-id="68c42-171">StockTickerHub třídu odvozenou z třídy rozbočovače SignalR zpracuje, připojení a volání metody přijímají od klientů.</span><span class="sxs-lookup"><span data-stu-id="68c42-171">A StockTickerHub class that derives from the SignalR Hub class will handle receiving connections and method calls from clients.</span></span> <span data-ttu-id="68c42-172">Potřebujete také udržovat uložených dat a spuštění časovače objekt pravidelně aktivovat aktualizaci cen, nezávisle na připojení klientů.</span><span class="sxs-lookup"><span data-stu-id="68c42-172">You also need to maintain stock data and run a Timer object to periodically trigger price updates, independently of client connections.</span></span> <span data-ttu-id="68c42-173">Tyto funkce nelze vložit ve třídě centra vzhledem k tomu, že jsou přechodné instance rozbočovače.</span><span class="sxs-lookup"><span data-stu-id="68c42-173">You can't put these functions in a Hub class, because Hub instances are transient.</span></span> <span data-ttu-id="68c42-174">Pro každou operaci v rozbočovači, jako je například připojení a volání od klienta k serveru se vytvoří instance třídy rozbočovače.</span><span class="sxs-lookup"><span data-stu-id="68c42-174">A Hub class instance is created for each operation on the hub, such as connections and calls from the client to the server.</span></span> <span data-ttu-id="68c42-175">Mechanismus, který zajišťuje uložených dat, aktualizuje ceny a vysílá aktualizaci cen má ke spuštění v samostatné třídě, která bude název StockTicker.</span><span class="sxs-lookup"><span data-stu-id="68c42-175">So the mechanism that keeps stock data, updates prices, and broadcasts the price updates has to run in a separate class, which you'll name StockTicker.</span></span>

![Všesměrové vysílání z StockTicker](tutorial-server-broadcast-with-signalr/_static/image5.png)

<span data-ttu-id="68c42-177">Chcete pouze jedna instance třídy StockTicker ke spuštění na serveru, takže budete muset nastavit odkaz z každé instance StockTickerHub StockTicker instanci typu singleton.</span><span class="sxs-lookup"><span data-stu-id="68c42-177">You only want one instance of the StockTicker class to run on the server, so you'll need to set up a reference from each StockTickerHub instance to the singleton StockTicker instance.</span></span> <span data-ttu-id="68c42-178">Třída StockTicker musí umět vysílat pro klienty, protože má uložených dat a aktivuje aktualizace, ale StockTicker není třída rozbočovače.</span><span class="sxs-lookup"><span data-stu-id="68c42-178">The StockTicker class has to be able to broadcast to clients because it has the stock data and triggers updates, but StockTicker is not a Hub class.</span></span> <span data-ttu-id="68c42-179">Proto má třída StockTicker k získání odkazu na objekt kontextu připojení rozbočovače SignalR.</span><span class="sxs-lookup"><span data-stu-id="68c42-179">Therefore, the StockTicker class has to get a reference to the SignalR Hub connection context object.</span></span> <span data-ttu-id="68c42-180">Pak můžete objekt context připojení SignalR na klienty.</span><span class="sxs-lookup"><span data-stu-id="68c42-180">It can then use the SignalR connection context object to broadcast to clients.</span></span>

1. <span data-ttu-id="68c42-181">V **Průzkumníka řešení**, klikněte pravým tlačítkem na projekt a klikněte na tlačítko **přidat | Třída rozbočovače SignalR (v2)**.</span><span class="sxs-lookup"><span data-stu-id="68c42-181">In **Solution Explorer**, right-click the project and click **Add | SignalR Hub Class (v2)**.</span></span>
2. <span data-ttu-id="68c42-182">Název nového centra *StockTickerHub.cs*a potom klikněte na tlačítko **přidat**.</span><span class="sxs-lookup"><span data-stu-id="68c42-182">Name the new hub *StockTickerHub.cs*, and then click **Add**.</span></span> <span data-ttu-id="68c42-183">Balíčky SignalR NuGet se přidají do vašeho projektu.</span><span class="sxs-lookup"><span data-stu-id="68c42-183">SignalR NuGet packages will be added to your project.</span></span>
3. <span data-ttu-id="68c42-184">Nahraďte kód šablony následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="68c42-184">Replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample2.cs)]

    <span data-ttu-id="68c42-185">[Centra](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) třída se používá k definování metody klienty můžete volat na serveru.</span><span class="sxs-lookup"><span data-stu-id="68c42-185">The [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) class is used to define methods the clients can call on the server.</span></span> <span data-ttu-id="68c42-186">Definujete jednu metodu: `GetAllStocks()`.</span><span class="sxs-lookup"><span data-stu-id="68c42-186">You are defining one method: `GetAllStocks()`.</span></span> <span data-ttu-id="68c42-187">Když klient se nejprve připojí k serveru, bude volat tuto metodu za účelem získání seznamu všech zásob s jejich aktuální ceny.</span><span class="sxs-lookup"><span data-stu-id="68c42-187">When a client initially connects to the server, it will call this method to get a list of all of the stocks with their current prices.</span></span> <span data-ttu-id="68c42-188">Metoda může provést synchronně a vrátit `IEnumerable<Stock>` vzhledem k tomu, že ji vrací data z paměti.</span><span class="sxs-lookup"><span data-stu-id="68c42-188">The method can execute synchronously and return `IEnumerable<Stock>` because it is returning data from memory.</span></span> <span data-ttu-id="68c42-189">Pokud má metodu k získání dat tímto způsobem něco, co by vyžadovalo čekání, jako je například vyhledávání v databázi nebo volání webové služby, zadali byste `Task<IEnumerable<Stock>>` jako návratovou hodnotu k povolení asynchronního zpracování.</span><span class="sxs-lookup"><span data-stu-id="68c42-189">If the method had to get the data by doing something that would involve waiting, such as a database lookup or a web service call, you would specify `Task<IEnumerable<Stock>>` as the return value to enable asynchronous processing.</span></span> <span data-ttu-id="68c42-190">Další informace najdete v tématu [ASP.NET pokyny k rozhraní API Center SignalR - Server - kdy spustit asynchronně](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).</span><span class="sxs-lookup"><span data-stu-id="68c42-190">For more information, see [ASP.NET SignalR Hubs API Guide - Server - When to execute asynchronously](../guide-to-the-api/hubs-api-guide-server.md#asyncmethods).</span></span>

    <span data-ttu-id="68c42-191">HubName atribut určuje, jak se bude odkazovat centrum v kódu jazyka JavaScript na straně klienta.</span><span class="sxs-lookup"><span data-stu-id="68c42-191">The HubName attribute specifies how the Hub will be referenced in JavaScript code on the client.</span></span> <span data-ttu-id="68c42-192">Výchozí název na straně klienta, pokud nepoužijete tento atribut je verze název třídy, kterou v tomto případě by stockTickerHub-ve formátu camelCase.</span><span class="sxs-lookup"><span data-stu-id="68c42-192">The default name on the client if you don't use this attribute is a camel-cased version of the class name, which in this case would be stockTickerHub.</span></span>

    <span data-ttu-id="68c42-193">Jak uvidíte později při vytváření třídy StockTicker, se vytvoří instanci typu singleton této třídy v jeho statickou vlastnost Instance.</span><span class="sxs-lookup"><span data-stu-id="68c42-193">As you'll see later when you create the StockTicker class, a singleton instance of that class is created in its static Instance property.</span></span> <span data-ttu-id="68c42-194">Instanci typu singleton StockTicker zůstanou v paměti bez ohledu na to, kolik klientů připojovat nebo odpojovat, a tato instance je metoda GetAllStocks používá k vrácení aktuální základní informace o.</span><span class="sxs-lookup"><span data-stu-id="68c42-194">That singleton instance of StockTicker remains in memory no matter how many clients connect or disconnect, and that instance is what the GetAllStocks method uses to return current stock information.</span></span>
4. <span data-ttu-id="68c42-195">Vytvořte nový soubor třídy do složky projektu, pojmenujte ho *StockTicker.cs*a potom nahraďte kód šablony následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="68c42-195">Create a new class file in the project folder, name it *StockTicker.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample3.cs)]

    <span data-ttu-id="68c42-196">Protože více vláken používat stejnou instanci StockTicker kódu, musí být threadsafe StockTicker třídy.</span><span class="sxs-lookup"><span data-stu-id="68c42-196">Since multiple threads will be running the same instance of StockTicker code, the StockTicker class has to be threadsafe.</span></span>

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a><span data-ttu-id="68c42-197">Instanci typu singleton ukládání do statických polí</span><span class="sxs-lookup"><span data-stu-id="68c42-197">Storing the singleton instance in a static field</span></span>

    <span data-ttu-id="68c42-198">Kód inicializuje statické \_pole instance, která zálohuje vlastnost Instance s instancí třídy, a to je jedinou instanci třídy, která mohou být vytvořeny, protože konstruktor je označený jako privátní.</span><span class="sxs-lookup"><span data-stu-id="68c42-198">The code initializes the static \_instance field that backs the Instance property with an instance of the class, and this is the only instance of the class that can be created, because the constructor is marked as private.</span></span> <span data-ttu-id="68c42-199">[Opožděná inicializace](https://msdn.microsoft.com/library/dd997286.aspx) se používá pro \_pole instance, není kvůli výkonu ale pokud chcete zajistit, že vytvoření instance threadsafe.</span><span class="sxs-lookup"><span data-stu-id="68c42-199">[Lazy initialization](https://msdn.microsoft.com/library/dd997286.aspx) is used for the \_instance field, not for performance reasons but to ensure that the instance creation is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample4.cs)]

    <span data-ttu-id="68c42-200">Pokaždé, když klient připojí k serveru, novou instanci třídy StockTickerHub spuštěna v samostatném vlákně získává instanci typu singleton StockTicker z StockTicker.Instance statické vlastnosti, kterou jste předtím viděli StockTickerHub třídy.</span><span class="sxs-lookup"><span data-stu-id="68c42-200">Each time a client connects to the server, a new instance of the StockTickerHub class running in a separate thread gets the StockTicker singleton instance from the StockTicker.Instance static property, as you saw earlier in the StockTickerHub class.</span></span>

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a><span data-ttu-id="68c42-201">Ukládání dat uložených v ConcurrentDictionary</span><span class="sxs-lookup"><span data-stu-id="68c42-201">Storing stock data in a ConcurrentDictionary</span></span>

    <span data-ttu-id="68c42-202">Konstruktor inicializuje \_akcie kolekce s určitými ukázkových uložených dat a GetAllStocks vrátí zásob.</span><span class="sxs-lookup"><span data-stu-id="68c42-202">The constructor initializes the \_stocks collection with some sample stock data, and GetAllStocks returns the stocks.</span></span> <span data-ttu-id="68c42-203">Jak jste viděli již dříve, je této kolekce akcie zase vrácený StockTickerHub.GetAllStocks, což je metoda serveru ve třídě rozbočovače, který klienti mohou volat.</span><span class="sxs-lookup"><span data-stu-id="68c42-203">As you saw earlier, this collection of stocks is in turn returned by StockTickerHub.GetAllStocks which is a server method in the Hub class that clients can call.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample5.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample6.cs)]

    <span data-ttu-id="68c42-204">Kolekce akcie je definován jako [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) typ pro bezpečný přístup z více vláken.</span><span class="sxs-lookup"><span data-stu-id="68c42-204">The stocks collection is defined as a [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) type for thread safety.</span></span> <span data-ttu-id="68c42-205">Jako alternativu můžete použít [slovníku](https://msdn.microsoft.com/library/xfhwa508.aspx) objektu a explicitně zamknout slovníku, když provedete změny.</span><span class="sxs-lookup"><span data-stu-id="68c42-205">As an alternative, you could use a [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) object and explicitly lock the dictionary when you make changes to it.</span></span>

    <span data-ttu-id="68c42-206">V této ukázkové aplikaci je OK k ukládání dat aplikací v paměti a ke ztrátě dat při uvolnění StockTicker instance.</span><span class="sxs-lookup"><span data-stu-id="68c42-206">For this sample application, it's OK to store application data in memory and to lose the data when the StockTicker instance is disposed.</span></span> <span data-ttu-id="68c42-207">V reálné aplikaci když pracujete s back endovým datům úložiště, například do databáze.</span><span class="sxs-lookup"><span data-stu-id="68c42-207">In a real application you would work with a back-end data store such as a database.</span></span>

    ### <a name="periodically-updating-stock-prices"></a><span data-ttu-id="68c42-208">Pravidelně aktualizuje cenami akcií</span><span class="sxs-lookup"><span data-stu-id="68c42-208">Periodically updating stock prices</span></span>

    <span data-ttu-id="68c42-209">Konstruktor spuštění objekt časovače, která pravidelně volá metody, které aktualizují cenami akcií v náhodných intervalech.</span><span class="sxs-lookup"><span data-stu-id="68c42-209">The constructor starts up a Timer object that periodically calls methods that update stock prices on a random basis.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample7.cs)]

    <span data-ttu-id="68c42-210">UpdateStockPrices je volán časovač, který předá hodnotu null v parametru state.</span><span class="sxs-lookup"><span data-stu-id="68c42-210">UpdateStockPrices is called by the Timer, which passes in null in the state parameter.</span></span> <span data-ttu-id="68c42-211">Před aktualizací ceny, je pořízené Zámek \_updateStockPricesLock objektu.</span><span class="sxs-lookup"><span data-stu-id="68c42-211">Before updating prices, a lock is taken on the \_updateStockPricesLock object.</span></span> <span data-ttu-id="68c42-212">Kód zkontroluje, zda jiné vlákno se už aktualizuje ceny, a pak zavolá TryUpdateStockPrice na každé populace v seznamu.</span><span class="sxs-lookup"><span data-stu-id="68c42-212">The code checks if another thread is already updating prices, and then it calls TryUpdateStockPrice on each stock in the list.</span></span> <span data-ttu-id="68c42-213">Metoda TryUpdateStockPrice rozhodne, zda se má změnit akcií a kolik ho změnit.</span><span class="sxs-lookup"><span data-stu-id="68c42-213">The TryUpdateStockPrice method decides whether to change the stock price, and how much to change it.</span></span> <span data-ttu-id="68c42-214">Pokud se změní minimální cenu akcie BroadcastStockPrice je volána k vysílání změnit minimální cenu akcie pro všechny připojené klienty.</span><span class="sxs-lookup"><span data-stu-id="68c42-214">If the stock price is changed, BroadcastStockPrice is called to broadcast the stock price change to all connected clients.</span></span>

    <span data-ttu-id="68c42-215">\_UpdatingStockPrices příznak je označen jako [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) tak, aby byl přístup k němu threadsafe.</span><span class="sxs-lookup"><span data-stu-id="68c42-215">The \_updatingStockPrices flag is marked as [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) to ensure that access to it is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample8.cs)]

    <span data-ttu-id="68c42-216">V reálné aplikaci by metoda TryUpdateStockPrice volání webové služby k vyhledání ceny; Tento kód použije generátor náhodných čísel náhodně provádět změny.</span><span class="sxs-lookup"><span data-stu-id="68c42-216">In a real application, the TryUpdateStockPrice method would call a web service to look up the price; in this code it uses a random number generator to make changes randomly.</span></span>

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a><span data-ttu-id="68c42-217">Získávání kontextu SignalR tak, aby třída StockTicker můžete vysílat pro klienty</span><span class="sxs-lookup"><span data-stu-id="68c42-217">Getting the SignalR context so that the StockTicker class can broadcast to clients</span></span>

    <span data-ttu-id="68c42-218">Protože změny cen pocházejí z objektu StockTicker tady, jedná se o objekt, který je potřeba zavolat metodu updateStockPrice na všechny připojené klienty.</span><span class="sxs-lookup"><span data-stu-id="68c42-218">Because the price changes originate here in the StockTicker object, this is the object that needs to call an updateStockPrice method on all connected clients.</span></span> <span data-ttu-id="68c42-219">Ve třídě rozbočovače máte rozhraní API pro volání metody klienta, ale StockTicker nedědí ze třídy rozbočovače a nemá odkaz na libovolný objekt rozbočovače.</span><span class="sxs-lookup"><span data-stu-id="68c42-219">In a Hub class you have an API for calling client methods, but StockTicker does not derive from the Hub class and does not have a reference to any Hub object.</span></span> <span data-ttu-id="68c42-220">Proto aby bylo možné vysílání připojeným klientům, StockTicker třídy musí získat instance kontextu SignalR pro třídu StockTickerHub, který budete používat pro volání metod na klientských počítačích.</span><span class="sxs-lookup"><span data-stu-id="68c42-220">Therefore, in order to broadcast to connected clients, the StockTicker class has to get the SignalR context instance for the StockTickerHub class and use that to call methods on clients.</span></span>

    <span data-ttu-id="68c42-221">Kód získá odkaz na kontext SignalR při vytváření instance třídy singleton, předá, které odkazují na konstruktoru, a umístí jej konstruktoru vlastnost klientů.</span><span class="sxs-lookup"><span data-stu-id="68c42-221">The code gets a reference to the SignalR context when it creates the singleton class instance, passes that reference to the constructor, and the constructor puts it in the Clients property.</span></span>

    <span data-ttu-id="68c42-222">Existují dva důvody, proč chcete přijímat pouze jednou kontextu: získání kontextu je náročná operace a jednou pro spolupráci se zajistí zachování zamýšleném pořadí zpráv odeslaných do klientů.</span><span class="sxs-lookup"><span data-stu-id="68c42-222">There are two reasons why you want to get the context just once: getting the context is an expensive operation, and getting it once ensures that the intended order of messages sent to clients is preserved.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample9.cs)]

    <span data-ttu-id="68c42-223">Získání vlastnosti klienti kontextu a umístit ho do vlastnost StockTickerClient umožňuje napsat kód pro volání metody klienta, která vypadá stejně jako by tomu bylo v třídě rozbočovače.</span><span class="sxs-lookup"><span data-stu-id="68c42-223">Getting the Clients property of the context and putting it in the StockTickerClient property lets you write code to call client methods that looks the same as it would in a Hub class.</span></span> <span data-ttu-id="68c42-224">Například na všechny klienty můžete napsat Clients.All.updateStockPrice(stock).</span><span class="sxs-lookup"><span data-stu-id="68c42-224">For instance, to broadcast to all clients you can write Clients.All.updateStockPrice(stock).</span></span>

    <span data-ttu-id="68c42-225">Metoda updateStockPrice, který voláte v BroadcastStockPrice ještě; neexistuje přidáte je později při psaní kódu, který běží na straně klienta.</span><span class="sxs-lookup"><span data-stu-id="68c42-225">The updateStockPrice method that you are calling in BroadcastStockPrice doesn't exist yet; you'll add it later when you write code that runs on the client.</span></span> <span data-ttu-id="68c42-226">Najdete zde updateStockPrice protože Clients.All je dynamická, což znamená, že výraz se vyhodnotí za běhu.</span><span class="sxs-lookup"><span data-stu-id="68c42-226">You can refer to updateStockPrice here because Clients.All is dynamic, which means the expression will be evaluated at runtime.</span></span> <span data-ttu-id="68c42-227">Při volání této metody se spustí, SignalR pošle názvu metody a hodnota parametru klienta a pokud klient má metodu s názvem updateStockPrice, zavolá tato metoda a hodnota parametru se předají do ní.</span><span class="sxs-lookup"><span data-stu-id="68c42-227">When this method call executes, SignalR will send the method name and the parameter value to the client, and if the client has a method named updateStockPrice, that method will be called and the parameter value will be passed to it.</span></span>

    <span data-ttu-id="68c42-228">Clients.All znamená, že odesílání pro všechny klienty.</span><span class="sxs-lookup"><span data-stu-id="68c42-228">Clients.All means send to all clients.</span></span> <span data-ttu-id="68c42-229">Funkce SignalR poskytuje další možnosti k určení, které klienti nebo skupiny klientů k odeslání.</span><span class="sxs-lookup"><span data-stu-id="68c42-229">SignalR gives you other options to specify which clients or groups of clients to send to.</span></span> <span data-ttu-id="68c42-230">Další informace najdete v tématu [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="68c42-230">For more information, see [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span></span>

### <a name="register-the-signalr-route"></a><span data-ttu-id="68c42-231">Zaregistrujte směrování funkce SignalR</span><span class="sxs-lookup"><span data-stu-id="68c42-231">Register the SignalR route</span></span>

<span data-ttu-id="68c42-232">Server musí znát adresu URL, která je pro zachycení a přístupem k systému SignalR.</span><span class="sxs-lookup"><span data-stu-id="68c42-232">The server needs to know which URL to intercept and direct to SignalR.</span></span> <span data-ttu-id="68c42-233">K tomu, přidejte třídu OWIN při spuštění:</span><span class="sxs-lookup"><span data-stu-id="68c42-233">To do that, add an OWIN startup class:</span></span>

1. <span data-ttu-id="68c42-234">V **Průzkumníka řešení**, klikněte pravým tlačítkem na projekt a potom klikněte na tlačítko **přidat | Třídy pro spuštění OWIN**.</span><span class="sxs-lookup"><span data-stu-id="68c42-234">In **Solution Explorer**, right-click the project, and then click **Add | OWIN Startup Class**.</span></span> <span data-ttu-id="68c42-235">Název třídy **Startup.cs**.</span><span class="sxs-lookup"><span data-stu-id="68c42-235">Name the class **Startup.cs**.</span></span>
2. <span data-ttu-id="68c42-236">Nahraďte kód v **Startup.cs** následujícím kódem.</span><span class="sxs-lookup"><span data-stu-id="68c42-236">Replace the code in **Startup.cs** with the following.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample10.cs)]

<span data-ttu-id="68c42-237">Teď jste dokončili nastavení do kódu serveru.</span><span class="sxs-lookup"><span data-stu-id="68c42-237">You have now completed setting up the server code.</span></span> <span data-ttu-id="68c42-238">V další části budete nastavení klienta.</span><span class="sxs-lookup"><span data-stu-id="68c42-238">In the next section you'll set up the client.</span></span>

<a id="client"></a>

## <a name="set-up-the-client-code"></a><span data-ttu-id="68c42-239">Nastavit kód klienta</span><span class="sxs-lookup"><span data-stu-id="68c42-239">Set up the client code</span></span>

1. <span data-ttu-id="68c42-240">Vytvořte nový soubor HTML ve složce projektu a pojmenujte ho *StockTicker.html*.</span><span class="sxs-lookup"><span data-stu-id="68c42-240">Create a new HTML file in the project folder, and name it *StockTicker.html*.</span></span>
2. <span data-ttu-id="68c42-241">Nahraďte kód šablony následujícím kódem.</span><span class="sxs-lookup"><span data-stu-id="68c42-241">Replace the template code with the following code.</span></span>

    [!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample11.html)]

    <span data-ttu-id="68c42-242">Kód HTML vytvoří tabulku s 5 sloupci, řádek záhlaví a řádek dat s jedinou buňku, která překlenuje všechny sloupce 5.</span><span class="sxs-lookup"><span data-stu-id="68c42-242">The HTML creates a table with 5 columns, a header row, and a data row with a single cell that spans all 5 columns.</span></span> <span data-ttu-id="68c42-243">Řádek dat se zobrazí "..." načítání"a bude se zobrazovat jenom krátkodobě při spuštění aplikace.</span><span class="sxs-lookup"><span data-stu-id="68c42-243">The data row displays "loading..." and will only be shown momentarily when the application starts.</span></span> <span data-ttu-id="68c42-244">Kód jazyka JavaScript se odebrat tento řádek a přidat v místě řádky s uložených dat načtených ze serveru.</span><span class="sxs-lookup"><span data-stu-id="68c42-244">JavaScript code will remove that row and add in its place rows with stock data retrieved from the server.</span></span>

    <span data-ttu-id="68c42-245">Značky skriptu zadat soubor skriptu jQuery, soubor skriptu core SignalR, soubor skriptu proxy SignalR a StockTicker soubor skriptu, který později vytvoříte.</span><span class="sxs-lookup"><span data-stu-id="68c42-245">The script tags specify the jQuery script file, the SignalR core script file, the SignalR proxies script file, and a StockTicker script file that you'll create later.</span></span> <span data-ttu-id="68c42-246">Soubor skriptu proxy SignalR, který určuje adresu URL "/ signalr/centra", generuje dynamicky a v tomto případě definuje metody proxy pro metody u třídy rozbočovače pro StockTickerHub.GetAllStocks.</span><span class="sxs-lookup"><span data-stu-id="68c42-246">The SignalR proxies script file, which specifies the "/signalr/hubs" URL, is dynamically generated and defines proxy methods for the methods on the Hub class, in this case for StockTickerHub.GetAllStocks.</span></span> <span data-ttu-id="68c42-247">Pokud dáváte přednost, tento soubor JavaScript vygenerovat ručně pomocí [nástroje SignalR](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) a vytváření dynamického souborů ve volání metody MapHubs zakázat.</span><span class="sxs-lookup"><span data-stu-id="68c42-247">If you prefer, you can generate this JavaScript file manually by using [SignalR Utilities](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) and disable dynamic file creation in the MapHubs method call.</span></span>
3. > [!IMPORTANT]
   > <span data-ttu-id="68c42-248">Ujistěte se, že odkazuje na soubor jazyka JavaScript v *StockTicker.html* jsou správné.</span><span class="sxs-lookup"><span data-stu-id="68c42-248">Make sure that the JavaScript file references in *StockTicker.html* are correct.</span></span> <span data-ttu-id="68c42-249">To znamená, ujistěte se, že jQuery verze v vaši značku skriptu (v příkladu 1.10.2) je stejná jako verze jQuery ve vašem projektu *skripty* složky a ujistěte se, že verze SignalR v vaši značku skriptu je stejný jako funkce SignalR verze ve vašem projektu *skripty* složky.</span><span class="sxs-lookup"><span data-stu-id="68c42-249">That is, make sure that the jQuery version in your script tag (1.10.2 in the example) is the same as the jQuery version in your project's *Scripts* folder, and make sure that the SignalR version in your script tag is the same as the SignalR version in your project's *Scripts* folder.</span></span> <span data-ttu-id="68c42-250">Změňte názvy souborů v značek skriptu, v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="68c42-250">Change the file names in the script tags if necessary.</span></span>
4. <span data-ttu-id="68c42-251">V **Průzkumníka řešení**, klikněte pravým tlačítkem na *StockTicker.html*a potom klikněte na tlačítko **nastavit jako úvodní stránku**.</span><span class="sxs-lookup"><span data-stu-id="68c42-251">In **Solution Explorer**, right-click *StockTicker.html*, and then click **Set as Start Page**.</span></span>
5. <span data-ttu-id="68c42-252">Vytvořte nový soubor JavaScript ve složce projektu s názvem *StockTicker.js*...</span><span class="sxs-lookup"><span data-stu-id="68c42-252">Create a new JavaScript file in the project folder and name it *StockTicker.js*..</span></span>
6. <span data-ttu-id="68c42-253">Nahraďte kód šablony následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="68c42-253">Replace the template code with the following code:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample12.js)]

    <span data-ttu-id="68c42-254">$.connection odkazuje na proxy služby SignalR.</span><span class="sxs-lookup"><span data-stu-id="68c42-254">$.connection refers to the SignalR proxies.</span></span> <span data-ttu-id="68c42-255">Kód získá odkaz na proxy serveru pro třídu StockTickerHub a umístí jej do proměnné akcie.</span><span class="sxs-lookup"><span data-stu-id="68c42-255">The code gets a reference to the proxy for the StockTickerHub class and puts it in the ticker variable.</span></span> <span data-ttu-id="68c42-256">Název proxy serveru je název, který se nastavuje atribut [HubName]:</span><span class="sxs-lookup"><span data-stu-id="68c42-256">The proxy name is the name that was set by the [HubName] attribute:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample13.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample14.cs)]

    <span data-ttu-id="68c42-257">Po definování proměnné a funkce jsou poslední řádek kódu v souboru inicializuje připojení SignalR volání start funkce SignalR.</span><span class="sxs-lookup"><span data-stu-id="68c42-257">After all the variables and functions are defined, the last line of code in the file initializes the SignalR connection by calling the SignalR start function.</span></span> <span data-ttu-id="68c42-258">Spuštění funkce asynchronně provede a vrátí [jQuery odloženo objekt](http://api.jquery.com/category/deferred-object/), což znamená, že může volat funkci Hotovo k určení funkce, která má být volána po dokončení asynchronní operace...</span><span class="sxs-lookup"><span data-stu-id="68c42-258">The start function executes asynchronously and returns a [jQuery Deferred object](http://api.jquery.com/category/deferred-object/), which means you can call the done function to specify the function to call when the asynchronous operation is completed..</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample15.js)]

    <span data-ttu-id="68c42-259">Init – funkce volá funkci getAllStocks na serveru a používá informace, který server vrátí aktualizace základní tabulky.</span><span class="sxs-lookup"><span data-stu-id="68c42-259">The init function calls the getAllStocks function on the server and uses the information that the server returns to update the stock table.</span></span> <span data-ttu-id="68c42-260">Všimněte si, že ve výchozím nastavení, budete muset použít ve formátu camelCase malá a velká písmena na straně klienta i název metody je – jazyka Pascal – na serveru.</span><span class="sxs-lookup"><span data-stu-id="68c42-260">Notice that by default, you have to use camel casing on the client although the method name is pascal-cased on the server.</span></span> <span data-ttu-id="68c42-261">Pravidlo camel-velká a malá písmena platí pouze pro metody, ne objekty.</span><span class="sxs-lookup"><span data-stu-id="68c42-261">The camel-casing rule only applies to methods, not objects.</span></span> <span data-ttu-id="68c42-262">Například můžete odkazovat na skladě. Symbol a akcie. Cena, ne stock.symbol nebo stock.price.</span><span class="sxs-lookup"><span data-stu-id="68c42-262">For example, you refer to stock.Symbol and stock.Price, not stock.symbol or stock.price.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample16.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample17.cs)]

    <span data-ttu-id="68c42-263">Pokud jste chtěli použít malých a velkých písmen pascal na straně klienta, nebo pokud jste chtěli použít název úplně jiné metody, vám může vylepšení centra metodu s atributem HubMethodName stejným způsobem upravena třídy rozbočovače s atributem HubName.</span><span class="sxs-lookup"><span data-stu-id="68c42-263">If you wanted to use pascal casing on the client, or if you wanted to use a completely different method name, you could decorate the Hub method with the HubMethodName attribute the same way you decorated the Hub class itself with the HubName attribute.</span></span>

    <span data-ttu-id="68c42-264">V metodě inicializace kód HTML pro řádek tabulky se vytvoří pro každou skladový objekt přijatých ze serveru volání formatStock na formát vlastnosti skladový objekt a potom volala mohla nahradit (která je definovaná v horní části *StockTicker.js*) nahraďte zástupné symboly v proměnné rowTemplate hodnoty vlastností skladový objekt.</span><span class="sxs-lookup"><span data-stu-id="68c42-264">In the init method, HTML for a table row is created for each stock object received from the server by calling formatStock to format properties of the stock object, and then by calling supplant (which is defined at the top of *StockTicker.js*) to replace placeholders in the rowTemplate variable with the stock object property values.</span></span> <span data-ttu-id="68c42-265">Výsledného souboru HTML se pak připojí k základní tabulky.</span><span class="sxs-lookup"><span data-stu-id="68c42-265">The resulting HTML is then appended to the stock table.</span></span>

    <span data-ttu-id="68c42-266">Volat funkci inicializace jejím předáním jako funkce zpětného volání, který se spustí po dokončení asynchronního spuštění funkce.</span><span class="sxs-lookup"><span data-stu-id="68c42-266">You call init by passing it in as a callback function that executes after the asynchronous start function completes.</span></span> <span data-ttu-id="68c42-267">Pokud jste volali init jako samostatný příkaz jazyka JavaScript po volání start, funkce by selhat, protože by spustit okamžitě bez čekání na spuštění funkce dokončete navazování připojení.</span><span class="sxs-lookup"><span data-stu-id="68c42-267">If you called init as a separate JavaScript statement after calling start, the function would fail because it would execute immediately without waiting for the start function to finish establishing the connection.</span></span> <span data-ttu-id="68c42-268">Funkce init v takovém případě by se pokusil zavolat funkci getAllStocks před navázáním připojení k serveru.</span><span class="sxs-lookup"><span data-stu-id="68c42-268">In that case, the init function would try to call the getAllStocks function before the server connection is established.</span></span>

    <span data-ttu-id="68c42-269">Když na serveru změní cena akcie společnosti, volá updateStockPrice na připojené klienty.</span><span class="sxs-lookup"><span data-stu-id="68c42-269">When the server changes a stock's price, it calls the updateStockPrice on connected clients.</span></span> <span data-ttu-id="68c42-270">Funkce je přidána do vlastnosti klienta stockTicker proxy je k dispozici k volání ze serveru.</span><span class="sxs-lookup"><span data-stu-id="68c42-270">The function is added to the client property of the stockTicker proxy in order to make it available to calls from the server.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample18.js)]

    <span data-ttu-id="68c42-271">Funkce updateStockPrice formátuje skladový objekt přijatou ze serveru do řádku tabulky na stejném principu funkce init.</span><span class="sxs-lookup"><span data-stu-id="68c42-271">The updateStockPrice function formats a stock object received from the server into a table row the same way as in the init function.</span></span> <span data-ttu-id="68c42-272">Místo přidávání řádku do tabulky, je však najde skladě aktuální řádek v tabulce a nahradí řádku novou.</span><span class="sxs-lookup"><span data-stu-id="68c42-272">However, instead of appending the row to the table, it finds the stock's current row in the table and replaces that row with the new one.</span></span>

<a id="test"></a>

## <a name="test-the-application"></a><span data-ttu-id="68c42-273">Testování aplikace</span><span class="sxs-lookup"><span data-stu-id="68c42-273">Test the application</span></span>

1. <span data-ttu-id="68c42-274">Stisknutím klávesy F5 spusťte aplikaci v režimu ladění.</span><span class="sxs-lookup"><span data-stu-id="68c42-274">Press F5 to run the application in debug mode.</span></span>

    <span data-ttu-id="68c42-275">Základní tabulky zpočátku zobrazí "načítání..." řádku, pak po krátké prodlevě, které se zobrazí počáteční uložených dat a spusťte ceny akcií, chcete-li změnit.</span><span class="sxs-lookup"><span data-stu-id="68c42-275">The stock table initially displays the "loading..." line, then after a short delay the initial stock data is displayed, and then the stock prices start to change.</span></span>

    ![Načítání](tutorial-server-broadcast-with-signalr/_static/image6.png)

    ![Počáteční základní tabulka](tutorial-server-broadcast-with-signalr/_static/image7.png)

    ![Základní tabulka přijímat změny ze serveru](tutorial-server-broadcast-with-signalr/_static/image8.png)
2. <span data-ttu-id="68c42-279">Zkopírujte adresu URL z adresního řádku prohlížeče a vložte ho do jednoho nebo více nového okna prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="68c42-279">Copy the URL from the browser address bar and paste it into one or more new browser window(s).</span></span>

    <span data-ttu-id="68c42-280">Počáteční uložených zobrazení je stejný jako první prohlížeče a změny probíhají souběžně.</span><span class="sxs-lookup"><span data-stu-id="68c42-280">The initial stock display is the same as the first browser and changes happen simultaneously.</span></span>
3. <span data-ttu-id="68c42-281">Zavřít všechny prohlížeče a otevřete nový prohlížeč a přejděte na stejnou adresu URL.</span><span class="sxs-lookup"><span data-stu-id="68c42-281">Close all browsers and open a new browser, then go to the same URL.</span></span>

    <span data-ttu-id="68c42-282">Objekt typu singleton StockTicker pokračuje ke spuštění na serveru, takže zobrazení základní tabulka ukazuje, že zásoby zlepšovalo, chcete-li změnit.</span><span class="sxs-lookup"><span data-stu-id="68c42-282">The StockTicker singleton object has continued to run in the server, so the stock table display shows that the stocks have continued to change.</span></span> <span data-ttu-id="68c42-283">(Nevidíte počáteční tabulka s nulou změnit hodnoty.)</span><span class="sxs-lookup"><span data-stu-id="68c42-283">(You don't see the initial table with zero change figures.)</span></span>
4. <span data-ttu-id="68c42-284">Zavřete prohlížeč.</span><span class="sxs-lookup"><span data-stu-id="68c42-284">Close the browser.</span></span>

<a id="enablelogging"></a>

## <a name="enable-logging"></a><span data-ttu-id="68c42-285">Povolení protokolování</span><span class="sxs-lookup"><span data-stu-id="68c42-285">Enable logging</span></span>

<span data-ttu-id="68c42-286">SignalR má vestavěné protokolování funkci, kterou můžete povolit na straně klienta na podporu při řešení potíží.</span><span class="sxs-lookup"><span data-stu-id="68c42-286">SignalR has a built-in logging function that you can enable on the client to aid in troubleshooting.</span></span> <span data-ttu-id="68c42-287">V této části Povolit protokolování a podívejte se na příklady, které ukazují, jak protokoly, že jste které z následujících metod přenosu pomocí SignalR:</span><span class="sxs-lookup"><span data-stu-id="68c42-287">In this section you enable logging and see examples that show how logs tell you which of the following transport methods SignalR is using:</span></span>

- <span data-ttu-id="68c42-288">[Protokoly Websocket](http://en.wikipedia.org/wiki/WebSocket)podporovaný IIS 8 a aktuální prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="68c42-288">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supported by IIS 8 and current browsers.</span></span>
- <span data-ttu-id="68c42-289">[Události odeslané serverem](http://en.wikipedia.org/wiki/Server-sent_events)podporovaný prohlížečích než Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="68c42-289">[Server-sent events](http://en.wikipedia.org/wiki/Server-sent_events), supported by browsers other than Internet Explorer.</span></span>
- <span data-ttu-id="68c42-290">[Navždy rámec](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe)podporovaný aplikace Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="68c42-290">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supported by Internet Explorer.</span></span>
- <span data-ttu-id="68c42-291">[Dlouhý interval dotazování AJAX](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling)podporovaná ve všech prohlížečích.</span><span class="sxs-lookup"><span data-stu-id="68c42-291">[Ajax long polling](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supported by all browsers.</span></span>

<span data-ttu-id="68c42-292">Pro jakékoli dané připojení SignalR vybere nejlepší metody přenosu, které podporují server i klient.</span><span class="sxs-lookup"><span data-stu-id="68c42-292">For any given connection, SignalR chooses the best transport method that both the server and the client support.</span></span>

1. <span data-ttu-id="68c42-293">Otevřít *StockTicker.js* a přidejte řádek kódu a povolení protokolování bezprostředně před kódem, který inicializuje připojení na konci souboru:</span><span class="sxs-lookup"><span data-stu-id="68c42-293">Open *StockTicker.js* and add a line of code to enable logging immediately before the code that initializes the connection at the end of the file:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample19.js)]
2. <span data-ttu-id="68c42-294">Stisknutím klávesy F5 spusťte projekt.</span><span class="sxs-lookup"><span data-stu-id="68c42-294">Press F5 to run the project.</span></span>
3. <span data-ttu-id="68c42-295">Otevřete okno vývojářských nástrojů v prohlížeči a vyberte v konzole naleznete v protokolech.</span><span class="sxs-lookup"><span data-stu-id="68c42-295">Open your browser's developer tools window, and select the Console to see the logs.</span></span> <span data-ttu-id="68c42-296">Budete muset aktualizovat stránku, aby zobrazil protokoly vyjednávání přepravy pro nové připojení Signalr.</span><span class="sxs-lookup"><span data-stu-id="68c42-296">You might have to refresh the page to see the logs of Signalr negotiating the transport method for a new connection.</span></span>

    <span data-ttu-id="68c42-297">Pokud používáte Internet Explorer 10 v systému Windows 8 (IIS 8), je způsob přepravy objekty Websocket.</span><span class="sxs-lookup"><span data-stu-id="68c42-297">If you are running Internet Explorer 10 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Konzola, IE 10 IIS 8](tutorial-server-broadcast-with-signalr/_static/image9.png)

    <span data-ttu-id="68c42-299">Pokud používáte Internet Explorer 10 na Windows 7 (službu IIS 7.5), je způsob přepravy iframe.</span><span class="sxs-lookup"><span data-stu-id="68c42-299">If you are running Internet Explorer 10 on Windows 7 (IIS 7.5), the transport method is iframe.</span></span>

    ![IE 10 konzoly, IIS 7.5](tutorial-server-broadcast-with-signalr/_static/image10.png)

    <span data-ttu-id="68c42-301">V aplikaci Firefox nainstalujte doplněk Firebug okno konzoly.</span><span class="sxs-lookup"><span data-stu-id="68c42-301">In Firefox, install the Firebug add-in to get a Console window.</span></span> <span data-ttu-id="68c42-302">Pokud používáte Firefox 19 ve Windows 8 (IIS 8), je přepravy objekty Websocket.</span><span class="sxs-lookup"><span data-stu-id="68c42-302">If you are running Firefox 19 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Firefox 19 IIS 8 Websockets](tutorial-server-broadcast-with-signalr/_static/image11.png)

    <span data-ttu-id="68c42-304">Pokud používáte Firefox 19 ve Windows 7 (službu IIS 7.5), je způsob přepravy události odeslané serverem.</span><span class="sxs-lookup"><span data-stu-id="68c42-304">If you are running Firefox 19 on Windows 7 (IIS 7.5), the transport method is server-sent events.</span></span>

    ![Konzola služby IIS 7.5, Firefox 19](tutorial-server-broadcast-with-signalr/_static/image12.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a><span data-ttu-id="68c42-306">Instalace a zkontrolujte úplnou ukázku StockTicker</span><span class="sxs-lookup"><span data-stu-id="68c42-306">Install and review the full StockTicker sample</span></span>

<span data-ttu-id="68c42-307">StockTicker aplikace, který je nainstalovaný [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) balíček NuGet obsahuje víc funkcí než zjednodušenou verzi, kterou jste právě vytvořili úplně od začátku.</span><span class="sxs-lookup"><span data-stu-id="68c42-307">The StockTicker application that is installed by the [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package includes more features than the simplified version that you just created from scratch.</span></span> <span data-ttu-id="68c42-308">V této části kurzu nainstalujte balíček NuGet a projděte si nové funkce a kód, který je implementuje.</span><span class="sxs-lookup"><span data-stu-id="68c42-308">In this section of the tutorial, you install the NuGet package and review the new features and the code that implements them.</span></span> <span data-ttu-id="68c42-309">Pokud instalace balíčku bez provedení předchozích kroků v tomto kurzu je nutné přidat do vašeho projektu třídy pro spuštění OWIN.</span><span class="sxs-lookup"><span data-stu-id="68c42-309">If you install the package without performing the earlier steps of this tutorial, you must add an OWIN startup class to your project.</span></span> <span data-ttu-id="68c42-310">Tento krok je vysvětleno v souboru readme.txt pro balíček NuGet.</span><span class="sxs-lookup"><span data-stu-id="68c42-310">This step is explained in the readme.txt file for the NuGet package.</span></span>

### <a name="install-the-signalrsample-nuget-package"></a><span data-ttu-id="68c42-311">Nainstalujte balíček SignalR.Sample NuGet</span><span class="sxs-lookup"><span data-stu-id="68c42-311">Install the SignalR.Sample NuGet package</span></span>

1. <span data-ttu-id="68c42-312">V **Průzkumníka řešení**, klikněte pravým tlačítkem na projekt a klikněte na tlačítko **spravovat balíčky NuGet**.</span><span class="sxs-lookup"><span data-stu-id="68c42-312">In **Solution Explorer**, right-click the project and click **Manage NuGet Packages**.</span></span>
2. <span data-ttu-id="68c42-313">V **spravovat balíčky NuGet** dialogové okno, klikněte na tlačítko **Online**, zadejte *SignalR.Sample* v **vyhledávání Online** pole a potom klikněte na tlačítko  **Nainstalujte** v **SignalR.Sample** balíčku.</span><span class="sxs-lookup"><span data-stu-id="68c42-313">In the **Manage NuGet Packages** dialog box, click **Online**, enter *SignalR.Sample* in the **Search Online** box, and then click **Install** in the **SignalR.Sample** package.</span></span>

    ![Nainstalujte balíček SignalR.Sample](tutorial-server-broadcast-with-signalr/_static/image13.png)
3. <span data-ttu-id="68c42-315">V **Průzkumníka řešení**, rozbalte *SignalR.Sample* složky, který byl vytvořen při instalaci balíčku SignalR.Sample.</span><span class="sxs-lookup"><span data-stu-id="68c42-315">In **Solution Explorer**, expand the *SignalR.Sample* folder which was created by installing the SignalR.Sample package.</span></span>
4. <span data-ttu-id="68c42-316">V *SignalR.Sample* složky, klikněte pravým tlačítkem na *StockTicker.html*a potom klikněte na tlačítko **nastavit jako úvodní stránku**.</span><span class="sxs-lookup"><span data-stu-id="68c42-316">In the *SignalR.Sample* folder, right-click *StockTicker.html*, and then click **Set As Start Page**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="68c42-317">Instalace SignalR.Sample NuGet balíčku může změnit verzi jQuery, který máte v vaše *skripty* složky.</span><span class="sxs-lookup"><span data-stu-id="68c42-317">Installing The SignalR.Sample NuGet package might change the version of jQuery that you have in your *Scripts* folder.</span></span> <span data-ttu-id="68c42-318">Nové *StockTicker.html* soubor, který se nainstaluje balíček *SignalR.Sample* složkou je synchronizovaný s verzí jQuery, který nainstaluje balíček, ale pokud budete chtít spustit váš původním *StockTicker.html* soubor znovu, možná budete muset nejprve aktualizovat odkaz jQuery ve značce skriptu.</span><span class="sxs-lookup"><span data-stu-id="68c42-318">The new *StockTicker.html* file that the package installs in the *SignalR.Sample* folder will be in sync with the jQuery version that the package installs, but if you want to run your original *StockTicker.html* file again, you might have to update the jQuery reference in the script tag first.</span></span>

### <a name="run-the-application"></a><span data-ttu-id="68c42-319">Spuštění aplikace</span><span class="sxs-lookup"><span data-stu-id="68c42-319">Run the application</span></span>

1. <span data-ttu-id="68c42-320">Stisknutím klávesy F5 spusťte aplikaci.</span><span class="sxs-lookup"><span data-stu-id="68c42-320">Press F5 to run the application.</span></span>

    <span data-ttu-id="68c42-321">Kromě mřížky, které jste viděli dříve úplné akciích aplikace ukazuje vodorovně posuvné okno, které se zobrazí stejná základní data.</span><span class="sxs-lookup"><span data-stu-id="68c42-321">In addition to the grid that you saw earlier, the full stock ticker application shows a horizontally scrolling window that displays the same stock data.</span></span> <span data-ttu-id="68c42-322">Když spustíte aplikaci poprvé, "trhu" je "uzavřený" a uvidíte statické mřížky a akcie okna, který není posouvání.</span><span class="sxs-lookup"><span data-stu-id="68c42-322">When you run the application for the first time, the "market" is "closed" and you see a static grid and a ticker window that isn't scrolling.</span></span>

    ![StockTicker obrazovky start](tutorial-server-broadcast-with-signalr/_static/image14.png)

    <span data-ttu-id="68c42-324">Po kliknutí na **otevřeném trhu**, **Live akcie akcie** pole začne posouvat vodorovně a spustí se server pravidelně vysílat změny ceny akcie v náhodných intervalech.</span><span class="sxs-lookup"><span data-stu-id="68c42-324">When you click **Open Market**, the **Live Stock Ticker** box starts to scroll horizontally, and the server starts to periodically broadcast stock price changes on a random basis.</span></span> <span data-ttu-id="68c42-325">Pokaždé, když ceny akcie změní, i **Live tabulky akcie** mřížky a **Live akcie akcie** pole jsou aktualizovány.</span><span class="sxs-lookup"><span data-stu-id="68c42-325">Each time a stock price changes, both the **Live Stock Table** grid and the **Live Stock Ticker** box are updated.</span></span> <span data-ttu-id="68c42-326">Pokud je změna ceny akcie společnosti kladná, stock je zobrazen zeleně na pozadí a při změně je záporný, stock se zobrazí s červeným pozadím.</span><span class="sxs-lookup"><span data-stu-id="68c42-326">When a stock's price change is positive, the stock is shown with a green background, and when the change is negative, the stock is shown with a red background.</span></span>

    ![Otevřete aplikaci StockTicker trhu](tutorial-server-broadcast-with-signalr/_static/image15.png)

    <span data-ttu-id="68c42-328">**Zavřít trhu** tlačítko přestane změny a posouvání akcií, k dispozici a **resetování** tlačítko obnoví všechny uložených dat do původního stavu před zahájením změny cen.</span><span class="sxs-lookup"><span data-stu-id="68c42-328">The **Close Market** button stops the changes and stops the ticker scrolling, and the **Reset** button resets all stock data to the initial state before price changes started.</span></span> <span data-ttu-id="68c42-329">Pokud otevřete další okno prohlížeče a přejděte na stejnou adresu URL, uvidíte stejná data dynamicky aktualizovat ve stejnou dobu v každým prohlížečem.</span><span class="sxs-lookup"><span data-stu-id="68c42-329">If you open more browser windows and go to the same URL, you see the same data dynamically updated at the same time in each browser.</span></span> <span data-ttu-id="68c42-330">Po klepnutí na tlačítka, reagujte všechny prohlížeče stejným způsobem jako ve stejnou dobu.</span><span class="sxs-lookup"><span data-stu-id="68c42-330">When you click one of the buttons, all browsers respond the same way at the same time.</span></span>

### <a name="live-stock-ticker-display"></a><span data-ttu-id="68c42-331">Živé akcie časovače, může zobrazení</span><span class="sxs-lookup"><span data-stu-id="68c42-331">Live Stock Ticker display</span></span>

<span data-ttu-id="68c42-332">**Live akcie akcie** zobrazení je neuspořádaný seznam do elementu div, který je formátován jako jeden řádek pomocí stylů CSS.</span><span class="sxs-lookup"><span data-stu-id="68c42-332">The **Live Stock Ticker** display is an unordered list in a div element that is formatted into a single line by CSS styles.</span></span> <span data-ttu-id="68c42-333">Časovače, může je inicializován a aktualizovat stejným způsobem jako v tabulce: tak, že nahradíte zástupný text v &lt;li&gt; řetězec šablony a dynamicky přidat &lt;li&gt; prvků, které mají &lt;ul&gt; element.</span><span class="sxs-lookup"><span data-stu-id="68c42-333">The ticker is initialized and updated the same way as the table: by replacing placeholders in a &lt;li&gt; template string and dynamically adding the &lt;li&gt; elements to the &lt;ul&gt; element.</span></span> <span data-ttu-id="68c42-334">Posouvání se provádí pomocí funkce animovat jQuery se liší okraj levé neuspořádaný seznam v rámci div.</span><span class="sxs-lookup"><span data-stu-id="68c42-334">The scrolling is performed by using the jQuery animate function to vary the margin-left of the unordered list within the div.</span></span>

<span data-ttu-id="68c42-335">Akciích HTML:</span><span class="sxs-lookup"><span data-stu-id="68c42-335">The stock ticker HTML:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample20.html)]

<span data-ttu-id="68c42-336">Akciích šablon stylů CSS:</span><span class="sxs-lookup"><span data-stu-id="68c42-336">The stock ticker CSS:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-signalr/samples/sample21.html)]

<span data-ttu-id="68c42-337">Posuňte se kód jazyka jQuery, která umožňuje:</span><span class="sxs-lookup"><span data-stu-id="68c42-337">The jQuery code that makes it scroll:</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample22.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a><span data-ttu-id="68c42-338">Další metody na serveru, na které můžete volat klienta</span><span class="sxs-lookup"><span data-stu-id="68c42-338">Additional methods on the server that the client can call</span></span>

<span data-ttu-id="68c42-339">Třída StockTickerHub definuje čtyři další metody, které můžete volat klienta:</span><span class="sxs-lookup"><span data-stu-id="68c42-339">The StockTickerHub class defines four additional methods that the client can call:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample23.cs)]

<span data-ttu-id="68c42-340">V reakci na tlačítka v horní části stránky se nazývají OpenMarket CloseMarket a obnovení.</span><span class="sxs-lookup"><span data-stu-id="68c42-340">OpenMarket, CloseMarket, and Reset are called in response to the buttons at the top of the page.</span></span> <span data-ttu-id="68c42-341">Vysvětlují vzor jednoho klienta, spouštění změnu stavu, ve kterém se okamžitě šíří do všech klientů.</span><span class="sxs-lookup"><span data-stu-id="68c42-341">They demonstrate the pattern of one client triggering a change in state that is immediately propagated to all clients.</span></span> <span data-ttu-id="68c42-342">Každá z těchto metod volá metodu ve třídě StockTicker který postihne trhu stav změnit a pak vyšle nový stav.</span><span class="sxs-lookup"><span data-stu-id="68c42-342">Each of these methods calls a method in the StockTicker class that effects the market state change and then broadcasts the new state.</span></span>

<span data-ttu-id="68c42-343">Ve třídě StockTicker udržuje MarketState vlastnost, která vrací hodnotu výčtu MarketState stavu na trhu:</span><span class="sxs-lookup"><span data-stu-id="68c42-343">In the StockTicker class, the state of the market is maintained by a MarketState property that returns a MarketState enum value:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample24.cs)]

<span data-ttu-id="68c42-344">Každá z metod, které ke změně stavu na trhu provést uvnitř bloku zámek protože StockTicker třída musí být threadsafe:</span><span class="sxs-lookup"><span data-stu-id="68c42-344">Each of the methods that change the market state do so inside a lock block because the StockTicker class has to be threadsafe:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample25.cs)]

<span data-ttu-id="68c42-345">K zajištění, že tento kód je threadsafe, \_marketState pole, která zálohuje MarketState vlastnost je označena jako volatile,</span><span class="sxs-lookup"><span data-stu-id="68c42-345">To ensure that this code is threadsafe, the \_marketState field that backs the MarketState property is marked as volatile,</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample26.cs)]

<span data-ttu-id="68c42-346">Metody BroadcastMarketStateChange a BroadcastMarketReset jsou podobné BroadcastStockPrice metody, které jste už viděli, s výjimkou volání různých metod definovaných v klientském počítači:</span><span class="sxs-lookup"><span data-stu-id="68c42-346">The BroadcastMarketStateChange and BroadcastMarketReset methods are similar to the BroadcastStockPrice method that you already saw, except they call different methods defined at the client:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-signalr/samples/sample27.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a><span data-ttu-id="68c42-347">Další funkce na straně klienta, která může volat na serveru</span><span class="sxs-lookup"><span data-stu-id="68c42-347">Additional functions on the client that the server can call</span></span>

<span data-ttu-id="68c42-348">Funkce updateStockPrice nyní zpracovává mřížky a časovače, může zobrazení a používá jQuery.Color pro flash červenou a zelenou barvy.</span><span class="sxs-lookup"><span data-stu-id="68c42-348">The updateStockPrice function now handles both the grid and the ticker display, and it uses jQuery.Color to flash red and green colors.</span></span>

<span data-ttu-id="68c42-349">Nové funkce v *SignalR.StockTicker.js* povolit a zakázat tlačítka na základě trhu stavu a zastavení nebo spuštění časovače, může okno vodorovného posouvání.</span><span class="sxs-lookup"><span data-stu-id="68c42-349">New functions in *SignalR.StockTicker.js* enable and disable the buttons based on market state, and they stop or start the ticker window horizontal scrolling.</span></span> <span data-ttu-id="68c42-350">Vzhledem k tomu, že na ticker.client, se neustále přidávají více funkcí [jQuery rozšířit funkce](http://api.jquery.com/jQuery.extend/) se používá k přidání je.</span><span class="sxs-lookup"><span data-stu-id="68c42-350">Since multiple functions are being added to ticker.client, the [jQuery extend function](http://api.jquery.com/jQuery.extend/) is used to add them.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample28.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a><span data-ttu-id="68c42-351">Instalace dalších klientských po navázání připojení</span><span class="sxs-lookup"><span data-stu-id="68c42-351">Additional client setup after establishing the connection</span></span>

<span data-ttu-id="68c42-352">Poté, co klient naváže připojení, je provést další úkony: Zjistěte, jestli je otevřeno nebo zavřeno, aby bylo možné volat odpovídající marketOpened nebo marketClosed funkce a volání metody serveru pro tlačítka připojit na trhu.</span><span class="sxs-lookup"><span data-stu-id="68c42-352">After the client establishes the connection, it has some additional work to do: find out if the market is open or closed in order to call the appropriate marketOpened or marketClosed function, and attach the server method calls to the buttons.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-signalr/samples/sample29.js)]

<span data-ttu-id="68c42-353">Metody serveru nejsou svázanou tlačítka až po navázání připojení tak, aby kód pokusí volat metody serveru, dokud nebudou k dispozici.</span><span class="sxs-lookup"><span data-stu-id="68c42-353">The server methods are not wired up to the buttons until after the connection is established, so that the code can't try to call the server methods before they are available.</span></span>

<a id="nextsteps"></a>

## <a name="next-steps"></a><span data-ttu-id="68c42-354">Další kroky</span><span class="sxs-lookup"><span data-stu-id="68c42-354">Next steps</span></span>

<span data-ttu-id="68c42-355">V tomto kurzu jste zjistili, jak programovat aplikace SignalR, který vysílá zprávy ze serveru na všechny připojené klienty, a v pravidelných intervalech a v reakci na oznámení z jakéhokoli klienta.</span><span class="sxs-lookup"><span data-stu-id="68c42-355">In this tutorial you've learned how to program a SignalR application that broadcasts messages from the server to all connected clients, both on a periodic basis and in response to notifications from any client.</span></span> <span data-ttu-id="68c42-356">Vzor pomocí instance typu singleton vícevláknové k údržbě stavu serveru také lze také v online her scénáře více hráčů.</span><span class="sxs-lookup"><span data-stu-id="68c42-356">The pattern of using a multi-threaded singleton instance to maintain server state can also be also used in multi-player online game scenarios.</span></span> <span data-ttu-id="68c42-357">Příklad najdete v tématu [ShootR hru, která je založena na SignalR](https://github.com/NTaylorMullen/ShootR).</span><span class="sxs-lookup"><span data-stu-id="68c42-357">For an example, see [the ShootR game that is based on SignalR](https://github.com/NTaylorMullen/ShootR).</span></span>

<span data-ttu-id="68c42-358">Kurzy, které ukazují scénáře komunikace peer-to-peer, naleznete v tématu [Začínáme s knihovnou SignalR](introduction-to-signalr.md) a [aktualizace v reálném čase s knihovnou SignalR](tutorial-high-frequency-realtime-with-signalr.md).</span><span class="sxs-lookup"><span data-stu-id="68c42-358">For tutorials that show peer-to-peer communication scenarios, see [Getting Started with SignalR](introduction-to-signalr.md) and [Real-Time Updating with SignalR](tutorial-high-frequency-realtime-with-signalr.md).</span></span>

<span data-ttu-id="68c42-359">Informace o pokročilejších pojmech vývoj SignalR, naleznete na následujících stránkách pro funkci SignalR zdrojový kód a prostředky:</span><span class="sxs-lookup"><span data-stu-id="68c42-359">To learn more advanced SignalR development concepts, visit the following sites for SignalR source code and resources:</span></span>

- [<span data-ttu-id="68c42-360">Funkce SignalR technologie ASP.NET</span><span class="sxs-lookup"><span data-stu-id="68c42-360">ASP.NET SignalR</span></span>](../../index.md)
- [<span data-ttu-id="68c42-361">Projekt SignalR</span><span class="sxs-lookup"><span data-stu-id="68c42-361">SignalR Project</span></span>](http://signalr.net/)
- [<span data-ttu-id="68c42-362">Funkce SignalR Githubu a ukázky</span><span class="sxs-lookup"><span data-stu-id="68c42-362">SignalR Github and Samples</span></span>](https://github.com/SignalR/SignalR)
- [<span data-ttu-id="68c42-363">SignalR Wiki</span><span class="sxs-lookup"><span data-stu-id="68c42-363">SignalR Wiki</span></span>](https://github.com/SignalR/SignalR/wiki)

<span data-ttu-id="68c42-364">Návod k nasazení aplikace SignalR do Azure najdete v tématu [pomocí SignalR s webovými aplikacemi ve službě Azure App Service](../deployment/using-signalr-with-azure-web-sites.md).</span><span class="sxs-lookup"><span data-stu-id="68c42-364">For a walkthrough on how to deploy a SignalR application to Azure, see [Using SignalR with Web Apps in Azure App Service](../deployment/using-signalr-with-azure-web-sites.md).</span></span> <span data-ttu-id="68c42-365">Podrobné informace o tom, jak nasadit webový projekt sady Visual Studio na webu Windows Azure naleznete v tématu [vytvoření webové aplikace ASP.NET ve službě Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).</span><span class="sxs-lookup"><span data-stu-id="68c42-365">For detailed information about how to deploy a Visual Studio web project to a Windows Azure Web Site, see [Create an ASP.NET web app in Azure App Service](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-get-started/).</span></span>
