---
uid: web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
title: "Efektivní stránkování prostřednictvím velké objemy dat (C#) | Microsoft Docs"
author: rick-anderson
description: "Při práci s velkými objemy dat, jako jeho základní retriev řízení zdroje dat není vhodná výchozí možnost stránkování ovládacího prvku prezentace dat..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/15/2006
ms.topic: article
ms.assetid: 59c01998-9326-4ecb-9392-cb9615962140
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
msc.type: authoredcontent
ms.openlocfilehash: ac16cc79f2ed6b62bf676553a374180cd0165632
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/24/2018
---
<a name="efficiently-paging-through-large-amounts-of-data-c"></a><span data-ttu-id="c9e51-103">Efektivní stránkování prostřednictvím velké objemy dat (C#)</span><span class="sxs-lookup"><span data-stu-id="c9e51-103">Efficiently Paging Through Large Amounts of Data (C#)</span></span>
====================
<span data-ttu-id="c9e51-104">podle [Scott Meisnerová](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c9e51-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c9e51-105">[Stáhněte si ukázkovou aplikaci](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) nebo [stáhnout PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="c9e51-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) or [Download PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span></span>

> <span data-ttu-id="c9e51-106">Výchozí možnost stránkování ovládacího prvku prezentace dat není vhodná, při práci s velkými objemy dat, jako ovládací prvek jeho základní zdroj dat načte všechny záznamy, i když se zobrazí pouze podmnožinu dat.</span><span class="sxs-lookup"><span data-stu-id="c9e51-106">The default paging option of a data presentation control is unsuitable when working with large amounts of data, as its underlying data source control retrieves all records, even though only a subset of data is displayed.</span></span> <span data-ttu-id="c9e51-107">V takových případech jsme musíte zapnout pro vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-107">In such circumstances, we must turn to custom paging.</span></span>


## <a name="introduction"></a><span data-ttu-id="c9e51-108">Úvod</span><span class="sxs-lookup"><span data-stu-id="c9e51-108">Introduction</span></span>

<span data-ttu-id="c9e51-109">Jak již bylo zmíněno v předchozím kurzu, můžou se implementovat stránkování v jedním ze dvou způsobů:</span><span class="sxs-lookup"><span data-stu-id="c9e51-109">As we discussed in the preceding tutorial, paging can be implemented in one of two ways:</span></span>

- <span data-ttu-id="c9e51-110">**Výchozí stránkování** může být implementováno jednoduše kontrolou možnost Povolit stránkování v datech ovládací prvek webu s inteligentní značky; však vždy, když je zobrazení stránky dat, ObjectDataSource načte *všechny* záznamy, dokonce i Přestože jsou zobrazena pouze podmnožina z nich na stránce</span><span class="sxs-lookup"><span data-stu-id="c9e51-110">**Default Paging** can be implemented by simply checking the Enable Paging option in the data Web control s smart tag; however, whenever viewing a page of data, the ObjectDataSource retrieves *all* of the records, even though only a subset of them are displayed in the page</span></span>
- <span data-ttu-id="c9e51-111">**Vlastní stránkování** zlepšuje výkon výchozí stránkování načtením pouze záznamy z databáze, který se má zobrazit na konkrétní stránku dat, které požadoval uživatel, potřebujete však vlastní stránkování vyžaduje trochu další úsilí k implementaci než výchozí stránkování</span><span class="sxs-lookup"><span data-stu-id="c9e51-111">**Custom Paging** improves the performance of default paging by retrieving only those records from the database that need to be displayed for the particular page of data requested by the user; however, custom paging involves a bit more effort to implement than default paging</span></span>

<span data-ttu-id="c9e51-112">Z důvodu usnadnění implementace jenom kontroly zaškrtávací políčko a níž Hotovo.</span><span class="sxs-lookup"><span data-stu-id="c9e51-112">Due to the ease of implementation just check a checkbox and you re done!</span></span> <span data-ttu-id="c9e51-113">výchozí stránkování je lákavou možnost.</span><span class="sxs-lookup"><span data-stu-id="c9e51-113">default paging is an attractive option.</span></span> <span data-ttu-id="c9e51-114">Svůj přístup na sunout při načítání všech záznamů, ale je nepravděpodobné číselné volbou při procházení dostatečně velké objemy dat nebo pro servery s více souběžných uživatelů.</span><span class="sxs-lookup"><span data-stu-id="c9e51-114">Its na�ve approach in retrieving all of the records, though, makes it an implausible choice when paging through sufficiently large amounts of data or for sites with many concurrent users.</span></span> <span data-ttu-id="c9e51-115">V takových případech musí jsme zapněte na vlastní stránkování Chcete-li poskytovat přizpůsobivý systému.</span><span class="sxs-lookup"><span data-stu-id="c9e51-115">In such circumstances, we must turn to custom paging in order to provide a responsive system.</span></span>

<span data-ttu-id="c9e51-116">Na výzvu vlastní stránkování se moci napsat dotaz, který vrátí sadu záznamů, které jsou potřeba pro konkrétní stránku dat přesné.</span><span class="sxs-lookup"><span data-stu-id="c9e51-116">The challenge of custom paging is being able to write a query that returns the precise set of records needed for a particular page of data.</span></span> <span data-ttu-id="c9e51-117">Naštěstí Microsoft SQL Server 2005 poskytuje new – klíčové slovo pro výsledky hodnocení, umožňující nám vytvořit dotaz, který můžete efektivně načíst správné podmnožinu záznamů.</span><span class="sxs-lookup"><span data-stu-id="c9e51-117">Fortunately, Microsoft SQL Server 2005 provides a new keyword for ranking results, which enables us to write a query that can efficiently retrieve the proper subset of records.</span></span> <span data-ttu-id="c9e51-118">V tomto kurzu jsme zobrazí, jak implementovat vlastní stránkování v ovládacím prvku GridView pomocí této new – klíčové slovo systému SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="c9e51-118">In this tutorial we'll see how to use this new SQL Server 2005 keyword to implement custom paging in a GridView control.</span></span> <span data-ttu-id="c9e51-119">I když je stejná jako pro výchozí stránkování, krokování z jedné stránky na další pomocí uživatelského rozhraní pro vlastní stránkování vlastní stránkování může být několik pořadí podle velikosti rychleji než výchozí stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-119">While the user interface for custom paging is identical to that for default paging, stepping from one page to the next using custom paging can be several orders of magnitude faster than default paging.</span></span>

> [!NOTE]
> <span data-ttu-id="c9e51-120">Přesný výkonnější vykazují vlastní stránkování závisí na celkový počet záznamů stránkování prostřednictvím a zatížení je umístěn na serveru databáze.</span><span class="sxs-lookup"><span data-stu-id="c9e51-120">The exact performance gain exhibited by custom paging depends on the total number of records being paged through and the load being placed on the database server.</span></span> <span data-ttu-id="c9e51-121">Na konci tohoto kurzu podíváme některé hrubý metriky, které prezentují výhod výkonu získaných pomocí vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-121">At the end of this tutorial we'll look at some rough metrics that showcase the benefits in performance obtained through custom paging.</span></span>


## <a name="step-1-understanding-the-custom-paging-process"></a><span data-ttu-id="c9e51-122">Krok 1: Pochopení vlastní proces stránkování</span><span class="sxs-lookup"><span data-stu-id="c9e51-122">Step 1: Understanding the Custom Paging Process</span></span>

<span data-ttu-id="c9e51-123">Při procházení dat, přesné záznamy zobrazené na stránce závisí na stránce dat požadovanou a počet záznamů zobrazených na stránce.</span><span class="sxs-lookup"><span data-stu-id="c9e51-123">When paging through data, the precise records displayed in a page depend upon the page of data being requested and the number of records displayed per page.</span></span> <span data-ttu-id="c9e51-124">Představte si například, že jsme chtěli 81 produkty, procházet po stránkách zobrazení 10 produktů na stránce.</span><span class="sxs-lookup"><span data-stu-id="c9e51-124">For example, imagine that we wanted to page through the 81 products, displaying 10 products per page.</span></span> <span data-ttu-id="c9e51-125">Při zobrazení na první stránku, d chceme produkty 1 až 10; Při zobrazení na druhé stránce jsme d zajímat produkty 11 až 20 a tak dále.</span><span class="sxs-lookup"><span data-stu-id="c9e51-125">When viewing the first page, we d want products 1 through 10; when viewing the second page we d be interested in products 11 through 20, and so on.</span></span>

<span data-ttu-id="c9e51-126">Existují tři proměnné, které určují, co je třeba záznamy načíst a jakým způsobem má být vykreslen rozhraní stránkování:</span><span class="sxs-lookup"><span data-stu-id="c9e51-126">There are three variables that dictate what records need to be retrieved and how the paging interface should be rendered:</span></span>

- <span data-ttu-id="c9e51-127">**Počáteční řádek indexu** index první řádek na stránce data k zobrazení; to index může být vypočítána vynásobí záznamy zobrazených na stránce index stránky a přidávání jednoho.</span><span class="sxs-lookup"><span data-stu-id="c9e51-127">**Start Row Index** the index of the first row in the page of data to display; this index can be calculated by multiplying the page index by the records to display per page and adding one.</span></span> <span data-ttu-id="c9e51-128">Například při procházení záznamy 10 současně, na první stránce (jehož index stránky je 0), řádek indexu spustit je 0 \* 10 + 1 nebo 1; pro druhé stránce (jehož index stránky je 1), řádek indexu spustit je 1 \* 10 + 1 , nebo 11.</span><span class="sxs-lookup"><span data-stu-id="c9e51-128">For example, when paging through records 10 at a time, for the first page (whose page index is 0), the Start Row Index is 0 \* 10 + 1, or 1; for the second page (whose page index is 1), the Start Row Index is 1 \* 10 + 1, or 11.</span></span>
- <span data-ttu-id="c9e51-129">**Maximální počet řádků** maximální počet záznamů zobrazených na stránce.</span><span class="sxs-lookup"><span data-stu-id="c9e51-129">**Maximum Rows** the maximum number of records to display per page.</span></span> <span data-ttu-id="c9e51-130">Tato proměnná se označuje jako maximální počet řádků, protože poslední existuje stránka může být méně záznamů vrácených než je velikost stránky.</span><span class="sxs-lookup"><span data-stu-id="c9e51-130">This variable is referred to as maximum rows since for the last page there may be fewer records returned than the page size.</span></span> <span data-ttu-id="c9e51-131">Například když stránkování prostřednictvím 81 produkty 10 záznamů na stránku, deváté a poslední stránka bude mít jenom jeden záznam.</span><span class="sxs-lookup"><span data-stu-id="c9e51-131">For example, when paging through the 81 products 10 records per page, the ninth and final page will have just one record.</span></span> <span data-ttu-id="c9e51-132">Neobsahuje žádné stránky, ale zobrazí další záznamy než hodnota maximální počet řádků.</span><span class="sxs-lookup"><span data-stu-id="c9e51-132">No page, though, will show more records than the Maximum Rows value.</span></span>
- <span data-ttu-id="c9e51-133">**Celkový počet záznamů** celkový počet záznamů stránkování prostřednictvím.</span><span class="sxs-lookup"><span data-stu-id="c9e51-133">**Total Record Count** the total number of records being paged through.</span></span> <span data-ttu-id="c9e51-134">Při této proměnné neběží t se potřeba zjistit, co záznamů pro danou stránku, určují rozhraní stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-134">While this variable isn t needed to determine what records to retrieve for a given page, it does dictate the paging interface.</span></span> <span data-ttu-id="c9e51-135">Například pokud jsou 81 produkty stránkování prostřednictvím, rozhraní stránkování zná zobrazíte devět čísla stránek v stránkování uživatelského rozhraní.</span><span class="sxs-lookup"><span data-stu-id="c9e51-135">For example, if there are 81 products being paged through, the paging interface knows to display nine page numbers in the paging UI.</span></span>

<span data-ttu-id="c9e51-136">S výchozí stránkování, je výpočet řádek indexu spustit jako produktu index stránky a velikost stránky a jeden, zatímco maximální počet řádků je jednoduše velikost stránky.</span><span class="sxs-lookup"><span data-stu-id="c9e51-136">With default paging, the Start Row Index is computed as the product of the page index and the page size plus one, whereas the Maximum Rows is simply the page size.</span></span> <span data-ttu-id="c9e51-137">Vzhledem k tomu, že výchozí stránkování načte všechny záznamy z databáze při vykreslování jakoukoli stránku dat, pro každý řádek indexu se označuje, a díky přesunutí spustit Index řádku řádek jednoduchý úkol.</span><span class="sxs-lookup"><span data-stu-id="c9e51-137">Since default paging retrieves all of the records from the database when rendering any page of data, the index for each row is known, thereby making moving to Start Row Index row a trivial task.</span></span> <span data-ttu-id="c9e51-138">Kromě toho je snadno dostupné, protože celkový počet záznamů s celkový počet záznamů v DataTable (nebo jakýkoliv objekt se používá k ukládání výsledků databáze).</span><span class="sxs-lookup"><span data-stu-id="c9e51-138">Moreover, the Total Record Count is readily available, as it s simply the number of records in the DataTable (or whatever object is being used to hold the database results).</span></span>

<span data-ttu-id="c9e51-139">Zadané proměnné spustit Index řádku a maximální počet řádků, vlastní implementaci stránkování musí vrátit pouze přesné podmnožinu spuštění Index řádku spustit a až do maximální počet řádků počet záznamů, po který záznamů.</span><span class="sxs-lookup"><span data-stu-id="c9e51-139">Given the Start Row Index and Maximum Rows variables, a custom paging implementation must only return the precise subset of records starting at the Start Row Index and up to Maximum Rows number of records after that.</span></span> <span data-ttu-id="c9e51-140">Vlastní stránkování poskytuje dva problémy:</span><span class="sxs-lookup"><span data-stu-id="c9e51-140">Custom paging provides two challenges:</span></span>

- <span data-ttu-id="c9e51-141">Jsme musí mít efektivní přidružit každý řádek v celého datového stránkování prostřednictvím tak, aby můžeme začít vrácení záznamy na zadaný Index řádku spustit index řádku</span><span class="sxs-lookup"><span data-stu-id="c9e51-141">We must be able to efficiently associate a row index with each row in the entire data being paged through so that we can start returning records at the specified Start Row Index</span></span>
- <span data-ttu-id="c9e51-142">Je potřeba zadat celkový počet záznamů stránkování prostřednictvím</span><span class="sxs-lookup"><span data-stu-id="c9e51-142">We need to provide the total number of records being paged through</span></span>

<span data-ttu-id="c9e51-143">V následujících dvou krocích podíváme skript SQL se musel reagovat na tyto dva problémy.</span><span class="sxs-lookup"><span data-stu-id="c9e51-143">In the next two steps we'll examine the SQL script needed to respond to these two challenges.</span></span> <span data-ttu-id="c9e51-144">Kromě skript SQL budete také musíme implementovat metody DAL a BLL.</span><span class="sxs-lookup"><span data-stu-id="c9e51-144">In addition to the SQL script, we'll also need to implement methods in the DAL and BLL.</span></span>

## <a name="step-2-returning-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="c9e51-145">Krok 2: Vrátí celkový počet záznamů stránkování prostřednictvím</span><span class="sxs-lookup"><span data-stu-id="c9e51-145">Step 2: Returning the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="c9e51-146">Před jsme zkontrolujte postup načtení přesné podmnožinu záznamů pro stránku se zobrazuje, umožní s první pohled na tom, jak vrátit celkový počet záznamů stránkování prostřednictvím.</span><span class="sxs-lookup"><span data-stu-id="c9e51-146">Before we examine how to retrieve the precise subset of records for the page being displayed, let s first look at how to return the total number of records being paged through.</span></span> <span data-ttu-id="c9e51-147">Tyto informace je třeba správně nakonfigurovat uživatelské rozhraní stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-147">This information is needed in order to properly configure the paging user interface.</span></span> <span data-ttu-id="c9e51-148">Celkový počet záznamů vrácených konkrétní dotazu SQL můžete získat pomocí [ `COUNT` agregační funkce](https://msdn.microsoft.com/library/ms175997.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9e51-148">The total number of records returned by a particular SQL query can be obtained by using the [`COUNT` aggregate function](https://msdn.microsoft.com/library/ms175997.aspx).</span></span> <span data-ttu-id="c9e51-149">Například můžete určit celkový počet záznamů v `Products` tabulky, můžeme použít následující dotaz:</span><span class="sxs-lookup"><span data-stu-id="c9e51-149">For example, to determine the total number of records in the `Products` table, we can use the following query:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample1.sql)]

<span data-ttu-id="c9e51-150">Umožní s přidání metody do našich DAL, který vrací tyto informace.</span><span class="sxs-lookup"><span data-stu-id="c9e51-150">Let s add a method to our DAL that returns this information.</span></span> <span data-ttu-id="c9e51-151">Konkrétně vytvoříme DAL metodu s názvem `TotalNumberOfProducts()` , která se spouští `SELECT` příkaz uvedené výše.</span><span class="sxs-lookup"><span data-stu-id="c9e51-151">In particular, we'll create a DAL method called `TotalNumberOfProducts()` that executes the `SELECT` statement shown above.</span></span>

<span data-ttu-id="c9e51-152">Začněte otevřením `Northwind.xsd` soubor typové datové sady `App_Code/DAL` složky.</span><span class="sxs-lookup"><span data-stu-id="c9e51-152">Start by opening the `Northwind.xsd` Typed DataSet file in the `App_Code/DAL` folder.</span></span> <span data-ttu-id="c9e51-153">Pak klikněte pravým tlačítkem na `ProductsTableAdapter` v návrháři a zvolte dotazu přidat.</span><span class="sxs-lookup"><span data-stu-id="c9e51-153">Next, right-click on the `ProductsTableAdapter` in the Designer and choose Add Query.</span></span> <span data-ttu-id="c9e51-154">Jako jsme jste viděli v předchozí kurzech to vám umožní na přidání nové metody vrstvy Dal, při vyvolání, provede konkrétní příkaz jazyka SQL nebo uloženou proceduru.</span><span class="sxs-lookup"><span data-stu-id="c9e51-154">As we ve seen in previous tutorials, this will allow us to add a new method to the DAL that, when invoked, will execute a particular SQL statement or stored procedure.</span></span> <span data-ttu-id="c9e51-155">Stejně jako u našich TableAdapter metody v předchozí kurzy, použijte příkaz SQL ad-hoc rozhodnout pro tento jeden.</span><span class="sxs-lookup"><span data-stu-id="c9e51-155">As with our TableAdapter methods in previous tutorials, for this one opt to use an ad-hoc SQL statement.</span></span>


![Použití příkazu SQL Ad-Hoc](efficiently-paging-through-large-amounts-of-data-cs/_static/image1.png)

<span data-ttu-id="c9e51-157">**Obrázek 1**: použití příkazu SQL Ad-Hoc</span><span class="sxs-lookup"><span data-stu-id="c9e51-157">**Figure 1**: Use an Ad-Hoc SQL Statement</span></span>


<span data-ttu-id="c9e51-158">Na další obrazovce můžeme určit, jaký typ dotaz k vytvoření.</span><span class="sxs-lookup"><span data-stu-id="c9e51-158">On the next screen we can specify what type of query to create.</span></span> <span data-ttu-id="c9e51-159">Vzhledem k tomu, že tento dotaz vrátí jeden, skalární hodnotu celkový počet záznamů v `Products` vyberte tabulku `SELECT` která vrací hodnotu možnost jednom.</span><span class="sxs-lookup"><span data-stu-id="c9e51-159">Since this query will return a single, scalar value the total number of records in the `Products` table choose the `SELECT` which returns a singe value option.</span></span>


![Konfigurace dotaz, který bude použit příkaz SELECT, který vrací jedinou hodnotu](efficiently-paging-through-large-amounts-of-data-cs/_static/image2.png)

<span data-ttu-id="c9e51-161">**Obrázek 2**: Konfigurace dotaz, který bude použit příkaz SELECT, který vrací jedinou hodnotu</span><span class="sxs-lookup"><span data-stu-id="c9e51-161">**Figure 2**: Configure the Query to Use a SELECT Statement that Returns a Single Value</span></span>


<span data-ttu-id="c9e51-162">Po označující typ dotazu používat, musí další určíme dotazu.</span><span class="sxs-lookup"><span data-stu-id="c9e51-162">After indicating the type of query to use, we must next specify the query.</span></span>


![Použití vyberte COUNT(\*) z produktů dotazu](efficiently-paging-through-large-amounts-of-data-cs/_static/image3.png)

<span data-ttu-id="c9e51-164">**Obrázek 3**: použít vyberte počet (\*) FROM produkty dotazu</span><span class="sxs-lookup"><span data-stu-id="c9e51-164">**Figure 3**: Use the SELECT COUNT(\*) FROM Products Query</span></span>


<span data-ttu-id="c9e51-165">Nakonec zadejte název metody.</span><span class="sxs-lookup"><span data-stu-id="c9e51-165">Finally, specify the name for the method.</span></span> <span data-ttu-id="c9e51-166">Jako s zmíněnými, umožňují použít `TotalNumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="c9e51-166">As aforementioned, let s use `TotalNumberOfProducts`.</span></span>


![Název TotalNumberOfProducts DAL – metoda](efficiently-paging-through-large-amounts-of-data-cs/_static/image4.png)

<span data-ttu-id="c9e51-168">**Obrázek 4**: název TotalNumberOfProducts DAL – metoda</span><span class="sxs-lookup"><span data-stu-id="c9e51-168">**Figure 4**: Name the DAL Method TotalNumberOfProducts</span></span>


<span data-ttu-id="c9e51-169">Po kliknutí na tlačítko Dokončit, průvodce přidá `TotalNumberOfProducts` metoda vrstvy Dal.</span><span class="sxs-lookup"><span data-stu-id="c9e51-169">After clicking Finish, the wizard will add the `TotalNumberOfProducts` method to the DAL.</span></span> <span data-ttu-id="c9e51-170">Skalární vracejících metody v DAL vrátit typy podporující hodnoty Null v případě, že je výsledek v dotazu SQL `NULL`.</span><span class="sxs-lookup"><span data-stu-id="c9e51-170">The scalar returning methods in the DAL return nullable types, in case the result from the SQL query is `NULL`.</span></span> <span data-ttu-id="c9e51-171">Naše `COUNT` dotaz, ale vždy vrátí jinou hodnotu než`NULL` hodnoty; bez ohledu na to, vrátí metoda DAL s možnou hodnotou Null celé číslo.</span><span class="sxs-lookup"><span data-stu-id="c9e51-171">Our `COUNT` query, however, will always return a non-`NULL` value; regardless, the DAL method returns a nullable integer.</span></span>

<span data-ttu-id="c9e51-172">Kromě metodu DAL potřebujeme také metoda v BLL.</span><span class="sxs-lookup"><span data-stu-id="c9e51-172">In addition to the DAL method, we also need a method in the BLL.</span></span> <span data-ttu-id="c9e51-173">Otevřete `ProductsBLL` třídy souboru a přidejte `TotalNumberOfProducts` metoda, která jednoduše volá, aby se DAL s `TotalNumberOfProducts` metoda:</span><span class="sxs-lookup"><span data-stu-id="c9e51-173">Open the `ProductsBLL` class file and add a `TotalNumberOfProducts` method that simply calls down to the DAL s `TotalNumberOfProducts` method:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample2.cs)]

<span data-ttu-id="c9e51-174">DAL s `TotalNumberOfProducts` metoda vrátí celé číslo s možnou hodnotou Null, nicméně jsme vytvořili, `ProductsBLL` třídu s `TotalNumberOfProducts` metody, které se vrátí standardní celé číslo.</span><span class="sxs-lookup"><span data-stu-id="c9e51-174">The DAL s `TotalNumberOfProducts` method returns a nullable integer; however, we ve created the `ProductsBLL` class s `TotalNumberOfProducts` method so that it returns a standard integer.</span></span> <span data-ttu-id="c9e51-175">Proto je potřeba mít `ProductsBLL` třídu s `TotalNumberOfProducts` metoda vrátí hodnotu část s možnou hodnotou Null celé číslo vrácené DAL s `TotalNumberOfProducts` metoda.</span><span class="sxs-lookup"><span data-stu-id="c9e51-175">Therefore, we need to have the `ProductsBLL` class s `TotalNumberOfProducts` method return the value portion of the nullable integer returned by the DAL s `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="c9e51-176">Volání `GetValueOrDefault()` vrací hodnotu na celé číslo s možnou hodnotou Null, pokud existuje; Pokud je na celé číslo s možnou hodnotou Null `null`, ale vrátí výchozí hodnota celé číslo, 0.</span><span class="sxs-lookup"><span data-stu-id="c9e51-176">The call to `GetValueOrDefault()` returns the value of the nullable integer, if it exists; if the nullable integer is `null`, however, it returns the default integer value, 0.</span></span>

## <a name="step-3-returning-the-precise-subset-of-records"></a><span data-ttu-id="c9e51-177">Krok 3: Vrácení přesné dílčí sady záznamů</span><span class="sxs-lookup"><span data-stu-id="c9e51-177">Step 3: Returning the Precise Subset of Records</span></span>

<span data-ttu-id="c9e51-178">Naše dalším krokem je vytvoření metod v DAL a BLL, který přijímat Index řádku spustit a maximální počet řádků proměnné už jsme probírali výše a vrátí příslušné záznamy.</span><span class="sxs-lookup"><span data-stu-id="c9e51-178">Our next task is to create methods in the DAL and BLL that accept the Start Row Index and Maximum Rows variables discussed earlier and return the appropriate records.</span></span> <span data-ttu-id="c9e51-179">Než to, umožňují s první pohled na potřebné skript SQL.</span><span class="sxs-lookup"><span data-stu-id="c9e51-179">Before we do that, let s first look at the needed SQL script.</span></span> <span data-ttu-id="c9e51-180">Výzvy, kterým čelí nám je, že jsme musí být schopen efektivně přiřadit indexu na každý řádek ve výsledcích celý stránkování prostřednictvím tak, aby vrátíme pouze tyto záznamy spouštění na řádek indexu spustit (a až zaznamenává maximální počet záznamů).</span><span class="sxs-lookup"><span data-stu-id="c9e51-180">The challenge facing us is that we must be able to efficiently assign an index to each row in the entire results being paged through so that we can return just those records starting at the Start Row Index (and up to the Maximum Records number of records).</span></span>

<span data-ttu-id="c9e51-181">Toto není výzvu, pokud již existuje sloupec v tabulce databáze, která slouží jako index řádku.</span><span class="sxs-lookup"><span data-stu-id="c9e51-181">This is not a challenge if there is already a column in the database table that serves as a row index.</span></span> <span data-ttu-id="c9e51-182">Na první pohled může myslíme si, která `Products` tabulky s `ProductID` by stačit pole, jako má první produktu `ProductID` 1, druhý a 2, a tak dále.</span><span class="sxs-lookup"><span data-stu-id="c9e51-182">At first glance we might think that the `Products` table s `ProductID` field would suffice, as the first product has `ProductID` of 1, the second a 2, and so on.</span></span> <span data-ttu-id="c9e51-183">Odstranění produktu však zanechává mezera v sekvenci, anulovány tento přístup.</span><span class="sxs-lookup"><span data-stu-id="c9e51-183">However, deleting a product leaves a gap in the sequence, nullifying this approach.</span></span>

<span data-ttu-id="c9e51-184">Existují dvě obecné postupy používané k efektivní přidružit index řádku s daty na stránku prostřednictvím, zpřístupňují přesné dílčí sadu záznamů, které mají být načteny:</span><span class="sxs-lookup"><span data-stu-id="c9e51-184">There are two general techniques used to efficiently associate a row index with the data to page through, thereby enabling the precise subset of records to be retrieved:</span></span>

- <span data-ttu-id="c9e51-185">**Pomocí systému SQL Server 2005 s `ROW_NUMBER()` – klíčové slovo** nový SQL Server 2005, `ROW_NUMBER()` – klíčové slovo přidruží hodnoticí každý vrácený záznam podle pořadí.</span><span class="sxs-lookup"><span data-stu-id="c9e51-185">**Using SQL Server 2005 s `ROW_NUMBER()` Keyword** new to SQL Server 2005, the `ROW_NUMBER()` keyword associates a ranking with each returned record based on some ordering.</span></span> <span data-ttu-id="c9e51-186">Toto pořadí slouží jako index řádku pro každý řádek.</span><span class="sxs-lookup"><span data-stu-id="c9e51-186">This ranking can be used as a row index for each row.</span></span>
- <span data-ttu-id="c9e51-187">**Pomocí proměnné tabulky a `SET ROWCOUNT`**  systému SQL Server s [ `SET ROWCOUNT` příkaz](https://msdn.microsoft.com/library/ms188774.aspx) umožňuje určit počet celkový počet záznamů dotaz by měl zpracovat před ukončením; [tabulky proměnné](http://www.sqlteam.com/item.asp?ItemID=9454) jsou místní proměnné T-SQL, které mohou být uloženy tabulková data akin k [dočasných tabulek](http://www.sqlteam.com/item.asp?ItemID=2029).</span><span class="sxs-lookup"><span data-stu-id="c9e51-187">**Using a Table Variable and `SET ROWCOUNT`** SQL Server s [`SET ROWCOUNT` statement](https://msdn.microsoft.com/library/ms188774.aspx) can be used to specify how many total records a query should process before terminating; [table variables](http://www.sqlteam.com/item.asp?ItemID=9454) are local T-SQL variables that can hold tabular data, akin to [temporary tables](http://www.sqlteam.com/item.asp?ItemID=2029).</span></span> <span data-ttu-id="c9e51-188">Tento postup funguje stejně dobře s Microsoft SQL Server 2005 a SQL Server 2000 (vzhledem k tomu `ROW_NUMBER()` přístup pracuje pouze s SQL Server 2005).</span><span class="sxs-lookup"><span data-stu-id="c9e51-188">This approach works equally well with both Microsoft SQL Server 2005 and SQL Server 2000 (whereas the `ROW_NUMBER()` approach only works with SQL Server 2005).</span></span>  
  
 <span data-ttu-id="c9e51-189">Rada tady je vytvoření proměnné tabulky, která má `IDENTITY` sloupce a sloupce pro primární klíče v tabulce, jejichž data se prostřednictvím stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-189">The idea here is to create a table variable that has an `IDENTITY` column and columns for the primary keys of the table whose data is being paged through.</span></span> <span data-ttu-id="c9e51-190">V dalším kroku obsah tabulky, jejichž data je stránkování prostřednictvím vypsána do proměnné tabulky, a tím přidružení sekvenční řádek indexu (prostřednictvím `IDENTITY` sloupec) pro každý záznam v tabulce.</span><span class="sxs-lookup"><span data-stu-id="c9e51-190">Next, the contents of the table whose data is being paged through is dumped into the table variable, thereby associating a sequential row index (via the `IDENTITY` column) for each record in the table.</span></span> <span data-ttu-id="c9e51-191">Po naplnění proměnnou tabulky `SELECT` příkaz na proměnnou tabulky spojena s podkladové tabulce, mohou být provedeny vysunout konkrétní záznamy.</span><span class="sxs-lookup"><span data-stu-id="c9e51-191">Once the table variable has been populated, a `SELECT` statement on the table variable, joined with the underlying table, can be executed to pull out the particular records.</span></span> <span data-ttu-id="c9e51-192">`SET ROWCOUNT` Se použije příkaz inteligentně omezit počet záznamů, které je třeba uložit do proměnné tabulky.</span><span class="sxs-lookup"><span data-stu-id="c9e51-192">The `SET ROWCOUNT` statement is used to intelligently limit the number of records that need to be dumped into the table variable.</span></span>  
  
 <span data-ttu-id="c9e51-193">Této efektivity přístup s je založena na číslo stránky, které jsou požadovány, jako `SET ROWCOUNT` hodnota je přiřazena na hodnotu Index řádku spustit a maximální počet řádků.</span><span class="sxs-lookup"><span data-stu-id="c9e51-193">This approach s efficiency is based on the page number being requested, as the `SET ROWCOUNT` value is assigned the value of Start Row Index plus the Maximum Rows.</span></span> <span data-ttu-id="c9e51-194">Při procházení nízká číslované stránky, jako je například první několik stránek dat. Tento přístup je velmi efektivní.</span><span class="sxs-lookup"><span data-stu-id="c9e51-194">When paging through low-numbered pages such as the first few pages of data this approach is very efficient.</span></span> <span data-ttu-id="c9e51-195">Ale vykazuje výkonu stránkování jako výchozí při načítání stránky poblíž konce.</span><span class="sxs-lookup"><span data-stu-id="c9e51-195">However, it exhibits default paging-like performance when retrieving a page near the end.</span></span>

<span data-ttu-id="c9e51-196">V tomto kurzu implementuje pomocí vlastní stránkování `ROW_NUMBER()` – klíčové slovo.</span><span class="sxs-lookup"><span data-stu-id="c9e51-196">This tutorial implements custom paging using the `ROW_NUMBER()` keyword.</span></span> <span data-ttu-id="c9e51-197">Další informace o používání proměnnou tabulky a `SET ROWCOUNT` techniku, najdete v části [A Další efektivní metodu pro stránkování prostřednictvím velkých sad výsledků dotazu](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="c9e51-197">For more information on using the table variable and `SET ROWCOUNT` technique, see [A More Efficient Method for Paging Through Large Result Sets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span></span>

<span data-ttu-id="c9e51-198">`ROW_NUMBER()` – Klíčové slovo přidružené hodnoticí jednotlivých záznamů vrácených přes konkrétní řazení pomocí následující syntaxe:</span><span class="sxs-lookup"><span data-stu-id="c9e51-198">The `ROW_NUMBER()` keyword associated a ranking with each record returned over a particular ordering using the following syntax:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample3.sql)]

<span data-ttu-id="c9e51-199">`ROW_NUMBER()`vrátí číselnou hodnotu, která určuje pořadí pro každý záznam s ohledem na uvedené řazení.</span><span class="sxs-lookup"><span data-stu-id="c9e51-199">`ROW_NUMBER()` returns a numerical value that specifies the rank for each record with regards to the indicated ordering.</span></span> <span data-ttu-id="c9e51-200">Například zobrazíte pořadí pro jednotlivé produkty, seřazené z nejvíc nákladné nejmenší, můžeme použít následující dotaz:</span><span class="sxs-lookup"><span data-stu-id="c9e51-200">For example, to see the rank for each product, ordered from the most expensive to the least, we could use the following query:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample4.sql)]

<span data-ttu-id="c9e51-201">Obrázek 5 ukazuje tento dotaz s výsledky při spuštění pomocí okna dotazu v sadě Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c9e51-201">Figure 5 shows this query s results when run through the query window in Visual Studio.</span></span> <span data-ttu-id="c9e51-202">Všimněte si, že tyto produkty jsou seřazené podle ceníku spolu s pořadí ceny pro každý řádek.</span><span class="sxs-lookup"><span data-stu-id="c9e51-202">Note that the products are ordered by price, along with a price rank for each row.</span></span>


![Cena pořadí je zahrnuté pro každý záznam se vrátí](efficiently-paging-through-large-amounts-of-data-cs/_static/image5.png)

<span data-ttu-id="c9e51-204">**Obrázek 5**: je zahrnuta pořadí ceny pro každý záznam se vrátí</span><span class="sxs-lookup"><span data-stu-id="c9e51-204">**Figure 5**: The Price Rank is Included for Each Returned Record</span></span>


> [!NOTE]
> <span data-ttu-id="c9e51-205">`ROW_NUMBER()`je jen jednou z mnoha nových funkcí hodnocení k dispozici v systému SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="c9e51-205">`ROW_NUMBER()` is just one of the many new ranking functions available in SQL Server 2005.</span></span> <span data-ttu-id="c9e51-206">Podrobnější diskuzi o `ROW_NUMBER()`, spolu s dalšími funkcemi hodnocení, přečtěte si [vrácení seřazeny výsledků s Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="c9e51-206">For a more thorough discussion of `ROW_NUMBER()`, along with the other ranking functions, read [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span></span>


<span data-ttu-id="c9e51-207">Při řazení výsledků k zadanému `ORDER BY` sloupec v `OVER` – klauzule (`UnitPrice`, v předchozím příkladu), SQL Server musí řazení výsledků.</span><span class="sxs-lookup"><span data-stu-id="c9e51-207">When ranking the results by the specified `ORDER BY` column in the `OVER` clause (`UnitPrice`, in the above example), SQL Server must sort the results.</span></span> <span data-ttu-id="c9e51-208">To je rychlý operace v případě clusterovaného indexu přes sloupcům, které jsou právě výsledky seřazené podle, nebo pokud je zahrnut indexu, ale může být dražší jinak.</span><span class="sxs-lookup"><span data-stu-id="c9e51-208">This is a quick operation if there is a clustered index over the column(s) the results are being ordered by, or if there is a covering index, but can be more costly otherwise.</span></span> <span data-ttu-id="c9e51-209">Zlepšení výkonu pro dotazy na dostatečně velký, zvažte přidání neclusterovaný index pro sloupec, podle kterého jsou výsledky seřazené podle.</span><span class="sxs-lookup"><span data-stu-id="c9e51-209">To help improve performance for sufficiently large queries, consider adding a non-clustered index for the column by which the results are ordered by.</span></span> <span data-ttu-id="c9e51-210">V tématu [řazení funkcí a výkonu v systému SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) pro podrobnější pohled na důležité informace o výkonu.</span><span class="sxs-lookup"><span data-stu-id="c9e51-210">See [Ranking Functions and Performance in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) for a more detailed look at the performance considerations.</span></span>

<span data-ttu-id="c9e51-211">Informace o hodnocení, vrácené `ROW_NUMBER()` nelze použít přímo v `WHERE` klauzule.</span><span class="sxs-lookup"><span data-stu-id="c9e51-211">The ranking information returned by `ROW_NUMBER()` cannot directly be used in the `WHERE` clause.</span></span> <span data-ttu-id="c9e51-212">Však lze vrátit odvozené tabulky `ROW_NUMBER()` výsledek, který lze potom zobrazí v `WHERE` klauzule.</span><span class="sxs-lookup"><span data-stu-id="c9e51-212">However, a derived table can be used to return the `ROW_NUMBER()` result, which can then appear in the `WHERE` clause.</span></span> <span data-ttu-id="c9e51-213">Například následující dotaz používá odvozenou tabulku vrátit sloupce ProductName a UnitPrice spolu s `ROW_NUMBER()` výsledek a pak používá `WHERE` klauzule pouze vráceny produkty, jejichž pořadí cena je 11 až 20:</span><span class="sxs-lookup"><span data-stu-id="c9e51-213">For example, the following query uses a derived table to return the ProductName and UnitPrice columns, along with the `ROW_NUMBER()` result, and then uses a `WHERE` clause to only return those products whose price rank is between 11 and 20:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample5.sql)]

<span data-ttu-id="c9e51-214">Rozšíření tento koncept trochu další, můžeme využívat tuto metodu pro načtení konkrétní stránky požadované hodnoty Start Index řádku a maximální počet řádků dat:</span><span class="sxs-lookup"><span data-stu-id="c9e51-214">Extending this concept a bit further, we can utilize this approach to retrieve a specific page of data given the desired Start Row Index and Maximum Rows values:</span></span>


[!code-html[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample6.html)]

> [!NOTE]
> <span data-ttu-id="c9e51-215">Jak jsme se zobrazí později v tomto kurzu  *`StartRowIndex`*  poskytl ObjectDataSource je indexovaný začínající na nule, zatímco `ROW_NUMBER()` hodnoty vrácené systému SQL Server 2005 je indexovaný začínajícím hodnotou 1.</span><span class="sxs-lookup"><span data-stu-id="c9e51-215">As we will see later on in this tutorial, the *`StartRowIndex`* supplied by the ObjectDataSource is indexed starting at zero, whereas the `ROW_NUMBER()` value returned by SQL Server 2005 is indexed starting at 1.</span></span> <span data-ttu-id="c9e51-216">Proto `WHERE` klauzule vrací tyto záznamy kde `PriceRank` striktně větší než  *`StartRowIndex`*  a menší než nebo rovno  *`StartRowIndex`*   +  *`MaximumRows`*.</span><span class="sxs-lookup"><span data-stu-id="c9e51-216">Therefore, the `WHERE` clause returns those records where `PriceRank` is strictly greater than *`StartRowIndex`* and less than or equal to *`StartRowIndex`* + *`MaximumRows`*.</span></span>


<span data-ttu-id="c9e51-217">Nyní který jsme sunout popsané jak `ROW_NUMBER()` lze použít k načtení konkrétní stránky data hodnoty Start Index řádku a maximální počet řádků, teď musíme implementovat tuto logiku jako metody v DAL a BLL.</span><span class="sxs-lookup"><span data-stu-id="c9e51-217">Now that we ve discussed how `ROW_NUMBER()` can be used to retrieve a particular page of data given the Start Row Index and Maximum Rows values, we now need to implement this logic as methods in the DAL and BLL.</span></span>

<span data-ttu-id="c9e51-218">Při vytváření tohoto dotazu, že jsme musíte se rozhodnout řazení podle kterého výsledky se určí; umožní s produkty seřadit podle názvu jejich v abecedním pořadí.</span><span class="sxs-lookup"><span data-stu-id="c9e51-218">When creating this query we must decide the ordering by which the results will be ranked; let s sort the products by their name in alphabetical order.</span></span> <span data-ttu-id="c9e51-219">To znamená, že s vlastní implementaci stránkování v tomto kurzu jsme nebude možné vytvořit vlastní sestavu stránkové, než můžete také řadit.</span><span class="sxs-lookup"><span data-stu-id="c9e51-219">This means that with the custom paging implementation in this tutorial we will not be able to create a custom paged report than can also be sorted.</span></span> <span data-ttu-id="c9e51-220">V dalším kurzu ale uvidíme jak takové funkce lze zadat.</span><span class="sxs-lookup"><span data-stu-id="c9e51-220">In the next tutorial, though, we'll see how such functionality can be provided.</span></span>

<span data-ttu-id="c9e51-221">V předchozí části jsme vytvořili metodu DAL jako příkaz SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="c9e51-221">In the previous section we created the DAL method as an ad-hoc SQL statement.</span></span> <span data-ttu-id="c9e51-222">Bohužel analyzátor T-SQL v sadě Visual Studio používá t nemá průvodce nastavením TableAdapter jako `OVER` syntaxe používané `ROW_NUMBER()` funkce.</span><span class="sxs-lookup"><span data-stu-id="c9e51-222">Unfortunately, the T-SQL parser in Visual Studio used by the TableAdapter wizard doesn t like the `OVER` syntax used by the `ROW_NUMBER()` function.</span></span> <span data-ttu-id="c9e51-223">Tato metoda DAL jsme proto musíte vytvořit jako uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="c9e51-223">Therefore, we must create this DAL method as a stored procedure.</span></span> <span data-ttu-id="c9e51-224">Vyberte Průzkumníka serveru v nabídce zobrazení (nebo v počtu Ctrl + Alt + S) a rozbalte `NORTHWND.MDF` uzlu.</span><span class="sxs-lookup"><span data-stu-id="c9e51-224">Select the Server Explorer from the View menu (or hit Ctrl+Alt+S) and expand the `NORTHWND.MDF` node.</span></span> <span data-ttu-id="c9e51-225">Pokud chcete přidat nové uložené procedury, klikněte pravým tlačítkem na uzel uložené procedury a zvolte možnost Přidat nové uloženou proceduru (viz obrázek 6).</span><span class="sxs-lookup"><span data-stu-id="c9e51-225">To add a new stored procedure, right-click on the Stored Procedures node and choose Add a New Stored Procedure (see Figure 6).</span></span>


![Přidat nové uložené procedury pro stránkování prostřednictvím produkty](efficiently-paging-through-large-amounts-of-data-cs/_static/image6.png)

<span data-ttu-id="c9e51-227">**Obrázek 6**: Přidání nové uložené procedury pro stránkování prostřednictvím produkty</span><span class="sxs-lookup"><span data-stu-id="c9e51-227">**Figure 6**: Add a New Stored Procedure for Paging Through the Products</span></span>


<span data-ttu-id="c9e51-228">Tuto uloženou proceduru musí přijmout dva vstupní parametry celé číslo - `@startRowIndex` a `@maximumRows` a použít `ROW_NUMBER()` funkce seřazené podle `ProductName` pole, které vrací pouze řádky větší než zadaná `@startRowIndex` a menší než nebo rovno `@startRowIndex`  +  `@maximumRow` s.</span><span class="sxs-lookup"><span data-stu-id="c9e51-228">This stored procedure should accept two integer input parameters - `@startRowIndex` and `@maximumRows` and use the `ROW_NUMBER()` function ordered by the `ProductName` field, returning only those rows greater than the specified `@startRowIndex` and less than or equal to `@startRowIndex` + `@maximumRow` s.</span></span> <span data-ttu-id="c9e51-229">Zadejte následující skript do nové uložené procedury a pak klikněte na ikonu Uložit Přidat uloženou proceduru k databázi.</span><span class="sxs-lookup"><span data-stu-id="c9e51-229">Enter the following script into the new stored procedure and then click the Save icon to add the stored procedure to the database.</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample7.sql)]

<span data-ttu-id="c9e51-230">Po vytvoření uložené procedury, pozorně otestování. Klikněte pravým tlačítkem na `GetProductsPaged` uložené procedury název v Průzkumníku serveru a vyberte možnost spustit.</span><span class="sxs-lookup"><span data-stu-id="c9e51-230">After creating the stored procedure, take a moment to test it out. Right-click on the `GetProductsPaged` stored procedure name in the Server Explorer and choose the Execute option.</span></span> <span data-ttu-id="c9e51-231">Visual Studio se potom zobrazí výzvu pro vstupní parametry `@startRowIndex` a `@maximumRow` s (viz obrázek 7).</span><span class="sxs-lookup"><span data-stu-id="c9e51-231">Visual Studio will then prompt you for the input parameters, `@startRowIndex` and `@maximumRow` s (see Figure 7).</span></span> <span data-ttu-id="c9e51-232">Zkuste různé hodnoty a podívejte se na výsledky.</span><span class="sxs-lookup"><span data-stu-id="c9e51-232">Try different values and examine the results.</span></span>


![Zadejte hodnotu @startRowIndex a @maximumRows parametry](efficiently-paging-through-large-amounts-of-data-cs/_static/image7.png)

<span data-ttu-id="c9e51-234">**Obrázek 7**: Zadejte hodnotu @startRowIndex a @maximumRows parametry</span><span class="sxs-lookup"><span data-stu-id="c9e51-234">**Figure 7**: Enter a Value for the @startRowIndex and @maximumRows Parameters</span></span>


<span data-ttu-id="c9e51-235">Po výběru těchto vstupních hodnot parametrů, ve výstupním okně se zobrazí výsledky.</span><span class="sxs-lookup"><span data-stu-id="c9e51-235">After choosing these input parameters values, the Output window will show the results.</span></span> <span data-ttu-id="c9e51-236">Obrázek 8 ukazuje výsledky při předávání v 10 pro oba `@startRowIndex` a `@maximumRows` parametry.</span><span class="sxs-lookup"><span data-stu-id="c9e51-236">Figure 8 shows the results when passing in 10 for both the `@startRowIndex` and `@maximumRows` parameters.</span></span>


<span data-ttu-id="c9e51-237">[![Jsou vráceny záznamy, by se zobrazí v druhé Data stránky](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="c9e51-237">[![The Records That Would Appear in the Second Page of Data are Returned](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span></span>

<span data-ttu-id="c9e51-238">**Obrázek 8**: záznamů, by se zobrazí v druhé stránce Data jsou vrácena ([Kliknutím zobrazit obrázek v plné velikosti](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="c9e51-238">**Figure 8**: The Records That Would Appear in the Second Page of Data are Returned ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span></span>


<span data-ttu-id="c9e51-239">Pomocí této uložené procedury vytvořili, jsme re připravené k vytvoření `ProductsTableAdapter` metoda.</span><span class="sxs-lookup"><span data-stu-id="c9e51-239">With this stored procedure created, we re ready to create the `ProductsTableAdapter` method.</span></span> <span data-ttu-id="c9e51-240">Otevřete `Northwind.xsd` zadané v datové sadě klikněte pravým tlačítkem v `ProductsTableAdapter`a zvolte možnost Přidat dotazu.</span><span class="sxs-lookup"><span data-stu-id="c9e51-240">Open the `Northwind.xsd` Typed DataSet, right-click in the `ProductsTableAdapter`, and choose the Add Query option.</span></span> <span data-ttu-id="c9e51-241">Místo vytvoření dotazu pomocí příkazu SQL ad-hoc, vytvořte ho pomocí existující uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="c9e51-241">Instead of creating the query using an ad-hoc SQL statement, create it using an existing stored procedure.</span></span>


![Create – metoda DAL použití existující uložené procedury](efficiently-paging-through-large-amounts-of-data-cs/_static/image11.png)

<span data-ttu-id="c9e51-243">**Obrázek 9**: vytvoření metody DAL použití existující uložené procedury</span><span class="sxs-lookup"><span data-stu-id="c9e51-243">**Figure 9**: Create the DAL Method Using an Existing Stored Procedure</span></span>


<span data-ttu-id="c9e51-244">V dalším kroku jsme vyzváni k výběru uložená procedura vyvolat.</span><span class="sxs-lookup"><span data-stu-id="c9e51-244">Next, we are prompted to select the stored procedure to invoke.</span></span> <span data-ttu-id="c9e51-245">Vyberte `GetProductsPaged` uložené procedury z rozevíracího seznamu.</span><span class="sxs-lookup"><span data-stu-id="c9e51-245">Pick the `GetProductsPaged` stored procedure from the drop-down list.</span></span>


![Vyberte GetProductsPaged uložené procedury z rozevíracího seznamu](efficiently-paging-through-large-amounts-of-data-cs/_static/image12.png)

<span data-ttu-id="c9e51-247">**Obrázek 10**: Zvolte GetProductsPaged uložené procedury z rozevíracího seznamu</span><span class="sxs-lookup"><span data-stu-id="c9e51-247">**Figure 10**: Choose the GetProductsPaged Stored Procedure from the Drop-Down List</span></span>


<span data-ttu-id="c9e51-248">Na další obrazovce pak zeptá, jaký typ dat je vrácený uložené procedury: tabulková data, jedna hodnota nebo žádná hodnota.</span><span class="sxs-lookup"><span data-stu-id="c9e51-248">The next screen then asks you what kind of data is returned by the stored procedure: tabular data, a single value, or no value.</span></span> <span data-ttu-id="c9e51-249">Vzhledem k tomu `GetProductsPaged` uložená procedura může vrátit více záznamů, znamenat, že vrací tabulková data.</span><span class="sxs-lookup"><span data-stu-id="c9e51-249">Since the `GetProductsPaged` stored procedure can return multiple records, indicate that it returns tabular data.</span></span>


![Označuje, že uložené procedury vrátí tabulková Data](efficiently-paging-through-large-amounts-of-data-cs/_static/image13.png)

<span data-ttu-id="c9e51-251">**Obrázek 11**: znamenat, že uložené procedury vrátí tabulková Data</span><span class="sxs-lookup"><span data-stu-id="c9e51-251">**Figure 11**: Indicate that the Stored Procedure Returns Tabular Data</span></span>


<span data-ttu-id="c9e51-252">Nakonec znamenat názvy metod, které chcete jste vytvořili.</span><span class="sxs-lookup"><span data-stu-id="c9e51-252">Finally, indicate the names of the methods you want to have created.</span></span> <span data-ttu-id="c9e51-253">Stejně jako u naše kurzy předchozí pokračujte a vytvořte metod pomocí obou výplně DataTable a vrátit DataTable.</span><span class="sxs-lookup"><span data-stu-id="c9e51-253">As with our previous tutorials, go ahead and create methods using both the Fill a DataTable and Return a DataTable.</span></span> <span data-ttu-id="c9e51-254">Název první metodu `FillPaged` a druhý `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="c9e51-254">Name the first method `FillPaged` and the second `GetProductsPaged`.</span></span>


![Název metody FillPaged a GetProductsPaged](efficiently-paging-through-large-amounts-of-data-cs/_static/image14.png)

<span data-ttu-id="c9e51-256">**Obrázek 12**: název metody FillPaged a GetProductsPaged</span><span class="sxs-lookup"><span data-stu-id="c9e51-256">**Figure 12**: Name the Methods FillPaged and GetProductsPaged</span></span>


<span data-ttu-id="c9e51-257">Kromě toho vytvořit DAL metody vrátit konkrétní stránky produktů, také potřebujeme nabízí takové funkce v BLL.</span><span class="sxs-lookup"><span data-stu-id="c9e51-257">In addition to created a DAL method to return a particular page of products, we also need to provide such functionality in the BLL.</span></span> <span data-ttu-id="c9e51-258">Jako metodu DAL BLL s GetProductsPaged metoda dva vstupy celé číslo pro zadání spustit Index řádku a maximální počet řádků, musíte přijmout a musí vracet pouze tyto záznamy, které spadají do zadaného rozsahu.</span><span class="sxs-lookup"><span data-stu-id="c9e51-258">Like the DAL method, the BLL s GetProductsPaged method must accept two integer inputs for specifying the Start Row Index and Maximum Rows, and must return just those records that fall within the specified range.</span></span> <span data-ttu-id="c9e51-259">Vytvořte BLL metody ve třídě ProductsBLL jenom volání dolů do vrstvy DAL s GetProductsPaged metoda, například takto:</span><span class="sxs-lookup"><span data-stu-id="c9e51-259">Create such a BLL method in the ProductsBLL class that merely calls down into the DAL s GetProductsPaged method, like so:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample8.cs)]

<span data-ttu-id="c9e51-260">Můžete použít libovolný název pro vstupní parametry BLL metoda s ale, jak jsme se zobrazí za chvíli rozhodnete použít `startRowIndex` a `maximumRows` uloží nám z další bit práce při konfiguraci ObjectDataSource při použití této metody.</span><span class="sxs-lookup"><span data-stu-id="c9e51-260">You can use any name for the BLL method s input parameters, but, as we will see shortly, choosing to use `startRowIndex` and `maximumRows` saves us from an extra bit of work when configuring an ObjectDataSource to use this method.</span></span>

## <a name="step-4-configuring-the-objectdatasource-to-use-custom-paging"></a><span data-ttu-id="c9e51-261">Krok 4: Konfigurace ObjectDataSource používat vlastní stránkování</span><span class="sxs-lookup"><span data-stu-id="c9e51-261">Step 4: Configuring the ObjectDataSource to Use Custom Paging</span></span>

<span data-ttu-id="c9e51-262">Metody BLL a DAL pro přístup k určité podmnožiny záznamů dokončení jsme re připravené k vytvoření GridView kontrolu této stránky prostřednictvím jeho základní záznamů pomocí vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-262">With the BLL and DAL methods for accessing a particular subset of records complete, we re ready to create a GridView control that pages through its underlying records using custom paging.</span></span> <span data-ttu-id="c9e51-263">Začněte otevřením `EfficientPaging.aspx` stránku `PagingAndSorting` složku, rutina GridView přidat na stránku a nakonfigurujte ho na použití nového ovládacího prvku ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="c9e51-263">Start by opening the `EfficientPaging.aspx` page in the `PagingAndSorting` folder, add a GridView to the page, and configure it to use a new ObjectDataSource control.</span></span> <span data-ttu-id="c9e51-264">V našem posledních kurzech jsme často měli ObjectDataSource nakonfigurovaná pro použití `ProductsBLL` třídu s `GetProducts` metoda.</span><span class="sxs-lookup"><span data-stu-id="c9e51-264">In our past tutorials, we often had the ObjectDataSource configured to use the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="c9e51-265">Tentokrát ale chceme používat `GetProductsPaged` metoda místo toho od `GetProducts` metoda vrátí *všechny* produktů v databázi zatímco `GetProductsPaged` vrátí pouze konkrétní podmnožinu záznamů.</span><span class="sxs-lookup"><span data-stu-id="c9e51-265">This time, however, we want to use the `GetProductsPaged` method instead, since the `GetProducts` method returns *all* of the products in the database whereas `GetProductsPaged` returns just a particular subset of records.</span></span>


![Konfigurace ObjectDataSource lze pomocí této metody GetProductsPaged ProductsBLL třídu s](efficiently-paging-through-large-amounts-of-data-cs/_static/image15.png)

<span data-ttu-id="c9e51-267">**Obrázek 13**: Konfigurace ObjectDataSource lze pomocí této metody GetProductsPaged ProductsBLL třídu s</span><span class="sxs-lookup"><span data-stu-id="c9e51-267">**Figure 13**: Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method</span></span>


<span data-ttu-id="c9e51-268">Od jsme re vytváření jen pro čtení GridView za chvíli nastavit metoda rozevíracím seznamu v příkaz INSERT, UPDATE a odstraňte karty na (žádný).</span><span class="sxs-lookup"><span data-stu-id="c9e51-268">Since we re creating a read-only GridView, take a moment to set the method drop-down list in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="c9e51-269">V dalším kroku ObjectDataSource průvodce k zadání nám zdroje `GetProductsPaged` metoda s `startRowIndex` a `maximumRows` vstupních hodnot parametrů.</span><span class="sxs-lookup"><span data-stu-id="c9e51-269">Next, the ObjectDataSource wizard prompts us for the sources of the `GetProductsPaged` method s `startRowIndex` and `maximumRows` input parameters values.</span></span> <span data-ttu-id="c9e51-270">Tyto vstupní parametry, jednoduše se ve skutečnosti nastavit GridView automaticky nechte zdrojovou sadu na hodnotu None a klikněte na tlačítko Dokončit.</span><span class="sxs-lookup"><span data-stu-id="c9e51-270">These input parameters will actually be set by the GridView automatically, so simply leave the source set to None and click Finish.</span></span>


![Nechte zdroje vstupní parametr jako None](efficiently-paging-through-large-amounts-of-data-cs/_static/image16.png)

<span data-ttu-id="c9e51-272">**Obrázek 14**: ponechte zdroje vstupní parametr jako None</span><span class="sxs-lookup"><span data-stu-id="c9e51-272">**Figure 14**: Leave the Input Parameter Sources as None</span></span>


<span data-ttu-id="c9e51-273">Po dokončení Průvodce ObjectDataSource, bude GridView obsahovat BoundField nebo vlastnost CheckBoxField pro každé pole data produktu.</span><span class="sxs-lookup"><span data-stu-id="c9e51-273">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="c9e51-274">Nebojte se, že přizpůsobení vzhledu s GridView podle svých potřeb.</span><span class="sxs-lookup"><span data-stu-id="c9e51-274">Feel free to tailor the GridView s appearance as you see fit.</span></span> <span data-ttu-id="c9e51-275">I sunout vyjádřit výslovný souhlas pro zobrazení jenom `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, a `UnitPrice` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="c9e51-275">I ve opted to display only the `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, and `UnitPrice` BoundFields.</span></span> <span data-ttu-id="c9e51-276">Navíc nakonfigurujte GridView pro podporu stránkování zaškrtnutím políčka Povolit stránkování v jeho inteligentních značek.</span><span class="sxs-lookup"><span data-stu-id="c9e51-276">Also, configure the GridView to support paging by checking the Enable Paging checkbox in its smart tag.</span></span> <span data-ttu-id="c9e51-277">Po provedení těchto změn GridView a ObjectDataSource deklarativní by měl vypadat podobně jako následující:</span><span class="sxs-lookup"><span data-stu-id="c9e51-277">After these changes, the GridView and ObjectDataSource declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample9.aspx)]

<span data-ttu-id="c9e51-278">Pokud navštívíte stránku prostřednictvím prohlížeče, ale GridView je žádná, kdy chcete vyhledat.</span><span class="sxs-lookup"><span data-stu-id="c9e51-278">If you visit the page through a browser, however, the GridView is no where to be found.</span></span>


![GridView se nezobrazí](efficiently-paging-through-large-amounts-of-data-cs/_static/image17.png)

<span data-ttu-id="c9e51-280">**Obrázek 15**: The GridView se nezobrazí</span><span class="sxs-lookup"><span data-stu-id="c9e51-280">**Figure 15**: The GridView is Not Displayed</span></span>


<span data-ttu-id="c9e51-281">Protože ObjectDataSource aktuálně používá 0 jako hodnoty pro obě chybí GridView `GetProductsPaged` `startRowIndex` a `maximumRows` vstupní parametry.</span><span class="sxs-lookup"><span data-stu-id="c9e51-281">The GridView is missing because the ObjectDataSource is currently using 0 as the values for both of the `GetProductsPaged` `startRowIndex` and `maximumRows` input parameters.</span></span> <span data-ttu-id="c9e51-282">Proto výsledný dotaz SQL vrací žádné záznamy a proto GridView nezobrazuje.</span><span class="sxs-lookup"><span data-stu-id="c9e51-282">Hence, the resulting SQL query is returning no records and therefore the GridView is not displayed.</span></span>

<span data-ttu-id="c9e51-283">Chcete-li to opravit, je potřeba nakonfigurovat ObjectDataSource používat vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-283">To remedy this, we need to configure the ObjectDataSource to use custom paging.</span></span> <span data-ttu-id="c9e51-284">Můžete to provést v následujících krocích:</span><span class="sxs-lookup"><span data-stu-id="c9e51-284">This can be accomplished in the following steps:</span></span>

1. <span data-ttu-id="c9e51-285">**Nastavit ObjectDataSource s `EnablePaging` vlastnost `true`**  tím je oznámeno ObjectDataSource, který je nutné předat `SelectMethod` dva další parametry: jeden k určení Index řádku spustit ([ `StartRowIndexParameterName` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)) a jeden, který zadejte maximální počet řádků ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span><span class="sxs-lookup"><span data-stu-id="c9e51-285">**Set the ObjectDataSource s `EnablePaging` property to `true`** this indicates to the ObjectDataSource that it must pass to the `SelectMethod` two additional parameters: one to specify the Start Row Index ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), and one to specify the Maximum Rows ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span></span>
2. <span data-ttu-id="c9e51-286">**Nastavit ObjectDataSource s `StartRowIndexParameterName` a `MaximumRowsParameterName` vlastnosti odpovídajícím způsobem** `StartRowIndexParameterName` a `MaximumRowsParameterName` vlastnosti označují názvy vstupní parametry předané do `SelectMethod` pro vlastní účely stránkování .</span><span class="sxs-lookup"><span data-stu-id="c9e51-286">**Set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` Properties Accordingly** the `StartRowIndexParameterName` and `MaximumRowsParameterName` properties indicate the names of the input parameters passed into the `SelectMethod` for custom paging purposes.</span></span> <span data-ttu-id="c9e51-287">Ve výchozím nastavení, jsou tyto názvy parametrů `startIndexRow` a `maximumRows`, což je důvod, proč, při vytváření `GetProductsPaged` metoda v BLL, lze použít tyto hodnoty pro vstupní parametry.</span><span class="sxs-lookup"><span data-stu-id="c9e51-287">By default, these parameter names are `startIndexRow` and `maximumRows`, which is why, when creating the `GetProductsPaged` method in the BLL, I used these values for the input parameters.</span></span> <span data-ttu-id="c9e51-288">Pokud jste se rozhodli použít jiný parametr názvy BLL s `GetProductsPaged` metoda jako `startIndex` a `maxRows`pro příklad by bylo potřeba nastavit ObjectDataSource s `StartRowIndexParameterName` a `MaximumRowsParameterName` vlastnosti odpovídajícím způsobem (například počáteční index pro `StartRowIndexParameterName` a maxRows pro `MaximumRowsParameterName`).</span><span class="sxs-lookup"><span data-stu-id="c9e51-288">If you chose to use different parameter names for the BLL s `GetProductsPaged` method such as `startIndex` and `maxRows`, for example you would need to set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` properties accordingly (such as startIndex for `StartRowIndexParameterName` and maxRows for `MaximumRowsParameterName`).</span></span>
3. <span data-ttu-id="c9e51-289">**Nastavit ObjectDataSource s [ `SelectCountMethod` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) na název metody, která vrátí celkový počet z záznamy se stránkovaného prostřednictvím (`TotalNumberOfProducts`)** odvolat, který `ProductsBLL` třídu s `TotalNumberOfProducts`metoda vrátí celkový počet záznamů stránkování prostřednictvím DAL metodu, která provede `SELECT COUNT(*) FROM Products` dotazu.</span><span class="sxs-lookup"><span data-stu-id="c9e51-289">**Set the ObjectDataSource s [`SelectCountMethod` Property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) to the Name of the Method that Returns the Total Number of Records Being Paged Through (`TotalNumberOfProducts`)** recall that the `ProductsBLL` class s `TotalNumberOfProducts` method returns the total number of records being paged through using a DAL method that executes a `SELECT COUNT(*) FROM Products` query.</span></span> <span data-ttu-id="c9e51-290">Tyto informace je třeba pomocí ObjectDataSource správně vykreslení rozhraní stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-290">This information is needed by the ObjectDataSource in order to correctly render the paging interface.</span></span>
4. <span data-ttu-id="c9e51-291">**Odeberte `startRowIndex` a `maximumRows` `<asp:Parameter>` elementy z ObjectDataSource s deklarativní** při konfiguraci ObjectDataSource prostřednictvím průvodce, Visual Studio automaticky přidá dva `<asp:Parameter>` prvky `GetProductsPaged` metoda s vstupní parametry.</span><span class="sxs-lookup"><span data-stu-id="c9e51-291">**Remove the `startRowIndex` and `maximumRows` `<asp:Parameter>` Elements from the ObjectDataSource s Declarative Markup** when configuring the ObjectDataSource through the wizard, Visual Studio automatically added two `<asp:Parameter>` elements for the `GetProductsPaged` method s input parameters.</span></span> <span data-ttu-id="c9e51-292">Nastavením `EnablePaging` k `true`, tyto parametry se předají automaticky, pokud se zobrazí také v deklarativní syntaxi, bude ObjectDataSource pokus předat *čtyři* parametry, které `GetProductsPaged` – metoda a dva parametry pro `TotalNumberOfProducts` metoda.</span><span class="sxs-lookup"><span data-stu-id="c9e51-292">By setting `EnablePaging` to `true`, these parameters will be passed automatically; if they also appear in the declarative syntax, the ObjectDataSource will attempt to pass *four* parameters to the `GetProductsPaged` method and two parameters to the `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="c9e51-293">Pokud zapomenete pro jejich odebrání `<asp:Parameter>` prvky, pokud na stránce prostřednictvím prohlížeče získáte chybovou zprávu jako: *ObjectDataSource 'ObjectDataSource1' nelze najít neobecnou metodu 'TotalNumberOfProducts', který má Parametry: startRowIndex maximumRows*.</span><span class="sxs-lookup"><span data-stu-id="c9e51-293">If you forget to remove these `<asp:Parameter>` elements, when visiting the page through a browser you'll get an error message like: *ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'TotalNumberOfProducts' that has parameters: startRowIndex, maximumRows*.</span></span>

<span data-ttu-id="c9e51-294">Po provedení těchto změn, deklarativní syntaxi s ObjectDataSource by měl vypadat následovně:</span><span class="sxs-lookup"><span data-stu-id="c9e51-294">After making these changes, the ObjectDataSource s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample10.aspx)]

<span data-ttu-id="c9e51-295">Všimněte si, že `EnablePaging` a `SelectCountMethod` byly nastaveny a `<asp:Parameter>` byl odebrán.</span><span class="sxs-lookup"><span data-stu-id="c9e51-295">Note that the `EnablePaging` and `SelectCountMethod` properties have been set and the `<asp:Parameter>` elements have been removed.</span></span> <span data-ttu-id="c9e51-296">16 obrázek ukazuje snímek obrazovky okna vlastnosti po provedly tyto změny.</span><span class="sxs-lookup"><span data-stu-id="c9e51-296">Figure 16 shows a screen shot of the Properties window after these changes have been made.</span></span>


![Pokud chcete použít vlastní stránkování, nakonfigurujte ovládacího prvku ObjectDataSource](efficiently-paging-through-large-amounts-of-data-cs/_static/image18.png)

<span data-ttu-id="c9e51-298">**Obrázek 16**: vlastní stránkování, nakonfigurovat ovládacího prvku ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="c9e51-298">**Figure 16**: To Use Custom Paging, Configure the ObjectDataSource Control</span></span>


<span data-ttu-id="c9e51-299">Po provedení těchto změn, najdete na této stránce prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="c9e51-299">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="c9e51-300">Měli byste vidět uvedeny, 10 produkty v abecedním pořadí.</span><span class="sxs-lookup"><span data-stu-id="c9e51-300">You should see 10 products listed, ordered alphabetically.</span></span> <span data-ttu-id="c9e51-301">Za chvíli krok prostřednictvím jednu stránku dat najednou.</span><span class="sxs-lookup"><span data-stu-id="c9e51-301">Take a moment to step through the data one page at a time.</span></span> <span data-ttu-id="c9e51-302">Když není žádný visual rozdíl z hlediska koncového uživatele s mezi výchozí stránkování a vlastní stránkování, vlastní stránkování efektivněji stránky prostřednictvím velké objemy dat jako načítat pouze tyto záznamy, které musí být zobrazen pro danou stránku.</span><span class="sxs-lookup"><span data-stu-id="c9e51-302">While there is no visual difference from the end user s perspective between default paging and custom paging, custom paging more efficiently pages through large amounts of data as it only retrieves those records that need to be displayed for a given page.</span></span>


<span data-ttu-id="c9e51-303">[![Data, Objednáno produktu s názvem, je stránkovaného fondu pomocí vlastní stránkování](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c9e51-303">[![The Data, Ordered by the Product s Name, is Paged Using Custom Paging](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span></span>

<span data-ttu-id="c9e51-304">**Obrázek 17**: dat, Objednáno produktu s názvem, je stránkovaného fondu pomocí vlastní stránkování ([Kliknutím zobrazit obrázek v plné velikosti](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="c9e51-304">**Figure 17**: The Data, Ordered by the Product s Name, is Paged Using Custom Paging ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span></span>


> [!NOTE]
> <span data-ttu-id="c9e51-305">S vlastní stránkování, počet stránce hodnoty vrácené ObjectDataSource s `SelectCountMethod` je uložený ve stavu zobrazení s GridView.</span><span class="sxs-lookup"><span data-stu-id="c9e51-305">With custom paging, the page count value returned by the ObjectDataSource�s `SelectCountMethod` is stored in the GridView�s view state.</span></span> <span data-ttu-id="c9e51-306">Ostatní GridView proměnné `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` kolekce a tak dále jsou uloženy v *řízení stavu*, který je jako trvalý, bez ohledu na hodnotu GridView s `EnableViewState` Vlastnost.</span><span class="sxs-lookup"><span data-stu-id="c9e51-306">Other GridView variables the `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` collection, and so on are stored in *control state*, which is persisted regardless of the value of the GridView�s `EnableViewState` property.</span></span> <span data-ttu-id="c9e51-307">Vzhledem k tomu `PageCount` hodnota je trvalé napříč postback pomocí zobrazení stavu, při použití rozhraní stránkování, která obsahuje odkaz na můžete přejít na poslední stránce, je nutné, aby byl povolen stav zobrazení s GridView.</span><span class="sxs-lookup"><span data-stu-id="c9e51-307">Since the `PageCount` value is persisted across postbacks using view state, when using a paging interface that includes a link to take you to the last page, it is imperative that the GridView�s view state be enabled.</span></span> <span data-ttu-id="c9e51-308">(Pokud vaše rozhraní stránkování neobsahuje přímý odkaz na poslední stránce, pak může zakázat stav zobrazení.)</span><span class="sxs-lookup"><span data-stu-id="c9e51-308">(If your paging interface does not include a direct link to the last page, then you may disable view state.)</span></span>


<span data-ttu-id="c9e51-309">Kliknutím na odkaz na poslední stránku způsobí, že zpětné volání a dává pokyn GridView aktualizovat jeho `PageIndex` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="c9e51-309">Clicking the last page link causes a postback and instructs the GridView to update its `PageIndex` property.</span></span> <span data-ttu-id="c9e51-310">Po kliknutí na odkaz na poslední stránku GridView přiřadí jeho `PageIndex` vlastnost na hodnotu jedna menší než jeho `PageCount` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="c9e51-310">If the last page link is clicked, the GridView assigns its `PageIndex` property to a value one less than its `PageCount` property.</span></span> <span data-ttu-id="c9e51-311">Zobrazení stavu Zakázáno `PageCount` hodnotu dojde ke ztrátě napříč postback a `PageIndex` přiřazen maximální celočíselná hodnota.</span><span class="sxs-lookup"><span data-stu-id="c9e51-311">With view state disabled, the `PageCount` value is lost across postbacks and the `PageIndex` is assigned the maximum integer value instead.</span></span> <span data-ttu-id="c9e51-312">V dalším kroku se pokusí určit počáteční index řádku vynásobením GridView `PageSize` a `PageCount` vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="c9e51-312">Next, the GridView attempts to determine the starting row index by multiplying the `PageSize` and `PageCount` properties.</span></span> <span data-ttu-id="c9e51-313">To vede `OverflowException` vzhledem k tomu, že produkt je větší než velikost maximální povolené celé číslo.</span><span class="sxs-lookup"><span data-stu-id="c9e51-313">This results in an `OverflowException` since the product exceeds the maximum allowed integer size.</span></span>

## <a name="implement-custom-paging-and-sorting"></a><span data-ttu-id="c9e51-314">Řazení a stránkování vlastní implementace</span><span class="sxs-lookup"><span data-stu-id="c9e51-314">Implement Custom Paging and Sorting</span></span>

<span data-ttu-id="c9e51-315">Naše aktuální vlastní implementaci stránkování vyžaduje pořadí, ve kterém je stránkovaného data prostřednictvím staticky při vytváření `GetProductsPaged` uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="c9e51-315">Our current custom paging implementation requires that the order by which the data is paged through be specified statically when creating the `GetProductsPaged` stored procedure.</span></span> <span data-ttu-id="c9e51-316">Však můžete může mít poznamenat, že rutina GridView s inteligentním obsahuje políčko Povolit řazení kromě možnost Povolit stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-316">However, you may have noted that the GridView s smart tag contains an Enable Sorting checkbox in addition to the Enable Paging option.</span></span> <span data-ttu-id="c9e51-317">Bohužel se přidání podpory pro řazení do GridView s naše aktuální vlastní implementaci stránkování pouze seřadíte záznamy na stránce aktuálně zobrazených dat.</span><span class="sxs-lookup"><span data-stu-id="c9e51-317">Unfortunately, adding sorting support to the GridView with our current custom paging implementation will only sort the records on the currently viewed page of data.</span></span> <span data-ttu-id="c9e51-318">Například pokud nakonfigurujete GridView také podporují stránkování a potom při prohlížení na první stránku dat, řadit podle názvu produktu v sestupném pořadí, bude zpětná pořadí produktů na stránce 1.</span><span class="sxs-lookup"><span data-stu-id="c9e51-318">For example, if you configure the GridView to also support paging and then, when viewing the first page of data, sort by product name in descending order, it will reverse the order of the products on page 1.</span></span> <span data-ttu-id="c9e51-319">Jak ukazuje obrázek 18, například Carnarvon tygři zobrazuje jako první produktu řazení ve vzestupném abecedním pořadí, který ignoruje 71 ostatních produktů po Carnarvon tygři abecedně; na první stránce pouze tyto záznamy jsou považovány za v toto řazení.</span><span class="sxs-lookup"><span data-stu-id="c9e51-319">As Figure 18 shows, such shows Carnarvon Tigers as the first product when sorting in reverse alphabetical order, which ignores the 71 other products that come after Carnarvon Tigers, alphabetically; only those records on the first page are considered in the sorting.</span></span>


<span data-ttu-id="c9e51-320">[![Má řazení proběhnout na Data zobrazují pouze na aktuální stránce.](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c9e51-320">[![Only the Data Shown on the Current Page is Sorted](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span></span>

<span data-ttu-id="c9e51-321">**Obrázek 18**: na Data zobrazují pouze na aktuální stránce má řazení proběhnout ([Kliknutím zobrazit obrázek v plné velikosti](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="c9e51-321">**Figure 18**: Only the Data Shown on the Current Page is Sorted ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span></span>


<span data-ttu-id="c9e51-322">Toto řazení se vztahuje pouze na aktuální stránku dat vzhledem k tomu, že toto řazení dochází po načtení dat z BLL s `GetProductsPaged` metoda a tato metoda vrátí pouze záznamy pro konkrétní stránky.</span><span class="sxs-lookup"><span data-stu-id="c9e51-322">The sorting only applies to the current page of data because the sorting is occurring after the data has been retrieved from the BLL s `GetProductsPaged` method, and this method only returns those records for the specific page.</span></span> <span data-ttu-id="c9e51-323">K implementaci řazení správně, je potřeba předat výraz řazení, který se `GetProductsPaged` metoda tak, aby data můžete před vrácením na konkrétní stránku dat seřazeny správně.</span><span class="sxs-lookup"><span data-stu-id="c9e51-323">To implement sorting correctly, we need to pass the sort expression to the `GetProductsPaged` method so that the data can be ranked appropriately before returning the specific page of data.</span></span> <span data-ttu-id="c9e51-324">Jak to provést v našem kurzu další uvidíme.</span><span class="sxs-lookup"><span data-stu-id="c9e51-324">We'll see how to accomplish this in our next tutorial.</span></span>

## <a name="implementing-custom-paging-and-deleting"></a><span data-ttu-id="c9e51-325">Implementace vlastních stránkování a odstranění</span><span class="sxs-lookup"><span data-stu-id="c9e51-325">Implementing Custom Paging and Deleting</span></span>

<span data-ttu-id="c9e51-326">Pokud jste povolení odstraňování funkcí v GridView, jejichž data se stránkovaného fondu pomocí technik vlastní stránkování, zjistíte, které při odstraňování poslední záznam na poslední stránce, GridView zmizí místo správně dekrementace GridView s `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="c9e51-326">If you enabling deleting functionality in a GridView whose data is paged using custom paging techniques you will find that when deleting the last record from the last page, the GridView disappears rather than appropriately decrementing the GridView s `PageIndex`.</span></span> <span data-ttu-id="c9e51-327">Chcete-li reprodukovat této chyby, povolte odstraňování pro tento kurz, který právě jsme právě vytvořili.</span><span class="sxs-lookup"><span data-stu-id="c9e51-327">To reproduce this bug, enable deleting for the tutorial just we just created.</span></span> <span data-ttu-id="c9e51-328">Přejděte na poslední stránku (stránka 9), kde měli vidět jednoho produktu, protože jsme se stránkování prostřednictvím 81 produkty, 10 produkty najednou.</span><span class="sxs-lookup"><span data-stu-id="c9e51-328">Go to the last page (page 9), where you should see a single product since we are paging through 81 products, 10 products at a time.</span></span> <span data-ttu-id="c9e51-329">Odstranění tohoto produktu.</span><span class="sxs-lookup"><span data-stu-id="c9e51-329">Delete this product.</span></span>

<span data-ttu-id="c9e51-330">Při odstraňování poslední produktu GridView *by měl* automaticky přejít na stránku osmého a takové funkce je vystavených s výchozí stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-330">Upon deleting the last product, the GridView *should* automatically go to the eighth page, and such functionality is exhibited with default paging.</span></span> <span data-ttu-id="c9e51-331">S vlastní stránkování, ale po odstranění poslední produktu na poslední stránce GridView jednoduše zmizí z obrazovky úplně.</span><span class="sxs-lookup"><span data-stu-id="c9e51-331">With custom paging, however, after deleting that last product on the last page, the GridView simply disappears from the screen altogether.</span></span> <span data-ttu-id="c9e51-332">Přesné příčině *proč* tomu, že je trochu nad rámec tohoto kurzu, zjistit [odstranění poslední záznam na poslední stránce z GridView s vlastní stránkování](http://scottonwriting.net/sowblog/posts/7326.aspx) nízké úrovně podrobnosti, zdroj Tento problém.</span><span class="sxs-lookup"><span data-stu-id="c9e51-332">The precise reason *why* this happens is a bit beyond the scope of this tutorial; see [Deleting the Last Record on the Last Page from a GridView with Custom Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) for the low-level details as to the source of this problem.</span></span> <span data-ttu-id="c9e51-333">V souhrnu ho s z důvodu následující posloupnosti kroků, které provádí GridView při kliknutí na tlačítko Odstranit:</span><span class="sxs-lookup"><span data-stu-id="c9e51-333">In summary it s due to the following sequence of steps that are performed by the GridView when the Delete button is clicked:</span></span>

1. <span data-ttu-id="c9e51-334">Odstranit záznam</span><span class="sxs-lookup"><span data-stu-id="c9e51-334">Delete the record</span></span>
2. <span data-ttu-id="c9e51-335">Získání příslušných záznamů má být zobrazen pro zadaný `PageIndex` a`PageSize`</span><span class="sxs-lookup"><span data-stu-id="c9e51-335">Get the appropriate records to display for the specified `PageIndex` and `PageSize`</span></span>
3. <span data-ttu-id="c9e51-336">Zkontrolujte, ujistěte se, že `PageIndex` není delší než počet stránek dat ve zdroji dat; pokud ji, automaticky snížení GridView s `PageIndex` vlastnost</span><span class="sxs-lookup"><span data-stu-id="c9e51-336">Check to ensure that the `PageIndex` does not exceed the number of pages of data in the data source; if it does, automatically decrement the GridView s `PageIndex` property</span></span>
4. <span data-ttu-id="c9e51-337">Rutina GridView pomocí záznamy získané v kroku 2 vytvořit vazbu na příslušnou stránku dat</span><span class="sxs-lookup"><span data-stu-id="c9e51-337">Bind the appropriate page of data to the GridView using the records obtained in Step 2</span></span>

<span data-ttu-id="c9e51-338">Problém vyplývá z faktu, že v kroku 2 `PageIndex` používá při metodou záznamy, které chcete zobrazit stále `PageIndex` poslední stránky, jehož jediným záznam právě byla odstraněna.</span><span class="sxs-lookup"><span data-stu-id="c9e51-338">The problem stems from the fact that in Step 2 the `PageIndex` used when grabbing the records to display is still the `PageIndex` of the last page whose sole record was just deleted.</span></span> <span data-ttu-id="c9e51-339">Proto v kroku 2 *žádné* záznamy jsou vráceny vzhledem k tomu, že poslední stránka dat už neobsahuje žádné záznamy.</span><span class="sxs-lookup"><span data-stu-id="c9e51-339">Therefore, in Step 2, *no* records are returned since that last page of data no longer contains any records.</span></span> <span data-ttu-id="c9e51-340">Potom v kroku 3 GridView rozpoznává, jeho `PageIndex` vlastnost je větší než celkový počet stránek ve zdroji dat (od jsme sunout odstranit poslední záznam na poslední stránku) a proto snižuje jeho `PageIndex` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="c9e51-340">Then, in Step 3, the GridView realizes that its `PageIndex` property is greater than the total number of pages in the data source (since we ve deleted the last record in the last page) and therefore decrements its `PageIndex` property.</span></span> <span data-ttu-id="c9e51-341">V kroku 4 GridView pokusí o samotné vazbu data načtená v kroku 2; ale v kroku 2 se nevrátily žádné záznamy, proto výsledkem prázdná GridView.</span><span class="sxs-lookup"><span data-stu-id="c9e51-341">In Step 4 the GridView attempts to bind itself to the data retrieved in Step 2; however, in Step 2 no records were returned, therefore resulting in an empty GridView.</span></span> <span data-ttu-id="c9e51-342">S výchozí stránkování, tento problém nemá t surface, protože v kroku 2 *všechny* ze zdroje dat se načítají záznamy.</span><span class="sxs-lookup"><span data-stu-id="c9e51-342">With default paging, this problem doesn t surface because in Step 2 *all* records are retrieved from the data source.</span></span>

<span data-ttu-id="c9e51-343">Chcete-li máme dvě možnosti.</span><span class="sxs-lookup"><span data-stu-id="c9e51-343">To fix this we have two options.</span></span> <span data-ttu-id="c9e51-344">První je vytvoření obslužné rutiny události pro GridView s `RowDeleted` obslužné rutiny události, která určuje počet záznamů, které byly zobrazeny na stránce, který byl právě odstraněn.</span><span class="sxs-lookup"><span data-stu-id="c9e51-344">The first is to create an event handler for the GridView s `RowDeleted` event handler that determines how many records were displayed in the page that was just deleted.</span></span> <span data-ttu-id="c9e51-345">Pokud došlo pouze jeden záznam, pak záznam právě odstranit poslední byla a potřebujeme se sníží GridView s `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="c9e51-345">If there was only one record, then the record just deleted must have been the last one and we need to decrement the GridView s `PageIndex`.</span></span> <span data-ttu-id="c9e51-346">Samozřejmě pouze chceme aktualizovat `PageIndex` Pokud operace odstranění byl ve skutečnosti úspěšný, který lze určit podle zajistit, aby `e.Exception` vlastnost je `null`.</span><span class="sxs-lookup"><span data-stu-id="c9e51-346">Of course, we only want to update the `PageIndex` if the delete operation was actually successful, which can be determined by ensuring that the `e.Exception` property is `null`.</span></span>

<span data-ttu-id="c9e51-347">Tento přístup funguje, protože aktualizuje `PageIndex` po kroku 1, ale před kroku 2.</span><span class="sxs-lookup"><span data-stu-id="c9e51-347">This approach works because it updates the `PageIndex` after Step 1 but before Step 2.</span></span> <span data-ttu-id="c9e51-348">V kroku 2, proto se vrátí příslušné sady záznamů.</span><span class="sxs-lookup"><span data-stu-id="c9e51-348">Therefore, in Step 2, the appropriate set of records is returned.</span></span> <span data-ttu-id="c9e51-349">K tomu použijte kód takto:</span><span class="sxs-lookup"><span data-stu-id="c9e51-349">To accomplish this, use code like the following:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample11.cs)]

<span data-ttu-id="c9e51-350">Alternativní řešení, je vytvoření obslužné rutiny události pro ObjectDataSource s `RowDeleted` událostí a nastavit `AffectedRows` vlastnost na hodnotu 1.</span><span class="sxs-lookup"><span data-stu-id="c9e51-350">An alternative workaround is to create an event handler for the ObjectDataSource s `RowDeleted` event and to set the `AffectedRows` property to a value of 1.</span></span> <span data-ttu-id="c9e51-351">Po odstranění záznamu v kroku 1 (ale před znovu načítání dat v kroku 2), aktualizace GridView jeho `PageIndex` vlastnost Pokud operaci měla vliv na jeden nebo více řádků.</span><span class="sxs-lookup"><span data-stu-id="c9e51-351">After deleting the record in Step 1 (but before re-retrieving the data in Step 2), the GridView updates its `PageIndex` property if one or more rows were affected by the operation.</span></span> <span data-ttu-id="c9e51-352">Ale `AffectedRows` vlastnost není nastaven ObjectDataSource a proto je tento krok vynechán.</span><span class="sxs-lookup"><span data-stu-id="c9e51-352">However, the `AffectedRows` property is not set by the ObjectDataSource and therefore this step is omitted.</span></span> <span data-ttu-id="c9e51-353">Je možné mít tento krok provést ručně nastavit `AffectedRows` vlastnost po úspěšném dokončení operace odstranění.</span><span class="sxs-lookup"><span data-stu-id="c9e51-353">One way to have this step executed is to manually set the `AffectedRows` property if the delete operation completes successfully.</span></span> <span data-ttu-id="c9e51-354">Můžete to provést pomocí kódu takto:</span><span class="sxs-lookup"><span data-stu-id="c9e51-354">This can be accomplished using code like the following:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample12.cs)]

<span data-ttu-id="c9e51-355">Kód pro obě tyto obslužné rutiny události lze nalézt v kódu třídu `EfficientPaging.aspx` příklad.</span><span class="sxs-lookup"><span data-stu-id="c9e51-355">The code for both of these events handlers can be found in code-behind class of the `EfficientPaging.aspx` example.</span></span>

## <a name="comparing-the-performance-of-default-and-custom-paging"></a><span data-ttu-id="c9e51-356">Porovnání výkonu výchozích a vlastních stránkování</span><span class="sxs-lookup"><span data-stu-id="c9e51-356">Comparing the Performance of Default and Custom Paging</span></span>

<span data-ttu-id="c9e51-357">Vzhledem k tomu, že vlastní stránkování pouze načte potřebné záznamů, zatímco výchozí stránkování vrátí *všechny* záznamy pro jednotlivé stránky zobrazení, se s vymazat, že je efektivnější než výchozí stránkování vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-357">Since custom paging only retrieves the needed records, whereas default paging returns *all* of the records for each page being viewed, it s clear that custom paging is more efficient than default paging.</span></span> <span data-ttu-id="c9e51-358">Ale jenom kolik efektivnější je vlastní stránkování?</span><span class="sxs-lookup"><span data-stu-id="c9e51-358">But just how much more efficient is custom paging?</span></span> <span data-ttu-id="c9e51-359">Jaký způsob zvýšení výkonu může zobrazit přesun z výchozího stránkování na vlastní stránkování?</span><span class="sxs-lookup"><span data-stu-id="c9e51-359">What sort of performance gains can be seen by moving from default paging to custom paging?</span></span>

<span data-ttu-id="c9e51-360">Bohužel se zde s žádné velikosti, která vyhoví všechny zodpovědět sem.</span><span class="sxs-lookup"><span data-stu-id="c9e51-360">Unfortunately, there s no one size fits all answer here.</span></span> <span data-ttu-id="c9e51-361">Zvýšení výkonu závisí na počtu faktorů, nejvíce viditelného dva se počet záznamů stránkování prostřednictvím a zatížení umístit do databáze serveru a komunikační kanály mezi webovým serverem a serverem databáze.</span><span class="sxs-lookup"><span data-stu-id="c9e51-361">The performance gain depends on a number of factors, the most prominent two being the number of records being paged through and the load placed on the database server and communication channels between the web server and database server.</span></span> <span data-ttu-id="c9e51-362">Pro malé tabulky s několika záznamy desítek může být nepatrné rozdíl výkonem.</span><span class="sxs-lookup"><span data-stu-id="c9e51-362">For small tables with just a few dozen records, the performance difference may be negligible.</span></span> <span data-ttu-id="c9e51-363">Pro rozsáhlé tabulky s tisíci na stovky tisíc řádků, ale výkonu rozdíl je čárkou nad vpravo.</span><span class="sxs-lookup"><span data-stu-id="c9e51-363">For large tables, with thousands to hundreds of thousands of rows, though, the performance difference is acute.</span></span>

<span data-ttu-id="c9e51-364">Článek min, [vlastní stránkování v technologii ASP.NET 2.0 pomocí serveru SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), obsahuje některé testy výkonu byl spuštěn vykazovat rozdíly ve výkonu mezi tyto dvě techniky stránkování při procházení tabulky databáze s 50 000 záznamů.</span><span class="sxs-lookup"><span data-stu-id="c9e51-364">An article of mine, [Custom Paging in ASP.NET 2.0 with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contains some performance tests I ran to exhibit the differences in performance between these two paging techniques when paging through a database table with 50,000 records.</span></span> <span data-ttu-id="c9e51-365">Tyto testy I ověřuje čas k provedení dotazu na úrovni serveru SQL (pomocí [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) a na stránku ASP.NET pomocí [ASP.NET s trasování funkce](https://msdn.microsoft.com/library/y13fw6we.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9e51-365">In these tests I examined both the time to execute the query at the SQL Server level (using [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) and at the ASP.NET page using [ASP.NET s tracing features](https://msdn.microsoft.com/library/y13fw6we.aspx).</span></span> <span data-ttu-id="c9e51-366">Mějte na paměti, že tyto testy měla spustit na můj vývoj pole s jedním uživatelem aktivní a proto jsou unscientific a není napodobovat vzorů zatížení typické webu.</span><span class="sxs-lookup"><span data-stu-id="c9e51-366">Keep in mind that these tests were run on my development box with a single active user, and therefore are unscientific and do not mimic typical website load patterns.</span></span> <span data-ttu-id="c9e51-367">Bez ohledu na to výsledky znázorňují relativní rozdíly v čase spuštění pro výchozí a vlastní stránkování při práci s dostatečně velké objemy dat.</span><span class="sxs-lookup"><span data-stu-id="c9e51-367">Regardless, the results illustrate the relative differences in execution time for default and custom paging when working with sufficiently large amounts of data.</span></span>


|  | <span data-ttu-id="c9e51-368">**Střední Doba trvání (sekundy)**</span><span class="sxs-lookup"><span data-stu-id="c9e51-368">**Avg. Duration (sec)**</span></span> | <span data-ttu-id="c9e51-369">**Čtení**</span><span class="sxs-lookup"><span data-stu-id="c9e51-369">**Reads**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="c9e51-370">**Výchozí stránkování SQL profileru**</span><span class="sxs-lookup"><span data-stu-id="c9e51-370">**Default Paging SQL Profiler**</span></span> | <span data-ttu-id="c9e51-371">1.411</span><span class="sxs-lookup"><span data-stu-id="c9e51-371">1.411</span></span> | <span data-ttu-id="c9e51-372">383</span><span class="sxs-lookup"><span data-stu-id="c9e51-372">383</span></span> |
| <span data-ttu-id="c9e51-373">**Vlastní stránkování SQL profileru**</span><span class="sxs-lookup"><span data-stu-id="c9e51-373">**Custom Paging SQL Profiler**</span></span> | <span data-ttu-id="c9e51-374">0.002</span><span class="sxs-lookup"><span data-stu-id="c9e51-374">0.002</span></span> | <span data-ttu-id="c9e51-375">29</span><span class="sxs-lookup"><span data-stu-id="c9e51-375">29</span></span> |
| <span data-ttu-id="c9e51-376">**Výchozí stránkování ASP.NET trasování**</span><span class="sxs-lookup"><span data-stu-id="c9e51-376">**Default Paging ASP.NET Trace**</span></span> | <span data-ttu-id="c9e51-377">2.379</span><span class="sxs-lookup"><span data-stu-id="c9e51-377">2.379</span></span> | <span data-ttu-id="c9e51-378">*N/A*</span><span class="sxs-lookup"><span data-stu-id="c9e51-378">*N/A*</span></span> |
| <span data-ttu-id="c9e51-379">**Vlastní trasování ASP.NET stránkování**</span><span class="sxs-lookup"><span data-stu-id="c9e51-379">**Custom Paging ASP.NET Trace**</span></span> | <span data-ttu-id="c9e51-380">0.029</span><span class="sxs-lookup"><span data-stu-id="c9e51-380">0.029</span></span> | <span data-ttu-id="c9e51-381">*N/A*</span><span class="sxs-lookup"><span data-stu-id="c9e51-381">*N/A*</span></span> |


<span data-ttu-id="c9e51-382">Jak vidíte, načítání konkrétní stránku dat vyžaduje 354 méně čtení v průměru a dokončit za zlomek času.</span><span class="sxs-lookup"><span data-stu-id="c9e51-382">As you can see, retrieving a particular page of data required 354 less reads on average and completed in a fraction of the time.</span></span> <span data-ttu-id="c9e51-383">Na stránce ASP.NET, vlastní stránky bylo možné vykreslit v blíží 1/100<sup>tý</sup> času trvalo při použití výchozí stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-383">At the ASP.NET page, custom the page was able to render in close to 1/100<sup>th</sup> of the time it took when using default paging.</span></span> <span data-ttu-id="c9e51-384">V tématu [Moje článku](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) Další informace o těchto výsledků spolu s kódem a databáze můžete stáhnout na reprodukujte tyto testy ve svém vlastním prostředí.</span><span class="sxs-lookup"><span data-stu-id="c9e51-384">See [my article](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) for more information on these results along with code and a database you can download to reproduce these tests in your own environment.</span></span>

## <a name="summary"></a><span data-ttu-id="c9e51-385">Souhrn</span><span class="sxs-lookup"><span data-stu-id="c9e51-385">Summary</span></span>

<span data-ttu-id="c9e51-386">Výchozí stránkování je lze velmi snadno implementovat jenom zaškrtnutí políčka Povolit stránkování v dat webové ovládací prvek s inteligentní značky, ale tyto jednoduchost dodává za cenu výkonu.</span><span class="sxs-lookup"><span data-stu-id="c9e51-386">Default paging is a cinch to implement just check the Enable Paging checkbox in the data Web control s smart tag but such simplicity comes at the cost of performance.</span></span> <span data-ttu-id="c9e51-387">S výchozí stránkování, když si uživatel vyžádá jakoukoli stránku dat *všechny* záznamů se vrátí, i když se může zobrazit pouze jen nepatrnou část z nich.</span><span class="sxs-lookup"><span data-stu-id="c9e51-387">With default paging, when a user requests any page of data *all* records are returned, even though only a tiny fraction of them may be shown.</span></span> <span data-ttu-id="c9e51-388">Boje proti tento nároky na výkon, nabízí ObjectDataSource alternativní stránkování vlastní možnost stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-388">To combat this performance overhead, the ObjectDataSource offers an alternative paging option custom paging.</span></span>

<span data-ttu-id="c9e51-389">Při vlastní stránkování vylepšuje výchozí stránkování problémy s výkonem s načtením pouze záznamy, které musí být zobrazeny, ho s složitější implementovat vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="c9e51-389">While custom paging improves upon default paging s performance issues by retrieving only those records that need to be displayed, it s more involved to implement custom paging.</span></span> <span data-ttu-id="c9e51-390">Nejdřív musí být napsané dotazu, který správně (a efektivně) přistupuje určitou podmnožinu požadované záznamy.</span><span class="sxs-lookup"><span data-stu-id="c9e51-390">First, a query must be written that correctly (and efficiently) accesses the specific subset of records requested.</span></span> <span data-ttu-id="c9e51-391">To lze provést v mnoha různými způsoby; jeden jsme se zaměřili na v tomto kurzu se má používat systém SQL Server 2005 s novou `ROW_NUMBER()` funkce pro řazení výsledků a pak vrátit jenom na ty výsledků jehož hodnocení spadá do zadaného rozsahu adres.</span><span class="sxs-lookup"><span data-stu-id="c9e51-391">This can be accomplished in a number of ways; the one we examined in this tutorial is to use SQL Server 2005 s new `ROW_NUMBER()` function to rank results, and then to return just those results whose ranking falls within a specified range.</span></span> <span data-ttu-id="c9e51-392">Kromě toho je potřeba přidat prostředky můžete určit celkový počet záznamů stránkování prostřednictvím.</span><span class="sxs-lookup"><span data-stu-id="c9e51-392">Furthermore, we need to add a means to determine the total number of records being paged through.</span></span> <span data-ttu-id="c9e51-393">Po vytvoření těchto metod DAL a BLL, musíme také nakonfigurovat ObjectDataSource, aby mohla určit, kolik celkový počet záznamů jsou stránkování prostřednictvím a správně můžete předat hodnoty Start Index řádku a maximální počet řádků BLL.</span><span class="sxs-lookup"><span data-stu-id="c9e51-393">After creating these DAL and BLL methods, we also need to configure the ObjectDataSource so that it can determine how many total records are being paged through and can correctly pass the Start Row Index and Maximum Rows values to the BLL.</span></span>

<span data-ttu-id="c9e51-394">Při implementaci vlastní stránkování vyžaduje několik kroků a není skoro stejně jednoduché jako výchozí stránkování, vlastní stránkování je nezbytné v případě stránkování prostřednictvím dostatečně velké objemy dat.</span><span class="sxs-lookup"><span data-stu-id="c9e51-394">While implementing custom paging does require a number of steps and is not nearly as simple as default paging, custom paging is a necessity when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="c9e51-395">Výsledky zkontrolován ukázal, vlastní stránkování můžete přenesen sekund z čas vykreslení stránky ASP.NET a zatížení na serveru databáze můžete zjednodušit pomocí jedné nebo více pořadí podle velikosti.</span><span class="sxs-lookup"><span data-stu-id="c9e51-395">As the results examined showed, custom paging can shed seconds off of the ASP.NET page render time and can lighten the load on the database server by one ore more orders of magnitude.</span></span>

<span data-ttu-id="c9e51-396">Radostí programování!</span><span class="sxs-lookup"><span data-stu-id="c9e51-396">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="c9e51-397">O autorovi</span><span class="sxs-lookup"><span data-stu-id="c9e51-397">About the Author</span></span>

<span data-ttu-id="c9e51-398">[Scott Meisnerová](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor sedm ASP/ASP.NET knih a zakladatele z [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracuje s technologií Microsoft Web od 1998.</span><span class="sxs-lookup"><span data-stu-id="c9e51-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c9e51-399">Scott funguje jako nezávislé poradce, trainer a zapisovače.</span><span class="sxs-lookup"><span data-stu-id="c9e51-399">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c9e51-400">Jeho nejnovější seznam k [ *Edice nakladatelství Sams naučit sami technologii ASP.NET 2.0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="c9e51-400">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c9e51-401">Dosažitelný v [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) nebo prostřednictvím svého blogu, který najdete na [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="c9e51-401">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="c9e51-402">[Předchozí](paging-and-sorting-report-data-cs.md)
[další](sorting-custom-paged-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="c9e51-402">[Previous](paging-and-sorting-report-data-cs.md)
[Next](sorting-custom-paged-data-cs.md)</span></span>
