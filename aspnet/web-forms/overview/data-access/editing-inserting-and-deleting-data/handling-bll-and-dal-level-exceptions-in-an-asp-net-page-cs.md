---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs
title: Zpracování výjimek BLL a DAL úroveň na stránku ASP.NET (C#) | Microsoft Docs
author: rick-anderson
description: V tomto kurzu zjistíme, jak zobrazit popisné a informativní chybová zpráva by dojít k výjimce během vložení, aktualizaci nebo odstranění operace...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/17/2006
ms.topic: article
ms.assetid: 49d8a66c-3ea8-4087-839f-179d1d94512a
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs
msc.type: authoredcontent
ms.openlocfilehash: e7589584f3b0773a739b785c433ec45eeac3607e
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/06/2018
ms.locfileid: "30888234"
---
<a name="handling-bll--and-dal-level-exceptions-in-an-aspnet-page-c"></a><span data-ttu-id="8c3c0-103">Zpracování výjimek BLL a DAL úroveň na stránku ASP.NET (C#)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-103">Handling BLL- and DAL-Level Exceptions in an ASP.NET Page (C#)</span></span>
====================
<span data-ttu-id="8c3c0-104">podle [Scott Meisnerová](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8c3c0-105">[Stáhněte si ukázkovou aplikaci](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_CS.exe) nebo [stáhnout PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/datatutorial18cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_CS.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/datatutorial18cs1.pdf)</span></span>

> <span data-ttu-id="8c3c0-106">V tomto kurzu jsme se zobrazí zobrazení popisné a informativní chybová zpráva při vložení, aktualizaci nebo operace odstranění dat ASP.NET ovládací prvek webu dojde k výjimce.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-106">In this tutorial we will see how to display a friendly, informative error message should an exception occur during an insert, update, or delete operation of an ASP.NET data Web control.</span></span>


## <a name="introduction"></a><span data-ttu-id="8c3c0-107">Úvod</span><span class="sxs-lookup"><span data-stu-id="8c3c0-107">Introduction</span></span>

<span data-ttu-id="8c3c0-108">Práci s daty z webové aplikace ASP.NET pomocí architektury vrstvené aplikace zahrnuje následující tři obecné kroky:</span><span class="sxs-lookup"><span data-stu-id="8c3c0-108">Working with data from an ASP.NET web application using a tiered application architecture involves the following three general steps:</span></span>

1. <span data-ttu-id="8c3c0-109">Určete, jakou metodu vrstvu obchodní logiky musí být volána a jaké parametr hodnoty k předejte ji.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-109">Determine what method of the Business Logic Layer needs to be invoked and what parameter values to pass it.</span></span> <span data-ttu-id="8c3c0-110">Hodnoty parametru může být naprogramováno, prostřednictvím kódu programu přiřazen nebo vstupy zadané uživatelem.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-110">The parameter values can be hard coded, programmatically-assigned, or inputs entered by the user.</span></span>
2. <span data-ttu-id="8c3c0-111">Vyvolání metody.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-111">Invoke the method.</span></span>
3. <span data-ttu-id="8c3c0-112">Zpracování výsledků.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-112">Process the results.</span></span> <span data-ttu-id="8c3c0-113">Při volání metody BLL metodu, která vrátí data, to může zahrnovat vazbě dat na data ovládací prvek webu.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-113">When calling a BLL method that returns data, this may involve binding the data to a data Web control.</span></span> <span data-ttu-id="8c3c0-114">Pro BLL metody, které upravují data to může zahrnovat provedení některé akce na základě návratové hodnoty nebo pohodlné zpracování všechny výjimky, které vznikly v kroku 2.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-114">For BLL methods that modify data, this may include performing some action based on a return value or gracefully handling any exception that arose in Step 2.</span></span>

<span data-ttu-id="8c3c0-115">Jak jsme viděli v [předchozí kurzu](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md), ObjectDataSource i data ovládací prvky webového zadejte body rozšiřitelnosti pro kroků 1 a 3.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-115">As we saw in the [previous tutorial](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md), both the ObjectDataSource and the data Web controls provide extensibility points for Steps 1 and 3.</span></span> <span data-ttu-id="8c3c0-116">Rutina GridView, například aktivuje její `RowUpdating` událostí před jeho hodnoty polí přiřazení k jeho ObjectDataSource `UpdateParameters` kolekce; jeho `RowUpdated` událost se vyvolá po dokončení operace ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-116">The GridView, for example, fires its `RowUpdating` event prior to assigning its field values to its ObjectDataSource's `UpdateParameters` collection; its `RowUpdated` event is raised after the ObjectDataSource has completed the operation.</span></span>

<span data-ttu-id="8c3c0-117">Jsme jste už se zaměřili na události, které aktivují během kroku 1 a viděli, jak můžete použít k přizpůsobení vstupní parametry nebo operaci zrušte.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-117">We've already examined the events that fire during Step 1 and have seen how they can be used to customize the input parameters or cancel the operation.</span></span> <span data-ttu-id="8c3c0-118">V tomto kurzu jsme budete zapněte naše pozornost k událostem, které budou spuštěny po dokončení operace.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-118">In this tutorial we'll turn our attention to the events that fire after the operation has completed.</span></span> <span data-ttu-id="8c3c0-119">Pomocí těchto obslužné rutiny událostí po úrovně, které můžeme, mimo jiné určit, pokud při operaci došlo k výjimce a zpracování řádně, zobrazení popisné a informativní chybová zpráva na obrazovce a ne jako výchozí bude použit standardní technologie ASP.NET stránka výjimka.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-119">With these post-level event handlers we can, among other things, determine if an exception occurred during the operation and handle it gracefully, displaying a friendly, informative error message on the screen rather than defaulting to the standard ASP.NET exception page.</span></span>

<span data-ttu-id="8c3c0-120">Pro ilustraci práce se tyto události po úrovni, vytvoříme stránky, který se zobrazuje seznam produktů v upravitelné GridView.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-120">To illustrate working with these post-level events, let's create a page that lists the products in an editable GridView.</span></span> <span data-ttu-id="8c3c0-121">Při aktualizaci produktu, pokud se výjimka vyvolána naše ASP.NET stránky se zobrazí zpráva krátké výše GridView, která vysvětluje, že došlo k potížím.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-121">When updating a product, if an exception is raised our ASP.NET page will display a short message above the GridView explaining that a problem has occurred.</span></span> <span data-ttu-id="8c3c0-122">Můžeme začít!</span><span class="sxs-lookup"><span data-stu-id="8c3c0-122">Let's get started!</span></span>

## <a name="step-1-creating-an-editable-gridview-of-products"></a><span data-ttu-id="8c3c0-123">Krok 1: Vytvoření upravitelné GridView produktů</span><span class="sxs-lookup"><span data-stu-id="8c3c0-123">Step 1: Creating an Editable GridView of Products</span></span>

<span data-ttu-id="8c3c0-124">V předchozích kurzu jsme vytvořili upravitelné GridView se právě dvěma poli `ProductName` a `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-124">In the previous tutorial we created an editable GridView with just two fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="8c3c0-125">To vyžaduje další přetížení pro vytvoření `ProductsBLL` třídy `UpdateProduct` metoda, ten, který pouze přijata tři vstupní parametry (produktu název, jednotkové ceny a ID) názvem na rozdíl od parametr pro každé pole produktu.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-125">This required creating an additional overload for the `ProductsBLL` class's `UpdateProduct` method, one that only accepted three input parameters (the product's name, unit price, and ID) as opposed a parameter for each product field.</span></span> <span data-ttu-id="8c3c0-126">V tomto kurzu praxi, můžeme tento postup opakujte, vytváření upravitelné GridView, který zobrazí název produktu, množství jednotce, jednotkové ceny a jednotky na skladě, ale umožňuje pouze název, jednotkové ceny a jednotky ve skladu k provádění úprav.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-126">For this tutorial, let's practice this technique again, creating an editable GridView that displays the product's name, quantity per unit, unit price, and units in stock, but only allows the name, unit price, and units in stock to be edited.</span></span>

<span data-ttu-id="8c3c0-127">Pro tento scénář budeme potřebovat další přetížení `UpdateProduct` metoda, ten, který přijímá čtyř parametrů: název produktu, jednotkové ceny, jednotky v stock a ID.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-127">To accommodate this scenario we'll need another overload of the `UpdateProduct` method, one that accepts four parameters: the product's name, unit price, units in stock, and ID.</span></span> <span data-ttu-id="8c3c0-128">Přidejte následující metodu do `ProductsBLL` třídy:</span><span class="sxs-lookup"><span data-stu-id="8c3c0-128">Add the following method to the `ProductsBLL` class:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample1.cs)]

<span data-ttu-id="8c3c0-129">Pomocí této metody dokončení jsme připraveni vytvořit stránku ASP.NET, která umožňuje pro úpravy tyto čtyři pole určitého produktu.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-129">With this method complete, we're ready to create the ASP.NET page that allows for editing these four particular product fields.</span></span> <span data-ttu-id="8c3c0-130">Otevřete `ErrorHandling.aspx` stránku `EditInsertDelete` složky a přidejte GridView na stránku pomocí návrháře.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-130">Open the `ErrorHandling.aspx` page in the `EditInsertDelete` folder and add a GridView to the page through the Designer.</span></span> <span data-ttu-id="8c3c0-131">GridView vytvořit vazbu k nové ObjectDataSource, mapování `Select()` metodu `ProductsBLL` třídy `GetProducts()` metoda a `Update()` metodu `UpdateProduct` přetížení právě vytvořili.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-131">Bind the GridView to a new ObjectDataSource, mapping the `Select()` method to the `ProductsBLL` class's `GetProducts()` method and the `Update()` method to the `UpdateProduct` overload just created.</span></span>


<span data-ttu-id="8c3c0-132">[![Použijte přetížení metody UpdateProduct, který přijímá čtyři vstupní parametry](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-132">[![Use the UpdateProduct Method Overload That Accepts Four Input Parameters](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image1.png)</span></span>

<span data-ttu-id="8c3c0-133">**Obrázek 1**: použití `UpdateProduct` přetížení aby přijímá čtyři vstupní parametry metody ([Kliknutím zobrazit obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="8c3c0-133">**Figure 1**: Use the `UpdateProduct` Method Overload That Accepts Four Input Parameters ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image3.png))</span></span>


<span data-ttu-id="8c3c0-134">Tím se vytvoří ObjectDataSource s `UpdateParameters` kolekci pomocí čtyř parametrů a GridView s polem pro každé pole produktu.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-134">This will create an ObjectDataSource with an `UpdateParameters` collection with four parameters and a GridView with a field for each of the product fields.</span></span> <span data-ttu-id="8c3c0-135">Přiřadí ObjectDataSource deklarativní `OldValuesParameterFormatString` vlastnost hodnota `original_{0}`, které způsobí výjimku, protože naše třída BLL neočekávané vstupní parametr s názvem `original_productID` být předán.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-135">The ObjectDataSource's declarative markup assigns the `OldValuesParameterFormatString` property the value `original_{0}`, which will cause an exception since our BLL class's don't expect an input parameter named `original_productID` to be passed in.</span></span> <span data-ttu-id="8c3c0-136">Nezapomeňte odebrat toto nastavení zcela z deklarativní syntaxe (nebo ji nastavte na výchozí hodnotu `{0}`).</span><span class="sxs-lookup"><span data-stu-id="8c3c0-136">Don't forget to remove this setting altogether from the declarative syntax (or set it to the default value, `{0}`).</span></span>

<span data-ttu-id="8c3c0-137">V dalším kroku porovnat dolů GridView zahrnout pouze `ProductName`, `QuantityPerUnit`, `UnitPrice`, a `UnitsInStock` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-137">Next, pare down the GridView to include only the `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` BoundFields.</span></span> <span data-ttu-id="8c3c0-138">Také Nebojte se použijte požadované úrovni poli formátování, vám přijde nezbytné (jako je například změna `HeaderText` vlastnosti).</span><span class="sxs-lookup"><span data-stu-id="8c3c0-138">Also feel free to apply any field-level formatting you deem necessary (such as changing the `HeaderText` properties).</span></span>

<span data-ttu-id="8c3c0-139">V předchozích kurzu jsme se podívali na způsob formátování `UnitPrice` BoundField jako měnu v režimu jen pro čtení i v režimu úprav.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-139">In the previous tutorial we looked at how to format the `UnitPrice` BoundField as a currency both in read-only mode and edit mode.</span></span> <span data-ttu-id="8c3c0-140">Umožňuje provést stejný sem.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-140">Let's do the same here.</span></span> <span data-ttu-id="8c3c0-141">Odvolat, že to vyžaduje nastavení BoundField `DataFormatString` vlastnost `{0:c}`, jeho `HtmlEncode` vlastnost `false`a jeho `ApplyFormatInEditMode` k `true`, jak je znázorněno na obrázku 2.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-141">Recall that this required setting the BoundField's `DataFormatString` property to `{0:c}`, its `HtmlEncode` property to `false`, and its `ApplyFormatInEditMode` to `true`, as shown in Figure 2.</span></span>


<span data-ttu-id="8c3c0-142">[![Konfigurace UnitPrice BoundField k zobrazení jako měny](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-142">[![Configure the UnitPrice BoundField to Display as a Currency](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image4.png)</span></span>

<span data-ttu-id="8c3c0-143">**Obrázek 2**: konfigurace `UnitPrice` BoundField displej jako měny ([Kliknutím zobrazit obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="8c3c0-143">**Figure 2**: Configure the `UnitPrice` BoundField to Display as a Currency ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image6.png))</span></span>


<span data-ttu-id="8c3c0-144">Formátování `UnitPrice` jako měny v rozhraní úpravy vyžaduje vytvoření obslužné rutiny události pro prvku GridView `RowUpdating` událost, která analyzuje řetězec ve formátu měny do `decimal` hodnotu.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-144">Formatting the `UnitPrice` as a currency in the editing interface requires creating an event handler for the GridView's `RowUpdating` event that parses the currency-formatted string into a `decimal` value.</span></span> <span data-ttu-id="8c3c0-145">Odvolat, který `RowUpdating` obslužné rutiny události z poslední kurzu zaškrtnuta možnost také zajistit, aby uživatel zadal `UnitPrice` hodnotu.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-145">Recall that the `RowUpdating` event handler from the last tutorial also checked to ensure that the user provided a `UnitPrice` value.</span></span> <span data-ttu-id="8c3c0-146">Ale pro účely tohoto kurzu umožňuje povolit uživatelům vynechejte cenu.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-146">However, for this tutorial let's allow the user to omit the price.</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample2.cs)]

<span data-ttu-id="8c3c0-147">Zahrnuje naše GridView `QuantityPerUnit` BoundField, ale tato BoundField by měl být pouze pro účely zobrazení a neměla by být upravitelné uživatelem.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-147">Our GridView includes a `QuantityPerUnit` BoundField, but this BoundField should be only for display purposes and should not be editable by the user.</span></span> <span data-ttu-id="8c3c0-148">Však jednoduše nastavit BoundFields `ReadOnly` vlastnost `true`.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-148">To arrange this, simply set the BoundFields' `ReadOnly` property to `true`.</span></span>


<span data-ttu-id="8c3c0-149">[![Zkontrolujte QuantityPerUnit BoundField jen pro čtení](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-149">[![Make the QuantityPerUnit BoundField Read-Only](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image7.png)</span></span>

<span data-ttu-id="8c3c0-150">**Obrázek 3**: Zkontrolujte `QuantityPerUnit` BoundField jen pro čtení ([Kliknutím zobrazit obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="8c3c0-150">**Figure 3**: Make the `QuantityPerUnit` BoundField Read-Only ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image9.png))</span></span>


<span data-ttu-id="8c3c0-151">Nakonec zaškrtněte políčko Povolit úpravy z prvku GridView inteligentních značek.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-151">Finally, check the Enable Editing checkbox from the GridView's smart tag.</span></span> <span data-ttu-id="8c3c0-152">Po dokončení těchto kroků `ErrorHandling.aspx` Návrhář stránky by měl vypadat podobně jako na obrázku 4.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-152">After completing these steps the `ErrorHandling.aspx` page's Designer should look similar to Figure 4.</span></span>


<span data-ttu-id="8c3c0-153">[![Odeberte všechny ale nutný BoundFields a zkontrolujte povolit úpravy zaškrtávací políčko](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-153">[![Remove All But the Needed BoundFields and Check the Enable Editing Checkbox](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image10.png)</span></span>

<span data-ttu-id="8c3c0-154">**Obrázek 4**: Odeberte všechny ale potřeby BoundFields a zaškrtněte políčko Povolit úpravy ([Kliknutím zobrazit obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="8c3c0-154">**Figure 4**: Remove All But the Needed BoundFields and Check the Enable Editing Checkbox ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image12.png))</span></span>


<span data-ttu-id="8c3c0-155">V tomto okamžiku máme seznam všech tyto produkty `ProductName`, `QuantityPerUnit`, `UnitPrice`, a `UnitsInStock` polí; však pouze `ProductName`, `UnitPrice`, a `UnitsInStock` pole lze upravovat.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-155">At this point we have a list of all of the products' `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` fields; however, only the `ProductName`, `UnitPrice`, and `UnitsInStock` fields can be edited.</span></span>


<span data-ttu-id="8c3c0-156">[![Uživatelé nyní můžete snadno upravit názvy produkty, ceny a jednotky v uložených pole](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-156">[![Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image13.png)</span></span>

<span data-ttu-id="8c3c0-157">**Obrázek 5**: názvy uživatelů lze nyní snadno upravit produkty, ceny a jednotky v Stock pole ([Kliknutím zobrazit obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="8c3c0-157">**Figure 5**: Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image15.png))</span></span>


## <a name="step-2-gracefully-handling-dal-level-exceptions"></a><span data-ttu-id="8c3c0-158">Krok 2: Pohodlné zpracování výjimky na úrovni DAL</span><span class="sxs-lookup"><span data-stu-id="8c3c0-158">Step 2: Gracefully Handling DAL-Level Exceptions</span></span>

<span data-ttu-id="8c3c0-159">Při našich upravitelné GridView nádherně funguje, když uživatelé zadat platné hodnoty pro název, ceny a jednotky v stock upravená produktu, zadávání neplatné hodnoty mít za následek výjimku.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-159">While our editable GridView works wonderfully when users enter legal values for the edited product's name, price, and units in stock, entering illegal values results in an exception.</span></span> <span data-ttu-id="8c3c0-160">Například vynechání `ProductName` hodnotu příčiny [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) vyvolání od `ProductName` vlastnost v `ProdcutsRow` třída má jeho `AllowDBNull` vlastnost nastavena na hodnotu `false`; Pokud databáze je vypnutý, `SqlException` bude vyvolané TableAdapter při pokusu o připojení k databázi.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-160">For example, omitting the `ProductName` value causes a [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) to be thrown since the `ProductName` property in the `ProdcutsRow` class has its `AllowDBNull` property set to `false`; if the database is down, a `SqlException` will be thrown by the TableAdapter when attempting to connect to the database.</span></span> <span data-ttu-id="8c3c0-161">Bez provedení akce, tyto výjimky vyvolat z Data Access Layer vrstvu obchodní logiky a potom na stránku ASP.NET a nakonec na modulem runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-161">Without taking any action, these exceptions bubble up from the Data Access Layer to the Business Logic Layer, then to the ASP.NET page, and finally to the ASP.NET runtime.</span></span>

<span data-ttu-id="8c3c0-162">V závislosti na konfiguraci webové aplikace a zda právě navštíveného aplikace z `localhost`, neošetřené výjimky může způsobit na stránce Obecná chyba serveru, sestava podrobnosti o chybě nebo uživatelsky přívětivý webové stránky.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-162">Depending on how your web application is configured and whether or not you're visiting the application from `localhost`, an unhandled exception can result in either a generic server-error page, a detailed error report, or a user-friendly web page.</span></span> <span data-ttu-id="8c3c0-163">V tématu [webové zpracování chyb aplikace technologie ASP.NET](http://www.15seconds.com/issue/030102.htm) a [customErrors Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) Další informace o odpovědí modulem runtime ASP.NET na nezachycenou výjimku.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-163">See [Web Application Error Handling in ASP.NET](http://www.15seconds.com/issue/030102.htm) and the [customErrors Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) for more information on how the ASP.NET runtime responds to an uncaught exception.</span></span>

<span data-ttu-id="8c3c0-164">Obrázek 6 ukazuje na obrazovce došlo při pokusu o aktualizaci produktu bez zadání `ProductName` hodnotu.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-164">Figure 6 shows the screen encountered when attempting to update a product without specifying the `ProductName` value.</span></span> <span data-ttu-id="8c3c0-165">Toto je výchozí podrobné informace o chybě sestava zobrazí, když procházejícího `localhost`.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-165">This is the default detailed error report displayed when coming through `localhost`.</span></span>


<span data-ttu-id="8c3c0-166">[![Vynechání název produktu, bude zobrazení Podrobnosti o výjimce](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-166">[![Omitting the Product's Name Will Display Exception Details](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image16.png)</span></span>

<span data-ttu-id="8c3c0-167">**Obrázek 6**: Vynechání podrobnosti výjimky zobrazení bude název produktu ([Kliknutím zobrazit obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="8c3c0-167">**Figure 6**: Omitting the Product's Name Will Display Exception Details ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image18.png))</span></span>


<span data-ttu-id="8c3c0-168">Tyto podrobnosti výjimky jsou užitečné při testování aplikace, koncový uživatel prezentuje obrazovky při krátkodobém výjimku je menší než vhodné.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-168">While such exception details are helpful when testing an application, presenting an end user with such a screen in the face of an exception is less than ideal.</span></span> <span data-ttu-id="8c3c0-169">Koncový uživatel nejspíš nebude vědět, co `NoNullAllowedException` je nebo proč byl způsobený.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-169">An end user likely doesn't know what a `NoNullAllowedException` is or why it was caused.</span></span> <span data-ttu-id="8c3c0-170">Lepší přístupem je uživateli zprostředkovali srozumitelnější zprávu, která vysvětluje, že došlo k potížím, pokus o aktualizaci produktu.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-170">A better approach is to present the user with a more user-friendly message explaining that there were problems attempting to update the product.</span></span>

<span data-ttu-id="8c3c0-171">Pokud dojde k výjimce při provádění této operace, po úroveň události v ObjectDataSource a ovládací prvek webu data poskytují prostředky pro zjišťovat a zrušit výjimka v proniknutí až modulem runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-171">If an exception occurs when performing the operation, the post-level events in both the ObjectDataSource and the data Web control provide a means to detect it and cancel the exception from bubbling up to the ASP.NET runtime.</span></span> <span data-ttu-id="8c3c0-172">Pro náš příklad vytvoříme obslužné rutiny události pro prvku GridView `RowUpdated` událost, která určuje, zda výjimku je aktivována a pokud ano, zobrazí podrobnosti o výjimce v ovládacím prvku popisek Web.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-172">For our example, let's create an event handler for the GridView's `RowUpdated` event that determines if an exception has fired and, if so, displays the exception details in a Label Web control.</span></span>

<span data-ttu-id="8c3c0-173">Začněte přidáním štítek na stránku ASP.NET, nastavení jeho `ID` vlastnost `ExceptionDetails` a vymazání jeho `Text` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-173">Start by adding a Label to the ASP.NET page, setting its `ID` property to `ExceptionDetails` and clearing out its `Text` property.</span></span> <span data-ttu-id="8c3c0-174">Chcete-li kreslení oko uživatele na tuto zprávu, nastavte jeho `CssClass` vlastnost `Warning`, tedy třídu CSS jsme přidali do `Styles.css` souboru v předchozí kurzu.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-174">In order to draw the user's eye to this message, set its `CssClass` property to `Warning`, which is a CSS class we added to the `Styles.css` file in the previous tutorial.</span></span> <span data-ttu-id="8c3c0-175">Odvolat, že tato třída šablon stylů CSS způsobí, že text popisku, který se zobrazí písmeny red, kurzíva, tučné písmo, velmi velké.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-175">Recall that this CSS class causes the Label's text to be displayed in a red, italic, bold, extra large font.</span></span>


<span data-ttu-id="8c3c0-176">[![Přidání ovládacího prvku popisek na stránku](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-176">[![Add a Label Web Control to the Page](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image19.png)</span></span>

<span data-ttu-id="8c3c0-177">**Obrázek 7**: Přidání ovládacího prvku popisek na stránku ([Kliknutím zobrazit obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="8c3c0-177">**Figure 7**: Add a Label Web Control to the Page ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image21.png))</span></span>


<span data-ttu-id="8c3c0-178">Vzhledem k tomu, že má být tento ovládací prvek popisek webu mají být zobrazeny pouze okamžitě po došlo k výjimce, nastavte jeho `Visible` vlastnost na hodnotu false v `Page_Load` obslužné rutiny události:</span><span class="sxs-lookup"><span data-stu-id="8c3c0-178">Since we want this Label Web control to be visible only immediately after an exception has occurred, set its `Visible` property to false in the `Page_Load` event handler:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample3.cs)]

<span data-ttu-id="8c3c0-179">S tímto kódem, na první návštěvě stránky a následné postback `ExceptionDetails` ovládací prvek bude mít jeho `Visible` vlastnost nastavena na hodnotu `false`.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-179">With this code, on the first page visit and subsequent postbacks the `ExceptionDetails` control will have its `Visible` property set to `false`.</span></span> <span data-ttu-id="8c3c0-180">Při krátkodobém úrovni DAL nebo BLL výjimky, které jsme můžete zjistit v prvku GridView `RowUpdated` obslužné rutiny události, se nastaví `ExceptionDetails` ovládacího prvku `Visible` vlastnost na hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-180">In the face of a DAL- or BLL-level exception, which we can detect in the GridView's `RowUpdated` event handler, we will set the `ExceptionDetails` control's `Visible` property to true.</span></span> <span data-ttu-id="8c3c0-181">Vzhledem k tomu, že obslužných rutin událostí pro ovládací prvek webové následovat po `Page_Load` obslužné rutiny událostí v životním cyklu stránky, se zobrazí popisek.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-181">Since Web control event handlers occur after the `Page_Load` event handler in the page lifecycle, the Label will be shown.</span></span> <span data-ttu-id="8c3c0-182">Na další zpětné volání, ale `Page_Load` obslužné rutiny události vrátíte `Visible` vlastnost zpět do `false`, znovu skrytí ze zobrazení.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-182">However, on the next postback, the `Page_Load` event handler will revert the `Visible` property back to `false`, hiding it from view again.</span></span>

> [!NOTE]
> <span data-ttu-id="8c3c0-183">Jsme odebrat také nezbytné pro nastavení `ExceptionDetails` ovládacího prvku `Visible` vlastnost `Page_Load` přiřazením jeho `Visible` vlastnost `false` v deklarativní syntaxi a zakázání svůj stav zobrazení (nastavení jeho `EnableViewState` vlastnost `false`).</span><span class="sxs-lookup"><span data-stu-id="8c3c0-183">Alternatively, we could remove the necessity for setting the `ExceptionDetails` control's `Visible` property in `Page_Load` by assigning its `Visible` property `false` in the declarative syntax and disabling its view state (setting its `EnableViewState` property to `false`).</span></span> <span data-ttu-id="8c3c0-184">V budoucích kurzu použijeme tento alternativní přístup.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-184">We'll use this alternative approach in a future tutorial.</span></span>


<span data-ttu-id="8c3c0-185">U ovládacího prvku popisek přidat naše dalším krokem je vytvoření obslužné rutiny události pro prvku GridView `RowUpdated` událostí.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-185">With the Label control added, our next step is to create the event handler for the GridView's `RowUpdated` event.</span></span> <span data-ttu-id="8c3c0-186">Vyberte GridView v návrháři, přejděte do okna vlastností a klikněte na bolt ikonu, výpis prvku GridView události.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-186">Select the GridView in the Designer, go to the Properties window, and click the lightning bolt icon, listing the GridView's events.</span></span> <span data-ttu-id="8c3c0-187">Měla by existovat již položka existuje pro prvku GridView `RowUpdating` události, jako jsme vytvořili obslužné rutiny události pro tuto událost v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-187">There should already be an entry there for the GridView's `RowUpdating` event, as we created an event handler for this event earlier in this tutorial.</span></span> <span data-ttu-id="8c3c0-188">Vytvoření obslužné rutiny událostí `RowUpdated` také událostí.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-188">Create an event handler for the `RowUpdated` event as well.</span></span>


![Vytvoření obslužné rutiny události pro událost RowUpdated GridView.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image22.png)

<span data-ttu-id="8c3c0-190">**Obrázek 8**: vytvoření obslužné rutiny události pro prvku GridView `RowUpdated` událostí</span><span class="sxs-lookup"><span data-stu-id="8c3c0-190">**Figure 8**: Create an Event Handler for the GridView's `RowUpdated` Event</span></span>


> [!NOTE]
> <span data-ttu-id="8c3c0-191">Můžete také vytvořit obslužnou rutinu události pomocí rozevíracích seznamů v horní části třídy souboru kódu na pozadí.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-191">You can also create the event handler through the drop-down lists at the top of the code-behind class file.</span></span> <span data-ttu-id="8c3c0-192">V rozevíracím seznamu na levé straně vyberte GridView a `RowUpdated` událost z jedné na pravé straně.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-192">Select the GridView from the drop-down list on the left and the `RowUpdated` event from the one on the right.</span></span>


<span data-ttu-id="8c3c0-193">Vytvoření této obslužné rutiny události bude do třídy kódu stránky ASP.NET přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="8c3c0-193">Creating this event handler will add the following code to the ASP.NET page's code-behind class:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample4.cs)]

<span data-ttu-id="8c3c0-194">Druhý vstupní parametr této obslužné rutiny události je objekt typu [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), který má tři vlastnosti týkající se zpracování výjimky:</span><span class="sxs-lookup"><span data-stu-id="8c3c0-194">This event handler's second input parameter is an object of type [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), which has three properties of interest for handling exceptions:</span></span>

- <span data-ttu-id="8c3c0-195">`Exception` odkaz na vyvolaná výjimka; Pokud žádné došlo k výjimce, tato vlastnost bude mít hodnotu `null`</span><span class="sxs-lookup"><span data-stu-id="8c3c0-195">`Exception` a reference to the thrown exception; if no exception has been thrown, this property will have a value of `null`</span></span>
- <span data-ttu-id="8c3c0-196">`ExceptionHandled` Logická hodnota, která označuje, zda bylo zpracováno výjimka v `RowUpdated` obslužné rutiny události; Pokud `false` (výchozí), výjimka je znovu vyvolána, percolating až modulem runtime ASP.NET</span><span class="sxs-lookup"><span data-stu-id="8c3c0-196">`ExceptionHandled` a Boolean value that indicates whether or not the exception was handled in the `RowUpdated` event handler; if `false` (the default), the exception is re-thrown, percolating up to the ASP.NET runtime</span></span>
- <span data-ttu-id="8c3c0-197">`KeepInEditMode` Pokud nastavena na `true` upravená řádek GridView zůstane v režimu úprav; Pokud `false` (výchozí), řádek GridView vrátí zpět na jeho režimu jen pro čtení</span><span class="sxs-lookup"><span data-stu-id="8c3c0-197">`KeepInEditMode` if set to `true` the edited GridView row remains in edit mode; if `false` (the default), the GridView row reverts back to its read-only mode</span></span>

<span data-ttu-id="8c3c0-198">Naše kód, pak by měla zkontrolovat Pokud `Exception` není `null`, což znamená, že při provádění operace došlo k výjimce.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-198">Our code, then, should check to see if `Exception` is not `null`, meaning that an exception was raised while performing the operation.</span></span> <span data-ttu-id="8c3c0-199">Pokud je to tento případ, chceme:</span><span class="sxs-lookup"><span data-stu-id="8c3c0-199">If this is the case, we want to:</span></span>

- <span data-ttu-id="8c3c0-200">Zobrazit zprávu v uživatelsky přívětivý `ExceptionDetails` popisek</span><span class="sxs-lookup"><span data-stu-id="8c3c0-200">Display a user-friendly message in the `ExceptionDetails` Label</span></span>
- <span data-ttu-id="8c3c0-201">Označuje, že byla zpracována výjimka</span><span class="sxs-lookup"><span data-stu-id="8c3c0-201">Indicate that the exception was handled</span></span>
- <span data-ttu-id="8c3c0-202">Zachovat GridView řádek v režimu úprav</span><span class="sxs-lookup"><span data-stu-id="8c3c0-202">Keep the GridView row in edit mode</span></span>

<span data-ttu-id="8c3c0-203">Tento následující kód provede tyto cíle:</span><span class="sxs-lookup"><span data-stu-id="8c3c0-203">This following code accomplishes these objectives:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample5.cs)]

<span data-ttu-id="8c3c0-204">Tuto obslužnou rutinu události začne kontrolou a zjistěte, zda `e.Exception` je `null`.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-204">This event handler begins by checking to see if `e.Exception` is `null`.</span></span> <span data-ttu-id="8c3c0-205">Pokud není, `ExceptionDetails` popisku `Visible` je nastavena na `true` a jeho `Text` vlastnost "Došlo k potížím při aktualizaci produktu."</span><span class="sxs-lookup"><span data-stu-id="8c3c0-205">If it's not, the `ExceptionDetails` Label's `Visible` property is set to `true` and its `Text` property to "There was a problem updating the product."</span></span> <span data-ttu-id="8c3c0-206">Podrobnosti o skutečné výjimku, která byla vydána jsou umístěny ve `e.Exception` objektu `InnerException` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-206">The details of the actual exception that was thrown reside in the `e.Exception` object's `InnerException` property.</span></span> <span data-ttu-id="8c3c0-207">Vnitřní výjimku je zkontrolován, a pokud je konkrétní typ, připojí se zprávou další, užitečné k `ExceptionDetails` popisku `Text` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-207">This inner exception is examined and, if it is of a particular type, an additional, helpful message is appended to the `ExceptionDetails` Label's `Text` property.</span></span> <span data-ttu-id="8c3c0-208">Nakonec `ExceptionHandled` a `KeepInEditMode` obě vlastnosti jsou nastaveny na `true`.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-208">Lastly, the `ExceptionHandled` and `KeepInEditMode` properties are both set to `true`.</span></span>

<span data-ttu-id="8c3c0-209">Obrázek 9 ukazuje snímek obrazovky tuto stránku při vynechání název produktu; Obrázek 10 ukazuje výsledky při zadávání neplatné `UnitPrice` hodnotu (-50).</span><span class="sxs-lookup"><span data-stu-id="8c3c0-209">Figure 9 shows a screen shot of this page when omitting the name of the product; Figure 10 shows the results when entering an illegal `UnitPrice` value (-50).</span></span>


<span data-ttu-id="8c3c0-210">[![ProductName BoundField musí obsahovat hodnotu](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-210">[![The ProductName BoundField Must Contain a Value](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image23.png)</span></span>

<span data-ttu-id="8c3c0-211">**Obrázek 9**: `ProductName` BoundField musí obsahovat hodnotu ([Kliknutím zobrazit obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="8c3c0-211">**Figure 9**: The `ProductName` BoundField Must Contain a Value ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image25.png))</span></span>


<span data-ttu-id="8c3c0-212">[![Záporné hodnoty UnitPrice je zakázán.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-212">[![Negative UnitPrice Values are Not Allowed](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image26.png)</span></span>

<span data-ttu-id="8c3c0-213">**Obrázek 10**: záporné `UnitPrice` není povolené jsou hodnoty ([Kliknutím zobrazit obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="8c3c0-213">**Figure 10**: Negative `UnitPrice` Values are Not Allowed ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image28.png))</span></span>


<span data-ttu-id="8c3c0-214">Nastavením `e.ExceptionHandled` vlastnost `true`, `RowUpdated` obslužné rutiny události oznámilo, že se má zajistit výjimku.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-214">By setting the `e.ExceptionHandled` property to `true`, the `RowUpdated` event handler has indicated that it has handled the exception.</span></span> <span data-ttu-id="8c3c0-215">Proto nebude výjimka rozšíří až modulem runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-215">Therefore, the exception won't propagate up to the ASP.NET runtime.</span></span>

> [!NOTE]
> <span data-ttu-id="8c3c0-216">Následující obrázky 9 a 10 zobrazit řádně způsob zpracování výjimek vyvolaných z důvodu neplatné uživatelský vstup.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-216">Figures 9 and 10 show a graceful way to handle exceptions raised due to invalid user input.</span></span> <span data-ttu-id="8c3c0-217">V ideálním případě by ale tyto neplatné vstupní se nikdy reach vrstvu obchodní logiky v prvé řadě jako stránku ASP.NET se ujistěte, že vstupy uživatele jsou platné před vyvoláním `ProductsBLL` třídy `UpdateProduct` metoda.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-217">Ideally, though, such invalid input will never reach the Business Logic Layer in the first place, as the ASP.NET page should ensure that the user's inputs are valid before invoking the `ProductsBLL` class's `UpdateProduct` method.</span></span> <span data-ttu-id="8c3c0-218">V našem další kurzu ukážeme, jak přidat ověřovací ovládací prvky pro úpravy a vkládání rozhraní zajistit, aby data odeslaná na vrstvu obchodní logiky vyhovuje obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-218">In our next tutorial we'll see how to add validation controls to the editing and inserting interfaces to ensure that the data submitted to the Business Logic Layer conforms to the business rules.</span></span> <span data-ttu-id="8c3c0-219">Ovládací prvky ověřování nejen zabránit vyvolání `UpdateProduct` metodu, dokud uživatel zadal data je platný, ale také poskytují informativnější činnost koncového uživatele pro identifikaci problémů vstupní data.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-219">The validation controls not only prevent the invocation of the `UpdateProduct` method until the user-supplied data is valid, but also provide a more informative user experience for identifying data entry problems.</span></span>


## <a name="step-3-gracefully-handling-bll-level-exceptions"></a><span data-ttu-id="8c3c0-220">Krok 3: Pohodlné zpracování výjimek BLL úrovni</span><span class="sxs-lookup"><span data-stu-id="8c3c0-220">Step 3: Gracefully Handling BLL-Level Exceptions</span></span>

<span data-ttu-id="8c3c0-221">Při vkládání, aktualizaci nebo odstranění dat, Data Access Layer může vyvolat výjimku, při krátkodobém chyb souvisejících s daty.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-221">When inserting, updating, or deleting data, the Data Access Layer may throw an exception in the face of a data-related error.</span></span> <span data-ttu-id="8c3c0-222">Databáze může být offline, nemusí mít měl sloupec tabulky požadovaná databáze má hodnotu nebo omezení úrovně tabulky bylo narušeno.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-222">The database may be offline, a required database table column might not have had a value specified, or a table-level constraint may have been violated.</span></span> <span data-ttu-id="8c3c0-223">Kromě výhradně souvisejících s daty výjimky vrstvu obchodní logiky, můžete použít výjimky k signalizují, že byla porušena obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-223">In addition to strictly data-related exceptions, the Business Logic Layer can use exceptions to indicate when business rules have been violated.</span></span> <span data-ttu-id="8c3c0-224">V [vytváření vrstvu obchodní logiky](../introduction/creating-a-business-logic-layer-cs.md) kurzu, například jsme přidali kontrolu obchodní pravidlo do původního `UpdateProduct` přetížení.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-224">In the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial, for example, we added a business rule check to the original `UpdateProduct` overload.</span></span> <span data-ttu-id="8c3c0-225">Konkrétně Pokud uživatel byl označíte produktu, jako zastaveny, vyžádali jsme si produktu nesmí být jen jeden od jeho dodavatele.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-225">Specifically, if the user was marking a product as discontinued, we required that the product not be the only one provided by its supplier.</span></span> <span data-ttu-id="8c3c0-226">Pokud tuto podmínku byla porušena, `ApplicationException` byla vyvolána.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-226">If this condition was violated, an `ApplicationException` was thrown.</span></span>

<span data-ttu-id="8c3c0-227">Pro `UpdateProduct` přetížení vytvořili v tomto kurzu, přidejme obchodního pravidla, která zakazuje `UnitPrice` pole z Probíhá nastavení objektu na novou hodnotu, která je větší, než dvojnásobek původní `UnitPrice` hodnota.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-227">For the `UpdateProduct` overload created in this tutorial, let's add a business rule that prohibits the `UnitPrice` field from being set to a new value that's more than twice the original `UnitPrice` value.</span></span> <span data-ttu-id="8c3c0-228">K tomu, upravte `UpdateProduct` přetížení tak, aby tuto kontrolu provede a vrátí `ApplicationException` Pokud porušení pravidla.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-228">To accomplish this, adjust the `UpdateProduct` overload so that it performs this check and throws an `ApplicationException` if the rule is violated.</span></span> <span data-ttu-id="8c3c0-229">Aktualizovaná metoda následovně:</span><span class="sxs-lookup"><span data-stu-id="8c3c0-229">The updated method follows:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample6.cs)]

<span data-ttu-id="8c3c0-230">Díky této změně způsobí, že všechny aktualizace ceny, která je větší, než dvojnásobek existující cena `ApplicationException` vyvolání.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-230">With this change, any price update that is more than twice the existing price will cause an `ApplicationException` to be thrown.</span></span> <span data-ttu-id="8c3c0-231">Stejně jako výjimky vyvolané z vrstvy DAL tento BLL vyvolá `ApplicationException` mohou být zjištěna a zpracovávány v prvku GridView `RowUpdated` obslužné rutiny události.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-231">Just like the exception raised from the DAL, this BLL-raised `ApplicationException` can be detected and handled in the GridView's `RowUpdated` event handler.</span></span> <span data-ttu-id="8c3c0-232">Ve skutečnosti `RowUpdated` kód obslužné rutiny události, protože zapisuje, správně rozpozná výjimku a zobrazit `ApplicationException`na `Message` hodnotu vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-232">In fact, the `RowUpdated` event handler's code, as written, will correctly detect this exception and display the `ApplicationException`'s `Message` property value.</span></span> <span data-ttu-id="8c3c0-233">Obrázek 11 ukazuje snímku obrazovky, když se uživatel pokusí aktualizovat cenu Chai $ 50,00, což je více než double jeho aktuální cena 19,95.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-233">Figure 11 shows a screen shot when a user attempts to update the price of Chai to $50.00, which is more than double its current price of $19.95.</span></span>


<span data-ttu-id="8c3c0-234">[![Obchodní pravidla zakáže zvyšuje ceny, které maximálně dvakrát cenu produktu](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-234">[![The Business Rules Disallow Price Increases That More Than Double a Product's Price](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image29.png)</span></span>

<span data-ttu-id="8c3c0-235">**Obrázek 11**: firmy pravidla zvyšuje zakázat ceny, které maximálně dvakrát cenu produktu ([Kliknutím zobrazit obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="8c3c0-235">**Figure 11**: The Business Rules Disallow Price Increases That More Than Double a Product's Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image31.png))</span></span>


> [!NOTE]
> <span data-ttu-id="8c3c0-236">V ideálním případě by se naše obchodní logiku pravidla mimo rozdělili `UpdateProduct` přetížení metody a do běžnou metodu.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-236">Ideally our business logic rules would be refactored out of the `UpdateProduct` method overloads and into a common method.</span></span> <span data-ttu-id="8c3c0-237">To je ponechán jako cvičení pro čtečku.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-237">This is left as an exercise for the reader.</span></span>


## <a name="summary"></a><span data-ttu-id="8c3c0-238">Souhrn</span><span class="sxs-lookup"><span data-stu-id="8c3c0-238">Summary</span></span>

<span data-ttu-id="8c3c0-239">Během vkládání, aktualizaci a odstraňování operace ovládací prvek webu dat a související se situací ObjectDataSource fire události před a po úrovně tohoto zarážku aktuální operace.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-239">During inserting, updating, and deleting operations, both the data Web control and the ObjectDataSource involved fire pre- and post-level events that bookend the actual operation.</span></span> <span data-ttu-id="8c3c0-240">Jak jsme viděli v tomto kurzu a ten předchozí při práci s upravitelné GridView prvku GridView `RowUpdating` aktivuje událost, za nímž následuje ObjectDataSource `Updating` událostí, okamžiku je příkaz aktualizace provedené ObjectDataSource základní objekt.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-240">As we saw in this tutorial and the preceding one, when working with an editable GridView the GridView's `RowUpdating` event fires, followed by the ObjectDataSource's `Updating` event, at which point the update command is made to the ObjectDataSource's underlying object.</span></span> <span data-ttu-id="8c3c0-241">Po dokončení operace ObjectDataSource `Updated` aktivuje událost, za nímž následuje prvku GridView `RowUpdated` událostí.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-241">After the operation has completed, the ObjectDataSource's `Updated` event fires, followed by the GridView's `RowUpdated` event.</span></span>

<span data-ttu-id="8c3c0-242">Můžeme vytvořit obslužné rutiny událostí předem úroveň události, aby bylo možné přizpůsobit vstupní parametry nebo po úroveň události, aby kontrolovat a reakce na výsledky operace.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-242">We can create event handlers for the pre-level events in order to customize the input parameters or for the post-level events in order to inspect and respond to the operation's results.</span></span> <span data-ttu-id="8c3c0-243">Obslužné rutiny událostí po úrovně se běžně používají ke zjištění, zda při operaci došlo k výjimce.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-243">Post-level event handlers are most commonly used to detect whether an exception occurred during the operation.</span></span> <span data-ttu-id="8c3c0-244">Při krátkodobém výjimku v těchto obslužných rutinách událostí na úrovni po volitelně může zpracovat výjimku samostatně.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-244">In the face of an exception, these post-level event handlers can optionally handle the exception on their own.</span></span> <span data-ttu-id="8c3c0-245">V tomto kurzu jsme viděli, jak zpracovat takové výjimky zobrazením popisný chybová zpráva.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-245">In this tutorial we saw how to handle such an exception by displaying a friendly error message.</span></span>

<span data-ttu-id="8c3c0-246">V dalším kurzu ukážeme, jak zmenšit prostor pravděpodobnost výjimky vzniklých formátování problémy dat (například zadáte jako záporné `UnitPrice`).</span><span class="sxs-lookup"><span data-stu-id="8c3c0-246">In the next tutorial we'll see how to lessen the likelihood of exceptions arising from data formatting issues (such as entering a negative `UnitPrice`).</span></span> <span data-ttu-id="8c3c0-247">Konkrétně podíváme Přidání ověření ovládacích prvků pro úpravy a vkládání rozhraní.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-247">Specifically, we'll look at how to add validation controls to the editing and inserting interfaces.</span></span>

<span data-ttu-id="8c3c0-248">Radostí programování!</span><span class="sxs-lookup"><span data-stu-id="8c3c0-248">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="8c3c0-249">O autorovi</span><span class="sxs-lookup"><span data-stu-id="8c3c0-249">About the Author</span></span>

<span data-ttu-id="8c3c0-250">[Scott Meisnerová](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor sedm ASP/ASP.NET knih a zakladatele z [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracuje s technologií Microsoft Web od 1998.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8c3c0-251">Scott funguje jako nezávislé poradce, trainer a zapisovače.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-251">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8c3c0-252">Jeho nejnovější seznam k [ *Edice nakladatelství Sams naučit sami technologii ASP.NET 2.0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="8c3c0-252">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8c3c0-253">Dosažitelný v [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) nebo prostřednictvím svého blogu, který najdete na [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="8c3c0-253">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="8c3c0-254">Zvláštní poděkování</span><span class="sxs-lookup"><span data-stu-id="8c3c0-254">Special Thanks To</span></span>

<span data-ttu-id="8c3c0-255">Tento kurz řady byla zkontrolovány uživatelem mnoho užitečné kontrolorů.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-255">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="8c3c0-256">Vést kontrolorem pro tento kurz byl Liz Shulok.</span><span class="sxs-lookup"><span data-stu-id="8c3c0-256">Lead reviewer for this tutorial was Liz Shulok.</span></span> <span data-ttu-id="8c3c0-257">Kontrola Moje nadcházející články MSDN máte zájem?</span><span class="sxs-lookup"><span data-stu-id="8c3c0-257">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="8c3c0-258">Pokud ano, vyřaďte mi řádek v [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-258">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8c3c0-259">[Předchozí](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)
> [další](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)</span><span class="sxs-lookup"><span data-stu-id="8c3c0-259">[Previous](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)
[Next](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)</span></span>
