---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
title: "Vytvoření vrstvy obchodní logiky (C#) | Microsoft Docs"
author: rick-anderson
description: "V tomto kurzu ukážeme, jak centralizovat obchodní pravidla do obchodní logiku vrstvy (BLL), který slouží jako prostředník pro výměnu dat mezi t..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/31/2010
ms.topic: article
ms.assetid: 85554606-47cb-4e4f-9848-eed9da579056
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: 7518ddd11a05a9e3d5df85e3cf6ceffa09a25060
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/24/2018
---
<a name="creating-a-business-logic-layer-c"></a><span data-ttu-id="17357-103">Vytvoření vrstvy obchodní logiky (C#)</span><span class="sxs-lookup"><span data-stu-id="17357-103">Creating a Business Logic Layer (C#)</span></span>
====================
<span data-ttu-id="17357-104">podle [Scott Meisnerová](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="17357-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="17357-105">[Stáhněte si ukázkovou aplikaci](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) nebo [stáhnout PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="17357-105">[Download Sample App](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) or [Download PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span></span>

> <span data-ttu-id="17357-106">V tomto kurzu vidíte jak centralizovat obchodní pravidla do obchodní logiku vrstvy (BLL), který slouží jako prostředník pro výměnu dat mezi prezentační vrstvou a DAL.</span><span class="sxs-lookup"><span data-stu-id="17357-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>


## <a name="introduction"></a><span data-ttu-id="17357-107">Úvod</span><span class="sxs-lookup"><span data-stu-id="17357-107">Introduction</span></span>

<span data-ttu-id="17357-108">Data přístup Layer (DAL) vytvořené v [první kurz](creating-a-data-access-layer-cs.md) této aplikace odděluje data přístup logiku z logiky prezentace.</span><span class="sxs-lookup"><span data-stu-id="17357-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-cs.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="17357-109">Ale při DAL řádně odděluje podrobnosti o přístupu dat od prezentační vrstvy, se nevynucuje žádné obchodní pravidla, které se mohou vztahovat.</span><span class="sxs-lookup"><span data-stu-id="17357-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="17357-110">Například pro naši aplikaci může chceme zakáže `CategoryID` nebo `SupplierID` pole `Products` tabulky má být změněn, kdy `Discontinued` je nastaveno na 1, nebo jsme chtít vynutit pravidla služebních zákazu situace, kdy Zaměstnanec spravuje uživatele, který byl přijat po jejich.</span><span class="sxs-lookup"><span data-stu-id="17357-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="17357-111">Další z typických možností je možná pouze uživatelé autorizace v konkrétní roli můžete odstranit produkty nebo můžete změnit `UnitPrice` hodnotu.</span><span class="sxs-lookup"><span data-stu-id="17357-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="17357-112">V tomto kurzu vidíte jak centralizovat do obchodní logiku vrstvy (BLL), který slouží jako prostředník pro výměnu dat mezi prezentační vrstvou a DAL tyto obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="17357-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="17357-113">V reálné aplikaci by měla být implementována BLL jako samostatné projektu knihovny tříd. ale pro tyto kurzy jsme budete implementovat BLL jako řadu třídy v našem `App_Code` složky, aby bylo možné zjednodušit strukturu projektu.</span><span class="sxs-lookup"><span data-stu-id="17357-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="17357-114">Obrázek 1 ukazuje architektury vztahy mezi prezentační vrstvy, BLL a DAL.</span><span class="sxs-lookup"><span data-stu-id="17357-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>


![BLL odděluje prezentační vrstvy od Data Access Layer a ukládá obchodní pravidla](creating-a-business-logic-layer-cs/_static/image1.png)

<span data-ttu-id="17357-116">**Obrázek 1**: BLL odděluje prezentační vrstvy od Data Access Layer a ukládá obchodní pravidla</span><span class="sxs-lookup"><span data-stu-id="17357-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>


## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="17357-117">Krok 1: Vytvoření BLL třídy</span><span class="sxs-lookup"><span data-stu-id="17357-117">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="17357-118">Naše BLL bude skládat ze čtyř třídy, jeden pro každou TableAdapter v DAL; Každá z těchto tříd BLL bude mít metody pro načítání, vkládání, aktualizaci a odstraňování z příslušných TableAdapter v DAL, použití příslušné obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="17357-118">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="17357-119">Chcete-li více této aplikace oddělte třídy související s vrstvou DAL a BLL, vytvoříme dvě podsložky v `App_Code` složky, `DAL` a `BLL`.</span><span class="sxs-lookup"><span data-stu-id="17357-119">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="17357-120">Jednoduše klikněte pravým tlačítkem na `App_Code` složky v Průzkumníku řešení a vyberte novou složku.</span><span class="sxs-lookup"><span data-stu-id="17357-120">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="17357-121">Po vytvoření tyto dvě složky, přesuňte typové datové sady vytvořené v první kurz do `DAL` podsložky.</span><span class="sxs-lookup"><span data-stu-id="17357-121">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="17357-122">Dále vytvořte čtyři soubory třídy BLL v `BLL` podsložky.</span><span class="sxs-lookup"><span data-stu-id="17357-122">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="17357-123">K tomu, klikněte pravým tlačítkem na `BLL` podsložku, zvolte možnost Přidat novou položku a vyberte šablonu třída.</span><span class="sxs-lookup"><span data-stu-id="17357-123">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="17357-124">Název třídy čtyři `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, a `EmployeesBLL`.</span><span class="sxs-lookup"><span data-stu-id="17357-124">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>


![Přidat čtyři nové třídy do složky App_Code](creating-a-business-logic-layer-cs/_static/image2.png)

<span data-ttu-id="17357-126">**Obrázek 2**: přidat čtyři nové třídy `App_Code` složky</span><span class="sxs-lookup"><span data-stu-id="17357-126">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>


<span data-ttu-id="17357-127">Dále umožňuje přidání metody do jednotlivých tříd jednoduše zabalit metody definované pro TableAdapters z první kurz.</span><span class="sxs-lookup"><span data-stu-id="17357-127">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="17357-128">Teď budou tyto metody stačí zavolat přímo do vrstvy DAL; se vrátíme později přidat veškeré potřebné obchodní logiky.</span><span class="sxs-lookup"><span data-stu-id="17357-128">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="17357-129">Pokud používáte Visual Studio Standard Edition nebo vyšší (to znamená, že *není* pomocí Visual Web Developer), Volitelně můžete navrhnout vaše třídy vizuálně pomocí [návrhář tříd](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span><span class="sxs-lookup"><span data-stu-id="17357-129">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="17357-130">Odkazovat [třídu návrháře Blog](https://blogs.msdn.com/classdesigner/default.aspx) Další informace o této nové funkce v sadě Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="17357-130">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>


<span data-ttu-id="17357-131">Pro `ProductsBLL` třída je potřeba přidat celkem sedm metody:</span><span class="sxs-lookup"><span data-stu-id="17357-131">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="17357-132">`GetProducts()`Vrátí všechny produkty</span><span class="sxs-lookup"><span data-stu-id="17357-132">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="17357-133">`GetProductByProductID(productID)`Vrátí součin s ID zadaného produktu</span><span class="sxs-lookup"><span data-stu-id="17357-133">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="17357-134">`GetProductsByCategoryID(categoryID)`Vrátí všechny produkty z Zadaná kategorie</span><span class="sxs-lookup"><span data-stu-id="17357-134">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="17357-135">`GetProductsBySupplier(supplierID)`Vrátí všechny produkty z zadaný dodavatele</span><span class="sxs-lookup"><span data-stu-id="17357-135">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="17357-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)`Vloží nového produktu do databáze pomocí hodnot předané; Vrátí `ProductID` hodnotu nově vloženou záznamu</span><span class="sxs-lookup"><span data-stu-id="17357-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="17357-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)`Aktualizuje existující produkt v databázi pomocí hodnoty předané; Vrátí `true` Pokud přesně jeden řádek aktualizován, `false` jinak</span><span class="sxs-lookup"><span data-stu-id="17357-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `true` if precisely one row was updated, `false` otherwise</span></span>
- <span data-ttu-id="17357-138">`DeleteProduct(productID)`Odstraní zadaný produkt z databáze</span><span class="sxs-lookup"><span data-stu-id="17357-138">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="17357-139">ProductsBLL.cs</span><span class="sxs-lookup"><span data-stu-id="17357-139">ProductsBLL.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample1.cs)]

<span data-ttu-id="17357-140">Metody, které jednoduše vrátit data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, a `GetProductBySuppliersID` jsou přímočará jednoduše volají do vrstvy DAL.</span><span class="sxs-lookup"><span data-stu-id="17357-140">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="17357-141">Když v některých případech může být obchodní pravidla, které potřebují k implementaci na této úrovni (například na základě aktuálně přihlášeného uživatele nebo roli, do které uživatel patří autorizační pravidla), jednoduše Ponecháme tyto metody jako-je.</span><span class="sxs-lookup"><span data-stu-id="17357-141">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="17357-142">Pro tyto metody pak BLL slouží pouze jako proxy server, pomocí kterého se přistupuje prezentační vrstvy podkladová data z Data Access Layer.</span><span class="sxs-lookup"><span data-stu-id="17357-142">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="17357-143">`AddProduct` a `UpdateProduct` metody jak využít jako parametry hodnoty pro různá pole produktu a přidání nového produktu nebo aktualizaci existující, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="17357-143">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="17357-144">Od řadu `Product` sloupce tabulky může přijmout `NULL` hodnoty (`CategoryID`, `SupplierID`, a `UnitPrice`, a další), ty vstupní parametry pro `AddProduct` a `UpdateProduct` které jsou namapovány na tyto sloupce použijte [typy s možnou hodnotou Null](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="17357-144">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="17357-145">Typy s možnou hodnotou Null jsou nové pro rozhraní .NET 2.0 a zadejte techniku, pro která udává, zda hodnota typ měli, místo toho se `null`.</span><span class="sxs-lookup"><span data-stu-id="17357-145">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `null`.</span></span> <span data-ttu-id="17357-146">V jazyce C# můžete příznak typ hodnoty jako typ s možnou hodnotou Null přidáním `?` po typ (například `int? x;`).</span><span class="sxs-lookup"><span data-stu-id="17357-146">In C# you can flag a value type as a nullable type by adding `?` after the type (like `int? x;`).</span></span> <span data-ttu-id="17357-147">Odkazovat [typy s možnou hodnotou Null](https://msdn.microsoft.com/library/1t3y8s4s.aspx) tématu [Průvodce programováním v C#](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) Další informace.</span><span class="sxs-lookup"><span data-stu-id="17357-147">Refer to the [Nullable Types](https://msdn.microsoft.com/library/1t3y8s4s.aspx) section in the [C# Programming Guide](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) for more information.</span></span>

<span data-ttu-id="17357-148">Všechny tři metody vrací logickou hodnotu udávající, zda byl řádek vložit, aktualizovat nebo odstranit, protože operaci nemusí mít za následek ovlivněných řádků.</span><span class="sxs-lookup"><span data-stu-id="17357-148">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="17357-149">Vývojář stránky volá-li například `DeleteProduct` předávání v `ProductID` pro neexistující produkt, `DELETE` prohlášení vydané do databáze bude mít žádný vliv a proto `DeleteProduct` metoda vrátí `false`.</span><span class="sxs-lookup"><span data-stu-id="17357-149">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `false`.</span></span>

<span data-ttu-id="17357-150">Všimněte si, že při přidání nového produktu nebo aktualizace stávající jsme trvat produktu nové nebo upravené hodnoty v polích jako seznam skalárních hodnot a přijetí `ProductsRow` instance.</span><span class="sxs-lookup"><span data-stu-id="17357-150">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="17357-151">Tento přístup je vybraná, protože `ProductsRow` třída odvozená z technologie ADO.NET `DataRow` třídy, která nemá výchozí konstruktor bez parametrů.</span><span class="sxs-lookup"><span data-stu-id="17357-151">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="17357-152">Chcete-li vytvořit nový `ProductsRow` instanci, musíte nejdřív vytvoříme `ProductsDataTable` instance a pak vyvolejte jeho `NewProductRow()` – metoda (který My v `AddProduct`).</span><span class="sxs-lookup"><span data-stu-id="17357-152">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="17357-153">Tohoto nedostatku rears jeho head, když jsme zapněte, pokud k vložení a aktualizace pomocí ObjectDataSource produkty.</span><span class="sxs-lookup"><span data-stu-id="17357-153">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="17357-154">Stručně řečeno ObjectDataSource se pokusí vytvořit instanci vstupní parametry.</span><span class="sxs-lookup"><span data-stu-id="17357-154">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="17357-155">Pokud metoda BLL očekává `ProductsRow` instanci, ObjectDataSource se pokusí vytvořit, ale nezdaří z důvodu nedostatku výchozí konstruktor bez parametrů.</span><span class="sxs-lookup"><span data-stu-id="17357-155">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="17357-156">Další informace o tento problém, naleznete v následujících dvou příspěvky ve fórech ASP.NET: [aktualizace ObjectDataSources s datovými sadami Strongly-Typed](https://forums.asp.net/1098630/ShowPost.aspx), a [problém s ObjectDataSource a datovou sadu Strongly-Typed](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="17357-156">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="17357-157">Dále v obou `AddProduct` a `UpdateProduct`, vytvoří kód `ProductsRow` instance a naplní s právě předané hodnoty.</span><span class="sxs-lookup"><span data-stu-id="17357-157">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="17357-158">Při přiřazování hodnot objektů DataColumns DataRow situace může nastat různé kontroly ověření na úrovni pole.</span><span class="sxs-lookup"><span data-stu-id="17357-158">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="17357-159">Proto uvedení předané hodnoty ručně zpět do DataRow pomáhá zajistit platnost dat, je předaná metodě BLL.</span><span class="sxs-lookup"><span data-stu-id="17357-159">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="17357-160">Bohužel silně typované třídy DataRow vygenerované Visual Studio nepoužívejte typy s možnou hodnotou Null.</span><span class="sxs-lookup"><span data-stu-id="17357-160">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="17357-161">Místo toho k označení, že by měla odpovídat konkrétní DataColumn v DataRow `NULL` databáze hodnotu musí používáme `SetColumnNameNull()` metoda.</span><span class="sxs-lookup"><span data-stu-id="17357-161">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="17357-162">V `UpdateProduct` nám nejdřív načíst v rámci produktu aktualizovat pomocí `GetProductByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="17357-162">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="17357-163">Když toto se může zdát jako nepotřebné cesty k databázi, bude prokázat smysl v budoucnu návodů, které prozkoumat optimistickou metodu souběžného tuto Navíc cestu.</span><span class="sxs-lookup"><span data-stu-id="17357-163">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="17357-164">Optimistickou metodu souběžného je technika zajistit, že dva uživatelé, kteří pracují současně na stejná data náhodnému přepsání své změny.</span><span class="sxs-lookup"><span data-stu-id="17357-164">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="17357-165">Metodou celý záznam také usnadňuje vytvoření metody aktualizace v BLL, který změnit, jenom podmnožinu sloupců DataRow.</span><span class="sxs-lookup"><span data-stu-id="17357-165">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="17357-166">Když jsme prozkoumat `SuppliersBLL` třída jsme tyto příklady najdete.</span><span class="sxs-lookup"><span data-stu-id="17357-166">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="17357-167">Nakonec, Všimněte si, že `ProductsBLL` třída má [DataObject atribut](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) na něho použít ( `[System.ComponentModel.DataObject]` syntaxe bezprostředně před Class – příkaz v horní části souboru) a metody mají [ Atributy DataObjectMethodAttribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="17357-167">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="17357-168">`DataObject` Atribut určí třída jako vhodný pro vytvoření vazby na objekt [ovládacího prvku ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), zatímco `DataObjectMethodAttribute` označuje cílem této metody.</span><span class="sxs-lookup"><span data-stu-id="17357-168">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="17357-169">Jak jsme budete vidět v budoucích kurzy, technologii ASP.NET 2.0 ObjectDataSource usnadňuje deklarativně přístup k datům z třídy.</span><span class="sxs-lookup"><span data-stu-id="17357-169">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="17357-170">Chcete-li filtrovat seznam možných třídy k vytvoření vazby ObjectDataSource průvodce, ve výchozím nastavení pouze tyto třídy, které jsou označeny jako `DataObjects` se zobrazují v rozevíracím seznamu v průvodci.</span><span class="sxs-lookup"><span data-stu-id="17357-170">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="17357-171">`ProductsBLL` Třída bude fungovat stejně dobře bez těchto atributů, ale jejich přidáním usnadňuje práci s v Průvodci ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="17357-171">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="17357-172">Přidávání dalších tříd</span><span class="sxs-lookup"><span data-stu-id="17357-172">Adding the Other Classes</span></span>

<span data-ttu-id="17357-173">Pomocí `ProductsBLL` třída dokončení, ještě musíme přidat třídy pro práci s kategorií, Dodavatelé a zaměstnanci.</span><span class="sxs-lookup"><span data-stu-id="17357-173">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="17357-174">Za chvíli vytvořit následující třídy a metody pomocí koncepty z výše uvedeném příkladu:</span><span class="sxs-lookup"><span data-stu-id="17357-174">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="17357-175">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="17357-175">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="17357-176">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="17357-176">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="17357-177">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="17357-177">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="17357-178">Jedna metoda vhodné poznamenat, je `SuppliersBLL` třídy `UpdateSupplierAddress` metoda.</span><span class="sxs-lookup"><span data-stu-id="17357-178">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="17357-179">Tato metoda poskytuje rozhraní pro aktualizaci jenom informace o adrese dodavatele.</span><span class="sxs-lookup"><span data-stu-id="17357-179">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="17357-180">Interně tato metoda čtení `SupplierDataRow` objekt pro zadaný `supplierID` (pomocí `GetSupplierBySupplierID`), nastaví její vlastnosti související s adres a pak zavolá do `SupplierDataTable`na `Update` metoda.</span><span class="sxs-lookup"><span data-stu-id="17357-180">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="17357-181">`UpdateSupplierAddress` Metoda následovně:</span><span class="sxs-lookup"><span data-stu-id="17357-181">The `UpdateSupplierAddress` method follows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample2.cs)]

<span data-ttu-id="17357-182">Naleznete v tomto článku stahování pro moje dokončení implementace třídy BLL.</span><span class="sxs-lookup"><span data-stu-id="17357-182">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="17357-183">Krok 2: Přístup prostřednictvím třídy BLL typové datové sady</span><span class="sxs-lookup"><span data-stu-id="17357-183">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="17357-184">Z prvního kurzu jsme viděli příklady pracovat přímo s datovou sadou zadali prostřednictvím kódu programu, ale s přidáním systému naše BLL třídy, prezentační vrstvou by měla fungovat proti BLL místo toho.</span><span class="sxs-lookup"><span data-stu-id="17357-184">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="17357-185">V `AllProducts.aspx` příklad z první kurz `ProductsTableAdapter` byl použit k vytvoření vazby seznam produktů GridView, jak je znázorněno v následujícím kódu:</span><span class="sxs-lookup"><span data-stu-id="17357-185">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample3.cs)]

<span data-ttu-id="17357-186">Pokud chcete používat nové BLL třídy, všechny které je potřeba změnit je jednoduše nahradit první řádek kódu `ProductsTableAdapter` objektu s `ProductBLL` objektu:</span><span class="sxs-lookup"><span data-stu-id="17357-186">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample4.cs)]

<span data-ttu-id="17357-187">Třídy BLL můžete přistupovat pomocí ObjectDataSource také deklarativně (jak je můžete typové datové sady).</span><span class="sxs-lookup"><span data-stu-id="17357-187">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="17357-188">Jsme budete mít hovoříte o ObjectDataSource podrobněji v následujících kurzech.</span><span class="sxs-lookup"><span data-stu-id="17357-188">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>


<span data-ttu-id="17357-189">[![Zobrazí se seznam produktů v GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="17357-189">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span></span>

<span data-ttu-id="17357-190">**Obrázek 3**: produkty v seznamu se zobrazí v GridView ([Kliknutím zobrazit obrázek v plné velikosti](creating-a-business-logic-layer-cs/_static/image5.png))</span><span class="sxs-lookup"><span data-stu-id="17357-190">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image5.png))</span></span>


## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="17357-191">Krok 3: Přidání ověření na úrovni pole do třídy DataRow</span><span class="sxs-lookup"><span data-stu-id="17357-191">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="17357-192">Ověření na úrovni pole jsou kontroly, které se vztahují na hodnoty vlastností objektů obchodní při vložení nebo aktualizaci.</span><span class="sxs-lookup"><span data-stu-id="17357-192">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="17357-193">Některá pravidla ověření na úrovni pole pro produkty patří:</span><span class="sxs-lookup"><span data-stu-id="17357-193">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="17357-194">`ProductName` Pole musí být 40 znaků nebo méně</span><span class="sxs-lookup"><span data-stu-id="17357-194">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="17357-195">`QuantityPerUnit` Pole musí být 20 znaků nebo méně</span><span class="sxs-lookup"><span data-stu-id="17357-195">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="17357-196">`ProductID`, `ProductName`, A `Discontinued` jsou povinná pole, ale všechny ostatní pole jsou volitelná</span><span class="sxs-lookup"><span data-stu-id="17357-196">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="17357-197">`UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, A `ReorderLevel` pole musí být větší než nebo rovna hodnotě nula.</span><span class="sxs-lookup"><span data-stu-id="17357-197">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="17357-198">Tato pravidla můžete a by měla být vyjádřena na úrovni databáze.</span><span class="sxs-lookup"><span data-stu-id="17357-198">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="17357-199">Limitu znak `ProductName` a `QuantityPerUnit` pole jsou zachyceny datové typy těchto sloupců `Products` tabulky (`nvarchar(40)` a `nvarchar(20)`, v uvedeném pořadí).</span><span class="sxs-lookup"><span data-stu-id="17357-199">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="17357-200">Zda jsou povinné a nepovinné pole jsou vyjádřeny ve sloupci tabulky databáze umožňuje `NULL` s.</span><span class="sxs-lookup"><span data-stu-id="17357-200">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="17357-201">Čtyři [omezení check](https://msdn.microsoft.com/library/ms188258.aspx) existují, ujistěte se, že pouze hodnoty větší než nebo rovna hodnotě nula provádět ji do `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, nebo `ReorderLevel` sloupce.</span><span class="sxs-lookup"><span data-stu-id="17357-201">Four [check constraints](https://msdn.microsoft.com/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="17357-202">Kromě vynucování tato pravidla na databázi by také měly být vynucovat na úrovni datové sady.</span><span class="sxs-lookup"><span data-stu-id="17357-202">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="17357-203">Ve skutečnosti se pro každý DataTable sadu objektů DataColumns zachytit již délka pole a zda je hodnota požadované nebo volitelné.</span><span class="sxs-lookup"><span data-stu-id="17357-203">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="17357-204">Pokud chcete zobrazit stávající ověření na úrovni pole automaticky poskytnuty, přejděte na návrháře DataSet, vyberte pole z jednoho z DataTables a potom přejděte do okna vlastností.</span><span class="sxs-lookup"><span data-stu-id="17357-204">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="17357-205">Jak ukazuje obrázek 4, `QuantityPerUnit` DataColumn v `ProductsDataTable` má maximální délku 20 znaků a povolit `NULL` hodnoty.</span><span class="sxs-lookup"><span data-stu-id="17357-205">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="17357-206">Pokud jsme pokus o nastavení `ProductsDataRow`na `QuantityPerUnit` vlastnost na hodnotu řetězce, který je delší než 20 znaků `ArgumentException` bude vyvolána.</span><span class="sxs-lookup"><span data-stu-id="17357-206">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>


<span data-ttu-id="17357-207">[![Sloupci DataColumn poskytuje základní ověření na úrovni pole](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="17357-207">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span></span>

<span data-ttu-id="17357-208">**Obrázek 4**: DataColumn poskytuje základní ověření na úrovni pole ([Kliknutím zobrazit obrázek v plné velikosti](creating-a-business-logic-layer-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="17357-208">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image8.png))</span></span>


<span data-ttu-id="17357-209">Bohužel jsme nelze zadat rozsah kontroly, jako `UnitPrice` hodnota musí být větší než nebo rovna hodnotě nula prostřednictvím okna Vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="17357-209">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="17357-210">Chcete-li provést tento typ ověření na úrovni pole, je potřeba vytvořit obslužnou rutinu události pro element DataTable na [columnchanging –](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) událostí.</span><span class="sxs-lookup"><span data-stu-id="17357-210">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="17357-211">Jak je uvedeno v [předchozí kurzu](creating-a-data-access-layer-cs.md), datové sady, DataTables a DataRow objekty vytvořené typové datové sady je možné rozšířit pomocí částečné třídy.</span><span class="sxs-lookup"><span data-stu-id="17357-211">As mentioned in the [preceding tutorial](creating-a-data-access-layer-cs.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="17357-212">Touto technikou, můžeme vytvořit `ColumnChanging` obslužné rutiny události pro `ProductsDataTable` třídy.</span><span class="sxs-lookup"><span data-stu-id="17357-212">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="17357-213">Začněte vytvořením třídy v `App_Code` složku s názvem `ProductsDataTable.ColumnChanging.cs`.</span><span class="sxs-lookup"><span data-stu-id="17357-213">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.cs`.</span></span>


<span data-ttu-id="17357-214">[![Přidejte novou třídu do složky App_Code](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="17357-214">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span></span>

<span data-ttu-id="17357-215">**Obrázek 5**: Přidání nové třídy do `App_Code` složky ([Kliknutím zobrazit obrázek v plné velikosti](creating-a-business-logic-layer-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="17357-215">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image11.png))</span></span>


<span data-ttu-id="17357-216">Dále vytvořte obslužnou rutinu události pro `ColumnChanging` událost, která zajistí, že `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, a `ReorderLevel` hodnoty ve sloupcích (není-li `NULL`) jsou větší než nebo rovna hodnotě nula.</span><span class="sxs-lookup"><span data-stu-id="17357-216">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="17357-217">Pokud tyto sloupce je mimo rozsah, throw `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="17357-217">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="17357-218">ProductsDataTable.ColumnChanging.cs</span><span class="sxs-lookup"><span data-stu-id="17357-218">ProductsDataTable.ColumnChanging.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample5.cs)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="17357-219">Krok 4: Vlastní obchodní pravidla přidávat do BLL třídy</span><span class="sxs-lookup"><span data-stu-id="17357-219">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="17357-220">Kromě ověření na úrovni pole můžou být vysoké úrovně vlastní obchodní pravidla, které se týkají různých entit nebo koncepty není vyjádřit kombinací na úrovni jeden sloupec, jako například:</span><span class="sxs-lookup"><span data-stu-id="17357-220">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="17357-221">Pokud už není podporovaný produktu, jeho `UnitPrice` nelze aktualizovat</span><span class="sxs-lookup"><span data-stu-id="17357-221">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="17357-222">Zaměstnance zemi, kde bydlíte musí být stejná jako jejich manager země, kde bydlíte</span><span class="sxs-lookup"><span data-stu-id="17357-222">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="17357-223">Produkt nelze zastaví, pokud se jedná pouze produktu, dodavatel</span><span class="sxs-lookup"><span data-stu-id="17357-223">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="17357-224">Třídy BLL by měl obsahovat kontroly k zajištění dodržování obchodních pravidel aplikace.</span><span class="sxs-lookup"><span data-stu-id="17357-224">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="17357-225">Tyto kontroly lze přidat přímo do metod, na které se vztahují.</span><span class="sxs-lookup"><span data-stu-id="17357-225">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="17357-226">Představte si, že naše obchodní pravidla určují, že produkt nelze označit – starší formáty Pokud byl produkt pouze od jiného dodavatele daného.</span><span class="sxs-lookup"><span data-stu-id="17357-226">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="17357-227">To znamená pokud produkt *X* byla pouze produktu jsme zakoupenému od dodavatele *Y*, jsme nelze označit *X* jako zastaví; Pokud však dodavatele *Y*nám součástí tři produkty, *A*, *B*, a *C*, jsme může označte všechny a všechny tyto jako zastaveny.</span><span class="sxs-lookup"><span data-stu-id="17357-227">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="17357-228">Vždy nejsou zarovnány liché obchodní pravidlo, ale obchodní pravidla a běžné smysl!</span><span class="sxs-lookup"><span data-stu-id="17357-228">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="17357-229">K vynucení toto obchodní pravidlo v `UpdateProducts` jsme by měl začínat kontrolou, pokud metoda `Discontinued` byla nastavena na `true` a pokud ano, by říkáme `GetProductsBySupplierID` k určení, kolik produkty jsme zakoupenému od dodavatele tohoto produktu.</span><span class="sxs-lookup"><span data-stu-id="17357-229">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `true` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="17357-230">Pokud jenom jeden produkt zakoupen z tohoto dodavatele, jsme throw `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="17357-230">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample6.cs)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="17357-231">Zpracování chyb při ověřování v prezentační vrstvě</span><span class="sxs-lookup"><span data-stu-id="17357-231">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="17357-232">Při volání BLL z prezentační vrstvou jsme rozhodnout, zda chcete pokus o zpracování všech výjimek, které může být vyvolána, nebo nechte je bublinový až ASP.NET (který vyvolá `HttpApplication`na `Error` událostí).</span><span class="sxs-lookup"><span data-stu-id="17357-232">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="17357-233">Ke zpracování výjimky při práci s BLL prostřednictvím kódu programu, můžeme použít [try... catch](https://msdn.microsoft.com/library/0yd65esw.aspx) bloku, jak ukazuje následující příklad:</span><span class="sxs-lookup"><span data-stu-id="17357-233">To handle an exception when working with the BLL programmatically, we can use a [try...catch](https://msdn.microsoft.com/library/0yd65esw.aspx) block, as the following example shows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample7.cs)]

<span data-ttu-id="17357-234">Ukážeme v budoucnosti kurzy, zpracování výjimek, které vyvolat z BLL při použití dat webové ovládacího prvku pro vkládání, aktualizaci, nebo odstranění dat mohou být ošetřeny přímo do obslužné rutiny události a nutnosti zabalení kód v `try...catch` bloky.</span><span class="sxs-lookup"><span data-stu-id="17357-234">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `try...catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="17357-235">Souhrn</span><span class="sxs-lookup"><span data-stu-id="17357-235">Summary</span></span>

<span data-ttu-id="17357-236">Dobře navrženou aplikace je vytvořený do různých vrstev, z nichž každý zapouzdří konkrétní roli.</span><span class="sxs-lookup"><span data-stu-id="17357-236">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="17357-237">Z prvního kurzu této série článku jsme vytvořili Data Access Layer pomocí typové datové sady; v tomto kurzu jsme vytvořili vrstvu obchodní logiky jako řadu třídy v naší aplikaci `App_Code` složky, která volají do našich DAL.</span><span class="sxs-lookup"><span data-stu-id="17357-237">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="17357-238">BLL implementuje úroveň pole a obchodní logiku pro naši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="17357-238">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="17357-239">Kromě vytvoření samostatné BLL, jako jsme to udělali v tomto kurzu je další možností rozšířit TableAdapters metody prostřednictvím částečné třídy.</span><span class="sxs-lookup"><span data-stu-id="17357-239">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="17357-240">Však touto technikou neumožňuje nám přepsat existující metody ani nemá ho oddělit naše DAL a naše BLL řádně přístupů, které jsme si prováděné v tomto článku.</span><span class="sxs-lookup"><span data-stu-id="17357-240">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="17357-241">DAL a BLL dokončení je připraven ke spuštění na našem prezentační vrstvy.</span><span class="sxs-lookup"><span data-stu-id="17357-241">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="17357-242">V [další kurz](master-pages-and-site-navigation-cs.md) jsme budete trvat stručný detour od data přístup témat a definovat konzistentní stránky rozložení pro používání v rámci kurzů k.</span><span class="sxs-lookup"><span data-stu-id="17357-242">In the [next tutorial](master-pages-and-site-navigation-cs.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="17357-243">Radostí programování!</span><span class="sxs-lookup"><span data-stu-id="17357-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="17357-244">O autorovi</span><span class="sxs-lookup"><span data-stu-id="17357-244">About the Author</span></span>

<span data-ttu-id="17357-245">[Scott Meisnerová](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor sedm ASP/ASP.NET knih a zakladatele z [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracuje s technologií Microsoft Web od 1998.</span><span class="sxs-lookup"><span data-stu-id="17357-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="17357-246">Scott funguje jako nezávislé poradce, trainer a zapisovače.</span><span class="sxs-lookup"><span data-stu-id="17357-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="17357-247">Jeho nejnovější seznam k [ *Edice nakladatelství Sams naučit sami technologii ASP.NET 2.0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="17357-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="17357-248">Dosažitelný v [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) nebo prostřednictvím svého blogu, který najdete na [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="17357-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="17357-249">Zvláštní poděkování</span><span class="sxs-lookup"><span data-stu-id="17357-249">Special Thanks To</span></span>

<span data-ttu-id="17357-250">Tento kurz řady byla zkontrolovány uživatelem mnoho užitečné kontrolorů.</span><span class="sxs-lookup"><span data-stu-id="17357-250">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="17357-251">Vést kontroloři v tomto kurzu bylo Liz Shulok, společnosti Dennis Patterson, Carlos Santos a Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="17357-251">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="17357-252">Kontrola Moje nadcházející články MSDN máte zájem?</span><span class="sxs-lookup"><span data-stu-id="17357-252">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="17357-253">Pokud ano, vyřaďte mi řádek v [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="17357-253">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="17357-254">[Předchozí](creating-a-data-access-layer-cs.md)
[další](master-pages-and-site-navigation-cs.md)</span><span class="sxs-lookup"><span data-stu-id="17357-254">[Previous](creating-a-data-access-layer-cs.md)
[Next](master-pages-and-site-navigation-cs.md)</span></span>
