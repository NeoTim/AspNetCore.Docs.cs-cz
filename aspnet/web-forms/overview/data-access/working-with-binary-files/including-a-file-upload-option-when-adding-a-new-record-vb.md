---
uid: web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-vb
title: "Včetně soubor nahrát možnost, při přidávání nového záznamu (VB) | Microsoft Docs"
author: rick-anderson
description: "Tento kurz ukazuje, jak vytvořit webové rozhraní, která umožňuje uživatelům zadejte textová data i nahrát binární soubory. Pro ilustraci t dostupné možnosti..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/27/2007
ms.topic: article
ms.assetid: 5776281d-4637-4d1e-a65b-2621d2cade44
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-vb
msc.type: authoredcontent
ms.openlocfilehash: eb462a0e8ce88037855ea12d00c1afc0419fa04e
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/24/2018
---
<a name="including-a-file-upload-option-when-adding-a-new-record-vb"></a><span data-ttu-id="64a25-104">Při přidávání nového záznamu (VB) včetně řešením nahrávání souborů</span><span class="sxs-lookup"><span data-stu-id="64a25-104">Including a File Upload Option When Adding a New Record (VB)</span></span>
====================
<span data-ttu-id="64a25-105">podle [Scott Meisnerová](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="64a25-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="64a25-106">[Stáhněte si ukázkovou aplikaci](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_VB.exe) nebo [stáhnout PDF](including-a-file-upload-option-when-adding-a-new-record-vb/_static/datatutorial56vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="64a25-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_VB.exe) or [Download PDF](including-a-file-upload-option-when-adding-a-new-record-vb/_static/datatutorial56vb1.pdf)</span></span>

> <span data-ttu-id="64a25-107">Tento kurz ukazuje, jak vytvořit webové rozhraní, která umožňuje uživatelům zadejte textová data i nahrát binární soubory.</span><span class="sxs-lookup"><span data-stu-id="64a25-107">This tutorial shows how to create a Web interface that allows the user to both enter text data and upload binary files.</span></span> <span data-ttu-id="64a25-108">Pro ilustraci možnosti k dispozici pro uložení binární data, jeden soubor se uloží v databázi při dalších je uložen v systému souborů.</span><span class="sxs-lookup"><span data-stu-id="64a25-108">To illustrate the options available to store binary data, one file will be saved in the database while the other is stored in the file system.</span></span>


## <a name="introduction"></a><span data-ttu-id="64a25-109">Úvod</span><span class="sxs-lookup"><span data-stu-id="64a25-109">Introduction</span></span>

<span data-ttu-id="64a25-110">V předchozích dvou kurzy jsme prozkoumali techniky pro ukládání binární data, která souvisí s aplikací s datovým modelem podívat, jak pomocí ovládacího prvku odesílání souborů při odpovědích odeslat soubory z klienta na webový server, a viděli, jak tato binární data k dispozici v datech W ovládací prvek EB.</span><span class="sxs-lookup"><span data-stu-id="64a25-110">In the previous two tutorials we explored techniques for storing binary data that is associated with the application s data model, looked at how to use the FileUpload control to send files from the client to the web server, and saw how to present this binary data in a data Web control.</span></span> <span data-ttu-id="64a25-111">Jsme jste ještě na postup přidružení odeslaná data datového modelu, ale v souvislosti se.</span><span class="sxs-lookup"><span data-stu-id="64a25-111">We ve yet to talk about how to associate uploaded data with the data model, though.</span></span>

<span data-ttu-id="64a25-112">V tomto kurzu vytvoříme na webové stránce Přidat novou kategorii.</span><span class="sxs-lookup"><span data-stu-id="64a25-112">In this tutorial we will create a web page to add a new category.</span></span> <span data-ttu-id="64a25-113">Kromě textová pole s názvem kategorie a popis bude nutné zahrnout dvou odesílání souborů při odpovědích ovládacích prvků pro nový obrázek kategorie s a jeden pro – příručka tuto stránku.</span><span class="sxs-lookup"><span data-stu-id="64a25-113">In addition to TextBoxes for the category s name and description, this page will need to include two FileUpload controls one for the new category s picture and one for the brochure.</span></span> <span data-ttu-id="64a25-114">Nahraný obrázek se uloží přímo v novém záznamu s `Picture` sloupce, zatímco – příručka se uloží do `~/Brochures` složku s cestou k souboru uložit v novém záznamu s `BrochurePath` sloupce.</span><span class="sxs-lookup"><span data-stu-id="64a25-114">The uploaded picture will be stored directly in the new record s `Picture` column, whereas the brochure will be saved to the `~/Brochures` folder with the path to the file saved in the new record s `BrochurePath` column.</span></span>

<span data-ttu-id="64a25-115">Před vytvořením této nové webové stránce, budeme potřebovat aktualizovat architekturu.</span><span class="sxs-lookup"><span data-stu-id="64a25-115">Before creating this new web page, we'll need to update the architecture.</span></span> <span data-ttu-id="64a25-116">`CategoriesTableAdapter` Nenačte s hlavním dotazu `Picture` sloupce.</span><span class="sxs-lookup"><span data-stu-id="64a25-116">The `CategoriesTableAdapter` s main query does not retrieve the `Picture` column.</span></span> <span data-ttu-id="64a25-117">V důsledku toho automaticky generovaný `Insert` metoda má vstupy pro jenom `CategoryName`, `Description`, a `BrochurePath` pole.</span><span class="sxs-lookup"><span data-stu-id="64a25-117">Consequently, the auto-generated `Insert` method only has inputs for the `CategoryName`, `Description`, and `BrochurePath` fields.</span></span> <span data-ttu-id="64a25-118">Proto je potřeba vytvořit další způsob v TableAdapter, který zobrazí výzvu pro všechny čtyři `Categories` pole.</span><span class="sxs-lookup"><span data-stu-id="64a25-118">Therefore, we need to create an additional method in the TableAdapter that prompts for all four `Categories` fields.</span></span> <span data-ttu-id="64a25-119">`CategoriesBLL` Třídy v vrstvu obchodní logiky bude taky potřeba aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="64a25-119">The `CategoriesBLL` class in the Business Logic Layer will also need to be updated.</span></span>

## <a name="step-1-adding-aninsertwithpicturemethod-to-thecategoriestableadapter"></a><span data-ttu-id="64a25-120">Krok 1: Přidání`InsertWithPicture`metodu`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="64a25-120">Step 1: Adding an`InsertWithPicture`Method to the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="64a25-121">Pokud jsme vytvořili `CategoriesTableAdapter` zpět v [vytváření Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) kurzu, jsme nakonfigurovali automaticky generovat `INSERT`, `UPDATE`, a `DELETE` příkazy založená na hlavní dotazu.</span><span class="sxs-lookup"><span data-stu-id="64a25-121">When we created the `CategoriesTableAdapter` back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, we configured it to automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the main query.</span></span> <span data-ttu-id="64a25-122">Kromě toho jsme pokyn TableAdapter využívat DB přímý přístup, který vytvoří metody `Insert`, `Update`, a `Delete`.</span><span class="sxs-lookup"><span data-stu-id="64a25-122">Moreover, we instructed the TableAdapter to employ the DB Direct approach, which created the methods `Insert`, `Update`, and `Delete`.</span></span> <span data-ttu-id="64a25-123">Tyto metody spouštění automaticky generovaný `INSERT`, `UPDATE`, a `DELETE` příkazy a v důsledku toho přijímat na základě sloupců vrácených dotazem hlavní vstupní parametry.</span><span class="sxs-lookup"><span data-stu-id="64a25-123">These methods execute the auto-generated `INSERT`, `UPDATE`, and `DELETE` statements and, consequently, accept input parameters based on the columns returned by the main query.</span></span> <span data-ttu-id="64a25-124">V [nahrávání souborů](uploading-files-vb.md) kurzu jsme rozšířen `CategoriesTableAdapter` s hlavní dotaz, který bude použit `BrochurePath` sloupce.</span><span class="sxs-lookup"><span data-stu-id="64a25-124">In the [Uploading Files](uploading-files-vb.md) tutorial we augmented the `CategoriesTableAdapter` s main query to use the `BrochurePath` column.</span></span>

<span data-ttu-id="64a25-125">Vzhledem k tomu, `CategoriesTableAdapter` s hlavní dotaz neodkazuje `Picture` sloupce, jsme můžete přidat nový záznam ani aktualizovat stávající záznam s hodnotou `Picture` sloupce.</span><span class="sxs-lookup"><span data-stu-id="64a25-125">Since the `CategoriesTableAdapter` s main query does not reference the `Picture` column, we can neither add a new record nor update an existing record with a value for the `Picture` column.</span></span> <span data-ttu-id="64a25-126">Aby bylo možné zachytit tyto informace, budeme buď vytvoření nové metody v TableAdapter, který se používá konkrétně k vložení záznamu s binární data nebo jsme, můžete upravit automaticky generovaný `INSERT` příkaz.</span><span class="sxs-lookup"><span data-stu-id="64a25-126">In order to capture this information, we can either create a new method in the TableAdapter that is used specifically to insert a record with binary data or we can customize the auto-generated `INSERT` statement.</span></span> <span data-ttu-id="64a25-127">Problém s přizpůsobení automaticky generovaného `INSERT` příkaz je, že jsme riskujete naše přizpůsobení přepsány průvodce.</span><span class="sxs-lookup"><span data-stu-id="64a25-127">The problem with customizing the auto-generated `INSERT` statement is that we risk having our customizations overwritten by the wizard.</span></span> <span data-ttu-id="64a25-128">Představte si například, že jsme přizpůsobit `INSERT` k začlenění použití `Picture` sloupce.</span><span class="sxs-lookup"><span data-stu-id="64a25-128">For example, imagine that we customized the `INSERT` statement to include use of the `Picture` column.</span></span> <span data-ttu-id="64a25-129">Tím by aktualizaci TableAdapter s `Insert` tak, aby zahrnoval další vstupní parametr pro binární data obrázek s kategorií s.</span><span class="sxs-lookup"><span data-stu-id="64a25-129">This would update the TableAdapter s `Insert` method to include an additional input parameter for the category s picture s binary data.</span></span> <span data-ttu-id="64a25-130">Metoda jsme poté lze vytvořit v vrstvu obchodní logiky a použít tuto metodu DAL volat tuto metodu BLL prostřednictvím prezentační vrstvy a všechno, co by nádherně fungovat.</span><span class="sxs-lookup"><span data-stu-id="64a25-130">We could then create a method in the Business Logic Layer to use this DAL method and invoke this BLL method through the Presentation Layer, and everything would work wonderfully.</span></span> <span data-ttu-id="64a25-131">To znamená až po příštím jsme nakonfigurovali TableAdapter pomocí Průvodce nastavením TableAdapter konfigurace.</span><span class="sxs-lookup"><span data-stu-id="64a25-131">That is, until the next time we configured the TableAdapter through the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="64a25-132">Dokončení průvodce, naše přizpůsobení `INSERT` příkaz budou přepsána, `Insert` metoda by obnovit jeho původní formuláře a kódu by nebude možné je kompilovat!</span><span class="sxs-lookup"><span data-stu-id="64a25-132">As soon as the wizard completed, our customizations to the `INSERT` statement would be overwritten, the `Insert` method would revert to its old form, and our code would no longer compile!</span></span>

> [!NOTE]
> <span data-ttu-id="64a25-133">Tento obtěžování hlukem je jiný problém, když pomocí uložené procedury místo ad-hoc příkazů SQL.</span><span class="sxs-lookup"><span data-stu-id="64a25-133">This annoyance is a non-issue when using stored procedures instead of ad-hoc SQL statements.</span></span> <span data-ttu-id="64a25-134">Budoucí kurzu bude prozkoumat pomocí uložené procedury místo příkazů SQL ad-hoc v datové vrstvě přístup.</span><span class="sxs-lookup"><span data-stu-id="64a25-134">A future tutorial will explore using stored procedures in lieu of ad-hoc SQL statements in the Data Access Layer.</span></span>


<span data-ttu-id="64a25-135">Aby se zabránilo této potenciální umožní místo vytvoření nové metody pro TableAdapter s bolestmi hlavy, nikoli přizpůsobení automaticky generovaného příkazy SQL.</span><span class="sxs-lookup"><span data-stu-id="64a25-135">To avoid this potential headache, rather than customizing the auto-generated SQL statements let s instead create a new method for the TableAdapter.</span></span> <span data-ttu-id="64a25-136">Tuto metodu s názvem `InsertWithPicture`, bude přijímat hodnoty `CategoryName`, `Description`, `BrochurePath`, a `Picture` sloupce a spusťte `INSERT` příkaz, který ukládá všechny čtyři hodnoty v novém záznamu.</span><span class="sxs-lookup"><span data-stu-id="64a25-136">This method, named `InsertWithPicture`, will accept values for the `CategoryName`, `Description`, `BrochurePath`, and `Picture` columns and execute an `INSERT` statement that stores all four values in a new record.</span></span>

<span data-ttu-id="64a25-137">Otevřete typové datové sady a z návrháře, klikněte pravým tlačítkem na `CategoriesTableAdapter` záhlaví s a v místní nabídce vyberte Přidat dotazu.</span><span class="sxs-lookup"><span data-stu-id="64a25-137">Open the Typed DataSet and, from the Designer, right-click on the `CategoriesTableAdapter` s header and choose Add Query from the context menu.</span></span> <span data-ttu-id="64a25-138">Spustí se Průvodce konfigurací dotazu TableAdapter, které začne tím, že požádá nám, jak by měla dotazu TableAdapter přistupovat k databázi.</span><span class="sxs-lookup"><span data-stu-id="64a25-138">This launches the TableAdapter Query Configuration Wizard, which begins by asking us how the TableAdapter query should access the database.</span></span> <span data-ttu-id="64a25-139">Zvolte příkazy SQL použít a klikněte na tlačítko Další.</span><span class="sxs-lookup"><span data-stu-id="64a25-139">Choose Use SQL statements and click Next.</span></span> <span data-ttu-id="64a25-140">Dalším krokem vyzve k zadání typu dotazu má být vygenerován.</span><span class="sxs-lookup"><span data-stu-id="64a25-140">The next step prompts for the type of query to be generated.</span></span> <span data-ttu-id="64a25-141">Od jsme re vytváření dotazu na přidejte nový záznam na `Categories` tabulky, vyberte vložení a klikněte na tlačítko Další.</span><span class="sxs-lookup"><span data-stu-id="64a25-141">Since we re creating a query to add a new record to the `Categories` table, choose INSERT and click Next.</span></span>


<span data-ttu-id="64a25-142">[![Možnost vložení](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="64a25-142">[![Select the INSERT Option](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.png)</span></span>

<span data-ttu-id="64a25-143">**Obrázek 1**: Vyberte možnost Vložit ([Kliknutím zobrazit obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="64a25-143">**Figure 1**: Select the INSERT Option ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.png))</span></span>


<span data-ttu-id="64a25-144">Teď je potřeba zadat `INSERT` příkaz jazyka SQL.</span><span class="sxs-lookup"><span data-stu-id="64a25-144">We now need to specify the `INSERT` SQL statement.</span></span> <span data-ttu-id="64a25-145">Průvodce automaticky navrhne `INSERT` příkaz odpovídající hlavní dotazu TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="64a25-145">The wizard automatically suggests an `INSERT` statement corresponding to the TableAdapter s main query.</span></span> <span data-ttu-id="64a25-146">V takovém případě ji s `INSERT` příkaz, který se vloží `CategoryName`, `Description`, a `BrochurePath` hodnoty.</span><span class="sxs-lookup"><span data-stu-id="64a25-146">In this case, it s an `INSERT` statement that inserts the `CategoryName`, `Description`, and `BrochurePath` values.</span></span> <span data-ttu-id="64a25-147">Aktualizovat příkaz tak, aby `Picture` sloupec se dodává spolu s `@Picture` parametr, například takto:</span><span class="sxs-lookup"><span data-stu-id="64a25-147">Update the statement so that the `Picture` column is included along with a `@Picture` parameter, like so:</span></span>


[!code-sql[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample1.sql)]

<span data-ttu-id="64a25-148">Poslední obrazovka průvodce požádá nám název nová metoda TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="64a25-148">The final screen of the wizard asks us to name the new TableAdapter method.</span></span> <span data-ttu-id="64a25-149">Zadejte `InsertWithPicture` a klikněte na tlačítko Dokončit.</span><span class="sxs-lookup"><span data-stu-id="64a25-149">Enter `InsertWithPicture` and click Finish.</span></span>


<span data-ttu-id="64a25-150">[![Název nové InsertWithPicture TableAdapter – metoda](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="64a25-150">[![Name the New TableAdapter Method InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.png)</span></span>

<span data-ttu-id="64a25-151">**Obrázek 2**: název nová metoda TableAdapter `InsertWithPicture` ([Kliknutím zobrazit obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="64a25-151">**Figure 2**: Name the New TableAdapter Method `InsertWithPicture` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.png))</span></span>


## <a name="step-2-updating-the-business-logic-layer"></a><span data-ttu-id="64a25-152">Krok 2: Aktualizace vrstvu obchodní logiky</span><span class="sxs-lookup"><span data-stu-id="64a25-152">Step 2: Updating the Business Logic Layer</span></span>

<span data-ttu-id="64a25-153">Vzhledem k tomu, že by měl prezentační vrstvy pouze rozhraní s vrstvu obchodní logiky než obcházení ho přejít přímo na Data Access Layer, potřebujeme vytvořit BLL metoda, která volá metodu DAL jsme právě vytvořili (`InsertWithPicture`).</span><span class="sxs-lookup"><span data-stu-id="64a25-153">Since the Presentation Layer should only interface with the Business Logic Layer rather than bypassing it to go directly to the Data Access Layer, we need to create a BLL method that invokes the DAL method we just created (`InsertWithPicture`).</span></span> <span data-ttu-id="64a25-154">V tomto kurzu Vytvoření metody v `CategoriesBLL` třídu s názvem `InsertWithPicture` , přijímá jako vstupní tři `String` s a `Byte` pole.</span><span class="sxs-lookup"><span data-stu-id="64a25-154">For this tutorial, create a method in the `CategoriesBLL` class named `InsertWithPicture` that accepts as input three `String` s and a `Byte` array.</span></span> <span data-ttu-id="64a25-155">`String` Jsou vstupní parametry pro název kategorie s, popis a cesta k souboru – příručka při `Byte` pole je pro binární obsah kategorie s obrázku.</span><span class="sxs-lookup"><span data-stu-id="64a25-155">The `String` input parameters are for the category s name, description, and brochure file path, while the `Byte` array is for the binary contents of the category s picture.</span></span> <span data-ttu-id="64a25-156">Jak ukazuje následující kód, tato metoda BLL vyvolá metodu odpovídající DAL:</span><span class="sxs-lookup"><span data-stu-id="64a25-156">As the following code shows, this BLL method invokes the corresponding DAL method:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample2.vb)]

> [!NOTE]
> <span data-ttu-id="64a25-157">Ujistěte se, že před přidáním uložení typové datové sady `InsertWithPicture` metodu BLL.</span><span class="sxs-lookup"><span data-stu-id="64a25-157">Make sure that you have saved the Typed DataSet before adding the `InsertWithPicture` method to the BLL.</span></span> <span data-ttu-id="64a25-158">Vzhledem k tomu, `CategoriesTableAdapter` kód třídy není automaticky generovaný na základě datové sady zadali tento t nejprve uložení změn do typové datové sady `Adapter` vlastnost won t vědět o `InsertWithPicture` metoda.</span><span class="sxs-lookup"><span data-stu-id="64a25-158">Since the `CategoriesTableAdapter` class code is auto-generated based on the Typed DataSet, if you don t first save your changes to the Typed DataSet the `Adapter` property won t know about the `InsertWithPicture` method.</span></span>


## <a name="step-3-listing-the-existing-categories-and-their-binary-data"></a><span data-ttu-id="64a25-159">Krok 3: Výpis existující kategorie a jejich binární Data</span><span class="sxs-lookup"><span data-stu-id="64a25-159">Step 3: Listing the Existing Categories and their Binary Data</span></span>

<span data-ttu-id="64a25-160">V tomto kurzu vytvoříme stránky, který umožňuje koncový uživatel přidat novou kategorii k systému, poskytuje obrázek a – příručka pro novou kategorii.</span><span class="sxs-lookup"><span data-stu-id="64a25-160">In this tutorial we will create a page that allows an end user to add a new category to the system, providing a picture and brochure for the new category.</span></span> <span data-ttu-id="64a25-161">V [předchozí kurzu](displaying-binary-data-in-the-data-web-controls-vb.md) jsme použili GridView s TemplateField a ImageField zobrazíte každý název kategorie s odkaz ke stažení jeho – příručka, popis a obrázek.</span><span class="sxs-lookup"><span data-stu-id="64a25-161">In the [preceding tutorial](displaying-binary-data-in-the-data-web-controls-vb.md) we used a GridView with a TemplateField and ImageField to display each category s name, description, picture, and a link to download its brochure.</span></span> <span data-ttu-id="64a25-162">Umožní s replikovat této funkce v tomto kurzu Vytvoření stránky, která uvádí všechny existující kategorie i umožňuje vytvořit nové.</span><span class="sxs-lookup"><span data-stu-id="64a25-162">Let s replicate that functionality for this tutorial, creating a page that both lists all existing categories and allows for new ones to be created.</span></span>

<span data-ttu-id="64a25-163">Začněte otevřením `DisplayOrDownload.aspx` stránku z `BinaryData` složky.</span><span class="sxs-lookup"><span data-stu-id="64a25-163">Start by opening the `DisplayOrDownload.aspx` page from the `BinaryData` folder.</span></span> <span data-ttu-id="64a25-164">Přejděte do zobrazení zdroje a zkopírujte GridView a ObjectDataSource s deklarativní syntaxi, vložením v rámci `<asp:Content>` element v `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="64a25-164">Go to the Source view and copy the GridView and ObjectDataSource s declarative syntax, pasting it within the `<asp:Content>` element in `UploadInDetailsView.aspx`.</span></span> <span data-ttu-id="64a25-165">Navíc tento t nezapomněli zkopírujte přes `GenerateBrochureLink` metoda z kódu třídu `DisplayOrDownload.aspx` k `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="64a25-165">Also, don t forget to copy over the `GenerateBrochureLink` method from the code-behind class of `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx`.</span></span>


<span data-ttu-id="64a25-166">[![Zkopírujte a vložte deklarativní syntaxe z DisplayOrDownload.aspx UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="64a25-166">[![Copy and Paste the Declarative Syntax from DisplayOrDownload.aspx to UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.png)</span></span>

<span data-ttu-id="64a25-167">**Obrázek 3**: Zkopírujte a vložte deklarativní syntaxi z `DisplayOrDownload.aspx` k `UploadInDetailsView.aspx` ([Kliknutím zobrazit obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="64a25-167">**Figure 3**: Copy and Paste the Declarative Syntax from `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.png))</span></span>


<span data-ttu-id="64a25-168">Po zkopírování deklarativní syntaxi a `GenerateBrochureLink` metodu přes `UploadInDetailsView.aspx` si prohlédněte stránku prostřednictvím prohlížeče a ujistěte se, že všechno, co jste zkopírovali přes správně.</span><span class="sxs-lookup"><span data-stu-id="64a25-168">After copying the declarative syntax and `GenerateBrochureLink` method over to the `UploadInDetailsView.aspx` page, view the page through a browser to ensure that everything was copied over correctly.</span></span> <span data-ttu-id="64a25-169">Měli byste vidět GridView výpis osm kategorie, která obsahuje odkaz ke stažení – příručka, jakož i na obrázku kategorie s.</span><span class="sxs-lookup"><span data-stu-id="64a25-169">You should see a GridView listing the eight categories that includes a link to download the brochure as well as the category s picture.</span></span>


<span data-ttu-id="64a25-170">[![Teď byste měli vidět každou kategorii společně s jeho binární Data](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="64a25-170">[![You Should Now See Each Category Along with Its Binary Data](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.png)</span></span>

<span data-ttu-id="64a25-171">**Obrázek 4**: můžete by měl nyní najdete v části každou kategorii společně s její binární Data ([Kliknutím zobrazit obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="64a25-171">**Figure 4**: You Should Now See Each Category Along with Its Binary Data ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.png))</span></span>


## <a name="step-4-configuring-thecategoriesdatasourceto-support-inserting"></a><span data-ttu-id="64a25-172">Krok 4: Konfigurace`CategoriesDataSource`pro podporu vkládání</span><span class="sxs-lookup"><span data-stu-id="64a25-172">Step 4: Configuring the`CategoriesDataSource`to Support Inserting</span></span>

<span data-ttu-id="64a25-173">`CategoriesDataSource` ObjectDataSource používané `Categories` GridView aktuálně neposkytuje možnost vložit data.</span><span class="sxs-lookup"><span data-stu-id="64a25-173">The `CategoriesDataSource` ObjectDataSource used by the `Categories` GridView currently does not provide the ability to insert data.</span></span> <span data-ttu-id="64a25-174">Kvůli podpoře vkládání prostřednictvím tohoto ovládacího prvku zdroje dat, je potřeba mapovat jeho `Insert` metoda na metodu v jeho základní objekt `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="64a25-174">In order to support inserting through this data source control, we need to map its `Insert` method to a method in its underlying object, `CategoriesBLL`.</span></span> <span data-ttu-id="64a25-175">Konkrétně jsme ji chcete mapovat k `CategoriesBLL` metoda jsme přidali zpět v kroku 2 `InsertWithPicture`.</span><span class="sxs-lookup"><span data-stu-id="64a25-175">In particular, we want to map it to the `CategoriesBLL` method we added back in Step 2, `InsertWithPicture`.</span></span>

<span data-ttu-id="64a25-176">Spusťte kliknutím na odkaz Konfigurace zdroje dat z ObjectDataSource s inteligentním.</span><span class="sxs-lookup"><span data-stu-id="64a25-176">Start by clicking the Configure Data Source link from the ObjectDataSource s smart tag.</span></span> <span data-ttu-id="64a25-177">Na první obrazovce se zobrazí objekt zdroje dat je nakonfigurováno pro práci s `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="64a25-177">The first screen shows the object the data source is configured to work with, `CategoriesBLL`.</span></span> <span data-ttu-id="64a25-178">Nechte toto nastavení jako-je a klikněte na tlačítko Další zálohy na obrazovku definovat metody Data.</span><span class="sxs-lookup"><span data-stu-id="64a25-178">Leave this setting as-is and click Next to advance to the Define Data Methods screen.</span></span> <span data-ttu-id="64a25-179">Přesunout na kartu vložení a vyberte `InsertWithPicture` z rozevíracího seznamu.</span><span class="sxs-lookup"><span data-stu-id="64a25-179">Move to the INSERT tab and pick the `InsertWithPicture` method from the drop-down list.</span></span> <span data-ttu-id="64a25-180">Kliknutím na tlačítko Dokončit ukončete průvodce.</span><span class="sxs-lookup"><span data-stu-id="64a25-180">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="64a25-181">[![Konfigurace ObjectDataSource lze pomocí této metody InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="64a25-181">[![Configure the ObjectDataSource to use the InsertWithPicture Method](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.png)</span></span>

<span data-ttu-id="64a25-182">**Obrázek 5**: Konfigurace ObjectDataSource používat `InsertWithPicture` – metoda ([Kliknutím zobrazit obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="64a25-182">**Figure 5**: Configure the ObjectDataSource to use the `InsertWithPicture` Method ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.png))</span></span>


> [!NOTE]
> <span data-ttu-id="64a25-183">Po dokončení průvodce, Visual Studio požádat, pokud chcete aktualizovat pole a klíče, který se znova vygeneruje data webové ovládací prvky pole.</span><span class="sxs-lookup"><span data-stu-id="64a25-183">Upon completing the wizard, Visual Studio may ask if you want to Refresh Fields and Keys, which will regenerate the data Web controls fields.</span></span> <span data-ttu-id="64a25-184">Ne, vybrat, protože kliknutím na tlačítko Ano, přepíše se tam pole vlastního nastavení provedené.</span><span class="sxs-lookup"><span data-stu-id="64a25-184">Choose No, because choosing Yes will overwrite any field customizations you may have made.</span></span>


<span data-ttu-id="64a25-185">Po dokončení průvodce, ObjectDataSource nyní zahrnují hodnotu pro jeho `InsertMethod` vlastnost a také `InsertParameters` pro sloupce čtyři kategorie, jako následující kód ukazuje:</span><span class="sxs-lookup"><span data-stu-id="64a25-185">After completing the wizard, the ObjectDataSource will now include a value for its `InsertMethod` property as well as `InsertParameters` for the four category columns, as the following declarative markup illustrates:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample3.aspx)]

## <a name="step-5-creating-the-inserting-interface"></a><span data-ttu-id="64a25-186">Krok 5: Vytvoření rozhraní vložení</span><span class="sxs-lookup"><span data-stu-id="64a25-186">Step 5: Creating the Inserting Interface</span></span>

<span data-ttu-id="64a25-187">Jako první součástí [přehled o vložení, aktualizace a odstranění dat](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), ovládacím prvku DetailsView poskytuje integrované vkládání rozhraní, které můžete použít při práci s ovládací prvek zdroje dat, která podporuje vkládání.</span><span class="sxs-lookup"><span data-stu-id="64a25-187">As first covered in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), the DetailsView control provides a built-in inserting interface that can be utilized when working with a data source control that supports inserting.</span></span> <span data-ttu-id="64a25-188">Umožní s přidání ovládacího prvku DetailsView na této stránce nahoře GridView, která bude trvale vykreslit jeho vkládání rozhraní umožňuje uživatelům rychle přidáte novou kategorii.</span><span class="sxs-lookup"><span data-stu-id="64a25-188">Let s add a DetailsView control to this page above the GridView that will permanently render its inserting interface, allowing a user to quickly add a new category.</span></span> <span data-ttu-id="64a25-189">Při přidávání novou kategorii v ovládacím prvku DetailsView, bude rutina GridView pod ním automaticky aktualizovat a zobrazit novou kategorii.</span><span class="sxs-lookup"><span data-stu-id="64a25-189">Upon adding a new category in the DetailsView, the GridView beneath it will automatically refresh and display the new category.</span></span>

<span data-ttu-id="64a25-190">Spuštění přetažením DetailsView z panelu nástrojů na návrháře výše GridView, nastavení jeho `ID` vlastnost `NewCategory` a vymazání `Height` a `Width` hodnot vlastností.</span><span class="sxs-lookup"><span data-stu-id="64a25-190">Start by dragging a DetailsView from the Toolbox onto the Designer above the GridView, setting its `ID` property to `NewCategory` and clearing out the `Height` and `Width` property values.</span></span> <span data-ttu-id="64a25-191">Z inteligentních značek DetailsView s navázat jej na existující `CategoriesDataSource` a pak zaškrtněte políčko Povolit vložení.</span><span class="sxs-lookup"><span data-stu-id="64a25-191">From the DetailsView s smart tag, bind it to the existing `CategoriesDataSource` and then check the Enable Inserting checkbox.</span></span>


<span data-ttu-id="64a25-192">[![Vytvořit vazbu CategoriesDataSource DetailsView a Povolit vložení](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="64a25-192">[![Bind the DetailsView to the CategoriesDataSource and Enable Inserting](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.png)</span></span>

<span data-ttu-id="64a25-193">**Obrázek 6**: DetailsView k vytvoření vazby `CategoriesDataSource` a Povolit vložení ([Kliknutím zobrazit obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="64a25-193">**Figure 6**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image12.png))</span></span>


<span data-ttu-id="64a25-194">Chcete-li trvale vykreslení DetailsView v jeho vkládání rozhraní, nastavte jeho `DefaultMode` vlastnost `Insert`.</span><span class="sxs-lookup"><span data-stu-id="64a25-194">To permanently render the DetailsView in its inserting interface, set its `DefaultMode` property to `Insert`.</span></span>

<span data-ttu-id="64a25-195">Všimněte si, že DetailsView má pět BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, a `BrochurePath` i když `CategoryID` BoundField není v rozhraní vkládání vykreslit, protože jeho `InsertVisible` je nastavena na `False`.</span><span class="sxs-lookup"><span data-stu-id="64a25-195">Note that the DetailsView has five BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` although the `CategoryID` BoundField is not rendered in the inserting interface because its `InsertVisible` property is set to `False`.</span></span> <span data-ttu-id="64a25-196">Tyto BoundFields existuje, protože jsou sloupce vrácený `GetCategories()` metoda, která je ObjectDataSource vyvolá načíst data.</span><span class="sxs-lookup"><span data-stu-id="64a25-196">These BoundFields exists because they are the columns returned by the `GetCategories()` method, which is what the ObjectDataSource invokes to retrieve its data.</span></span> <span data-ttu-id="64a25-197">Pro vkládání, ale nemůžeme nejsou zobrazeny t chcete, aby mohl uživatel, zadejte hodnotu pro `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="64a25-197">For inserting, however, we don t want to let the user specify a value for `NumberOfProducts`.</span></span> <span data-ttu-id="64a25-198">Kromě toho je potřeba povolit, aby nahrát obrázku pro nové kategorie a také nahrát PDF pro – příručka.</span><span class="sxs-lookup"><span data-stu-id="64a25-198">Moreover, we need to allow them to upload a picture for the new category as well as upload a PDF for the brochure.</span></span>

<span data-ttu-id="64a25-199">Odeberte `NumberOfProducts` BoundField DetailsView úplně a pak aktualizujte `HeaderText` vlastnosti `CategoryName` a `BrochurePath` BoundFields do kategorií a – příručka, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="64a25-199">Remove the `NumberOfProducts` BoundField from the DetailsView altogether and then update the `HeaderText` properties of the `CategoryName` and `BrochurePath` BoundFields to Category and Brochure, respectively.</span></span> <span data-ttu-id="64a25-200">V dalším kroku převést `BrochurePath` BoundField do TemplateField a přidat nové TemplateField pro obrázek, poskytnete tento nový TemplateField `HeaderText` hodnotu obrázku.</span><span class="sxs-lookup"><span data-stu-id="64a25-200">Next, convert the `BrochurePath` BoundField into a TemplateField and add a new TemplateField for the picture, giving this new TemplateField a `HeaderText` value of Picture.</span></span> <span data-ttu-id="64a25-201">Přesunout `Picture` TemplateField, aby byla mezi `BrochurePath` TemplateField a CommandField.</span><span class="sxs-lookup"><span data-stu-id="64a25-201">Move the `Picture` TemplateField so that it is between the `BrochurePath` TemplateField and CommandField.</span></span>


![Vytvořit vazbu CategoriesDataSource DetailsView a Povolit vložení](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.gif)

<span data-ttu-id="64a25-203">**Obrázek 7**: DetailsView k vytvoření vazby `CategoriesDataSource` a Povolit vložení</span><span class="sxs-lookup"><span data-stu-id="64a25-203">**Figure 7**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting</span></span>


<span data-ttu-id="64a25-204">Pokud jste převedli `BrochurePath` BoundField do TemplateField prostřednictvím dialogové okno Upravit pole TemplateField zahrnuje `ItemTemplate`, `EditItemTemplate`, a `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="64a25-204">If you converted the `BrochurePath` BoundField into a TemplateField through the Edit Fields dialog box, the TemplateField includes an `ItemTemplate`, `EditItemTemplate`, and `InsertItemTemplate`.</span></span> <span data-ttu-id="64a25-205">Pouze `InsertItemTemplate` je potřeba, ale, takže můžete bez obav odstranit dvě šablony.</span><span class="sxs-lookup"><span data-stu-id="64a25-205">Only the `InsertItemTemplate` is needed, however, so feel free to remove the other two templates.</span></span> <span data-ttu-id="64a25-206">V tomto okamžiku deklarativní syntaxi DetailsView s by měl vypadat asi takto:</span><span class="sxs-lookup"><span data-stu-id="64a25-206">At this point your DetailsView s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample4.aspx)]

## <a name="adding-fileupload-controls-for-the-brochure-and-picture-fields"></a><span data-ttu-id="64a25-207">Přidání ovládacích prvků odesílání souborů při odpovědích – příručka a pole obrázků</span><span class="sxs-lookup"><span data-stu-id="64a25-207">Adding FileUpload Controls for the Brochure and Picture Fields</span></span>

<span data-ttu-id="64a25-208">V současné době `BrochurePath` TemplateField s `InsertItemTemplate` obsahuje textové pole, když `Picture` TemplateField neobsahuje žádné šablony.</span><span class="sxs-lookup"><span data-stu-id="64a25-208">Presently, the `BrochurePath` TemplateField s `InsertItemTemplate` contains a TextBox, while the `Picture` TemplateField does not contain any templates.</span></span> <span data-ttu-id="64a25-209">Je potřeba aktualizovat tyto dvě s TemplateField `InsertItemTemplate` s k využití řízení odesílání souborů při odpovědích.</span><span class="sxs-lookup"><span data-stu-id="64a25-209">We need to update these two TemplateField s `InsertItemTemplate` s to use FileUpload controls.</span></span>

<span data-ttu-id="64a25-210">Ze s DetailsView inteligentní značky, zvolte možnost Upravit šablony a potom vyberte `BrochurePath` TemplateField s `InsertItemTemplate` z rozevíracího seznamu.</span><span class="sxs-lookup"><span data-stu-id="64a25-210">From the DetailsView s smart tag, choose the Edit Templates option and then select the `BrochurePath` TemplateField s `InsertItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="64a25-211">Odeberte textového pole a poté přetáhněte ovládací prvek odesílání souborů při odpovědích z panelu nástrojů do šablony.</span><span class="sxs-lookup"><span data-stu-id="64a25-211">Remove the TextBox and then drag a FileUpload control from the Toolbox into the template.</span></span> <span data-ttu-id="64a25-212">Nastavení ovládacího prvku odesílání souborů při odpovědích s `ID` k `BrochureUpload`.</span><span class="sxs-lookup"><span data-stu-id="64a25-212">Set the FileUpload control s `ID` to `BrochureUpload`.</span></span> <span data-ttu-id="64a25-213">Podobně, přidání ovládacího prvku odesílání souborů při odpovědích `Picture` TemplateField s `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="64a25-213">Similarly, add a FileUpload control to the `Picture` TemplateField s `InsertItemTemplate`.</span></span> <span data-ttu-id="64a25-214">Nastavit tento ovládací prvek odesílání souborů při odpovědích s `ID` k `PictureUpload`.</span><span class="sxs-lookup"><span data-stu-id="64a25-214">Set this FileUpload control s `ID` to `PictureUpload`.</span></span>


<span data-ttu-id="64a25-215">[![Přidání ovládacího prvku odesílání souborů při odpovědích na InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="64a25-215">[![Add a FileUpload Control to the InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image13.png)</span></span>

<span data-ttu-id="64a25-216">**Obrázek 8**: Přidání ovládacího prvku odesílání souborů při odpovědích `InsertItemTemplate` ([Kliknutím zobrazit obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="64a25-216">**Figure 8**: Add a FileUpload Control to the `InsertItemTemplate` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image14.png))</span></span>


<span data-ttu-id="64a25-217">Po provedení těchto dodatky, bude mít dva TemplateField s deklarativní syntaxi:</span><span class="sxs-lookup"><span data-stu-id="64a25-217">After making these additions, the two TemplateField s declarative syntax will be:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample5.aspx)]

<span data-ttu-id="64a25-218">Pokud uživatel přidá novou kategorii, chceme zajistěte, aby – příručka a obrázek o správný typ souboru.</span><span class="sxs-lookup"><span data-stu-id="64a25-218">When a user adds a new category, we want to ensure that the brochure and picture are of the correct file type.</span></span> <span data-ttu-id="64a25-219">Pro – příručka musí uživatel zadat PDF.</span><span class="sxs-lookup"><span data-stu-id="64a25-219">For the brochure, the user must supply a PDF.</span></span> <span data-ttu-id="64a25-220">Na obrázku, je nutné uživatelům nahrát soubor obrázku, ale provést povolujeme *žádné* bitové kopie souboru nebo jenom soubory obrázků určitého typu, například GIF nebo formátu JPG využívá?</span><span class="sxs-lookup"><span data-stu-id="64a25-220">For the picture, we need the user to upload an image file, but do we allow *any* image file or only image files of a particular type, such as GIFs or JPGs?</span></span> <span data-ttu-id="64a25-221">Aby bylo možné různých typech souborů, d musíme rozšířit `Categories` schéma tak, aby zahrnovaly sloupec, který zachycuje typ souboru, aby tento typ může odeslat klientovi prostřednictvím `Response.ContentType` v `DisplayCategoryPicture.aspx`.</span><span class="sxs-lookup"><span data-stu-id="64a25-221">In order to allow for different file types, we d need to extend the `Categories` schema to include a column that captures the file type so that this type can be sent to the client through `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="64a25-222">Vzhledem k tomu, že jsme nejsou zobrazeny t mít tento sloupce, je doporučeno omezit uživatele, kteří pouze poskytovat typu souboru konkrétní image.</span><span class="sxs-lookup"><span data-stu-id="64a25-222">Since we don t have such a column, it would be prudent to restrict users to only providing a specific image file type.</span></span> <span data-ttu-id="64a25-223">`Categories` Existujících bitových kopií tabulky s rastrové obrázky, ale formátu JPG využívá jsou vhodnější formát souboru pro obrázky obsluhovat prostřednictvím webu.</span><span class="sxs-lookup"><span data-stu-id="64a25-223">The `Categories` table s existing images are bitmaps, but JPGs are a more appropriate file format for images served over the web.</span></span>

<span data-ttu-id="64a25-224">Pokud uživatel odešle typ nesprávný soubor, je potřeba zrušit úlohy insert a zobrazí zprávu s upozorněním, problém.</span><span class="sxs-lookup"><span data-stu-id="64a25-224">If a user uploads an incorrect file type, we need to cancel the insert and display a message indicating the problem.</span></span> <span data-ttu-id="64a25-225">Přidání ovládacího prvku popisek webové pod DetailsView.</span><span class="sxs-lookup"><span data-stu-id="64a25-225">Add a Label Web control beneath the DetailsView.</span></span> <span data-ttu-id="64a25-226">Nastavit jeho `ID` vlastnost `UploadWarning`, zrušte na jeho `Text` vlastnost, nastavte `CssClass` vlastnost na upozornění a `Visible` a `EnableViewState` vlastnosti, které chcete `False`.</span><span class="sxs-lookup"><span data-stu-id="64a25-226">Set its `ID` property to `UploadWarning`, clear out its `Text` property, set the `CssClass` property to Warning, and the `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="64a25-227">`Warning` Třída CSS, která je definována v `Styles.css` a vykreslí text ve velkých, red, kurzívou, tučné písmo.</span><span class="sxs-lookup"><span data-stu-id="64a25-227">The `Warning` CSS class is defined in `Styles.css` and renders the text in a large, red, italicized, bold font.</span></span>

> [!NOTE]
> <span data-ttu-id="64a25-228">V ideálním případě `CategoryName` a `Description` BoundFields bude převedena na TemplateFields a jejich vložení rozhraní přizpůsobit.</span><span class="sxs-lookup"><span data-stu-id="64a25-228">Ideally, the `CategoryName` and `Description` BoundFields would be converted to TemplateFields and their inserting interfaces customized.</span></span> <span data-ttu-id="64a25-229">`Description` Vkládání rozhraní, například by pravděpodobně být vhodnější prostřednictvím textové pole víceřádkový.</span><span class="sxs-lookup"><span data-stu-id="64a25-229">The `Description` inserting interface, for example, would likely be better suited through a multi-line textbox.</span></span> <span data-ttu-id="64a25-230">A protože `CategoryName` sloupec nepřijímá `NULL` hodnoty, RequiredFieldValidator musí být přidaní do zkontrolujte uživatele poskytuje hodnotu pro název nové kategorie s.</span><span class="sxs-lookup"><span data-stu-id="64a25-230">And since the `CategoryName` column does not accept `NULL` values, a RequiredFieldValidator should be added to ensure the user provides a value for the new category s name.</span></span> <span data-ttu-id="64a25-231">Tyto kroky jsou ponechána jako cvičení čtečky.</span><span class="sxs-lookup"><span data-stu-id="64a25-231">These steps are left as an exercise to the reader.</span></span> <span data-ttu-id="64a25-232">Odkazovat zpět [přizpůsobení rozhraní pro úpravu dat](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) pro hlubší pohled na rozhraní pro úpravu dat rozšířit.</span><span class="sxs-lookup"><span data-stu-id="64a25-232">Refer back to [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) for an in-depth look at augmenting the data modification interfaces.</span></span>


## <a name="step-6-saving-the-uploaded-brochure-to-the-web-server-s-file-system"></a><span data-ttu-id="64a25-233">Krok 6: Ukládání nahrané – příručka k systému souborů webového serveru s</span><span class="sxs-lookup"><span data-stu-id="64a25-233">Step 6: Saving the Uploaded Brochure to the Web Server s File System</span></span>

<span data-ttu-id="64a25-234">Když uživatel zadá hodnoty pro novou kategorii a kliknutím na tlačítko Vložit, proběhne zpětné volání a kterou se vkládání pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="64a25-234">When the user enters the values for a new category and clicks the Insert button, a postback occurs and the inserting workflow unfolds.</span></span> <span data-ttu-id="64a25-235">První, DetailsView s [ `ItemInserting` událostí](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) aktivuje.</span><span class="sxs-lookup"><span data-stu-id="64a25-235">First, the DetailsView s [`ItemInserting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) fires.</span></span> <span data-ttu-id="64a25-236">Další, ObjectDataSource s `Insert()` metoda je volána, výsledkem nový záznam, který se přidává do `Categories` tabulky.</span><span class="sxs-lookup"><span data-stu-id="64a25-236">Next, the ObjectDataSource s `Insert()` method is invoked, which results in a new record being added to the `Categories` table.</span></span> <span data-ttu-id="64a25-237">Potom DetailsView s [ `ItemInserted` událostí](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) aktivuje.</span><span class="sxs-lookup"><span data-stu-id="64a25-237">After that, the DetailsView s [`ItemInserted` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) fires.</span></span>

<span data-ttu-id="64a25-238">Před ObjectDataSource s `Insert()` metoda je volána, jsme musíte nejdříve se ujistěte, typy souborů odpovídající byly odeslaný uživatele a pak uložte – příručka PDF do systému souborů webového serveru s.</span><span class="sxs-lookup"><span data-stu-id="64a25-238">Before the ObjectDataSource s `Insert()` method is invoked, we must first ensure that the appropriate file types were uploaded by the user and then save the brochure PDF to the web server s file system.</span></span> <span data-ttu-id="64a25-239">Vytvoření obslužné rutiny události pro DetailsView s `ItemInserting` událostí a přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="64a25-239">Create an event handler for the DetailsView s `ItemInserting` event and add the following code:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample6.vb)]

<span data-ttu-id="64a25-240">Obslužné rutiny události spustí odkazem `BrochureUpload` řízení odesílání souborů při odpovědích ze šablon s DetailsView.</span><span class="sxs-lookup"><span data-stu-id="64a25-240">The event handler starts by referencing the `BrochureUpload` FileUpload control from the DetailsView s templates.</span></span> <span data-ttu-id="64a25-241">Poté Pokud – příručka se nahrají, je zkontrolován s příponou nahrávaný soubor.</span><span class="sxs-lookup"><span data-stu-id="64a25-241">Then, if a brochure has been uploaded, the uploaded file s extension is examined.</span></span> <span data-ttu-id="64a25-242">Pokud není rozšíření. PDF, pak upozornění se zobrazí, se zruší úlohy insert a ukončí provádění obslužné rutiny události.</span><span class="sxs-lookup"><span data-stu-id="64a25-242">If the extension is not .PDF, then a warning is displayed, the insert is cancelled, and the execution of the event handler ends.</span></span>

> [!NOTE]
> <span data-ttu-id="64a25-243">Spoléhat na s příponou nahrávaný soubor není sure-fire technika pro zajištění, že nahrávaný soubor je dokument PDF.</span><span class="sxs-lookup"><span data-stu-id="64a25-243">Relying on the uploaded file s extension is not a sure-fire technique for ensuring that the uploaded file is a PDF document.</span></span> <span data-ttu-id="64a25-244">Uživatel může mít platný dokument PDF s příponou `.Brochure`, nebo může mít prováděné dokumentu souborů PDF a zadané ho `.pdf` rozšíření.</span><span class="sxs-lookup"><span data-stu-id="64a25-244">The user could have a valid PDF document with the extension `.Brochure`, or could have taken a non-PDF document and given it a `.pdf` extension.</span></span> <span data-ttu-id="64a25-245">Binární obsah souboru s by bylo nutné prostřednictvím kódu programu prověřit, chcete-li více jednoznačně ověřte typ souboru.</span><span class="sxs-lookup"><span data-stu-id="64a25-245">The file s binary content would need to be programmatically examined in order to more conclusively verify the file type.</span></span> <span data-ttu-id="64a25-246">Takové důkladné přístupy, ale jsou často přehnaně; Kontrola rozšíření je dostatečné pro většinu scénářů.</span><span class="sxs-lookup"><span data-stu-id="64a25-246">Such thorough approaches, though, are often overkill; checking the extension is sufficient for most scenarios.</span></span>


<span data-ttu-id="64a25-247">Jak je popsáno v [nahrávání souborů](uploading-files-vb.md) kurzu, musí dát pozor, při ukládání souborů do systému souborů tak, že jeden uživatel s nahrávání nepřepisuje jiné s.</span><span class="sxs-lookup"><span data-stu-id="64a25-247">As discussed in the [Uploading Files](uploading-files-vb.md) tutorial, care must be taken when saving files to the file system so that one user s upload does not overwrite another s.</span></span> <span data-ttu-id="64a25-248">V tomto kurzu jsme se pokusí použít stejný název jako nahrávaný soubor.</span><span class="sxs-lookup"><span data-stu-id="64a25-248">For this tutorial we will attempt to use the same name as the uploaded file.</span></span> <span data-ttu-id="64a25-249">Pokud již existuje soubor v `~/Brochures` directory tohoto souboru stejný název, ale nemůžeme budete připojit číslo na konci dokud nebude nalezen jedinečný název.</span><span class="sxs-lookup"><span data-stu-id="64a25-249">If there already exists a file in the `~/Brochures` directory with that same file name, however, we'll append a number at the end until a unique name is found.</span></span> <span data-ttu-id="64a25-250">Například, pokud uživatel odesílá informace o soubor s názvem `Meats.pdf`, ale již existuje soubor s názvem `Meats.pdf` v `~/Brochures` složky, Změníme názvu uloženého souboru `Meats-1.pdf`.</span><span class="sxs-lookup"><span data-stu-id="64a25-250">For example, if the user uploads a brochure file named `Meats.pdf`, but there is already a file named `Meats.pdf` in the `~/Brochures` folder, we'll change the saved file name to `Meats-1.pdf`.</span></span> <span data-ttu-id="64a25-251">Pokud existuje, pokusíme se `Meats-2.pdf`a tak dále, dokud nebude nalezen jedinečný název souboru.</span><span class="sxs-lookup"><span data-stu-id="64a25-251">If that exists, we'll try `Meats-2.pdf`, and so on, until a unique file name is found.</span></span>

<span data-ttu-id="64a25-252">Následující kód používá [ `File.Exists(path)` metoda](https://msdn.microsoft.com/library/system.io.file.exists.aspx) k určení, pokud soubor se zadaným názvem již existuje.</span><span class="sxs-lookup"><span data-stu-id="64a25-252">The following code uses the [`File.Exists(path)` method](https://msdn.microsoft.com/library/system.io.file.exists.aspx) to determine if a file already exists with the specified file name.</span></span> <span data-ttu-id="64a25-253">Pokud ano, potrvá pokusit nové názvy souborů – příručka, dokud nebude nalezen žádný konflikt.</span><span class="sxs-lookup"><span data-stu-id="64a25-253">If so, it continues to try new file names for the brochure until no conflict is found.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample7.vb)]

<span data-ttu-id="64a25-254">Jakmile nebyl nalezen platný název souboru, soubor musí být uloženy do systému souborů a ObjectDataSource s `brochurePath``InsertParameter` hodnota musí být aktualizovány tak, aby tento název souboru je zapsána do databáze.</span><span class="sxs-lookup"><span data-stu-id="64a25-254">Once a valid file name has been found, the file needs to be saved to the file system and the ObjectDataSource s `brochurePath``InsertParameter` value needs to be updated so that this file name is written to the database.</span></span> <span data-ttu-id="64a25-255">Jak jsme viděli zpět v *nahrávání souborů* kurzu soubor můžete uložit pomocí ovládacího prvku odesílání souborů při odpovědích s `SaveAs(path)` metoda.</span><span class="sxs-lookup"><span data-stu-id="64a25-255">As we saw back in the *Uploading Files* tutorial, the file can be saved using the FileUpload control s `SaveAs(path)` method.</span></span> <span data-ttu-id="64a25-256">Chcete-li aktualizovat ObjectDataSource s `brochurePath` parametr, použijte `e.Values` kolekce.</span><span class="sxs-lookup"><span data-stu-id="64a25-256">To update the ObjectDataSource s `brochurePath` parameter, use the `e.Values` collection.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample8.vb)]

## <a name="step-7-saving-the-uploaded-picture-to-the-database"></a><span data-ttu-id="64a25-257">Krok 7: Ukládání nahraný obrázek do databáze</span><span class="sxs-lookup"><span data-stu-id="64a25-257">Step 7: Saving the Uploaded Picture to the Database</span></span>

<span data-ttu-id="64a25-258">K uložení nahraný obrázek v novém `Categories` záznamů, je potřeba přiřadit nahrané binární obsah ObjectDataSource s `picture` parametr v DetailsView s `ItemInserting` událostí.</span><span class="sxs-lookup"><span data-stu-id="64a25-258">To store the uploaded picture in the new `Categories` record, we need to assign the uploaded binary content to the ObjectDataSource s `picture` parameter in the DetailsView s `ItemInserting` event.</span></span> <span data-ttu-id="64a25-259">Uděláme toto přiřazení, ale musíme nejprve se ujistěte, že nahraný obrázek je JPG a není nějaký jiný typ obrázku.</span><span class="sxs-lookup"><span data-stu-id="64a25-259">Before we make this assignment, however, we need to first make sure that the uploaded picture is a JPG and not some other image type.</span></span> <span data-ttu-id="64a25-260">Jako v kroku 6 umožní používat příponu souboru s nahraný obrázek zjistit typ s.</span><span class="sxs-lookup"><span data-stu-id="64a25-260">As in Step 6, let s use the uploaded picture s file extension to ascertain its type.</span></span>

<span data-ttu-id="64a25-261">Při `Categories` tabulky umožňuje `NULL` hodnoty `Picture` sloupec, všechny kategorie aktuálně mít obrázku.</span><span class="sxs-lookup"><span data-stu-id="64a25-261">While the `Categories` table allows `NULL` values for the `Picture` column, all categories currently have a picture.</span></span> <span data-ttu-id="64a25-262">Umožní s nutí uživatele zadat obrázku při přidávání nové kategorie prostřednictvím této stránky.</span><span class="sxs-lookup"><span data-stu-id="64a25-262">Let s force the user to provide a picture when adding a new category through this page.</span></span> <span data-ttu-id="64a25-263">Následující kód kontroluje odeslal obrázku a zda má příslušná rozšíření.</span><span class="sxs-lookup"><span data-stu-id="64a25-263">The following code checks to ensure that a picture has been uploaded and that it has an appropriate extension.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample9.vb)]

<span data-ttu-id="64a25-264">Tento kód musí být umístěny *před* kód z kroku 6 tak, že pokud dojde k potížím s nahrávání obrázku, obslužné rutiny události bude ukončen před uložením souboru – příručka k systému souborů.</span><span class="sxs-lookup"><span data-stu-id="64a25-264">This code should be placed *before* the code from Step 6 so that if there is a problem with the picture upload, the event handler will terminate before the brochure file is saved to the file system.</span></span>

<span data-ttu-id="64a25-265">Za předpokladu, že příslušný soubor byl odeslán, přiřaďte nahrané binární obsah hodnotu obrázek parametru s následující řádek kódu:</span><span class="sxs-lookup"><span data-stu-id="64a25-265">Assuming that an appropriate file has been uploaded, assign the uploaded binary content to the picture parameter s value with the following line of code:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample10.vb)]

## <a name="the-completeiteminsertingevent-handler"></a><span data-ttu-id="64a25-266">Kompletní`ItemInserting`obslužné rutiny události</span><span class="sxs-lookup"><span data-stu-id="64a25-266">The Complete`ItemInserting`Event Handler</span></span>

<span data-ttu-id="64a25-267">Pro úplnost, zde je `ItemInserting` obslužné rutiny událostí v celé jeho šíři:</span><span class="sxs-lookup"><span data-stu-id="64a25-267">For completeness, here is the `ItemInserting` event handler in its entirety:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample11.vb)]

## <a name="step-8-fixing-thedisplaycategorypictureaspxpage"></a><span data-ttu-id="64a25-268">Krok 8: Opravě`DisplayCategoryPicture.aspx`stránky</span><span class="sxs-lookup"><span data-stu-id="64a25-268">Step 8: Fixing the`DisplayCategoryPicture.aspx`Page</span></span>

<span data-ttu-id="64a25-269">Umožňují s za chvíli k otestování vkládání rozhraní a `ItemInserting` obslužné rutiny události, který byl vytvořen v posledních několika krocích.</span><span class="sxs-lookup"><span data-stu-id="64a25-269">Let s take a moment to test out the inserting interface and `ItemInserting` event handler that was created over the last few steps.</span></span> <span data-ttu-id="64a25-270">Přejděte `UploadInDetailsView.aspx` stránky prostřednictvím prohlížeče a pokus o přidání kategorie, ale vynechejte na obrázku, nebo zadat jiný JPG obrázku nebo – příručka jiného typu než PDF.</span><span class="sxs-lookup"><span data-stu-id="64a25-270">Visit the `UploadInDetailsView.aspx` page through a browser and attempt to add a category, but omit the picture, or specify a non-JPG picture or a non-PDF brochure.</span></span> <span data-ttu-id="64a25-271">V každém z těchto případů zobrazí se chybová zpráva a pracovní postup vložení zrušen.</span><span class="sxs-lookup"><span data-stu-id="64a25-271">In any of these cases, an error message will be displayed and the insert workflow cancelled.</span></span>


<span data-ttu-id="64a25-272">[![Zpráva upozornění se zobrazí, pokud je načtený neplatný typ souboru](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="64a25-272">[![A Warning Message is Displayed If an Invalid File Type is Uploaded](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image15.png)</span></span>

<span data-ttu-id="64a25-273">**Obrázek 9**: zprávy A upozornění se zobrazí, pokud je načtený neplatný typ souboru ([Kliknutím zobrazit obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="64a25-273">**Figure 9**: A Warning Message is Displayed If an Invalid File Type is Uploaded ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image16.png))</span></span>


<span data-ttu-id="64a25-274">Jakmile ověříte, že stránka vyžaduje obrázku k odeslání a získaných t přijmout soubory jiného typu než PDF nebo jiných JPG, přidat novou kategorii s platný obrázek JPG, když – příručka pole ponecháte prázdné.</span><span class="sxs-lookup"><span data-stu-id="64a25-274">Once you have verified that the page requires a picture to be uploaded and won t accept non-PDF or non-JPG files, add a new category with a valid JPG picture, leaving the Brochure field empty.</span></span> <span data-ttu-id="64a25-275">Po kliknutí na tlačítko Vložit, bude odeslat zpět na stránku a nový záznam se zařadí do `Categories` tabulku s binární obsah nahraný obrázek s uloženy přímo v databázi.</span><span class="sxs-lookup"><span data-stu-id="64a25-275">After clicking the Insert button, the page will postback and a new record will be added to the `Categories` table with the uploaded image s binary contents stored directly in the database.</span></span> <span data-ttu-id="64a25-276">GridView se aktualizuje a zobrazí řádek pro nově přidaného kategorie, ale, jak ukazuje obrázek 10, není nový obrázek s kategorie vykreslí správně.</span><span class="sxs-lookup"><span data-stu-id="64a25-276">The GridView is updated and shows a row for the newly added category, but, as Figure 10 shows, the new category s picture is not rendered correctly.</span></span>


<span data-ttu-id="64a25-277">[![Nové kategorie s, které se nezobrazí obrázek](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="64a25-277">[![The New Category s Picture is not Displayed](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image17.png)</span></span>

<span data-ttu-id="64a25-278">**Obrázek 10**: novou kategorii s obrázek nezobrazí ([Kliknutím zobrazit obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="64a25-278">**Figure 10**: The New Category s Picture is not Displayed ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image18.png))</span></span>


<span data-ttu-id="64a25-279">Nový obrázek se nezobrazí. Důvodem je skutečnost, protože `DisplayCategoryPicture.aspx` stránky, která vrátí Zadaná kategorie s obrázku je nakonfigurovat pro zpracování rastrové obrázky, které mají hlavičku OLE.</span><span class="sxs-lookup"><span data-stu-id="64a25-279">The reason the new picture is not displayed is because the `DisplayCategoryPicture.aspx` page that returns a specified category s picture is configured to process bitmaps that have an OLE header.</span></span> <span data-ttu-id="64a25-280">Tuto hlavičku 78 bajtů se odstraní z `Picture` sloupec s binární obsah před jejich odesláním zpět do klienta.</span><span class="sxs-lookup"><span data-stu-id="64a25-280">This 78 byte header is stripped from the `Picture` column s binary contents before they are sent back to the client.</span></span> <span data-ttu-id="64a25-281">Ale soubor JPG, který jsme právě nahráli nové kategorie nemá tuto hlavičku OLE; platný, nezbytné bajtů jsou proto odebírán z bitové kopie s binární data.</span><span class="sxs-lookup"><span data-stu-id="64a25-281">But the JPG file we just uploaded for the new category does not have this OLE header; therefore, valid, necessary bytes are being removed from the image s binary data.</span></span>

<span data-ttu-id="64a25-282">Vzhledem k tomu, že jsou teď i bitmapy s hlavičky OLE a formátu JPG využívá v `Categories` tabulky, musíme aktualizovat `DisplayCategoryPicture.aspx` tak, aby nepodporuje hlavičku OLE odstraňování pro původní osm kategorie a obchází odstraňování záznamů novější kategorie.</span><span class="sxs-lookup"><span data-stu-id="64a25-282">Since there are now both bitmaps with OLE headers and JPGs in the `Categories` table, we need to update `DisplayCategoryPicture.aspx` so that it does the OLE header stripping for the original eight categories and bypasses this stripping for the newer category records.</span></span> <span data-ttu-id="64a25-283">V našem kurzu další podíváme, jak se bude aktualizovat stávající záznam s image a budete aktualizujeme všechny staré kategorie obrázky, aby byly formátu JPG využívá.</span><span class="sxs-lookup"><span data-stu-id="64a25-283">In our next tutorial we'll examine how to update an existing record s image, and we'll update all of the old category pictures so that they are JPGs.</span></span> <span data-ttu-id="64a25-284">Teď, když, použijte následující kód v `DisplayCategoryPicture.aspx` k odebrání hlaviček OLE pouze u těchto původní osm kategorií:</span><span class="sxs-lookup"><span data-stu-id="64a25-284">For now, though, use the following code in `DisplayCategoryPicture.aspx` to strip the OLE headers only for those original eight categories:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample12.vb)]

<span data-ttu-id="64a25-285">Díky této změně JPG bitové kopie je nyní v správně vykreslen GridView.</span><span class="sxs-lookup"><span data-stu-id="64a25-285">With this change, the JPG image is now rendered correctly in the GridView.</span></span>


<span data-ttu-id="64a25-286">[![JPG Image pro nové kategorie jsou správně vykreslen.](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="64a25-286">[![The JPG Images for New Categories are Correctly Rendered](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image19.png)</span></span>

<span data-ttu-id="64a25-287">**Obrázek 11**: obrázků JPG pro nové kategorie jsou správně vykreslen ([Kliknutím zobrazit obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="64a25-287">**Figure 11**: The JPG Images for New Categories are Correctly Rendered ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image20.png))</span></span>


## <a name="step-9-deleting-the-brochure-in-the-face-of-an-exception"></a><span data-ttu-id="64a25-288">Krok 9: Odstranění – příručka při krátkodobém výjimku</span><span class="sxs-lookup"><span data-stu-id="64a25-288">Step 9: Deleting the Brochure in the Face of an Exception</span></span>

<span data-ttu-id="64a25-289">Jedním z problémů v systému souborů webového serveru s ukládání binárních dat je, že přináší odpojení mezi v datovém modelu a jeho binární data.</span><span class="sxs-lookup"><span data-stu-id="64a25-289">One of the challenges of storing binary data on the web server s file system is that it introduces a disconnect between the data model and its binary data.</span></span> <span data-ttu-id="64a25-290">Proto vždy, když dojde k odstranění záznamu, odpovídající binární data v systému souborů musí také odebrány.</span><span class="sxs-lookup"><span data-stu-id="64a25-290">Therefore, whenever a record is deleted, the corresponding binary data on the file system must also be removed.</span></span> <span data-ttu-id="64a25-291">To lze uplatnit při vkládání také.</span><span class="sxs-lookup"><span data-stu-id="64a25-291">This can come into play when inserting, as well.</span></span> <span data-ttu-id="64a25-292">Vezměte v úvahu následující scénář: uživatel přidá novou kategorii, zadání – příručka a platný obrázek.</span><span class="sxs-lookup"><span data-stu-id="64a25-292">Consider the following scenario: a user adds a new category, specifying a valid picture and brochure.</span></span> <span data-ttu-id="64a25-293">Po kliknutí na tlačítko Vložit, dojde k zpětné volání a DetailsView s `ItemInserting` událost je aktivována, ukládání – příručka k systému souborů webového serveru s.</span><span class="sxs-lookup"><span data-stu-id="64a25-293">Upon clicking the Insert button, a postback occurs and the DetailsView s `ItemInserting` event fires, saving the brochure to the web server s file system.</span></span> <span data-ttu-id="64a25-294">Další, ObjectDataSource s `Insert()` je volána metoda, která volá `CategoriesBLL` třídu s `InsertWithPicture` metodu, která volá `CategoriesTableAdapter` s `InsertWithPicture` metoda.</span><span class="sxs-lookup"><span data-stu-id="64a25-294">Next, the ObjectDataSource s `Insert()` method is invoked, which calls the `CategoriesBLL` class s `InsertWithPicture` method, which calls the `CategoriesTableAdapter` s `InsertWithPicture` method.</span></span>

<span data-ttu-id="64a25-295">Nyní, co se stane, pokud se databáze nachází v režimu offline nebo pokud dojde k chybě v `INSERT` příkazu SQL?</span><span class="sxs-lookup"><span data-stu-id="64a25-295">Now, what happens if the database is offline, or if there is an error in the `INSERT` SQL statement?</span></span> <span data-ttu-id="64a25-296">Jasně se nezdaří úlohy INSERT, aby žádné nové kategorie řádek bude přidán do databáze.</span><span class="sxs-lookup"><span data-stu-id="64a25-296">Clearly the INSERT will fail, so no new category row will be added to the database.</span></span> <span data-ttu-id="64a25-297">Ale stále nahrané – příručka soubor uložený v systému souborů webového serveru s!</span><span class="sxs-lookup"><span data-stu-id="64a25-297">But we still have the uploaded brochure file sitting on the web server s file system!</span></span> <span data-ttu-id="64a25-298">Tento soubor je nutné odstranit při krátkodobém výjimku během vkládání pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="64a25-298">This file needs to be deleted in the face of an exception during the inserting workflow.</span></span>

<span data-ttu-id="64a25-299">Jak je popsáno dříve v [zpracování BLL - a výjimky na úrovni DAL na stránku ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) kurzu, když je vyvolána výjimka z v rámci depths architektury probublá až prostřednictvím různých vrstev.</span><span class="sxs-lookup"><span data-stu-id="64a25-299">As discussed previously in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial, when an exception is thrown from within the depths of the architecture it is bubbled up through the various layers.</span></span> <span data-ttu-id="64a25-300">V prezentační vrstvě, můžeme určit, pokud došlo k výjimce z DetailsView s `ItemInserted` událostí.</span><span class="sxs-lookup"><span data-stu-id="64a25-300">At the Presentation Layer, we can determine if an exception has occurred from the DetailsView s `ItemInserted` event.</span></span> <span data-ttu-id="64a25-301">Tuto obslužnou rutinu události také poskytuje hodnoty ObjectDataSource s `InsertParameters`.</span><span class="sxs-lookup"><span data-stu-id="64a25-301">This event handler also provides the values of the ObjectDataSource s `InsertParameters`.</span></span> <span data-ttu-id="64a25-302">Proto, můžeme vytvořit obslužnou rutinu události pro `ItemInserted` událost, která zkontroluje, zda došlo k výjimce a pokud ano, odstraní soubor určený touto ObjectDataSource s `brochurePath` parametr:</span><span class="sxs-lookup"><span data-stu-id="64a25-302">Therefore, we can create an event handler for the `ItemInserted` event that checks if there was an exception and, if so, deletes the file specified by the ObjectDataSource s `brochurePath` parameter:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample13.vb)]

## <a name="summary"></a><span data-ttu-id="64a25-303">Souhrn</span><span class="sxs-lookup"><span data-stu-id="64a25-303">Summary</span></span>

<span data-ttu-id="64a25-304">Existuje několik kroků, které musíte provést, chcete-li poskytovat webové rozhraní pro přidávání záznamů, které zahrnují binární data.</span><span class="sxs-lookup"><span data-stu-id="64a25-304">There are a number of steps that must be performed in order to provide a web-based interface for adding records that include binary data.</span></span> <span data-ttu-id="64a25-305">Pokud binární data ukládají přímo do databáze, je možné se, že budete muset aktualizovat architekturu, přidání konkrétní metody pro zpracování případu, kdy bude vložen, binární data.</span><span class="sxs-lookup"><span data-stu-id="64a25-305">If the binary data is being stored directly into the database, chances are you'll need to update the architecture, adding specific methods to handle the case where binary data is being inserted.</span></span> <span data-ttu-id="64a25-306">Jakmile architektura byla aktualizovaná, dalším krokem vytvoření vkládání rozhraní, což lze provést pomocí DetailsView, který byl přizpůsoben, aby patří odesílání souborů při odpovědích ovládací prvek pro každé pole binární data.</span><span class="sxs-lookup"><span data-stu-id="64a25-306">Once the architecture has been updated, the next step is creating the inserting interface, which can be accomplished using a DetailsView that has been customized to include a FileUpload control for each binary data field.</span></span> <span data-ttu-id="64a25-307">Odeslaná data pak můžete uložit do systému souborů webového serveru s nebo přiřazené parametr zdroje dat v DetailsView s `ItemInserting` obslužné rutiny události.</span><span class="sxs-lookup"><span data-stu-id="64a25-307">The uploaded data can then be saved to the web server s file system or assigned to a data source parameter in the DetailsView s `ItemInserting` event handler.</span></span>

<span data-ttu-id="64a25-308">Ukládání binární data do systému souborů vyžaduje další plánování než ukládání dat přímo do databáze.</span><span class="sxs-lookup"><span data-stu-id="64a25-308">Saving binary data to the file system requires more planning than saving data directly into the database.</span></span> <span data-ttu-id="64a25-309">Schéma pojmenování musí být vybrána, aby se zabránilo jeden uživatel s nahrávání přepsal jiné s.</span><span class="sxs-lookup"><span data-stu-id="64a25-309">A naming scheme must be chosen in order to avoid one user s upload overwriting another s.</span></span> <span data-ttu-id="64a25-310">Další kroky musí navíc přesměrováni na Odstranit nahrávaný soubor, pokud se nezdaří vložení databáze.</span><span class="sxs-lookup"><span data-stu-id="64a25-310">Also, extra steps must be taken to delete the uploaded file if the database insert fails.</span></span>

<span data-ttu-id="64a25-311">Nyní je k dispozici možnost přidávat nové kategorie s – příručka a obrázek, ale nemůžeme systému jste ještě a podívat se na tom, jak aktualizovat existující kategorie s binární data nebo jak správně odebrat binární data pro odstraněné kategorii.</span><span class="sxs-lookup"><span data-stu-id="64a25-311">We now have the ability to add new categories to the system with a brochure and picture, but we ve yet to look at how to update an existing category s binary data or how to correctly remove the binary data for a deleted category.</span></span> <span data-ttu-id="64a25-312">V dalším kurzu jsme budete prozkoumejte těchto dvou tématech.</span><span class="sxs-lookup"><span data-stu-id="64a25-312">We'll explore these two topics in the next tutorial.</span></span>

<span data-ttu-id="64a25-313">Radostí programování!</span><span class="sxs-lookup"><span data-stu-id="64a25-313">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="64a25-314">O autorovi</span><span class="sxs-lookup"><span data-stu-id="64a25-314">About the Author</span></span>

<span data-ttu-id="64a25-315">[Scott Meisnerová](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor sedm ASP/ASP.NET knih a zakladatele z [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracuje s technologií Microsoft Web od 1998.</span><span class="sxs-lookup"><span data-stu-id="64a25-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="64a25-316">Scott funguje jako nezávislé poradce, trainer a zapisovače.</span><span class="sxs-lookup"><span data-stu-id="64a25-316">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="64a25-317">Jeho nejnovější seznam k [ *Edice nakladatelství Sams naučit sami technologii ASP.NET 2.0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="64a25-317">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="64a25-318">Dosažitelný v [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) nebo prostřednictvím svého blogu, který najdete na [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="64a25-318">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="64a25-319">Zvláštní poděkování</span><span class="sxs-lookup"><span data-stu-id="64a25-319">Special Thanks To</span></span>

<span data-ttu-id="64a25-320">Tento kurz řady byla zkontrolovány uživatelem mnoho užitečné kontrolorů.</span><span class="sxs-lookup"><span data-stu-id="64a25-320">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="64a25-321">Vést kontroloři v tomto kurzu se Dave Gardner, Teresy Murphy a Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="64a25-321">Lead reviewers for this tutorial were Dave Gardner, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="64a25-322">Kontrola Moje nadcházející články MSDN máte zájem?</span><span class="sxs-lookup"><span data-stu-id="64a25-322">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="64a25-323">Pokud ano, vyřaďte mi řádek v [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="64a25-323">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="64a25-324">[Předchozí](displaying-binary-data-in-the-data-web-controls-vb.md)
[další](updating-and-deleting-existing-binary-data-vb.md)</span><span class="sxs-lookup"><span data-stu-id="64a25-324">[Previous](displaying-binary-data-in-the-data-web-controls-vb.md)
[Next](updating-and-deleting-existing-binary-data-vb.md)</span></span>
