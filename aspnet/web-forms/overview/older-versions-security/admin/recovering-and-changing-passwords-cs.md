---
uid: web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
title: Obnovení a změna hesel (C#) | Microsoft Docs
author: rick-anderson
description: Technologie ASP.NET obsahuje dva ovládací prvky webového asistence s obnovením a změny hesla. Ovládací prvek PasswordRecovery umožňuje návštěvníka k obnovení jeho ztraceny pa...
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/01/2008
ms.topic: article
ms.assetid: 19c4d042-4e34-4b44-9f1d-6bf2253ba366
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
msc.type: authoredcontent
ms.openlocfilehash: 7f8b019631eff4840bf1759f8e2752946abcaf80
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/06/2018
ms.locfileid: "30891000"
---
<a name="recovering-and-changing-passwords-c"></a><span data-ttu-id="2f8d3-104">Obnovení a změna hesel (C#)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-104">Recovering and Changing Passwords (C#)</span></span>
====================
<span data-ttu-id="2f8d3-105">podle [Scott Meisnerová](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="2f8d3-106">[Stáhněte si kód](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip) nebo [stáhnout PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-106">[Download Code](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip) or [Download PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span></span>

> <span data-ttu-id="2f8d3-107">Technologie ASP.NET obsahuje dva ovládací prvky webového asistence s obnovením a změny hesla.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-107">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="2f8d3-108">Ovládací prvek PasswordRecovery umožňuje návštěvníka k obnovení jeho hesla. ztraceny.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-108">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="2f8d3-109">Změna hesla byla řízení umožňuje uživatelům aktualizovat heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-109">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="2f8d3-110">Jako další ovládací prvky související s přihlášením webové jsme viděli v rámci tohoto kurzu řady PasswordRecovery a změna hesla byla řídí pracují s rozhraní členství na pozadí a resetovat nebo změnit hesla uživatelů.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-110">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>


## <a name="introduction"></a><span data-ttu-id="2f8d3-111">Úvod</span><span class="sxs-lookup"><span data-stu-id="2f8d3-111">Introduction</span></span>

<span data-ttu-id="2f8d3-112">Mezi weby pro moje bank, nástroj společnosti, phone společnosti, e-mailové účty a přizpůsobené webové portály, většina lidí, je nutné desítek různá hesla pamatovat.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-112">Between the websites for my bank, utility company, phone company, email accounts, and personalized web portals, I, like most people, have dozens of different passwords to remember.</span></span> <span data-ttu-id="2f8d3-113">S pověřením mnoho pamatovat dní je běžné pro uživatele, kteří mají zapomenou své heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-113">With so many credentials to memorize these days, it's not uncommon for people to forget their password.</span></span> <span data-ttu-id="2f8d3-114">Pro tento účet, weby, které nabízejí uživatelské účty muset měl mít uživatel k obnovení jeho hesla.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-114">To account for this, websites that offer user accounts need to include a way for a user to recover his password.</span></span> <span data-ttu-id="2f8d3-115">Tento proces obvykle zahrnuje generování nové, náhodné heslo a e-mailem žádají e-mailovou adresu uživatele v souboru.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-115">This process typically involves generating a new, random password and emailing it to the user's email address on file.</span></span> <span data-ttu-id="2f8d3-116">Většina uživatelů po přijetí své nové heslo vrátit do lokality a změnit si heslo z náhodně generované jeden více snadno zapamatovatelný klíčem.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-116">After receiving their new password most users return to the site and change their password from the randomly generated one to a more memorable one.</span></span>

<span data-ttu-id="2f8d3-117">Technologie ASP.NET obsahuje dva ovládací prvky webového asistence s obnovením a změny hesla.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-117">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="2f8d3-118">Ovládací prvek PasswordRecovery umožňuje návštěvníka k obnovení jeho hesla. ztraceny.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-118">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="2f8d3-119">Změna hesla byla řízení umožňuje uživatelům aktualizovat heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-119">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="2f8d3-120">Jako další ovládací prvky související s přihlášením webové jsme viděli v rámci tohoto kurzu řady PasswordRecovery a změna hesla byla řídí pracují s rozhraní členství na pozadí a resetovat nebo změnit hesla uživatelů.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-120">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

<span data-ttu-id="2f8d3-121">V tomto kurzu vyzkoušíme pomocí těchto dvou ovládacích prvků.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-121">In this tutorial we will examine using these two controls.</span></span> <span data-ttu-id="2f8d3-122">Také jsme uvidí jak programově změnit a resetovat heslo uživatele pomocí `MembershipUser` třídy `ChangePassword` a `ResetPassword` metody.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-122">We will also see how to programmatically change and reset a user's password via the `MembershipUser` class's `ChangePassword` and `ResetPassword` methods.</span></span>

## <a name="step-1-helping-users-recover-lost-passwords"></a><span data-ttu-id="2f8d3-123">Krok 1: Pomoc uživatelům obnovení ztraceného hesla</span><span class="sxs-lookup"><span data-stu-id="2f8d3-123">Step 1: Helping Users Recover Lost Passwords</span></span>

<span data-ttu-id="2f8d3-124">Všechny weby, které podporují uživatelské účty nutné uživatelům poskytnout stejný mechanismus pro obnovení jejich zapomenutým heslům.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-124">All websites that support user accounts need to provide users with some mechanism for recovering their forgotten passwords.</span></span> <span data-ttu-id="2f8d3-125">Dobrá zpráva je, že implementace takové funkce technologie ASP.NET není uloženy díky ovládací prvek PasswordRecovery webu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-125">The good news is that implementing such functionality in ASP.NET is a breeze thanks to the PasswordRecovery Web control.</span></span> <span data-ttu-id="2f8d3-126">Ovládací prvek PasswordRecovery vykreslí rozhraní, které zobrazí výzvu pro své uživatelské jméno a v případě potřeby odpovědí na své bezpečnostní otázku.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-126">The PasswordRecovery control renders an interface that prompts the user for their username and, if needed, the answer to their security question.</span></span> <span data-ttu-id="2f8d3-127">Ho e-maily pak uživatel své heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-127">It then emails the user their password.</span></span>

> [!NOTE]
> <span data-ttu-id="2f8d3-128">Protože e-mailové zprávy jsou přenášena ve formátu prostého textu existují zabezpečení rizika spojená s odesíláním heslo uživatele e-mailem.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-128">Because email messages are transmitted over the wire in plain-text there are security risks involved with sending a user's password via email.</span></span>


<span data-ttu-id="2f8d3-129">Ovládací prvek PasswordRecovery se skládá ze tří zobrazení:</span><span class="sxs-lookup"><span data-stu-id="2f8d3-129">The PasswordRecovery control consists of three views:</span></span>

- <span data-ttu-id="2f8d3-130">**Uživatelské jméno** -vyzve návštěvníka pro své uživatelské jméno.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-130">**UserName** - prompts the visitor for their username.</span></span> <span data-ttu-id="2f8d3-131">Toto je počáteční zobrazení.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-131">This is the initial view.</span></span>
- <span data-ttu-id="2f8d3-132">**Otázka**-zobrazí uživatelské jméno a bezpečnostní otázku uživatele textu, společně s textové pole pro uživatele k zadání odpovědi na své bezpečnostní otázku.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-132">**Question**- displays the user's username and security question as text, along with a TextBox for the user to enter the answer to his security question.</span></span>
- <span data-ttu-id="2f8d3-133">**Úspěch**-zobrazí zprávu informující uživatele, který heslo má byla e-mailem.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-133">**Success**- displays a message informing the user that his password has been emailed.</span></span>

<span data-ttu-id="2f8d3-134">Zobrazí se zobrazení a akce prováděné ovládacího prvku PasswordRecovery závisí na následujících nastavení konfigurace členství:</span><span class="sxs-lookup"><span data-stu-id="2f8d3-134">The views displayed and actions performed by the PasswordRecovery control depend upon the following Membership configuration settings:</span></span>

- `RequiresQuestionAndAnswer`
- `EnablePasswordRetrieval`
- `EnablePasswordReset`

<span data-ttu-id="2f8d3-135">Rozhraní framework členství `RequiresQuestionAndAnswer` nastavení určuje, jestli uživatelé musí zadat bezpečnostní otázku a odpověď při registraci k účtu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-135">The Membership framework's `RequiresQuestionAndAnswer` setting indicates whether users must specify a security question and answer when registering for an account.</span></span> <span data-ttu-id="2f8d3-136">Jak již bylo zmíněno <a id="_msoanchor_1"> </a> [ *vytváření uživatelských účtů* ](../membership/creating-user-accounts-cs.md) kurz, pokud `RequiresQuestionAndAnswer` má hodnotu True (výchozí), pak CreateUserWizard rozhraní obsahuje textové pole ovládací prvky pro nového uživatele bezpečnostní otázku a odpověď; Pokud `RequiresQuestionAndAnswer` hodnotu False, nebudou tyto údaje.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-136">As we discussed in the <a id="_msoanchor_1"></a>[*Creating User Accounts*](../membership/creating-user-accounts-cs.md) tutorial, if `RequiresQuestionAndAnswer` is True (the default) then the CreateUserWizard's interface includes TextBox controls for the new user's security question and answer; if `RequiresQuestionAndAnswer` is False, no such information is collected.</span></span> <span data-ttu-id="2f8d3-137">Podobně pokud `RequiresQuestionAndAnswer` je True a potom zobrazí ovládací prvek PasswordRecovery, otázka zobrazit, co uživatel zadá své uživatelské jméno, heslo je obnovena pouze v případě, že uživatel zadá správný bezpečnostní otázce.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-137">Similarly, if `RequiresQuestionAndAnswer` is True, then the PasswordRecovery control displays the Question view after the user has entered their username; the password is recovered only if the user enters the correct security answer.</span></span> <span data-ttu-id="2f8d3-138">Pokud `RequiresQuestionAndAnswer` je False, ale ovládací prvek PasswordRecovery přesune přímo ze zobrazení uživatelské jméno k zobrazení úspěch.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-138">If `RequiresQuestionAndAnswer` is False, however, the PasswordRecovery control moves straight from the UserName view to the Success view.</span></span>

<span data-ttu-id="2f8d3-139">Poté, co uživatel zadal své uživatelské jméno - nebo jeho uživatelské jméno a zabezpečení odpovědí, pokud `RequiresQuestionAndAnswer` má hodnotu True - PasswordRecovery e-maily uživatele heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-139">After the user has provided his username - or his username and security answer, if `RequiresQuestionAndAnswer` is True - the PasswordRecovery emails the user his password.</span></span> <span data-ttu-id="2f8d3-140">Pokud `EnablePasswordRetrieval` je možnost nastavena na hodnotu True, pak uživatel e-mailu jejich aktuální heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-140">If the `EnablePasswordRetrieval` option is set to True, then the user is emailed their current password.</span></span> <span data-ttu-id="2f8d3-141">Pokud je nastaveno na hodnotu False a `EnablePasswordReset` nastaven na hodnotu True, pak ovládacího prvku PasswordRecovery vygeneruje nové, náhodné heslo pro uživatele a e-maily tohoto nového hesla k nim.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-141">If it is set to False and `EnablePasswordReset` is set to True, then the PasswordRecovery control generates a new, random password for the user, and emails this new password to them.</span></span> <span data-ttu-id="2f8d3-142">Pokud oba `EnablePasswordRetrieval` a `EnablePasswordReset` hodnotu False, ovládacího prvku PasswordRecovery vyvolá výjimku.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-142">If both `EnablePasswordRetrieval` and `EnablePasswordReset` are False, the PasswordRecovery control throws an exception.</span></span>

> [!NOTE]
> <span data-ttu-id="2f8d3-143">Odvolat, který `SqlMembershipProvider` ukládá hesla uživatelů ke službám v jednom ze tří formátů: zaškrtnutí, Hashed (výchozí) nebo zašifrovaná.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-143">Recall that the `SqlMembershipProvider` stores users' passwords in one of three formats: Clear, Hashed (the default), or Encrypted.</span></span> <span data-ttu-id="2f8d3-144">Používáno úložiště závisí na nastavení konfigurace členství. ukázkové aplikace používá formát hesla Hashed.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-144">The storage mechanism used depends on the Membership configuration settings; the demo application uses the Hashed password format.</span></span> <span data-ttu-id="2f8d3-145">Při použití formátu heslo Hashed `EnablePasswordRetrieval` možnost musí být nastaveno na hodnotu False, protože systém nemůže určit vlastní heslo uživatele z hodnoty hash verze uložená v databázi.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-145">When using the Hashed password format the `EnablePasswordRetrieval` option must be set to False because the system cannot determine the user's actual password from the hashed version stored in the database.</span></span>


<span data-ttu-id="2f8d3-146">Obrázek 1 ukazuje, jak je konfigurace členství vliv PasswordRecovery rozhraní a chování.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-146">Figure 1 illustrates how the PasswordRecovery's interface and behavior is influenced by the Membership configuration.</span></span>


<span data-ttu-id="2f8d3-147">[![RequiresQuestionAndAnswer, EnablePasswordRetrieval a EnablePasswordReset ovlivnit vzhled a chování PasswordRecovery ovládacího prvku](recovering-and-changing-passwords-cs/_static/image2.png)](recovering-and-changing-passwords-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-147">[![The RequiresQuestionAndAnswer, EnablePasswordRetrieval, and EnablePasswordReset Influence the PasswordRecovery control's Appearance and Behavior](recovering-and-changing-passwords-cs/_static/image2.png)](recovering-and-changing-passwords-cs/_static/image1.png)</span></span>

<span data-ttu-id="2f8d3-148">**Obrázek 1**: `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, a `EnablePasswordReset` ovlivnit vzhled a chování ovládacího prvku PasswordRecovery ([Kliknutím zobrazit obrázek v plné velikosti](recovering-and-changing-passwords-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="2f8d3-148">**Figure 1**: The `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, and `EnablePasswordReset` Influence the PasswordRecovery control's Appearance and Behavior  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image3.png))</span></span>


> [!NOTE]
> <span data-ttu-id="2f8d3-149">V <a id="_msoanchor_2"> </a> [ *vytváření schématu členství v systému SQL Server* ](../membership/creating-the-membership-schema-in-sql-server-cs.md) kurzu jsme nakonfigurovali zprostředkovatel členství nastavením `RequiresQuestionAndAnswer` na hodnotu True, `EnablePasswordRetrieval` na Hodnotu false, a `EnablePasswordReset` na hodnotu True.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-149">In the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial we configured the Membership provider by setting `RequiresQuestionAndAnswer` to True, `EnablePasswordRetrieval` to False, and `EnablePasswordReset` to True.</span></span>


### <a name="using-the-passwordrecovery-control"></a><span data-ttu-id="2f8d3-150">Použití ovládacího prvku PasswordRecovery</span><span class="sxs-lookup"><span data-stu-id="2f8d3-150">Using the PasswordRecovery Control</span></span>

<span data-ttu-id="2f8d3-151">Podívejme se na stránku ASP.NET pomocí ovládacího prvku PasswordRecovery.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-151">Let's look at using the PasswordRecovery control in an ASP.NET page.</span></span> <span data-ttu-id="2f8d3-152">Otevřete `RecoverPassword.aspx` a přetáhněte ji a vyřadit ovládacího prvku PasswordRecovery z panelu nástrojů na návrháře; nastavit jeho `ID` k `RecoverPwd`.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-152">Open `RecoverPassword.aspx` and drag and drop a PasswordRecovery control from the Toolbox onto the Designer; set its `ID` to `RecoverPwd`.</span></span> <span data-ttu-id="2f8d3-153">Jako přihlašovací údaje a CreateUserWizard webových ovládacích prvků vykreslit zobrazení ovládacích prvků PasswordRecovery bohaté složené rozhraní, které obsahuje popisky, textových polí, tlačítek a ovládací prvky pro ověřování.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-153">Like the Login and CreateUserWizard Web controls, the PasswordRecovery control's views render a rich composite interface that includes Labels, TextBoxes, Buttons, and validation controls.</span></span> <span data-ttu-id="2f8d3-154">Můžete přizpůsobit vzhled zobrazení prostřednictvím vlastnosti stylu ovládacího prvku nebo převedením zobrazení na šablony.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-154">You can customize the appearance of the views through the control's style properties or by converting the views into templates.</span></span> <span data-ttu-id="2f8d3-155">Nechat to jako cvičení pro zúčastněným čtečku.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-155">I leave this as an exercise for the interested reader.</span></span>

<span data-ttu-id="2f8d3-156">Pokud uživatel navštíví Tato stránka se bude zadejte svoje uživatelské jméno a klikněte na tlačítko pro odeslání.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-156">When a user visits this page she will enter her username and click the Submit button.</span></span> <span data-ttu-id="2f8d3-157">Protože jsme nastavili `RequiresQuestionAndAnswer` vlastnost na hodnotu True v nastavení konfigurace naše členství, PasswordRecovery řízení se pak zobrazit otázku.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-157">Because we have set the `RequiresQuestionAndAnswer` property to True in our Membership configuration settings, the PasswordRecovery control will then display the Question view.</span></span> <span data-ttu-id="2f8d3-158">Poté, co uživatel zadá svůj odpovědí správné zabezpečení a na odeslání, bude prvek PasswordRecovery aktualizovat jeden se náhodně vygenerované heslo uživatele a e-mailu toto heslo e-mailovou adresu na soubor.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-158">After the user enters her correct security answer and clicks Submit, the PasswordRecovery control will update the user's password to a randomly-generated one, and email this password to the email address on file.</span></span> <span data-ttu-id="2f8d3-159">Všechny tyto bylo možné bez nám nutnosti napsat jediný řádek kódu!</span><span class="sxs-lookup"><span data-stu-id="2f8d3-159">All of this was possible without us having to write a single line of code!</span></span>

<span data-ttu-id="2f8d3-160">Před zahájením testovacího této stránce, je poslední část konfigurace do mají tendenci: je potřeba zadat nastavení doručení e-mailu v `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-160">Before you test this page, there's one final piece of configuration to tend to: we need to specify the mail delivery settings in `Web.config`.</span></span> <span data-ttu-id="2f8d3-161">Ovládací prvek PasswordRecovery závisí na těchto nastavení pro odesílání e-mailu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-161">The PasswordRecovery control relies on these settings for sending the email.</span></span>

<span data-ttu-id="2f8d3-162">Konfigurace doručování e-mailu se specifikuje prostřednictvím [ `<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx)na [ `<mailSettings>` element](https://msdn.microsoft.com/library/w355a94k.aspx).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-162">The mail delivery configuration is specified through the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx)'s [`<mailSettings>` element](https://msdn.microsoft.com/library/w355a94k.aspx).</span></span> <span data-ttu-id="2f8d3-163">Použití [ `<smtp>` element](https://msdn.microsoft.com/library/ms164240.aspx) udávajících metodu doručení a ve výchozím nastavení z adresy.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-163">Use the [`<smtp>` element](https://msdn.microsoft.com/library/ms164240.aspx) to indicate the delivery method and the default From address.</span></span> <span data-ttu-id="2f8d3-164">Následující kód konfiguruje nastavení e-mailu, síti SMTP serveru s názvem `smtp.example.com` na port 25 a s uživatelským jménem a heslem přihlašovací údaje uživatelského jména a hesla.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-164">The following markup configures mail settings to use a network SMTP server named `smtp.example.com` on port 25 and with username/password credentials of username and password.</span></span>

> [!NOTE]
> <span data-ttu-id="2f8d3-165">`<system.net>` je podřízený prvek kořenového `<configuration>` elementu a na stejné úrovni jako `<system.web>`.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-165">`<system.net>` is a child element of the root `<configuration>` element and a sibling of `<system.web>`.</span></span> <span data-ttu-id="2f8d3-166">Proto nevkládejte `<system.net>` v rámci `<system.web>` element; namísto toho uložte na stejné úrovni.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-166">Therefore, do not put the `<system.net>` element within the `<system.web>` element; instead, put it at the same level.</span></span>


[!code-xml[Main](recovering-and-changing-passwords-cs/samples/sample1.xml)]

<span data-ttu-id="2f8d3-167">Kromě používání SMTP server v síti, můžete alternativně zadat výstupního adresáře, kde má e-mailové zprávy zasílat uloží.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-167">In addition to using an SMTP server on the network, you can alternatively specify a pickup directory where email messages to be sent should be deposited.</span></span>

<span data-ttu-id="2f8d3-168">Po konfiguraci nastavení SMTP, přejděte `RecoverPassword.aspx` stránku prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-168">Once you have configured the SMTP settings, visit the `RecoverPassword.aspx` page through a browser.</span></span> <span data-ttu-id="2f8d3-169">Zkuste je napřed zadáním uživatelského jména, která neexistuje v úložišti uživatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-169">First try entering a username that doesn't exist in the user store.</span></span> <span data-ttu-id="2f8d3-170">Jak je vidět na obrázku 2, ovládacího prvku PasswordRecovery zobrazí zprávu s upozorněním, že informace o uživateli nelze získat přístup.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-170">As Figure 2 shows, the PasswordRecovery control displays a message indicating that the user information could not be accessed.</span></span> <span data-ttu-id="2f8d3-171">Text zprávy lze přizpůsobit prostřednictvím ovládacího prvku [ `UserNameFailureText` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-171">The text of the message can be customized through the control's [`UserNameFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span></span>


<span data-ttu-id="2f8d3-172">[![Pokud je zadáno neplatné uživatelské jméno se zobrazí chybová zpráva](recovering-and-changing-passwords-cs/_static/image5.png)](recovering-and-changing-passwords-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-172">[![An Error Message is Displayed if an Invalid Username is Entered](recovering-and-changing-passwords-cs/_static/image5.png)](recovering-and-changing-passwords-cs/_static/image4.png)</span></span>

<span data-ttu-id="2f8d3-173">**Obrázek 2**: chybová zpráva se zobrazí, pokud je zadáno neplatné uživatelské jméno ([Kliknutím zobrazit obrázek v plné velikosti](recovering-and-changing-passwords-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="2f8d3-173">**Figure 2**: An Error Message is Displayed if an Invalid Username is Entered  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image6.png))</span></span>


<span data-ttu-id="2f8d3-174">Nyní zadejte uživatelské jméno.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-174">Now enter a username.</span></span> <span data-ttu-id="2f8d3-175">Použití uživatelské jméno účtu v systému s e-mailovou adresu, můžete přístup a jejichž zabezpečení zodpovědět vám vědět.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-175">Use the username of an account in the system with an email address that you can access and whose security answer you know.</span></span> <span data-ttu-id="2f8d3-176">Po zadání uživatelského jména a kliknutí na tlačítko Odeslat, zobrazí ovládací prvek PasswordRecovery jeho zobrazení otázku.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-176">After entering the username and clicking Submit, the PasswordRecovery control displays its Question view.</span></span> <span data-ttu-id="2f8d3-177">Jako s zobrazení uživatelské jméno, pokud zadáte nesprávné odpovězte PasswordRecovery ovládací prvek zobrazí chybové zprávy (viz obrázek 3).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-177">As with the UserName view, if you enter an incorrect answer the PasswordRecovery control displays an error message (see Figure 3).</span></span> <span data-ttu-id="2f8d3-178">Použití [ `QuestionFailureText` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) přizpůsobit tato chybová zpráva.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-178">Use the [`QuestionFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) to customize this error message.</span></span>


<span data-ttu-id="2f8d3-179">[![Pokud uživatel zadá neplatná odpověď zabezpečení, zobrazí se chybová zpráva](recovering-and-changing-passwords-cs/_static/image8.png)](recovering-and-changing-passwords-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-179">[![An Error Message is Displayed if the User Enters an Invalid Security Answer](recovering-and-changing-passwords-cs/_static/image8.png)](recovering-and-changing-passwords-cs/_static/image7.png)</span></span>

<span data-ttu-id="2f8d3-180">**Obrázek 3**: chybová zpráva se zobrazí, pokud uživatel zadá neplatná odpověď zabezpečení ([Kliknutím zobrazit obrázek v plné velikosti](recovering-and-changing-passwords-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="2f8d3-180">**Figure 3**: An Error Message is Displayed if the User Enters an Invalid Security Answer  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image9.png))</span></span>


<span data-ttu-id="2f8d3-181">Nakonec zadejte správné zabezpečení odpovědí a klikněte na tlačítko Odeslat.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-181">Finally, enter the correct security answer and click Submit.</span></span> <span data-ttu-id="2f8d3-182">Na pozadí ovládacího prvku PasswordRecovery generuje náhodné heslo, přiřadí k uživatelskému účtu, odešle e-mail informující uživatele své nové heslo (viz obrázek 4) a potom zobrazí zobrazení informací o úspěchu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-182">Behind the scenes, the PasswordRecovery control generates a random password, assigns it to the user account, sends an email informing the user of their new password (see Figure 4), and then displays the Success view.</span></span>


<span data-ttu-id="2f8d3-183">[![Uživatel je odeslán E-mail s His nové heslo](recovering-and-changing-passwords-cs/_static/image11.png)](recovering-and-changing-passwords-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-183">[![The User is Sent an Email with His New Password](recovering-and-changing-passwords-cs/_static/image11.png)](recovering-and-changing-passwords-cs/_static/image10.png)</span></span>

<span data-ttu-id="2f8d3-184">**Obrázek 4**: uživatele je odeslán E-mail s His nové heslo ([Kliknutím zobrazit obrázek v plné velikosti](recovering-and-changing-passwords-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="2f8d3-184">**Figure 4**: The User is Sent an Email with His New Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image12.png))</span></span>


### <a name="customizing-the-email"></a><span data-ttu-id="2f8d3-185">Přizpůsobení e-mailu</span><span class="sxs-lookup"><span data-stu-id="2f8d3-185">Customizing the Email</span></span>

<span data-ttu-id="2f8d3-186">Výchozí e-mailu pomocí ovládacího prvku PasswordRecovery je spíš matné (viz obrázek 4).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-186">The default email sent by the PasswordRecovery control is rather dull (see Figure 4).</span></span> <span data-ttu-id="2f8d3-187">Je zpráva odeslána z účet zadaný v `<smtp>` elementu `from` atribut s předmětem heslo a text ve formátu prostého textu:</span><span class="sxs-lookup"><span data-stu-id="2f8d3-187">The message is sent from the account specified in the `<smtp>` element's `from` attribute with the subject Password and the plain-text body:</span></span>

<span data-ttu-id="2f8d3-188">Vraťte se k webu a přihlaste se pomocí následujících informací.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-188">Please return to the site and log in using the following information.</span></span>

<span data-ttu-id="2f8d3-189">Uživatelské jméno: *uživatelské jméno*</span><span class="sxs-lookup"><span data-stu-id="2f8d3-189">User Name: *username*</span></span>

<span data-ttu-id="2f8d3-190">Heslo: *heslo*</span><span class="sxs-lookup"><span data-stu-id="2f8d3-190">Password: *password*</span></span>

<span data-ttu-id="2f8d3-191">Tuto zprávu lze přizpůsobit prostřednictvím kódu programu prostřednictvím obslužné rutiny události pro ovládací prvek PasswordRecovery [ `SendingMail` událostí](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), nebo deklarativně pomocí [ `MailDefinition` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-191">This message can be customized programmatically through an event handler for the PasswordRecovery control's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), or declaratively through the [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span></span> <span data-ttu-id="2f8d3-192">Podíváme se na obě tyto možnosti.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-192">Let's explore both of these options.</span></span>

<span data-ttu-id="2f8d3-193">`SendingMail` Událost je aktivována například právo předtím, než se odesílají e-mailové zprávy a je naše poslední možnost, aby prostřednictvím kódu programu upravit e-mailové zprávy.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-193">The `SendingMail` event is fired right before the email message is sent and is our last chance to programmatically adjust the email message.</span></span> <span data-ttu-id="2f8d3-194">Pokud tato událost je aktivována, obslužné rutiny události je předán objekt typu [ `MailMessageEventArgs` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), jejichž `Message` vlastnost obsahuje odkaz na e-mailu odeslány.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-194">When this event is raised, the event handler is passed an object of type [`MailMessageEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), whose `Message` property contains a reference to the email about to be sent.</span></span>

<span data-ttu-id="2f8d3-195">Vytvoření obslužné rutiny událostí `SendingMail` událostí a přidejte následující kód, který přidá prostřednictvím kódu programu `webmaster@example.com` do seznamu kopie.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-195">Create an event handler for the `SendingMail` event and add the following code, which programmatically adds `webmaster@example.com` to the CC list.</span></span>

[!code-csharp[Main](recovering-and-changing-passwords-cs/samples/sample2.cs)]

<span data-ttu-id="2f8d3-196">E-mailové zprávě můžete nakonfigurovat taky přes deklarativní způsobem.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-196">The email message can also be configured through declarative means.</span></span> <span data-ttu-id="2f8d3-197">PasswordRecovery `MailDefinition` vlastnost je objekt typu [ `MailDefinition` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-197">The PasswordRecovery's `MailDefinition` property is an object of type [`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx).</span></span> <span data-ttu-id="2f8d3-198">`MailDefinition` Třída nabízí hostitel vlastnosti související s e-mailu, včetně `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`a další.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-198">The `MailDefinition` class offers a host of email-related properties, including `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`, and others.</span></span> <span data-ttu-id="2f8d3-199">Pro začátek se nastavit [ `Subject` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx) něco srozumitelnější než ten, který je ve výchozím nastavení (heslo), používá, jako je vaše heslo bylo resetováno...</span><span class="sxs-lookup"><span data-stu-id="2f8d3-199">For starters, set the [`Subject` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx) to something more descriptive than the one used by default ( Password ), such as Your password has been reset...</span></span>

<span data-ttu-id="2f8d3-200">Chcete-li přizpůsobit text e-mailovou zprávu, kterou je potřeba vytvořit soubor samostatné e-mailové šablony, která obsahuje obsah textu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-200">To customize the body of the email message we need to create a separate email template file that contains the body's contents.</span></span> <span data-ttu-id="2f8d3-201">Začněte vytvořením novou složku na webu s názvem `EmailTemplates`.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-201">Start by creating a new folder in the website named `EmailTemplates`.</span></span> <span data-ttu-id="2f8d3-202">Dál přidejte nový textový soubor do této složky s názvem `PasswordRecovery.txt` a přidejte následující obsah:</span><span class="sxs-lookup"><span data-stu-id="2f8d3-202">Next, add a new text file to this folder named `PasswordRecovery.txt` and add the following content:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample3.aspx)]

<span data-ttu-id="2f8d3-203">Všimněte si použití zástupné symboly `<%UserName%>` a `<%Password%>`.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-203">Note the use of the placeholders `<%UserName%>` and `<%Password%>`.</span></span> <span data-ttu-id="2f8d3-204">Ovládací prvek PasswordRecovery automaticky uživatelské jméno a heslo obnovené před odesláním e-mailu uživatele nahradí tyto dva zástupné znaky.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-204">The PasswordRecovery control automatically replaces these two placeholders with the user's username and recovered password prior to sending the email.</span></span>

<span data-ttu-id="2f8d3-205">A konečně, přejděte `MailDefinition`na [ `BodyFileName` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) k e-mailovou šablonu, kterou jsme právě vytvořili (`~/EmailTemplates/PasswordRecovery.txt`).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-205">Lastly, point the `MailDefinition`'s [`BodyFileName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) to the email template we just created (`~/EmailTemplates/PasswordRecovery.txt`).</span></span>

<span data-ttu-id="2f8d3-206">Po provedení těchto změn pokroku `RecoverPassword.aspx` stránky a zadejte vaše uživatelské jméno a zabezpečení odpovědí.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-206">After making these changes revisit the `RecoverPassword.aspx` page and enter your username and security answer.</span></span> <span data-ttu-id="2f8d3-207">Obdržíte e-mailu, který vypadá jako jeden z obrázku 5, by měl.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-207">You receive should an email that looks like the one in Figure 5.</span></span> <span data-ttu-id="2f8d3-208">Všimněte si, že `webmaster@example.com` bylo by kopie a zda byly aktualizovány předmět a text.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-208">Note that `webmaster@example.com` has been CC'd and that the subject and body have been updated.</span></span>


<span data-ttu-id="2f8d3-209">[![Byly aktualizovány předmět, text a seznamu kopie](recovering-and-changing-passwords-cs/_static/image14.png)](recovering-and-changing-passwords-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-209">[![The Subject, Body, and CC List Have Been Updated](recovering-and-changing-passwords-cs/_static/image14.png)](recovering-and-changing-passwords-cs/_static/image13.png)</span></span>

<span data-ttu-id="2f8d3-210">**Obrázek 5**: předmětu, textu a byly aktualizovány kopie seznamu ([Kliknutím zobrazit obrázek v plné velikosti](recovering-and-changing-passwords-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="2f8d3-210">**Figure 5**: The Subject, Body, and CC List Have Been Updated  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image15.png))</span></span>


<span data-ttu-id="2f8d3-211">Odeslat e-mail ve formátu HTML nastavit [ `IsBodyHtml` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) na hodnotu True (výchozí hodnota je False) a aktualizace šablony e-mailu, zahrnout HTML.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-211">To send an HTML-formatted email set [`IsBodyHtml`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) to True (the default is False) and update the email template to include HTML.</span></span>

<span data-ttu-id="2f8d3-212">`MailDefinition` Vlastnost není pro třídu PasswordRecovery jedinečné.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-212">The `MailDefinition` property is not unique to the PasswordRecovery class.</span></span> <span data-ttu-id="2f8d3-213">Jak jsme uvidí v kroku 2, změna hesla byla ovládací prvek také nabízí `MailDefinition` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-213">As we will see in Step 2, the ChangePassword control also offers a `MailDefinition` property.</span></span> <span data-ttu-id="2f8d3-214">Kromě toho zahrnuje ovládacího prvku CreateUserWizard taková vlastnost lze nastavit automaticky odeslat zprávu Uvítacího e-mailu pro nové uživatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-214">Moreover, the CreateUserWizard control includes such a property that you can configure to automatically send a welcome email message to new users.</span></span>

> [!NOTE]
> <span data-ttu-id="2f8d3-215">Aktuálně neexistují žádné odkazy v levém navigačním panelu pro dosažení `RecoverPassword.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-215">Currently there are no links in the left-hand navigation for reaching the `RecoverPassword.aspx` page.</span></span> <span data-ttu-id="2f8d3-216">Uživatel by zájmu pouze v návštěvě této stránky, pokud uživatel se nepodařilo úspěšně Přihlaste se k webu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-216">A user would only be interested in visiting this page if she was unable to successfully log on to the site.</span></span> <span data-ttu-id="2f8d3-217">Proto aktualizovat `Login.aspx` stránky zahrnout odkaz `RecoverPassword.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-217">Therefore, update the `Login.aspx` page to include a link to the `RecoverPassword.aspx` page.</span></span>


### <a name="programmatically-resetting-a-users-password"></a><span data-ttu-id="2f8d3-218">Prostřednictvím kódu programu resetuje heslo uživatele</span><span class="sxs-lookup"><span data-stu-id="2f8d3-218">Programmatically Resetting a User's Password</span></span>

<span data-ttu-id="2f8d3-219">Při resetování hesla uživatele PasswordRecovery řízení volání `MembershipUser` objektu [ `ResetPassword` metoda](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-219">When resetting a user's password the PasswordRecovery control calls the `MembershipUser` object's [`ResetPassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx).</span></span> <span data-ttu-id="2f8d3-220">Tato metoda má dva přetížení:</span><span class="sxs-lookup"><span data-stu-id="2f8d3-220">This method has two overloads:</span></span>

- <span data-ttu-id="2f8d3-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** -Resetuje heslo uživatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** - resets a user's password.</span></span> <span data-ttu-id="2f8d3-222">Toto přetížení použijte, pokud `RequiresQuestionAndAnswer` je False.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-222">Use this overload if `RequiresQuestionAndAnswer` is False.</span></span>
- <span data-ttu-id="2f8d3-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** -Obnoví jenom Pokud heslo uživatele zadaných *securityAnswer* je správný.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** - resets a user's password only if the supplied *securityAnswer* is correct.</span></span> <span data-ttu-id="2f8d3-224">Toto přetížení použijte, pokud `RequiresQuestionAndAnswer` má hodnotu True.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-224">Use this overload if `RequiresQuestionAndAnswer` is True.</span></span>

<span data-ttu-id="2f8d3-225">Obě přetížení vrátí nové, náhodně vygenerované heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-225">Both overloads return the new, randomly-generated password.</span></span>

<span data-ttu-id="2f8d3-226">S jinými metodami v rozhraní framework členství, jako `ResetPassword` metoda delegátů k nakonfigurovaného zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-226">Like with the other methods in the Membership framework, the `ResetPassword` method delegates to the configured provider.</span></span> <span data-ttu-id="2f8d3-227">`SqlMembershipProvider` Vyvolá `aspnet_Membership_ResetPassword` předávání uložené procedury, uživatelské jméno, nové heslo a odpověď zadané heslo, mezi další pole.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-227">The `SqlMembershipProvider` invokes the `aspnet_Membership_ResetPassword` stored procedure, passing in the user's username, the new password, and the supplied password answer, among other fields.</span></span> <span data-ttu-id="2f8d3-228">Uložená procedura zajišťuje, že odpověď hesla odpovídá a pak aktualizuje heslo uživatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-228">The stored procedure ensures that the password answer matches and then updates the user's password.</span></span>

<span data-ttu-id="2f8d3-229">Několik poznámky k implementaci nižší úrovně:</span><span class="sxs-lookup"><span data-stu-id="2f8d3-229">A couple of low-level implementation notes:</span></span>

- <span data-ttu-id="2f8d3-230">Neuzamčení uživatele nelze resetovat svoje heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-230">A locked out user cannot reset her password.</span></span> <span data-ttu-id="2f8d3-231">Však může neschválených uživatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-231">However, an unapproved user may.</span></span> <span data-ttu-id="2f8d3-232">Jsme se zabývat uzamčené a schválení stavů v podrobněji <a id="_msoanchor_3"> </a> [ *Unlocking a schválení uživatelem* ](unlocking-and-approving-user-accounts-cs.md) kurzu účty.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-232">We will discuss the locked out and approved states in more detail in the <a id="_msoanchor_3"></a>[*Unlocking and Approving User*](unlocking-and-approving-user-accounts-cs.md) Accounts tutorial.</span></span>
- <span data-ttu-id="2f8d3-233">Pokud odpověď pro heslo je nesprávné, se zvýší počet pokusů o odpověď hesla se nezdařila uživatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-233">If the password answer is incorrect, the user's failed password answer attempt count is incremented.</span></span> <span data-ttu-id="2f8d3-234">Dojde-li zadaný počet pokusů o zabezpečení neplatná odpověď v rámci určeného časového období, uživatel je uzamčen.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-234">If a specified number of invalid security answer attempts occur within a specified time window, the user is locked out.</span></span>

### <a name="a-word-on-how-the-random-passwords-are-generated"></a><span data-ttu-id="2f8d3-235">Word na tom, jak náhodných hesla jsou generovány.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-235">A Word on How the Random Passwords are Generated</span></span>

<span data-ttu-id="2f8d3-236">Náhodně generovaný hesla v e-mailové zprávy v útvarů 4 a 5 jsou vytvořené pomocí třídy členství [ `GeneratePassword` metoda](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-236">The randomly-generated passwords shown in the email messages in Figures 4 and 5 are created by the Membership class's [`GeneratePassword` method](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx).</span></span> <span data-ttu-id="2f8d3-237">Tato metoda přijímá dva vstupní datového celé číslo - *délka* a *numberOfNonAlphanumericCharacters* - a vrátí řetězec alespoň *délka* znaků dlouhé a obsahují v nejméně *numberOfNonAlphanumericCharacters* počet jiných než alfanumerických znaků.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-237">This method accepts two integer input paramters - *length* and *numberOfNonAlphanumericCharacters* - and returns a string at least *length* characters long with at least *numberOfNonAlphanumericCharacters* number of non-alphanumeric characters.</span></span> <span data-ttu-id="2f8d3-238">Když tato metoda je volána z v rámci třídy členství nebo ovládací prvky webového související s přihlášením, hodnoty pro tyto dva parametry jsou určeny konfigurace členství `MinRequiredPasswordLength` a `MinRequiredNonalphanumericCharacters` vlastnosti, které se nastaví na 7 a 1, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-238">When this method is called from within the Membership classes or Login-related Web controls, the values for these two parameters are determined by the Membership configuration's `MinRequiredPasswordLength` and `MinRequiredNonalphanumericCharacters` properties, which we set to 7 and 1, respectively.</span></span>

<span data-ttu-id="2f8d3-239">`GeneratePassword` Metoda používá k zajištění, že je v jaké náhodných znaků nejsou vybrány žádné odchylka kryptograficky silnou generátoru náhodných čísel.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-239">The `GeneratePassword` method uses a cryptographically strong random number generator to ensure that there is no bias in what random characters are selected.</span></span> <span data-ttu-id="2f8d3-240">Kromě toho `GeneratePassword` je `public`, což znamená, můžete ho přímo z vaší aplikace ASP.NET Pokud je potřeba generovat řetězců náhodných nebo hesla.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-240">Furthermore, `GeneratePassword` is `public`, meaning that you can use it directly from your ASP.NET application if you need to generate random strings or passwords.</span></span>

> [!NOTE]
> <span data-ttu-id="2f8d3-241">`SqlMembershipProvider` Třída vždy vygeneruje náhodné heslo aspoň 14 znaků, takže když `MinRequiredPasswordLength` je menší než 14 a její hodnota je ignorována.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-241">The `SqlMembershipProvider` class always generates a random password at least 14 characters long, so if `MinRequiredPasswordLength` is less than 14 then its value is ignored.</span></span>


## <a name="step-2-changing-passwords"></a><span data-ttu-id="2f8d3-242">Krok 2: Změna hesla</span><span class="sxs-lookup"><span data-stu-id="2f8d3-242">Step 2: Changing Passwords</span></span>

<span data-ttu-id="2f8d3-243">Hesla náhodně generované obtížně mějte na paměti.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-243">The randomly-generated passwords are difficult to remember.</span></span> <span data-ttu-id="2f8d3-244">Vezměte v úvahu heslo ukazuje obrázek 4: `WWGUZv(f2yM:Bd`.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-244">Consider the password shown in Figure 4: `WWGUZv(f2yM:Bd`.</span></span> <span data-ttu-id="2f8d3-245">Akci, která potvrzení paměti!</span><span class="sxs-lookup"><span data-stu-id="2f8d3-245">Try committing that to memory!</span></span> <span data-ttu-id="2f8d3-246">Needless znamená po odeslání náhodně vygenerované heslo tohoto uživatele se budete chtít změnit heslo zapamatovatelný.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-246">Needless to say, after a user is sent a randomly-generated password of this sort, she'll want to change the password to something more memorable.</span></span>

<span data-ttu-id="2f8d3-247">Použití ovládacího prvku Změna hesla byla k vytvoření rozhraní pro uživatele Chcete-li změnit své heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-247">Use the ChangePassword control to create an interface for a user to change her password.</span></span> <span data-ttu-id="2f8d3-248">Mnohem jako prvek PasswordRecovery ovládacího prvku Změna hesla byla se skládá ze dvou zobrazení: Změna hesla a úspěch.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-248">Much like the PasswordRecovery control, the ChangePassword control consists of two views: Change Password and Success.</span></span> <span data-ttu-id="2f8d3-249">Zobrazení změnit heslo vyzve uživatele k jejich staré a nové heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-249">The Change Password view prompts the user for their old and new passwords.</span></span> <span data-ttu-id="2f8d3-250">Při zadávání správné staré heslo a nové heslo, které splňuje minimální délku a požadavky na jiných než alfanumerických znaků, ovládacího prvku Změna hesla byla aktualizace hesla a zobrazení úspěch.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-250">Upon supplying the correct old password and a new password that meets the minimum length and non-alphanumeric character requirements, the ChangePassword control updates the user's password and displays the Success view.</span></span>

> [!NOTE]
> <span data-ttu-id="2f8d3-251">Změna hesla byla řízení změní heslo uživatele vyvoláním `MembershipUser` objektu [ `ChangePassword` metoda](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-251">The ChangePassword control modifies the user's password by invoking the `MembershipUser` object's [`ChangePassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx).</span></span> <span data-ttu-id="2f8d3-252">Změna hesla byla metoda přijímá dva `string` vstupní parametry - *Původní_heslo* a *nové_heslo*- a aktualizuje uživatelský účet s *nové_heslo*, za předpokladu, že zadaných *Původní_heslo* je správný.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-252">The ChangePassword method accepts two `string` input parameters - *oldPassword* and *newPassword*- and updates the user's account with the *newPassword*, assuming the supplied *oldPassword* is correct.</span></span>


<span data-ttu-id="2f8d3-253">Otevřete `ChangePassword.aspx` stránky a přidání ovládacího prvku Změna hesla byla na stránku pojmenování ho `ChangePwd`.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-253">Open the `ChangePassword.aspx` page and add a ChangePassword control to the page, naming it `ChangePwd`.</span></span> <span data-ttu-id="2f8d3-254">V tomto okamžiku by měl zobrazení návrhu zobrazení změnit heslo zobrazení (viz obrázek 6).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-254">At this point, the Design view should show the Change Password view (see Figure 6).</span></span> <span data-ttu-id="2f8d3-255">Jako pomocí ovládacího prvku PasswordRecovery můžete přepínat mezi zobrazeními pomocí inteligentních značek ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-255">Like with the PasswordRecovery control, you can toggle between the views via the control's Smart Tag.</span></span> <span data-ttu-id="2f8d3-256">Kromě toho tato zobrazení objevuje se přizpůsobitelné prostřednictvím vlastnosti různé stylu nebo převedením na šablonu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-256">Furthermore, these views' appearances are customizable through the assorted style properties or by converting them to a template.</span></span>


<span data-ttu-id="2f8d3-257">[![Přidání ovládacího prvku Změna hesla byla na stránku](recovering-and-changing-passwords-cs/_static/image17.png)](recovering-and-changing-passwords-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-257">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-cs/_static/image17.png)](recovering-and-changing-passwords-cs/_static/image16.png)</span></span>

<span data-ttu-id="2f8d3-258">**Obrázek 6**: Přidání ovládacího prvku Změna hesla byla na stránku ([Kliknutím zobrazit obrázek v plné velikosti](recovering-and-changing-passwords-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="2f8d3-258">**Figure 6**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image18.png))</span></span>


<span data-ttu-id="2f8d3-259">Změna hesla byla řízení můžete aktualizovat heslo aktuálně přihlášeného uživatele *nebo* hesla jiný, zadaného uživatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-259">The ChangePassword control can update the currently logged in user's password *or* the password of another, specified user.</span></span> <span data-ttu-id="2f8d3-260">Jak je vidět na obrázku 6, výchozí zobrazení změnit heslo vykreslí jenom tři ovládacích prvcích TextBox: jeden pro staré heslo a dva jsou pro nové heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-260">As Figure 6 shows, the default Change Password view renders just three TextBox controls: one for the old password and two for the new password.</span></span> <span data-ttu-id="2f8d3-261">Toto rozhraní výchozí se používá k aktualizaci hesla aktuálně přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-261">This default interface is used to update the currently logged on user's password.</span></span>

<span data-ttu-id="2f8d3-262">Použití ovládacího prvku Změna hesla byla aktualizace hesla jiného uživatele, nastavte ovládacího prvku [ `DisplayUserName` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) na hodnotu True.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-262">To use the ChangePassword control to update another user's password, set the control's [`DisplayUserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) to True.</span></span> <span data-ttu-id="2f8d3-263">Díky tomu přidá čtvrtý textové pole na stránku, dotaz na uživatelské jméno uživatele, jehož heslo chcete změnit.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-263">Doing so adds a fourth TextBox to the page, prompting for the username of the user whose password to change.</span></span>

<span data-ttu-id="2f8d3-264">Nastavení `DisplayUserName` na True je užitečné, pokud chcete, aby mohl zaznamenané si uživatel změnit svoje heslo bez nutnosti k přihlášení.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-264">Setting `DisplayUserName` to True is useful if you want to let a logged out user change her password without having to log in.</span></span> <span data-ttu-id="2f8d3-265">Osobně je pravděpodobné, že není nic se nutnosti uživateli přihlášení před povolením jí chcete-li změnit své heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-265">Personally, I think there's nothing wrong with requiring a user to login before allowing her to change her password.</span></span> <span data-ttu-id="2f8d3-266">Proto nechte `DisplayUserName` nastavena na hodnotu False (výchozí).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-266">Therefore, leave `DisplayUserName` set to False (its default).</span></span> <span data-ttu-id="2f8d3-267">Při vytvoření toto rozhodnutí, ale jsme v podstatě se blokování anonymní uživatelé z dosažení této stránky.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-267">In making this decision, however, we essentially are barring anonymous users from reaching this page.</span></span> <span data-ttu-id="2f8d3-268">Aktualizovat autorizačních pravidel adres URL lokality tak, aby anonymní uživatelé z navštívíte Odepřít `ChangePassword.aspx`.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-268">Update the site's URL authorization rules so as to deny anonymous users from visiting `ChangePassword.aspx`.</span></span> <span data-ttu-id="2f8d3-269">Pokud bude nutné aktualizovat vaše paměti v syntaxi adresy URL autorizační pravidlo, přečtěte si téma zpět <a id="_msoanchor_4"> </a> [ *autorizace na základě uživatele* ](../membership/user-based-authorization-cs.md) kurzu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-269">If you need to refresh your memory on the URL authorization rule syntax, refer back to the <a id="_msoanchor_4"></a>[*User-Based Authorization*](../membership/user-based-authorization-cs.md) tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="2f8d3-270">To nemusí připadat, který `DisplayUserName` vlastnost je užitečná pro umožňují tak správcům změnu hesla jiných uživatelů.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-270">It may seem that the `DisplayUserName` property is useful for allowing administrators to change other users' passwords.</span></span> <span data-ttu-id="2f8d3-271">Ale i v případě `DisplayUserName` nastaven na hodnotu True, musí být známé a zadali správné staré heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-271">However, even when `DisplayUserName` is set to True the correct old password must be known and entered.</span></span> <span data-ttu-id="2f8d3-272">Se věnuje techniky pro umožňují tak správcům změnit hesla uživatelů ke službám v kroku 3.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-272">We will talk about techniques for allowing administrators to change users' passwords in Step 3.</span></span>


<span data-ttu-id="2f8d3-273">Přejděte `ChangePassword.aspx` stránky prostřednictvím prohlížeče a změňte si heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-273">Visit the `ChangePassword.aspx` page through a browser and change your password.</span></span> <span data-ttu-id="2f8d3-274">Všimněte si, že pokud zadáte nové heslo, které nesplňuje délku hesla a požadavky na jiných než alfanumerických znaků zadaný v konfiguraci členství, zobrazí se chybová zpráva (viz obrázek 7).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-274">Note that an error message is displayed if you enter a new password that fails to meet the password length and non-alphanumeric character requirements specified in the Membership configuration (see Figure 7).</span></span>


<span data-ttu-id="2f8d3-275">[![Přidání ovládacího prvku Změna hesla byla na stránku](recovering-and-changing-passwords-cs/_static/image20.png)](recovering-and-changing-passwords-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-275">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-cs/_static/image20.png)](recovering-and-changing-passwords-cs/_static/image19.png)</span></span>

<span data-ttu-id="2f8d3-276">**Obrázek 7**: Přidání ovládacího prvku Změna hesla byla na stránku ([Kliknutím zobrazit obrázek v plné velikosti](recovering-and-changing-passwords-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="2f8d3-276">**Figure 7**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image21.png))</span></span>


<span data-ttu-id="2f8d3-277">Po zadání správné staré heslo a platný nové heslo, přihlášeného na uživatele změnit heslo a zobrazí úspěch.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-277">Upon entering the correct old password and a valid new password, the logged on user's password is changed and the Success view displayed.</span></span>

### <a name="sending-a-confirmation-email"></a><span data-ttu-id="2f8d3-278">Odesílání e-mailu s potvrzením</span><span class="sxs-lookup"><span data-stu-id="2f8d3-278">Sending a Confirmation Email</span></span>

<span data-ttu-id="2f8d3-279">Ve výchozím nastavení Změna hesla byla řízení neodešle e-mailovou zprávu uživatele, jejichž hesla byla právě aktualizována.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-279">By default, the ChangePassword control does not send an email message to the user whose password was just updated.</span></span> <span data-ttu-id="2f8d3-280">Pokud chcete odeslat e-mail, jednoduše nakonfigurovat ovládacího prvku `MailDefinition` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-280">If you'd like to send an email, simply configure the control's `MailDefinition` property.</span></span> <span data-ttu-id="2f8d3-281">Umožňuje nakonfigurovat Změna hesla byla ovládacího prvku tak, aby uživatel je odeslán e-mail ve formátu HTML, který obsahuje své nové heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-281">Let's configure the ChangePassword control so that the user is sent an HTML-formatted email that contains their new password.</span></span>

<span data-ttu-id="2f8d3-282">Začněte vytvořením nového souboru v `EmailTemplates` složku s názvem `ChangePassword.htm`.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-282">Start by creating a new file in the `EmailTemplates` folder named `ChangePassword.htm`.</span></span> <span data-ttu-id="2f8d3-283">Přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="2f8d3-283">Add the following markup:</span></span>

[!code-html[Main](recovering-and-changing-passwords-cs/samples/sample4.html)]

<span data-ttu-id="2f8d3-284">Dále nastavte Změna hesla byla ovládacího prvku `MailDefinition` vlastnosti `BodyFileName`, `IsBodyHtml`, a `Subject` vlastnosti, které chcete ~ / EmailTemplates/ChangePassword.htm, True a heslo změnil!, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-284">Next, set the ChangePassword control's `MailDefinition` property's `BodyFileName`, `IsBodyHtml`, and `Subject` properties to ~/EmailTemplates/ChangePassword.htm, True, and Your password has changed!, respectively.</span></span>

<span data-ttu-id="2f8d3-285">Po provedení těchto změn, otevírat stránku a změňte si heslo znovu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-285">After making these changes, revisit the page and change your password again.</span></span> <span data-ttu-id="2f8d3-286">Tentokrát ovládací prvek Změna hesla byla odešle přizpůsobené, ve formátu HTML e-mailu na e-mailovou adresu uživatele v souboru (viz obrázek 8).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-286">This time, the ChangePassword control sends a customized, HTML-formatted email to the user's email address on file (see Figure 8).</span></span>


<span data-ttu-id="2f8d3-287">[![E-mailová zpráva s informací, že jejich heslo uživatele byl změněn](recovering-and-changing-passwords-cs/_static/image23.png)](recovering-and-changing-passwords-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-287">[![An Email Message Informs the User That Their Password has Changed](recovering-and-changing-passwords-cs/_static/image23.png)](recovering-and-changing-passwords-cs/_static/image22.png)</span></span>

<span data-ttu-id="2f8d3-288">**Obrázek 8**: e-mailová zpráva s informací, že jejich heslo uživatele změnil ([Kliknutím zobrazit obrázek v plné velikosti](recovering-and-changing-passwords-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="2f8d3-288">**Figure 8**: An Email Message Informs the User That Their Password has Changed  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image24.png))</span></span>


## <a name="step-3-allowing-administrators-to-change-users-passwords"></a><span data-ttu-id="2f8d3-289">Krok 3: Povolení správcům změnit hesla uživatelů</span><span class="sxs-lookup"><span data-stu-id="2f8d3-289">Step 3: Allowing Administrators to Change Users' Passwords</span></span>

<span data-ttu-id="2f8d3-290">Běžné funkce v aplikacích, které podporují uživatelské účty je schopnost správce o změnu hesla jiných uživatelů.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-290">A common feature in applications that support user accounts is the ability for an administrative user to change other users' passwords.</span></span> <span data-ttu-id="2f8d3-291">Někdy se tato funkce vyžaduje, protože systém nemá schopnost změny hesla pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-291">Sometimes this functionality is required because the system lacks the ability for users to change their own passwords.</span></span> <span data-ttu-id="2f8d3-292">V takovém případě by jedině uživatel obnovit zapomenuté heslo správce je přiřadit nové heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-292">In such a case, the only way for a user to recover their forgotten password would be for the administrator to assign them a new password.</span></span> <span data-ttu-id="2f8d3-293">S ovládacími prvky PasswordRecovery a změna hesla byla však administrativní uživatelé nemusí zaneprázdněných sami s změna hesel uživatelů, uživatelé mohou díky této sami.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-293">With the PasswordRecovery and ChangePassword controls, however, administrative users need not busy themselves with changing users' passwords, as users are capable of doing this themselves.</span></span>

<span data-ttu-id="2f8d3-294">Ale co když váš klient insists, že administrativní uživatelé by měli být moci změnit hesla jiných uživatelů?</span><span class="sxs-lookup"><span data-stu-id="2f8d3-294">But what if your client insists that administrative users should be able to change other users' passwords?</span></span> <span data-ttu-id="2f8d3-295">Bohužel přidání této funkce lze bit práce.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-295">Unfortunately, adding this functionality can be a bit of work.</span></span> <span data-ttu-id="2f8d3-296">Chcete-li změnit heslo uživatele, musí být poskytnuty staré a nové heslo `MembershipUser` objektu `ChangePassword` metoda, ale správce by neměl mít znát heslo uživatele, aby ji upravit.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-296">To change a user's password, both the old and new password must be supplied to the `MembershipUser` object's `ChangePassword` method, but an administrator shouldn't have to know a user's password in order to modify it.</span></span>

<span data-ttu-id="2f8d3-297">Jeden alternativní řešení, je nejprve obnovit heslo uživatele a pak ji změňte nové heslo pomocí kódu podobně jako tento:</span><span class="sxs-lookup"><span data-stu-id="2f8d3-297">One workaround is to first reset the user's password and then change it to the new password using code like the following:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample5.aspx)]

<span data-ttu-id="2f8d3-298">Tento kód začíná načítání informací o *uživatelské jméno*, což je uživatele, jehož heslo správce chce změnit.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-298">This code starts by retrieving information about *username*, which is the user whose password the administrator wishes to change.</span></span> <span data-ttu-id="2f8d3-299">Dále `ResetPassword` metoda je volána, který přiřazuje a nové, náhodné heslo uživatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-299">Next, the `ResetPassword` method is invoked, which assigns and the user a new, random password.</span></span> <span data-ttu-id="2f8d3-300">Toto náhodně vygenerované heslo je vrácená metodou a uložené v proměnné `resetPwd`.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-300">This randomly-generated password is returned by the method and stored in the variable `resetPwd`.</span></span> <span data-ttu-id="2f8d3-301">Teď, když budeme vědět, za který uživatelské heslo, můžeme ho změnit prostřednictvím volání `ChangePassword`.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-301">Now that we know the user's password, we can change it via a call to `ChangePassword`.</span></span>

<span data-ttu-id="2f8d3-302">Problém je, že tento kód funguje jenom v případě konfigurace systému členství je nastaven tak, aby `RequiresQuestionAndAnswer` je False.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-302">The problem is that this code only works if the Membership system configuration is set such that `RequiresQuestionAndAnswer` is False.</span></span> <span data-ttu-id="2f8d3-303">Pokud `RequiresQuestionAndAnswer` má hodnotu True, jako je v naší aplikaci, pak se `ResetPassword` metoda musí být předán bezpečnostní otázce, jinak vyvolá výjimku.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-303">If `RequiresQuestionAndAnswer` is True, as it is with our application, then the `ResetPassword` method needs to be passed the security answer, otherwise it will throw an exception.</span></span>

<span data-ttu-id="2f8d3-304">Pokud rozhraní členství je nakonfigurován tak, aby vyžadovala bezpečnostní otázku a odpověď, a ještě vašeho klienta insists, aby správci mohli změnit hesla uživatelů ke službám, máte tři možnosti:</span><span class="sxs-lookup"><span data-stu-id="2f8d3-304">If the Membership framework is configured to require a security question and answer, and yet your client insists that administrators be able to change users' passwords, you have three options:</span></span>

- <span data-ttu-id="2f8d3-305">Throw rukou v vzduchem a váš klient říct, že toto je pouze jeden z věcí, které nelze provést.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-305">Throw your hands in the air and tell your client that this is just one thing that cannot be done.</span></span>
- <span data-ttu-id="2f8d3-306">Nastavit `RequiresQuestionAndAnswer` má hodnotu False.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-306">Set `RequiresQuestionAndAnswer` to False.</span></span> <span data-ttu-id="2f8d3-307">Výsledkem je méně zabezpečené aplikace.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-307">This results in a less secure application.</span></span> <span data-ttu-id="2f8d3-308">Představte si, že nefarious uživatel získal přístup k e-mailovou schránku jiného uživatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-308">Imagine that a nefarious user has gained access to another user's email inbox.</span></span> <span data-ttu-id="2f8d3-309">Možná ohroženými uživatelskými opustil svého stolu přejít na oběd a nebyla uzamčení pracovní stanici, nebo možná získat přístup k e-mailu z veřejného terminálu a nebylo odhlásit. V obou případech můžete navštívit nefarious uživatele `RecoverPassword.aspx` stránky a zadejte uživatelské jméno.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-309">Perhaps the compromised user has left their desk to go to lunch and didn't lock their workstation, or maybe they accessed their email from a public terminal and didn't sign out. In either case, the nefarious user can visit the `RecoverPassword.aspx` page and enter the user's username.</span></span> <span data-ttu-id="2f8d3-310">Systém se pak e-mailu obnovené heslo bez výzvy pro bezpečnostní otázce.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-310">The system will then email the recovered password without prompting for the security answer.</span></span>
- <span data-ttu-id="2f8d3-311">Nepoužívat abstraktní vrstvu vytvořené framework členství a pracovat přímo s databázi systému SQL Server.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-311">Bypass the abstraction layer created by the Membership framework and work directly with the SQL Server database.</span></span> <span data-ttu-id="2f8d3-312">Schéma členství zahrnuje uložené procedury s názvem `aspnet_Membership_SetPassword` , nastaví heslo uživatele a aby bylo možné úkolu nevyžaduje bezpečnostní otázce ani staré heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-312">The Membership schema includes a stored procedure named `aspnet_Membership_SetPassword` that sets a user's password and does not require the security answer or old password in order to accomplish its task.</span></span>

<span data-ttu-id="2f8d3-313">Žádnou z těchto možností jsou zvláště přitažlivé, ale který je, jak se někdy přejde vývojáře.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-313">None of these options are particularly appealing, but that's how the life of a developer goes sometimes.</span></span>

<span data-ttu-id="2f8d3-314">I se dopředu a implementovat třetí přístup psaní kódu, který obchází `Membership` a `MembershipUser` třídy a pracuje přímo na `SecurityTutorials` databáze.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-314">I went ahead and implemented the third approach, writing code that bypasses the `Membership` and `MembershipUser` classes and operates directly against the `SecurityTutorials` database.</span></span>

> [!NOTE]
> <span data-ttu-id="2f8d3-315">Pracovat přímo s databází, je shattered zapouzdření poskytované rozhraní členství.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-315">By working directly with the database, the encapsulation provided by the Membership framework is shattered.</span></span> <span data-ttu-id="2f8d3-316">Toto rozhodnutí sváže nám `SqlMembershipProvider`, provádění kódu méně přenositelností.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-316">This decision ties us to the `SqlMembershipProvider`, making our code less portable.</span></span> <span data-ttu-id="2f8d3-317">Kromě toho tento kód nemusí fungovat podle očekávání v budoucích verzích technologie ASP.NET, pokud se změní členství ve schématu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-317">Furthermore, this code may not work as expected in future versions of ASP.NET if the Membership schema changes.</span></span> <span data-ttu-id="2f8d3-318">Tento přístup je alternativní řešení, a jako většinu řešení není příkladem osvědčené postupy.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-318">This approach is a workaround and, like most workarounds, is not an example of best practices.</span></span>


<span data-ttu-id="2f8d3-319">Kód obsahuje některé body bits a je velmi náročná.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-319">The code has some unattractive bits and is quite lengthy.</span></span> <span data-ttu-id="2f8d3-320">Proto nechcete zbytečných souborů v tomto kurzu se hloubkové posouzení ho.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-320">Therefore, I don't want to clutter this tutorial with an in-depth examination of it.</span></span> <span data-ttu-id="2f8d3-321">Pokud vás zajímá v dalších informací, stáhněte si kód pro tento kurz a najdete `~/Administration/ManageUsers.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-321">If you are interested in learning more, download the code for this tutorial and visit the `~/Administration/ManageUsers.aspx` page.</span></span> <span data-ttu-id="2f8d3-322">Tuto stránku, kterou jsme vytvořili v <a id="_msoanchor_5"> </a> [předchozí kurzu](building-an-interface-to-select-one-user-account-from-many-cs.md), obsahuje seznam jednotlivých uživatelů.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-322">This page, which we created in the <a id="_msoanchor_5"></a>[preceding tutorial](building-an-interface-to-select-one-user-account-from-many-cs.md), lists each user.</span></span> <span data-ttu-id="2f8d3-323">Aktualizovali GridView zahrnout odkaz `UserInformation.aspx` stránky, předávání uživatelské jméno vybraného uživatele prostřednictvím řetězec dotazu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-323">I've updated the GridView to include a link to the `UserInformation.aspx` page, passing the selected user's username through the querystring.</span></span> <span data-ttu-id="2f8d3-324">`UserInformation.aspx` Stránky zobrazí informace o vybraný uživatel a textová pole pro změnu hesla (viz obrázek 9).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-324">The `UserInformation.aspx` page displays information about the selected user and TextBoxes for changing their password (see Figure 9).</span></span>

<span data-ttu-id="2f8d3-325">Po zadání nové heslo, potvrzení do textového pole druhý a kliknutím na tlačítko Aktualizovat uživatele, zpětné volání vyplývá a `aspnet_Membership_SetPassword` vyvolat uloženou proceduru aktualizace heslo uživatele.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-325">After entering the new password, confirming it in the second TextBox, and clicking the Update User Button, a postback ensues and the `aspnet_Membership_SetPassword` stored procedure is invoked, updating the user's password.</span></span> <span data-ttu-id="2f8d3-326">Doporučte I ty čtečky zájem o tuto funkci seznámení s kód a zkuste to rozšíření funkcí, které chcete zahrnout, odesílání e-mailu pro uživatele, jehož heslo bylo změněno.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-326">I encourage those readers interested in this functionality to become more familiar with the code and try extending the functionality to include sending an email to the user whose password was changed.</span></span>


<span data-ttu-id="2f8d3-327">[![Správce může změnit heslo uživatele](recovering-and-changing-passwords-cs/_static/image26.png)](recovering-and-changing-passwords-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-327">[![An Administrator May Change a User's Password](recovering-and-changing-passwords-cs/_static/image26.png)](recovering-and-changing-passwords-cs/_static/image25.png)</span></span>

<span data-ttu-id="2f8d3-328">**Obrázek 9**: Správce může změnit heslo uživatele ([Kliknutím zobrazit obrázek v plné velikosti](recovering-and-changing-passwords-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="2f8d3-328">**Figure 9**: An Administrator May Change a User's Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image27.png))</span></span>


> [!NOTE]
> <span data-ttu-id="2f8d3-329">`UserInformation.aspx` Stránce aktuálně funguje pouze, pokud rozhraní členství je nakonfigurovaná pro ukládání hesel ve formátu Clear nebo Hashed.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-329">The `UserInformation.aspx` page currently only works if the Membership framework is configured to store passwords in Clear or Hashed format.</span></span> <span data-ttu-id="2f8d3-330">Chybí však kód k šifrování nové heslo, i když se zobrazí pozvánka k přidat tuto funkci.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-330">It lacks the code to encrypt the new password, although you are invited to add this functionality.</span></span> <span data-ttu-id="2f8d3-331">Způsob I doporučujeme přidání nezbytného kódu je použití decompiler jako [Reflector](http://www.aisto.com/roeder/dotnet/) pro zjištění zdrojového kódu pro metody v rozhraní .NET Framework; spustit tak, že prověří `SqlMembershipProvider` třídy `ChangePassword` metoda.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-331">The way I recommend adding the necessary code is to use a decompiler like [Reflector](http://www.aisto.com/roeder/dotnet/) to examine the source code for methods in the .NET Framework; start by examining the `SqlMembershipProvider` class's `ChangePassword` method.</span></span> <span data-ttu-id="2f8d3-332">Toto je technika, který byl použit pro zápis kódu pro vytvoření hodnoty hash hesla.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-332">This is the technique I used to write the code for creating a hash of the password.</span></span>


## <a name="summary"></a><span data-ttu-id="2f8d3-333">Souhrn</span><span class="sxs-lookup"><span data-stu-id="2f8d3-333">Summary</span></span>

<span data-ttu-id="2f8d3-334">Technologie ASP.NET nabízí dvou ovládacích prvků, aby pomohla uživatelům spravovat své heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-334">ASP.NET offers two controls to help users manage their password.</span></span> <span data-ttu-id="2f8d3-335">Ovládací prvek PasswordRecovery je užitečné pro ty, kteří zapomenou své heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-335">The PasswordRecovery control is useful for those who have forgotten their passwords.</span></span> <span data-ttu-id="2f8d3-336">V závislosti na konfiguraci framework členství uživatel je buď e-mailem hesla pro existující nebo nové, náhodně vygenerované heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-336">Depending on the Membership framework's configuration, the user is either emailed their existing password or a new, randomly-generated password.</span></span> <span data-ttu-id="2f8d3-337">Změna hesla byla ovládací prvek umožňuje uživatelům aktualizovat své heslo.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-337">The ChangePassword control enables a user to update their password.</span></span>

<span data-ttu-id="2f8d3-338">Jako přihlašovací údaje a CreateUserWizard ovládacích prvků vykreslení ovládacích prvků PasswordRecovery a změna hesla byla bohaté uživatelské rozhraní bez nutnosti psaní ikonu deklarativní nebo řádek kódu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-338">Like the Login and CreateUserWizard controls, the PasswordRecovery and ChangePassword controls render a rich user interface without having to write a lick of declarative markup or line of code.</span></span> <span data-ttu-id="2f8d3-339">Pokud výchozí uživatelské rozhraní nevyhovuje vašim potřebám, můžete přizpůsobit přes různé vlastnosti stylu.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-339">If the default user interface doesn't meet your needs, you can customize it through a variety of style properties.</span></span> <span data-ttu-id="2f8d3-340">Ovládací prvky rozhraní Alternativně může být převedeny na šablony pro i podrobnějšího ovládání.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-340">Alternatively, the controls' interfaces may be converted into templates, for an even finer degree of control.</span></span> <span data-ttu-id="2f8d3-341">Na pozadí tyto ovládací prvky použít rozhraní API členství vyvolání `MembershipUser` objektu `ResetPassword` a `ChangePassword` metody.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-341">Behind the scenes these controls use the Membership API, invoking the `MembershipUser` object's `ResetPassword` and `ChangePassword` methods.</span></span>

<span data-ttu-id="2f8d3-342">Radostí programování!</span><span class="sxs-lookup"><span data-stu-id="2f8d3-342">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="2f8d3-343">Další čtení</span><span class="sxs-lookup"><span data-stu-id="2f8d3-343">Further Reading</span></span>

<span data-ttu-id="2f8d3-344">Další informace o tématech popsané v tomto kurzu najdete v následujících zdrojích informací:</span><span class="sxs-lookup"><span data-stu-id="2f8d3-344">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="2f8d3-345">Změna hesla byla řízení – elementy QuickStart</span><span class="sxs-lookup"><span data-stu-id="2f8d3-345">ChangePassword Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/changepassword.aspx)
- [<span data-ttu-id="2f8d3-346">Ovládací prvek PasswordRecovery – elementy QuickStart</span><span class="sxs-lookup"><span data-stu-id="2f8d3-346">PasswordRecovery Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/passwordrecovery.aspx)
- [<span data-ttu-id="2f8d3-347">Odesílání e-mailu v technologii ASP.NET</span><span class="sxs-lookup"><span data-stu-id="2f8d3-347">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="2f8d3-348">`System.Net.Mail` Nejčastější dotazy</span><span class="sxs-lookup"><span data-stu-id="2f8d3-348">`System.Net.Mail` FAQs</span></span>](http://www.systemnetmail.com/)

### <a name="about-the-author"></a><span data-ttu-id="2f8d3-349">O autorovi</span><span class="sxs-lookup"><span data-stu-id="2f8d3-349">About the Author</span></span>

<span data-ttu-id="2f8d3-350">Scott Meisnerová, vytvořit více knih ASP/ASP.NET a zakladatele 4GuysFromRolla.com, má byla od 1998 práce s technologií Microsoft Web.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-350">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="2f8d3-351">Scott funguje jako nezávislé poradce, trainer a zapisovače.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-351">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="2f8d3-352">Jeho nejnovější seznam k  *[Edice nakladatelství Sams naučit sami technologii ASP.NET 2.0 za 24 hodin](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-352">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="2f8d3-353">Scott lze dosáhnout za [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) nebo prostřednictvím svého blogu v [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="2f8d3-353">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="2f8d3-354">Zvláštní poděkování</span><span class="sxs-lookup"><span data-stu-id="2f8d3-354">Special Thanks To</span></span>

<span data-ttu-id="2f8d3-355">Tento kurz řady byla zkontrolovány uživatelem mnoho užitečné kontrolorů.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-355">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="2f8d3-356">Vést kontroloři pro účely tohoto kurzu zahrnují Michael Emmings a Suchi Banerjee.</span><span class="sxs-lookup"><span data-stu-id="2f8d3-356">Lead reviewers for this tutorial include Michael Emmings and Suchi Banerjee.</span></span> <span data-ttu-id="2f8d3-357">Kontrola Moje nadcházející články MSDN máte zájem?</span><span class="sxs-lookup"><span data-stu-id="2f8d3-357">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="2f8d3-358">Pokud ano, vyřaďte mi řádek v [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-358">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="2f8d3-359">[Předchozí](building-an-interface-to-select-one-user-account-from-many-cs.md)
> [další](unlocking-and-approving-user-accounts-cs.md)</span><span class="sxs-lookup"><span data-stu-id="2f8d3-359">[Previous](building-an-interface-to-select-one-user-account-from-many-cs.md)
[Next](unlocking-and-approving-user-accounts-cs.md)</span></span>
