---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
title: "Podrobnosti o chybě protokolování s ASP.NET stavu monitorování (C#) | Microsoft Docs"
author: rick-anderson
description: "Systém monitorování stavu společnosti Microsoft poskytuje snadný a přizpůsobit způsob do protokolu různé události web, včetně neošetřených výjimek. V tomto kurzu provede p..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/09/2009
ms.topic: article
ms.assetid: b1abb452-642a-4ff3-8504-37b85590ff79
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
msc.type: authoredcontent
ms.openlocfilehash: 06f8b57c8973fff5c07e82100cd43f6757d454f9
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/10/2017
---
<a name="logging-error-details-with-aspnet-health-monitoring-c"></a><span data-ttu-id="61792-104">Podrobnosti o chybě protokolování s ASP.NET stavu monitorování (C#)</span><span class="sxs-lookup"><span data-stu-id="61792-104">Logging Error Details with ASP.NET Health Monitoring (C#)</span></span>
====================
<span data-ttu-id="61792-105">podle [Scott Meisnerová](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="61792-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="61792-106">[Stáhněte si kód](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip) nebo [stáhnout PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="61792-106">[Download Code](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip) or [Download PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)</span></span>

> <span data-ttu-id="61792-107">Systém monitorování stavu společnosti Microsoft poskytuje snadný a přizpůsobit způsob do protokolu různé události web, včetně neošetřených výjimek.</span><span class="sxs-lookup"><span data-stu-id="61792-107">Microsoft's health monitoring system provides an easy and customizable way to log various web events, including unhandled exceptions.</span></span> <span data-ttu-id="61792-108">Tento kurz vás provede nastavením stavu systému pro monitorování k protokolování neošetřených výjimek k databázi a vývojáři prostřednictvím e-mailové zprávy.</span><span class="sxs-lookup"><span data-stu-id="61792-108">This tutorial walks through setting up the health monitoring system to log unhandled exceptions to a database and to notify developers via an e-mail message.</span></span>


## <a name="introduction"></a><span data-ttu-id="61792-109">Úvod</span><span class="sxs-lookup"><span data-stu-id="61792-109">Introduction</span></span>

<span data-ttu-id="61792-110">Protokolování je užitečným nástrojem pro sledování stavu nasazení aplikace a pro všechny problémy, které mohou nastat diagnostice.</span><span class="sxs-lookup"><span data-stu-id="61792-110">Logging is a useful tool for monitoring the health of a deployed application and for diagnosing any problems that may arise.</span></span> <span data-ttu-id="61792-111">Je obzvláště důležité k protokolování chyb, ke kterým došlo v době nasazení aplikace, takže lze napravit.</span><span class="sxs-lookup"><span data-stu-id="61792-111">It is especially important to log errors that occur in a deployed application so that they can be remedied.</span></span> <span data-ttu-id="61792-112">`Error` Událost se vyvolá, vždy, když dojde k neošetřené výjimce v aplikaci ASP.NET; [předchozí kurzu](processing-unhandled-exceptions-cs.md) vám ukázal, jak chcete upozornit vývojář chybu a vytvořením obslužné rutiny události pro protokolujejípodrobnosti.`Error` událostí.</span><span class="sxs-lookup"><span data-stu-id="61792-112">The `Error` event is raised whenever an unhandled exception occurs in an ASP.NET application; the [preceding tutorial](processing-unhandled-exceptions-cs.md) showed how to notify a developer of an error and log its details by creating an event handler for the `Error` event.</span></span> <span data-ttu-id="61792-113">Vytváření však `Error` obslužné rutiny události do protokolu podrobnosti k chybě a upozornění vývojář je zbytečné, jak tento úkol provést ASP. NET na *stavu systému pro monitorování*.</span><span class="sxs-lookup"><span data-stu-id="61792-113">However, creating an `Error` event handler to log the error's details and notify a developer is unnecessary, as this task can be performed by ASP.NET's *health monitoring system*.</span></span>

<span data-ttu-id="61792-114">Stav systému pro monitorování bylo zavedeno v technologii ASP.NET 2.0 a slouží k monitorování stavu nasazené aplikace ASP.NET pomocí protokolování událostí, ke kterým došlo během doby platnosti žádosti nebo aplikace.</span><span class="sxs-lookup"><span data-stu-id="61792-114">The health monitoring system was introduced in ASP.NET 2.0 and is designed to monitor the health of a deployed ASP.NET application by logging events that occur during the application or request's lifetime.</span></span> <span data-ttu-id="61792-115">Události zapsané podle stavu systému pro monitorování jsou označovány jako *události sledování stavu* nebo *webové události*a zahrnují:</span><span class="sxs-lookup"><span data-stu-id="61792-115">The events logged by the health monitoring system are referred to as *health monitoring events* or *Web events*, and include:</span></span>

- <span data-ttu-id="61792-116">Události životního cyklu aplikace, například pokud se aplikace spustí nebo zastaví</span><span class="sxs-lookup"><span data-stu-id="61792-116">Application lifetime events, such as when an application starts or stops</span></span>
- <span data-ttu-id="61792-117">Události zabezpečení, včetně neúspěšných pokusů o přihlášení a neúspěšné požadavky autorizace adresy URL</span><span class="sxs-lookup"><span data-stu-id="61792-117">Security events, including failed login attempts and failed URL authorization requests</span></span>
- <span data-ttu-id="61792-118">Chyby aplikace, včetně neošetřené výjimky, zobrazení stavu analýza výjimky, žádost o ověření výjimky a chyby při kompilaci mezi jiné typy chyb.</span><span class="sxs-lookup"><span data-stu-id="61792-118">Application errors, including unhandled exceptions, view state parsing exceptions, request validation exceptions, and compilation errors, among other types of errors.</span></span>

<span data-ttu-id="61792-119">Když stavu monitorování událost se vyvolá, můžete je zaznamenána do libovolný počet zadaný *protokolu zdroje*.</span><span class="sxs-lookup"><span data-stu-id="61792-119">When a health monitoring event is raised it can be logged to any number of specified *log sources*.</span></span> <span data-ttu-id="61792-120">Stav systému pro monitorování se dodává s protokolu zdrojů, které protokolovat webové události do databáze Microsoft SQL Server, do protokolu událostí systému Windows, nebo prostřednictvím e-mailové zprávy, mimo jiné.</span><span class="sxs-lookup"><span data-stu-id="61792-120">The health monitoring system ships with log sources that log Web events to a Microsoft SQL Server database, to the Windows Event Log, or via an e-mail message, among others.</span></span> <span data-ttu-id="61792-121">Můžete také vytvořit vlastní zdroje protokolu.</span><span class="sxs-lookup"><span data-stu-id="61792-121">You can also create your own log sources.</span></span>

<span data-ttu-id="61792-122">Události protokoluje stav monitorování systému, společně s protokolu zdroje, používá, jsou definovány v `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="61792-122">The events the health monitoring system logs, along with the log sources used, are defined in `Web.config`.</span></span> <span data-ttu-id="61792-123">Zadání několika řádků kódu konfigurace můžete použít k protokolování neošetřených výjimek všechny k databázi a upozornit vás výjimky prostřednictvím e-mailu na sledování stavu.</span><span class="sxs-lookup"><span data-stu-id="61792-123">With a few lines of configuration markup you can use health monitoring to log all unhandled exceptions to a database and to notify you of the exception via e-mail.</span></span>

## <a name="exploring-the-health-monitoring-systems-configuration"></a><span data-ttu-id="61792-124">Prohlížení stavu monitorování konfigurace systému</span><span class="sxs-lookup"><span data-stu-id="61792-124">Exploring the Health Monitoring System's Configuration</span></span>

<span data-ttu-id="61792-125">Stav monitorování chování systému je definované informace o konfiguraci, který je umístěný ve [ `<healthMonitoring>` element](https://msdn.microsoft.com/en-us/library/2fwh2ss9.aspx) v `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="61792-125">The health monitoring system's behavior is defined by its configuration information, which is located in the [`<healthMonitoring>` element](https://msdn.microsoft.com/en-us/library/2fwh2ss9.aspx) in `Web.config`.</span></span> <span data-ttu-id="61792-126">Tento konfigurační oddíl definuje mimo jiné, tři důležité následující informace:</span><span class="sxs-lookup"><span data-stu-id="61792-126">This configuration section defines, among other things, the following three important pieces of information:</span></span>

1. <span data-ttu-id="61792-127">Sledování události stavu, je-li vyvolána, by se mělo protokolovat,</span><span class="sxs-lookup"><span data-stu-id="61792-127">The health monitoring events that, when raised, should be logged,</span></span>
2. <span data-ttu-id="61792-128">Protokol zdrojů, a</span><span class="sxs-lookup"><span data-stu-id="61792-128">The log sources, and</span></span>
3. <span data-ttu-id="61792-129">Jak každý stav monitorování událostí, které jsou definované v (1) je namapována na zdroji protokolu definované v (2).</span><span class="sxs-lookup"><span data-stu-id="61792-129">How each health monitoring event defined in (1) is mapped to the log sources defined in (2).</span></span>

<span data-ttu-id="61792-130">Tyto informace se specifikuje prostřednictvím tři podřízené položky konfigurace – elementy: [ `<eventMappings>` ](https://msdn.microsoft.com/en-us/library/yc5yk01w.aspx), [ `<providers>` ](https://msdn.microsoft.com/en-us/library/zaa41kz1.aspx), a [ `<rules>` ](https://msdn.microsoft.com/en-us/library/fe5wyxa0.aspx), v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="61792-130">This information is specified through three children configuration elements: [`<eventMappings>`](https://msdn.microsoft.com/en-us/library/yc5yk01w.aspx), [`<providers>`](https://msdn.microsoft.com/en-us/library/zaa41kz1.aspx), and [`<rules>`](https://msdn.microsoft.com/en-us/library/fe5wyxa0.aspx), respectively.</span></span>

<span data-ttu-id="61792-131">Výchozí stav monitorování informace o konfiguraci systému najdete v `Web.config` souboru v `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` složky.</span><span class="sxs-lookup"><span data-stu-id="61792-131">The default health monitoring system configuration information can be found in the `Web.config` file in `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` folder.</span></span> <span data-ttu-id="61792-132">Tyto informace o konfiguraci výchozí s některé značek odebrat jako stručný výtah je zobrazena níže:</span><span class="sxs-lookup"><span data-stu-id="61792-132">This default configuration information, with some markup removed for brevity, is shown below:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample1.xml)]

<span data-ttu-id="61792-133">Stav události týkající se monitorování jsou definovány v `<eventMappings>` element, který poskytuje lidské popisný název pro třídu události sledování stavu.</span><span class="sxs-lookup"><span data-stu-id="61792-133">The health monitoring events of interest are defined in the `<eventMappings>` element, which gives a human-friendly name to a class of health monitoring events.</span></span> <span data-ttu-id="61792-134">Do výše uvedeného kódu `<eventMappings>` element přiřadí lidské popisný název "Všechny chyby" události typu sledování stavu `WebBaseErrorEvent` a název "selhání audity" stav monitorování událostí typu `WebFailureAuditEvent`.</span><span class="sxs-lookup"><span data-stu-id="61792-134">In the markup above, the `<eventMappings>` element assigns the human-friendly name "All Errors" to the health monitoring events of type `WebBaseErrorEvent` and the name "Failure Audits" to health monitoring events of type `WebFailureAuditEvent`.</span></span>

<span data-ttu-id="61792-135">`<providers>` Element definuje zdrojů protokolu, bude mít lidské popisný název a zadání žádné informace o konfiguraci určitého zdroj protokolu.</span><span class="sxs-lookup"><span data-stu-id="61792-135">The `<providers>` element defines the log sources, giving them a human-friendly name and specifying any log source-specific configuration information.</span></span> <span data-ttu-id="61792-136">První `<add>` element definuje zprostředkovatele "EventLogProvider", které protokoly sledování událostí pomocí zadaného stavu `EventLogWebEventProvider` třídy.</span><span class="sxs-lookup"><span data-stu-id="61792-136">The first `<add>` element defines the "EventLogProvider" provider, which logs the specified health monitoring events using the `EventLogWebEventProvider` class.</span></span> <span data-ttu-id="61792-137">`EventLogWebEventProvider` Třída protokoluje události do protokolu událostí systému Windows.</span><span class="sxs-lookup"><span data-stu-id="61792-137">The `EventLogWebEventProvider` class logs the event to the Windows Event Log.</span></span> <span data-ttu-id="61792-138">Druhý `<add>` element definuje "SqlWebEventProvider" poskytovatele, který protokoluje události do databáze Microsoft SQL Server prostřednictvím `SqlWebEventProvider` třídy.</span><span class="sxs-lookup"><span data-stu-id="61792-138">The second `<add>` element defines the "SqlWebEventProvider" provider, which logs events to a Microsoft SQL Server database via the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="61792-139">Konfigurace "SqlWebEventProvider" Určuje připojovací řetězec databáze (`connectionStringName`) mezi další možnosti konfigurace.</span><span class="sxs-lookup"><span data-stu-id="61792-139">The "SqlWebEventProvider" configuration specifies the database's connection string (`connectionStringName`) among other configuration options.</span></span>

<span data-ttu-id="61792-140">`<rules>` Element mapy událostí uvedený v `<eventMappings>` element přihlásit zdroje `<providers>` elementu.</span><span class="sxs-lookup"><span data-stu-id="61792-140">The `<rules>` element maps the events specified in the `<eventMappings>` element to log sources in the `<providers>` element.</span></span> <span data-ttu-id="61792-141">Ve výchozím nastavení webové aplikace ASP.NET protokolu všechny neošetřené výjimky a auditování chyby do protokolu událostí systému Windows.</span><span class="sxs-lookup"><span data-stu-id="61792-141">By default, ASP.NET web applications log all unhandled exceptions and audit failures to the Windows Event Log.</span></span>

## <a name="logging-events-to-a-database"></a><span data-ttu-id="61792-142">Protokolování událostí do databáze</span><span class="sxs-lookup"><span data-stu-id="61792-142">Logging Events to a Database</span></span>

<span data-ttu-id="61792-143">Výchozí konfigurace systému pro sledování stavu můžete přizpůsobit na základě webové aplikace ve webové aplikaci přidáním `<healthMonitoring>` oddílu aplikace `Web.config` souboru.</span><span class="sxs-lookup"><span data-stu-id="61792-143">The health monitoring system's default configuration can be customized on a web application-by-web application basis by adding a `<healthMonitoring>` section to the application's `Web.config` file.</span></span> <span data-ttu-id="61792-144">Můžete zahrnout další prvky v `<eventMappings>`, `<providers>`, a `<rules>` části pomocí `<add>` elementu.</span><span class="sxs-lookup"><span data-stu-id="61792-144">You can include additional elements in the `<eventMappings>`, `<providers>`, and `<rules>` sections by using the `<add>` element.</span></span> <span data-ttu-id="61792-145">Odebrání konfigurace použít výchozí nastavení `<remove>` element, nebo použijte `<clear />` odebrat všechny výchozí hodnoty z jednoho z těchto částí.</span><span class="sxs-lookup"><span data-stu-id="61792-145">To remove a setting from the default configuration use the `<remove>` element, or use `<clear />` to remove all default values from one of these sections.</span></span> <span data-ttu-id="61792-146">Nakonfigurujme kniha recenze webové aplikace do databáze Microsoft SQL Server pomocí protokolu všechny neošetřené výjimky `SqlWebEventProvider` třídy.</span><span class="sxs-lookup"><span data-stu-id="61792-146">Let's configure the Book Reviews web application to log all unhandled exceptions to a Microsoft SQL Server database using the `SqlWebEventProvider` class.</span></span>

<span data-ttu-id="61792-147">`SqlWebEventProvider` Třída je součástí stavu systému pro monitorování a protokoly událostí k zadané databázi systému SQL Server sledování stavu.</span><span class="sxs-lookup"><span data-stu-id="61792-147">The `SqlWebEventProvider` class is part of the health monitoring system and logs a health monitoring event to a specified SQL Server database.</span></span> <span data-ttu-id="61792-148">`SqlWebEventProvider` Třída očekává, že zadaná databáze obsahuje uložené procedury s názvem `aspnet_WebEvent_LogEvent`.</span><span class="sxs-lookup"><span data-stu-id="61792-148">The `SqlWebEventProvider` class expects that the specified database includes a stored procedure named `aspnet_WebEvent_LogEvent`.</span></span> <span data-ttu-id="61792-149">Tato uložená procedura je předán podrobnosti události a za úkol ukládání podrobnosti události.</span><span class="sxs-lookup"><span data-stu-id="61792-149">This stored procedure is passed the details of the event and is tasked with storing the event details.</span></span> <span data-ttu-id="61792-150">Dobrá zpráva je, že není potřeba vytvořit to uložené procedury ani tabulku pro ukládání podrobností události.</span><span class="sxs-lookup"><span data-stu-id="61792-150">The good news is that you do not need to create this stored procedure nor the table to store the event details.</span></span> <span data-ttu-id="61792-151">Můžete přidat tyto objekty k databázi pomocí `aspnet_regsql.exe` nástroj.</span><span class="sxs-lookup"><span data-stu-id="61792-151">You can add these objects to your database using the `aspnet_regsql.exe` tool.</span></span>

> [!NOTE]
> <span data-ttu-id="61792-152">`aspnet_regsql.exe` Nástroj se zabývá zpět [ *konfigurace na web, používá aplikace služby* kurzu](configuring-a-website-that-uses-application-services-cs.md) když jsme doplnili podporu pro ASP. NET na aplikační služby.</span><span class="sxs-lookup"><span data-stu-id="61792-152">The `aspnet_regsql.exe` tool was discussed back in the [*Configuring a Website That Uses Application Services* tutorial](configuring-a-website-that-uses-application-services-cs.md) when we added support for ASP.NET's application services.</span></span> <span data-ttu-id="61792-153">V důsledku toho již obsahuje databázi recenze adresáře webu `aspnet_WebEvent_LogEvent` uložené procedury, která ukládá informace o události do tabulky s názvem `aspnet_WebEvent_Events`.</span><span class="sxs-lookup"><span data-stu-id="61792-153">Consequently, the Book Reviews website's database already contains the `aspnet_WebEvent_LogEvent` stored procedure, which stores the event information into a table named `aspnet_WebEvent_Events`.</span></span>


<span data-ttu-id="61792-154">Jakmile máte nezbytné uložené procedury a tabulky, které jsou přidány k vaší databázi, zbývá dáte pokyn, aby k protokolování neošetřených výjimek všechny do databáze sledování stavu.</span><span class="sxs-lookup"><span data-stu-id="61792-154">Once you have the necessary stored procedure and table added to your database, all that remains is to instruct health monitoring to log all unhandled exceptions to the database.</span></span> <span data-ttu-id="61792-155">Dosáhnout přidáním následující kód do vašeho webu `Web.config` souboru:</span><span class="sxs-lookup"><span data-stu-id="61792-155">Accomplish this by adding the following markup to your website's `Web.config` file:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample2.xml)]

<span data-ttu-id="61792-156">Stav monitorování konfigurace značek výše používá `<clear />` elementy vymazat sledování informace o konfiguraci z předem definovaných stavu `<eventMappings>`, `<providers>`, a `<rules>` oddíly.</span><span class="sxs-lookup"><span data-stu-id="61792-156">The health monitoring configuration markup above uses `<clear />` elements to wipe the pre-defined health monitoring configuration information from the `<eventMappings>`, `<providers>`, and `<rules>` sections.</span></span> <span data-ttu-id="61792-157">Pak přidá jeden záznam pro každý z těchto částí.</span><span class="sxs-lookup"><span data-stu-id="61792-157">It then adds a single entry to each of these sections.</span></span>

- <span data-ttu-id="61792-158">`<eventMappings>` Element definuje jeden stav monitorování události týkající se s názvem "Všechny chyby", která je vyvolána vždy, když dojde k neošetřené výjimce.</span><span class="sxs-lookup"><span data-stu-id="61792-158">The `<eventMappings>` element defines a single health monitoring event of interest named "All Errors", which is raised whenever an unhandled exception occurs.</span></span>
- <span data-ttu-id="61792-159">`<providers>` Element definuje jeden protokol zdroj s názvem "SqlWebEventProvider", který používá `SqlWebEventProvider` třídy.</span><span class="sxs-lookup"><span data-stu-id="61792-159">The `<providers>` element defines a single log source named "SqlWebEventProvider" that uses the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="61792-160">`connectionStringName` Atribut byla nastavena na "ReviewsConnectionString", což je název připojení k naší řetězce definované v `<connectionStrings>` oddílu.</span><span class="sxs-lookup"><span data-stu-id="61792-160">The `connectionStringName` attribute has been set to "ReviewsConnectionString", which is the name of our connection string defined in the `<connectionStrings>` section.</span></span>
- <span data-ttu-id="61792-161">Nakonec &lt;pravidla&gt; element označuje, že když událost "Všechny chyby" ukáže, že se mají být protokolovány pomocí zprostředkovatele "SqlWebEventProvider".</span><span class="sxs-lookup"><span data-stu-id="61792-161">Finally, the &lt;rules&gt; element indicates that when an "All Errors" event transpires that it should be logged using the "SqlWebEventProvider" provider.</span></span>

<span data-ttu-id="61792-162">Tyto informace o konfiguraci dá pokyn, stav systému k protokolování neošetřených výjimek všechny k databázi recenze adresáře pro monitorování.</span><span class="sxs-lookup"><span data-stu-id="61792-162">This configuration information instructs the health monitoring system to log all unhandled exceptions to the Book Reviews database.</span></span>

> [!NOTE]
> <span data-ttu-id="61792-163">`WebBaseErrorEvent` Událost je aktivována pouze pro chyby serveru; není vyvolána pro chyby protokolu HTTP, třeba požadavek na zdroj technologie ASP.NET, který nebyl nalezen.</span><span class="sxs-lookup"><span data-stu-id="61792-163">The `WebBaseErrorEvent` event is only raised for server errors; it is not raised for HTTP errors, such as a request for an ASP.NET resource that is not found.</span></span> <span data-ttu-id="61792-164">Tím se liší od chování `HttpApplication` třídy `Error` událost, která je vyvolána pro server i chyby protokolu HTTP.</span><span class="sxs-lookup"><span data-stu-id="61792-164">This differs from the behavior of the `HttpApplication` class's `Error` event, which is raised for both server and HTTP errors.</span></span>


<span data-ttu-id="61792-165">Informace o stavu systému v akci pro monitorování, přejděte na webovou stránku a generování běhová chyba navštivte stránky `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="61792-165">To see the health monitoring system in action, visit the website and generate a runtime error by visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="61792-166">Zobrazí se příslušná chybová stránka – výjimka podrobnosti žlutý obrazovka smrti (Pokud návštěvou místně) nebo vlastní chybovou stránku (při návštěvě webu v produkčním prostředí).</span><span class="sxs-lookup"><span data-stu-id="61792-166">You should see the appropriate error page - either the Exception Details Yellow Screen of Death (when visiting locally) or the custom error page (when visiting the site in production).</span></span> <span data-ttu-id="61792-167">Stav systému pro monitorování na pozadí protokolovány informace o chybě databáze.</span><span class="sxs-lookup"><span data-stu-id="61792-167">Behind the scenes, the health monitoring system logged the error information to the database.</span></span> <span data-ttu-id="61792-168">By měl být jeden záznam v `aspnet_WebEvent_Events` tabulky (viz **obrázek 1**); tento záznam obsahuje informace o této chybě modulu runtime, který právě došlo k chybě.</span><span class="sxs-lookup"><span data-stu-id="61792-168">There should be one record in the `aspnet_WebEvent_Events` table (see **Figure 1**); this record contains information about the runtime error that just occurred.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image2.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image1.png)

<span data-ttu-id="61792-169">**Obrázek 1**: Podrobnosti o chybě byly protokolovány `aspnet_WebEvent_Events` tabulky</span><span class="sxs-lookup"><span data-stu-id="61792-169">**Figure 1**: The Error Details Were Logged to the `aspnet_WebEvent_Events` Table</span></span>  
<span data-ttu-id="61792-170">([Kliknutím zobrazit obrázek v plné velikosti](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="61792-170">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))</span></span>

### <a name="displaying-the-error-log-in-a-web-page"></a><span data-ttu-id="61792-171">Zobrazení v protokolu chyb na webové stránce</span><span class="sxs-lookup"><span data-stu-id="61792-171">Displaying the Error Log In a Web Page</span></span>

<span data-ttu-id="61792-172">Stav systému pro monitorování s aktuální konfigurací webu, zaznamená všechny neošetřené výjimky k databázi.</span><span class="sxs-lookup"><span data-stu-id="61792-172">With the website's current configuration, the health monitoring system logs all unhandled exceptions to the database.</span></span> <span data-ttu-id="61792-173">Sledování stavu však neposkytuje žádný mechanismus zobrazte protokol chyb prostřednictvím na webové stránce.</span><span class="sxs-lookup"><span data-stu-id="61792-173">However, health monitoring does not provide any mechanism to view the error log through a web page.</span></span> <span data-ttu-id="61792-174">Je však sestavení stránku ASP.NET, která zobrazuje tyto informace z databáze.</span><span class="sxs-lookup"><span data-stu-id="61792-174">However, you could build an ASP.NET page that displays this information from the database.</span></span> <span data-ttu-id="61792-175">(Jako ukážeme na okamžik, se můžete rozhodnout pro mít podrobnosti o chybě vám odeslán e-mailová zpráva.)</span><span class="sxs-lookup"><span data-stu-id="61792-175">(As we'll see momentarily, you can opt to have the error details sent to you in an e-mail message.)</span></span>

<span data-ttu-id="61792-176">Pokud vytvoříte taková stránka, zkontrolujte, zda že je provést kroky k Povolit jenom autorizovaným uživatelům, chcete-li zobrazit podrobnosti o chybě.</span><span class="sxs-lookup"><span data-stu-id="61792-176">If you create such a page, make sure you take steps to allow only authorized users to view the error details.</span></span> <span data-ttu-id="61792-177">Pokud váš web již aktivuje uživatelské účty se autorizačních pravidel adres URL můžete použít k omezení přístupu na stránku na určité uživatele nebo role.</span><span class="sxs-lookup"><span data-stu-id="61792-177">If your site already employs user accounts then you can use URL authorization rules to restrict access to the page to certain users or roles.</span></span> <span data-ttu-id="61792-178">Další informace o tom, jak udělit nebo omezení přístupu k webovým stránkám na základě přihlášeného uživatele, najdete v části Moje [kurzy zabezpečení webu](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span><span class="sxs-lookup"><span data-stu-id="61792-178">For more information on how to grant or restrict access to web pages based on the logged in user, refer to my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

> [!NOTE]
> <span data-ttu-id="61792-179">Jsou zde popsány následné kurzu alternativní Chyba protokolování a oznámení systému s názvem ELMAH.</span><span class="sxs-lookup"><span data-stu-id="61792-179">The subsequent tutorial explores an alternative error logging and notification system named ELMAH.</span></span> <span data-ttu-id="61792-180">ELMAH zahrnuje integrovanou mechanismus pro zobrazení v protokolu chyb z obou webové stránky a jako informačního kanálu RSS.</span><span class="sxs-lookup"><span data-stu-id="61792-180">ELMAH includes a built-in mechanism to view the error log from both a web page and as an RSS feed.</span></span>


## <a name="logging-events-to-e-mail"></a><span data-ttu-id="61792-181">Protokolování událostí do e-mailu</span><span class="sxs-lookup"><span data-stu-id="61792-181">Logging Events to E-Mail</span></span>

<span data-ttu-id="61792-182">Stav systému pro monitorování obsahuje poskytovatele zdroj protokolu, který "" zaprotokoluje událost e-mailové zprávě.</span><span class="sxs-lookup"><span data-stu-id="61792-182">The health monitoring system includes a log source provider that "logs" an event to an e-mail message.</span></span> <span data-ttu-id="61792-183">Zdroj protokolu obsahuje stejné informace, která je zaznamenána do databáze v textu e-mailové zprávy.</span><span class="sxs-lookup"><span data-stu-id="61792-183">The log source includes the same information that is logged to the database in the e-mail message body.</span></span> <span data-ttu-id="61792-184">Tento zdroj protokolu můžete informovala, že vývojář stavu monitorování výskytu daných událostí.</span><span class="sxs-lookup"><span data-stu-id="61792-184">You can use this log source to notify a developer when a certain health monitoring event occurs.</span></span>

<span data-ttu-id="61792-185">Umožňuje aktualizovat recenze kniha konfiguraci příslušného webu tak, aby obdržíme e-mailu vždy, když k výjimce dochází.</span><span class="sxs-lookup"><span data-stu-id="61792-185">Let's update the Book Reviews website's configuration so that we receive an e-mail whenever an exception occurs.</span></span> <span data-ttu-id="61792-186">K tomu je potřeba provést tři úkoly:</span><span class="sxs-lookup"><span data-stu-id="61792-186">To accomplish this we need to perform three tasks:</span></span>

1. <span data-ttu-id="61792-187">Konfigurace webové aplikace ASP.NET pro odeslání e-mailu.</span><span class="sxs-lookup"><span data-stu-id="61792-187">Configure the ASP.NET web application to send e-mail.</span></span> <span data-ttu-id="61792-188">Toho dosahuje tak, že určíte, jak se odesílají e-mailové zprávy prostřednictvím `<system.net>` konfigurační prvek.</span><span class="sxs-lookup"><span data-stu-id="61792-188">This is accomplished by specifying how e-mail messages are sent via the `<system.net>` configuration element.</span></span> <span data-ttu-id="61792-189">Další informace o odesílání e-mailové zprávy v aplikaci ASP.NET najdete v části [odesílání e-mailu v ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) a [nejčastější dotazy týkající se System.Net.Mail](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="61792-189">For more information on sending e-mail messages in an ASP.NET application refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>
2. <span data-ttu-id="61792-190">Zaregistrujte poskytovatele správy zdrojového protokolu e-mailu v `<providers>` elementu a</span><span class="sxs-lookup"><span data-stu-id="61792-190">Register the e-mail log source provider in the `<providers>` element, and</span></span>
3. <span data-ttu-id="61792-191">Přidání položky do `<rules>` element, který mapuje událostí "Všechny chyby" poskytovatele správy zdrojového protokolu přidali v kroku (2).</span><span class="sxs-lookup"><span data-stu-id="61792-191">Add an entry to the `<rules>` element that maps the "All Errors" event to the log source provider added in step (2).</span></span>

<span data-ttu-id="61792-192">Sledování systému stavu zahrnuje dvě třídy zprostředkovatele zdroj e-mailu protokolu: `SimpleMailWebEventProvider` a `TemplatedMailWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="61792-192">The health monitoring system includes two e-mail log source provider classes: `SimpleMailWebEventProvider` and `TemplatedMailWebEventProvider`.</span></span> <span data-ttu-id="61792-193">[ `SimpleMailWebEventProvider` Třída](https://msdn.microsoft.com/en-us/library/system.web.management.simplemailwebeventprovider.aspx) odesílá prostého textu e-mailovou zprávu, která zahrnuje události, podrobnosti a poskytuje málo přizpůsobení text e-mailu.</span><span class="sxs-lookup"><span data-stu-id="61792-193">The [`SimpleMailWebEventProvider` class](https://msdn.microsoft.com/en-us/library/system.web.management.simplemailwebeventprovider.aspx) sends a plain-text e-mail message that includes the event details and provides little customization of the e-mail body.</span></span> <span data-ttu-id="61792-194">S [ `TemplatedMailWebEventProvider` třída](https://msdn.microsoft.com/en-us/library/system.web.management.templatedmailwebeventprovider.aspx) zadáte stránku ASP.NET, jejichž vykreslované značky se používá jako text zprávy pro e-mailová zpráva.</span><span class="sxs-lookup"><span data-stu-id="61792-194">With the [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/en-us/library/system.web.management.templatedmailwebeventprovider.aspx) you specify an ASP.NET page whose rendered markup is used as the body for the e-mail message.</span></span> <span data-ttu-id="61792-195">[ `TemplatedMailWebEventProvider` Třída](https://msdn.microsoft.com/en-us/library/system.web.management.templatedmailwebeventprovider.aspx) vám dává mnohem větší kontrolu nad obsah a formát e-mailová zpráva, ale vyžaduje trochu další předem práci, jako je nutné vytvořit stránku ASP.NET, který generuje tělo e-mailové zprávy.</span><span class="sxs-lookup"><span data-stu-id="61792-195">The [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/en-us/library/system.web.management.templatedmailwebeventprovider.aspx) gives you much greater control over the contents and format of the e-mail message, but requires a bit more upfront work as you have to create the ASP.NET page that generates the e-mail message's body.</span></span> <span data-ttu-id="61792-196">Tento kurz se zaměřuje na pomocí `SimpleMailWebEventProvider` třídy.</span><span class="sxs-lookup"><span data-stu-id="61792-196">This tutorial focuses on using the `SimpleMailWebEventProvider` class.</span></span>

<span data-ttu-id="61792-197">Aktualizovat stav monitorování systému `<providers>` element v `Web.config` souboru protokolu zdroj pro `SimpleMailWebEventProvider` třídy:</span><span class="sxs-lookup"><span data-stu-id="61792-197">Update the health monitoring system's `<providers>` element in the `Web.config` file to include a log source for the `SimpleMailWebEventProvider` class:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample3.xml)]

<span data-ttu-id="61792-198">Výše uvedený kód používá `SimpleMailWebEventProvider` třída jako poskytovatele správy zdrojového protokolu a přiřadí ji popisný název "EmailWebEventProvider".</span><span class="sxs-lookup"><span data-stu-id="61792-198">The above markup uses the `SimpleMailWebEventProvider` class as the log source provider, and assigns it the friendly name "EmailWebEventProvider".</span></span> <span data-ttu-id="61792-199">Kromě toho `<add>` atribut obsahuje další možnosti konfigurace, jako je například Komu a z adresy e-mailová zpráva.</span><span class="sxs-lookup"><span data-stu-id="61792-199">Moreover, the `<add>` attribute includes additional configuration options, such as the To and From addresses of the e-mail message.</span></span>

<span data-ttu-id="61792-200">Se zdrojem e-mailu protokolu definované zbývá dáte pokyn, aby stav systému pro použití tohoto zdroje k "protokolování" neošetřené výjimky pro monitorování.</span><span class="sxs-lookup"><span data-stu-id="61792-200">With the e-mail log source defined, all that remains is to instruct the health monitoring system to use this source to "log" unhandled exceptions.</span></span> <span data-ttu-id="61792-201">To je možné udělat přidáním nové pravidlo v `<rules>` části:</span><span class="sxs-lookup"><span data-stu-id="61792-201">This is accomplished by adding a new rule in the `<rules>` section:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample4.xml)]

<span data-ttu-id="61792-202">`<rules>` Část teď obsahuje dvě pravidla.</span><span class="sxs-lookup"><span data-stu-id="61792-202">The `<rules>` section now includes two rules.</span></span> <span data-ttu-id="61792-203">První z nich, s názvem "Všechny chyby na e-mailu", odešle zdroj protokolu "EmailWebEventProvider" všechny neošetřené výjimky.</span><span class="sxs-lookup"><span data-stu-id="61792-203">The first one, named "All Errors To E-Mail", sends all unhandled exceptions to the "EmailWebEventProvider" log source.</span></span> <span data-ttu-id="61792-204">Toto pravidlo má za následek odesílání podrobnosti o chybách na webu do zadané adresy.</span><span class="sxs-lookup"><span data-stu-id="61792-204">This rule has the effect of sending details about errors on the website to the specified To address.</span></span> <span data-ttu-id="61792-205">"Všechny chyby do databáze" pravidlo zaznamená podrobnosti o chybě do databáze lokality.</span><span class="sxs-lookup"><span data-stu-id="61792-205">The "All Errors To Database" rule logs the error details to the site's database.</span></span> <span data-ttu-id="61792-206">V důsledku toho vždy, když dojde k neošetřené výjimce v lokalitě podrobnosti jsou přihlášení k databázi i odeslán na zadanou e-mailovou adresu.</span><span class="sxs-lookup"><span data-stu-id="61792-206">Consequently, whenever an unhandled exception occurs on the site its details are both logged to the database and sent to specified e-mail address.</span></span>

<span data-ttu-id="61792-207">**Obrázek 2** ukazuje vygenerovaných e-mailu `SimpleMailWebEventProvider` třídy při návštěvě `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="61792-207">**Figure 2** shows the e-mail generated by the `SimpleMailWebEventProvider` class when visiting `Genre.aspx?ID=foo`.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image5.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image4.png)

<span data-ttu-id="61792-208">**Obrázek 2**: Podrobnosti o chybě se odesílají e-mailové zprávy</span><span class="sxs-lookup"><span data-stu-id="61792-208">**Figure 2**: The Error Details are Sent in an E-Mail Message</span></span>  
<span data-ttu-id="61792-209">([Kliknutím zobrazit obrázek v plné velikosti](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="61792-209">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))</span></span>

## <a name="summary"></a><span data-ttu-id="61792-210">Souhrn</span><span class="sxs-lookup"><span data-stu-id="61792-210">Summary</span></span>

<span data-ttu-id="61792-211">Systém monitorování stavu ASP.NET je navržena k umožnění správci sledovat stav nasazených webových aplikací.</span><span class="sxs-lookup"><span data-stu-id="61792-211">The ASP.NET health monitoring system is designed to allow administrators to monitor the health of a deployed web application.</span></span> <span data-ttu-id="61792-212">Události monitorování stavu se vyvolá, když unfold určité akce, například při zastavení aplikace, pokud uživatel úspěšně přihlásí webu, nebo když dojde k neošetřené výjimce.</span><span class="sxs-lookup"><span data-stu-id="61792-212">Health monitoring events are raised when certain actions unfold, such as when the application stops, when a user successfully logs onto the site, or when an unhandled exception occurs.</span></span> <span data-ttu-id="61792-213">Tyto události může být protokolovány libovolný počet zdrojů protokolu.</span><span class="sxs-lookup"><span data-stu-id="61792-213">These events can be logged to any number of log sources.</span></span> <span data-ttu-id="61792-214">Tento kurz vám ukázal, jak k databázi a prostřednictvím e-mailová zpráva protokolu podrobnosti o neošetřených výjimek.</span><span class="sxs-lookup"><span data-stu-id="61792-214">This tutorial showed how to log the details of unhandled exceptions to a database and through an e-mail message.</span></span>

<span data-ttu-id="61792-215">Tento kurz se zaměřuje na použití k protokolování neošetřených výjimek, ale mějte na paměti, že monitorování stavu slouží k měření celkového stavu nasazené aplikace ASP.NET a obsahuje celou řadu událostí sledování stavu a protokolu zdroje není sledování stavu prozkoumali sem.</span><span class="sxs-lookup"><span data-stu-id="61792-215">This tutorial focused on using health monitoring to log unhandled exceptions, but keep in mind that health monitoring is designed to measure the overall health of a deployed ASP.NET application and includes a wealth of health monitoring events and log sources not explored here.</span></span> <span data-ttu-id="61792-216">Co je více, můžete vytvořit vlastní sledování událostí a protokolu zdrojů, stavu potřeby nastat.</span><span class="sxs-lookup"><span data-stu-id="61792-216">What's more, you can create your own health monitoring events and log sources, should the need arise.</span></span> <span data-ttu-id="61792-217">Pokud vás zajímá dozvědět další informace o sledování stavu, dobrý prvním krokem je pročtěte [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)na [sledování nejčastější dotazy týkající se stavu](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span><span class="sxs-lookup"><span data-stu-id="61792-217">If you are interested in learning more about health monitoring, a good first step is to read through [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)'s [health monitoring FAQ](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span></span> <span data-ttu-id="61792-218">Následující, poraďte se [postupy: použití sledování stavu v technologii ASP.NET 2.0](https://msdn.microsoft.com/en-us/library/ms998306.aspx).</span><span class="sxs-lookup"><span data-stu-id="61792-218">Following that, consult [How To: Use Health Monitoring in ASP.NET 2.0](https://msdn.microsoft.com/en-us/library/ms998306.aspx).</span></span>

<span data-ttu-id="61792-219">Radostí programování!</span><span class="sxs-lookup"><span data-stu-id="61792-219">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="61792-220">Další čtení</span><span class="sxs-lookup"><span data-stu-id="61792-220">Further Reading</span></span>

<span data-ttu-id="61792-221">Další informace o tématech popsané v tomto kurzu najdete v následujících zdrojích informací:</span><span class="sxs-lookup"><span data-stu-id="61792-221">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="61792-222">Přehled monitorování stavu technologie ASP.NET</span><span class="sxs-lookup"><span data-stu-id="61792-222">ASP.NET Health Monitoring Overview</span></span>](https://msdn.microsoft.com/en-us/library/bb398933.aspx)
- [<span data-ttu-id="61792-223">Konfigurace a přizpůsobení stav monitorování systému technologie ASP.NET</span><span class="sxs-lookup"><span data-stu-id="61792-223">Configuring and Customizing the Health Monitoring System of ASP.NET</span></span>](http://dotnetslackers.com/articles/aspnet/ConfiguringAndCustomizingTheHealthMonitoringSystemOfASPNET.aspx)
- [<span data-ttu-id="61792-224">Časté otázky – stavu monitorování v technologii ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="61792-224">FAQ - Health Monitoring in ASP.NET 2.0</span></span>](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)
- [<span data-ttu-id="61792-225">Postupy: Odeslání e-mailové oznámení o sledování stavu</span><span class="sxs-lookup"><span data-stu-id="61792-225">How To: Send E-Mail for Health Monitoring Notifications</span></span>](https://msdn.microsoft.com/en-us/library/ms227553.aspx)
- [<span data-ttu-id="61792-226">Postupy: Použití sledování stavu technologie ASP.NET</span><span class="sxs-lookup"><span data-stu-id="61792-226">How To: Use Health Monitoring in ASP.NET</span></span>](https://msdn.microsoft.com/en-us/library/ms998306.aspx)
- [<span data-ttu-id="61792-227">Stav monitorování technologie ASP.NET</span><span class="sxs-lookup"><span data-stu-id="61792-227">Health Monitoring in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/031407-1.aspx)

>[!div class="step-by-step"]
<span data-ttu-id="61792-228">[Předchozí](processing-unhandled-exceptions-cs.md)
[další](logging-error-details-with-elmah-cs.md)</span><span class="sxs-lookup"><span data-stu-id="61792-228">[Previous](processing-unhandled-exceptions-cs.md)
[Next](logging-error-details-with-elmah-cs.md)</span></span>
