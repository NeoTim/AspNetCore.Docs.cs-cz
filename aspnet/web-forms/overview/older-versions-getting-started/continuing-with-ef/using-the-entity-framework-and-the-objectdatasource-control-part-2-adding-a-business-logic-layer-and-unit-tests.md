---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests
title: 'Pomocí rozhraní Entity Framework 4.0 a ovládacího prvku ObjectDataSource, část 2: Přidání vrstvu obchodní logiky a testování částí | Microsoft Docs'
author: tdykstra
description: Tento kurz řady staví na webové aplikace Contoso univerzity, který byl vytvořený Začínáme s řadou kurz Entity Framework 4.0. I...
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/26/2011
ms.topic: article
ms.assetid: efb0e677-10b8-48dc-93d3-9ba3902dd807
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests
msc.type: authoredcontent
ms.openlocfilehash: ecdfb2bdc546f55778ec4cc1f61aa66e129134ea
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/06/2018
---
<a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests"></a><span data-ttu-id="b6349-104">Pomocí rozhraní Entity Framework 4.0 a ovládacího prvku ObjectDataSource, část 2: Přidání vrstvu obchodní logiky a testy jednotek</span><span class="sxs-lookup"><span data-stu-id="b6349-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 2: Adding a Business Logic Layer and Unit Tests</span></span>
====================
<span data-ttu-id="b6349-105">Podle [tní Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="b6349-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="b6349-106">Tento kurz řady staví na webové aplikace Contoso univerzity, který byl vytvořený [Začínáme s Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) kurz řady.</span><span class="sxs-lookup"><span data-stu-id="b6349-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="b6349-107">Pokud nebyla dokončena starší kurzy, jako výchozí bod pro účely tohoto kurzu můžete [stažení aplikace](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) , kterou by jste vytvořili.</span><span class="sxs-lookup"><span data-stu-id="b6349-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="b6349-108">Můžete také [stažení aplikace](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) vytvořené dokončení kurzu řady.</span><span class="sxs-lookup"><span data-stu-id="b6349-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="b6349-109">Pokud máte dotazy týkající se kurzy, můžete je do příspěvku [ASP.NET Entity Framework fórum](https://forums.asp.net/1227.aspx).</span><span class="sxs-lookup"><span data-stu-id="b6349-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>


<span data-ttu-id="b6349-110">V předchozích kurzu jste vytvořili vícevrstvé webové aplikace používající rozhraní Entity Framework a `ObjectDataSource` ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="b6349-110">In the previous tutorial you created an n-tier web application using the Entity Framework and the `ObjectDataSource` control.</span></span> <span data-ttu-id="b6349-111">Tento kurz ukazuje, jak přidat obchodní logiky při oddělíte vrstvu obchodní logiky (BLL) a přístup k datům layer (DAL) a ukazuje, jak vytvářet testy částí automatizované pro BLL.</span><span class="sxs-lookup"><span data-stu-id="b6349-111">This tutorial shows how to add business logic while keeping the business-logic layer (BLL) and the data-access layer (DAL) separate, and it shows how to create automated unit tests for the BLL.</span></span>

<span data-ttu-id="b6349-112">V tomto kurzu budete dokončit následující úlohy:</span><span class="sxs-lookup"><span data-stu-id="b6349-112">In this tutorial you'll complete the following tasks:</span></span>

- <span data-ttu-id="b6349-113">Vytvořte rozhraní úložiště, který deklaruje metody přístupu k datům, které potřebujete.</span><span class="sxs-lookup"><span data-stu-id="b6349-113">Create a repository interface that declares the data-access methods you need.</span></span>
- <span data-ttu-id="b6349-114">Implementujte rozhraní úložiště v třídě úložiště.</span><span class="sxs-lookup"><span data-stu-id="b6349-114">Implement the repository interface in the repository class.</span></span>
- <span data-ttu-id="b6349-115">Vytvořte třídu obchodní logiky, který zavolá třídu úložiště k provádění funkcí přístup k datům.</span><span class="sxs-lookup"><span data-stu-id="b6349-115">Create a business-logic class that calls the repository class to perform data-access functions.</span></span>
- <span data-ttu-id="b6349-116">Připojení `ObjectDataSource` řízení k třídě obchodní logiky místo třídu úložiště.</span><span class="sxs-lookup"><span data-stu-id="b6349-116">Connect the `ObjectDataSource` control to the business-logic class instead of to the repository class.</span></span>
- <span data-ttu-id="b6349-117">Vytvoření projektu testování částí a třídu úložiště, která používá kolekce v paměti pro jeho data store.</span><span class="sxs-lookup"><span data-stu-id="b6349-117">Create a unit-test project and a repository class that uses in-memory collections for its data store.</span></span>
- <span data-ttu-id="b6349-118">Vytvoření testů jednotek pro obchodní logiky, která chcete přidat do třídy obchodní logiky, pak spusťte test, abyste viděli, nezdaří.</span><span class="sxs-lookup"><span data-stu-id="b6349-118">Create a unit test for business logic that you want to add to the business-logic class, then run the test and see it fail.</span></span>
- <span data-ttu-id="b6349-119">Implementovat obchodní logiku v třídě obchodní logiky, a poté znovu spusťte jednotka otestovat, abyste viděli, předat.</span><span class="sxs-lookup"><span data-stu-id="b6349-119">Implement the business logic in the business-logic class, then re-run the unit test and see it pass.</span></span>

<span data-ttu-id="b6349-120">Budete pracovat *Departments.aspx* a *DepartmentsAdd.aspx* stránek, které jste vytvořili v předchozí kurzu.</span><span class="sxs-lookup"><span data-stu-id="b6349-120">You'll work with the *Departments.aspx* and *DepartmentsAdd.aspx* pages that you created in the previous tutorial.</span></span>

## <a name="creating-a-repository-interface"></a><span data-ttu-id="b6349-121">Vytváření rozhraní úložiště</span><span class="sxs-lookup"><span data-stu-id="b6349-121">Creating a Repository Interface</span></span>

<span data-ttu-id="b6349-122">Budete zahájíte vytváření rozhraní úložiště.</span><span class="sxs-lookup"><span data-stu-id="b6349-122">You'll begin by creating the repository interface.</span></span>

<span data-ttu-id="b6349-123">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b6349-123">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image1.png)</span></span>

<span data-ttu-id="b6349-124">V *DAL* složku, vytvořte nový soubor třídy a pojmenujte ji *ISchoolRepository.cs*a existujícího kódu nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="b6349-124">In the *DAL* folder, create a new class file, name it *ISchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample1.cs)]

<span data-ttu-id="b6349-125">Rozhraní definuje jednu metodu pro každou z CRUD (vytvořit, číst, aktualizovat, odstraňovat) metody, které jste vytvořili v třídě úložiště.</span><span class="sxs-lookup"><span data-stu-id="b6349-125">The interface defines one method for each of the CRUD (create, read, update, delete) methods that you created in the repository class.</span></span>

<span data-ttu-id="b6349-126">V `SchoolRepository` třídy v *SchoolRepository.cs*, označuje, že tato třída implementuje `ISchoolRepository` rozhraní:</span><span class="sxs-lookup"><span data-stu-id="b6349-126">In the `SchoolRepository` class in *SchoolRepository.cs*, indicate that this class implements the `ISchoolRepository` interface:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample2.cs)]

## <a name="creating-a-business-logic-class"></a><span data-ttu-id="b6349-127">Vytvoření třídy obchodní logiky</span><span class="sxs-lookup"><span data-stu-id="b6349-127">Creating a Business-Logic Class</span></span>

<span data-ttu-id="b6349-128">V dalším kroku vytvoříte třídu obchodní logiky.</span><span class="sxs-lookup"><span data-stu-id="b6349-128">Next, you'll create the business-logic class.</span></span> <span data-ttu-id="b6349-129">To uděláte tak, aby můžete přidat obchodní logiky, která budou spuštěny `ObjectDataSource` řídit, přestože to není, ještě.</span><span class="sxs-lookup"><span data-stu-id="b6349-129">You do this so that you can add business logic that will be executed by the `ObjectDataSource` control, although you will not do that yet.</span></span> <span data-ttu-id="b6349-130">Prozatím se nová třída obchodní logiky provádět pouze stejné operace CRUD, které nemá úložiště.</span><span class="sxs-lookup"><span data-stu-id="b6349-130">For now, the new business-logic class will only perform the same CRUD operations that the repository does.</span></span>

<span data-ttu-id="b6349-131">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="b6349-131">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image3.png)</span></span>

<span data-ttu-id="b6349-132">Vytvořte novou složku a pojmenujte ji *BLL*.</span><span class="sxs-lookup"><span data-stu-id="b6349-132">Create a new folder and name it *BLL*.</span></span> <span data-ttu-id="b6349-133">(V reálné aplikaci byste vrstvu obchodní logiky obvykle implementovaný jako knihovny tříd – samostatný projekt – ale na zjednodušení tento kurz se zachová BLL třídy ve složce projektu.)</span><span class="sxs-lookup"><span data-stu-id="b6349-133">(In a real-world application, the business-logic layer would typically be implemented as a class library — a separate project — but to keep this tutorial simple, BLL classes will be kept in a project folder.)</span></span>

<span data-ttu-id="b6349-134">V *BLL* složku, vytvořte nový soubor třídy a pojmenujte ji *SchoolBL.cs*a existujícího kódu nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="b6349-134">In the *BLL* folder, create a new class file, name it *SchoolBL.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample3.cs)]

<span data-ttu-id="b6349-135">Tento kód vytvoří stejné CRUD metody, které jste viděli dříve v třídě úložiště, ale ne přístup metody rozhraní Entity Framework přímo, volá úložiště, metody třídy.</span><span class="sxs-lookup"><span data-stu-id="b6349-135">This code creates the same CRUD methods you saw earlier in the repository class, but instead of accessing the Entity Framework methods directly, it calls the repository class methods.</span></span>

<span data-ttu-id="b6349-136">Třída proměnné, která obsahuje odkaz na třídu úložiště je definována jako typ rozhraní a kód, který vytvoří instanci třídy úložiště se nachází v dva konstruktory.</span><span class="sxs-lookup"><span data-stu-id="b6349-136">The class variable that holds a reference to the repository class is defined as an interface type, and the code that instantiates the repository class is contained in two constructors.</span></span> <span data-ttu-id="b6349-137">Konstruktor bez parametrů použije `ObjectDataSource` ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="b6349-137">The parameterless constructor will be used by the `ObjectDataSource` control.</span></span> <span data-ttu-id="b6349-138">Vytvoří instanci `SchoolRepository` třídu, která jste vytvořili dříve.</span><span class="sxs-lookup"><span data-stu-id="b6349-138">It creates an instance of the `SchoolRepository` class that you created earlier.</span></span> <span data-ttu-id="b6349-139">Další konstruktoru umožňuje ať kód, který vytvoří instanci třídy obchodní logiky, která má předat libovolný objekt, který implementuje rozhraní úložiště.</span><span class="sxs-lookup"><span data-stu-id="b6349-139">The other constructor allows whatever code that instantiates the business-logic class to pass in any object that implements the repository interface.</span></span>

<span data-ttu-id="b6349-140">CRUD metody, které volají třídu úložiště a dva konstruktory umožňují použití třídy obchodní logiky s jakoukoli back-end data store zvolíte.</span><span class="sxs-lookup"><span data-stu-id="b6349-140">The CRUD methods that call the repository class and the two constructors make it possible to use the business-logic class with whatever back-end data store you choose.</span></span> <span data-ttu-id="b6349-141">Třída obchodní logiky nemusí zajímat, jak třídu, která je volání potrvají data.</span><span class="sxs-lookup"><span data-stu-id="b6349-141">The business-logic class does not need to be aware of how the class that it's calling persists the data.</span></span> <span data-ttu-id="b6349-142">(To se často označuje jako *trvalost které*.) To usnadňuje testování, jednotky, protože třída obchodní logiky můžete připojit k implementace úložiště, který používá něco jako jednoduchý jako v paměti `List` kolekce k ukládání dat.</span><span class="sxs-lookup"><span data-stu-id="b6349-142">(This is often called *persistence ignorance*.) This facilitates unit testing, because you can connect the business-logic class to a repository implementation that uses something as simple as in-memory `List` collections to store data.</span></span>

> [!NOTE]
> <span data-ttu-id="b6349-143">Technicky jsou objekty entity stále není trvalost – které ignorují, protože jste instanci ze třídy, které dědí od rozhraní Entity Framework `EntityObject` třídy.</span><span class="sxs-lookup"><span data-stu-id="b6349-143">Technically, the entity objects are still not persistence-ignorant, because they're instantiated from classes that inherit from the Entity Framework's `EntityObject` class.</span></span> <span data-ttu-id="b6349-144">Pro dokončení trvalost které můžete použít *prostý staré objekty CLR*, nebo *POCOs*, místo objekty, které dědí od `EntityObject` třídy.</span><span class="sxs-lookup"><span data-stu-id="b6349-144">For complete persistence ignorance, you can use *plain old CLR objects*, or *POCOs*, in place of objects that inherit from the `EntityObject` class.</span></span> <span data-ttu-id="b6349-145">Použití POCOs je nad rámec tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="b6349-145">Using POCOs is beyond the scope of this tutorial.</span></span> <span data-ttu-id="b6349-146">Další informace najdete v tématu [testovatelnosti a Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx) na webu MSDN.)</span><span class="sxs-lookup"><span data-stu-id="b6349-146">For more information, see [Testability and Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx) on the MSDN website.)</span></span>


<span data-ttu-id="b6349-147">Teď se můžete připojit `ObjectDataSource` ovládacích prvků mají obchodní logiky třídy místo na úložišti a ověřte, že všechno funguje stejně jako předtím.</span><span class="sxs-lookup"><span data-stu-id="b6349-147">Now you can connect the `ObjectDataSource` controls to the business-logic class instead of to the repository and verify that everything works as it did before.</span></span>

<span data-ttu-id="b6349-148">V *Departments.aspx* a *DepartmentsAdd.aspx*, změňte všechny výskyty `TypeName="ContosoUniversity.DAL.SchoolRepository"` k `TypeName="ContosoUniversity.BLL.SchoolBL`".</span><span class="sxs-lookup"><span data-stu-id="b6349-148">In *Departments.aspx* and *DepartmentsAdd.aspx*, change each occurrence of `TypeName="ContosoUniversity.DAL.SchoolRepository"` to `TypeName="ContosoUniversity.BLL.SchoolBL`".</span></span> <span data-ttu-id="b6349-149">(Ve všech existují čtyři instancí.)</span><span class="sxs-lookup"><span data-stu-id="b6349-149">(There are four instances in all.)</span></span>

<span data-ttu-id="b6349-150">Spustit *Departments.aspx* a *DepartmentsAdd.aspx* stránky k ověření, že budou i nadále fungovat stejně jako před.</span><span class="sxs-lookup"><span data-stu-id="b6349-150">Run the *Departments.aspx* and *DepartmentsAdd.aspx* pages to verify that they still work as they did before.</span></span>

<span data-ttu-id="b6349-151">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="b6349-151">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image5.png)</span></span>

<span data-ttu-id="b6349-152">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="b6349-152">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image7.png)</span></span>

## <a name="creating-a-unit-test-project-and-repository-implementation"></a><span data-ttu-id="b6349-153">Vytvoření projektu testování částí a implementace úložiště</span><span class="sxs-lookup"><span data-stu-id="b6349-153">Creating a Unit-Test Project and Repository Implementation</span></span>

<span data-ttu-id="b6349-154">Přidat nový projekt na řešení pomocí **testovacího projektu** šablony a pojmenujte ji `ContosoUniversity.Tests`.</span><span class="sxs-lookup"><span data-stu-id="b6349-154">Add a new project to the solution using the **Test Project** template, and name it `ContosoUniversity.Tests`.</span></span>

<span data-ttu-id="b6349-155">V testu projektu přidejte odkaz na `System.Data.Entity` a přidejte odkaz na projekt `ContosoUniversity` projektu.</span><span class="sxs-lookup"><span data-stu-id="b6349-155">In the test project, add a reference to `System.Data.Entity` and add a project reference to the `ContosoUniversity` project.</span></span>

<span data-ttu-id="b6349-156">Nyní můžete vytvořit třídu úložiště, které budete používat s testy jednotek.</span><span class="sxs-lookup"><span data-stu-id="b6349-156">You can now create the repository class that you'll use with unit tests.</span></span> <span data-ttu-id="b6349-157">Úložiště dat pro toto úložiště bude v rámci třídy.</span><span class="sxs-lookup"><span data-stu-id="b6349-157">The data store for this repository will be within the class.</span></span>

<span data-ttu-id="b6349-158">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="b6349-158">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image9.png)</span></span>

<span data-ttu-id="b6349-159">V testu projektu vytvořte nový soubor třídy, pojmenujte ji *MockSchoolRepository.cs*a existujícího kódu nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="b6349-159">In the test project, create a new class file, name it *MockSchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample4.cs)]

<span data-ttu-id="b6349-160">Tato třída úložiště má stejné metody CRUD jako ten, který má přístup k rozhraní Entity Framework přímo, ale pracují s `List` kolekce v paměti, nikoli s databází.</span><span class="sxs-lookup"><span data-stu-id="b6349-160">This repository class has the same CRUD methods as the one that accesses the Entity Framework directly, but they work with `List` collections in memory instead of with a database.</span></span> <span data-ttu-id="b6349-161">To usnadňuje třídu testovací nastavit a ověřit testy částí pro třídu obchodní logiky.</span><span class="sxs-lookup"><span data-stu-id="b6349-161">This makes it easier for a test class to set up and validate unit tests for the business-logic class.</span></span>

## <a name="creating-unit-tests"></a><span data-ttu-id="b6349-162">Testování částí</span><span class="sxs-lookup"><span data-stu-id="b6349-162">Creating Unit Tests</span></span>

<span data-ttu-id="b6349-163">**Testování** šablona projektu pro můžete vytvořit třídu test jednotky se zakázaným inzerováním a svůj další úkol je tato třída upravit přidáním metody testů jednotek do ji pro obchodní logiky, která chcete přidat do třídy obchodní logiky.</span><span class="sxs-lookup"><span data-stu-id="b6349-163">The **Test** project template created a stub unit test class for you, and your next task is to modify this class by adding unit test methods to it for business logic that you want to add to the business-logic class.</span></span>

<span data-ttu-id="b6349-164">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="b6349-164">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image11.png)</span></span>

<span data-ttu-id="b6349-165">Na vysoké školy Contoso všechny jednotlivé lektorem lze pouze správce jednoho oddělení a je nutné přidat obchodní logiku a vynuťte toto pravidlo.</span><span class="sxs-lookup"><span data-stu-id="b6349-165">At Contoso University, any individual instructor can only be the administrator of a single department, and you need to add business logic to enforce this rule.</span></span> <span data-ttu-id="b6349-166">Začněte přidáním testy a spouštění testů neuvidíte nezdaří.</span><span class="sxs-lookup"><span data-stu-id="b6349-166">You will start by adding tests and running the tests to see them fail.</span></span> <span data-ttu-id="b6349-167">Budete pak přidejte kód a znovu spusťte testy, byla očekávána zobrazíte jejich předávání.</span><span class="sxs-lookup"><span data-stu-id="b6349-167">You'll then add the code and rerun the tests, expecting to see them pass.</span></span>

<span data-ttu-id="b6349-168">Otevřete *UnitTest1.cs* souboru a přidejte `using` pro obchodní logiku a data access vrstvy, které jste vytvořili v projektu ContosoUniversity příkazy:</span><span class="sxs-lookup"><span data-stu-id="b6349-168">Open the *UnitTest1.cs* file and add `using` statements for the business logic and data-access layers that you created in the ContosoUniversity project:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample5.cs)]

<span data-ttu-id="b6349-169">Nahraďte `TestMethod1` metoda pomocí následujících metod:</span><span class="sxs-lookup"><span data-stu-id="b6349-169">Replace the `TestMethod1` method with the following methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample6.cs)]

<span data-ttu-id="b6349-170">`CreateSchoolBL` Metoda vytvoří instanci třídy úložiště, kterou jste vytvořili pro projekt, který se potom předá do nové instance třídy obchodní logiky testování jednotka.</span><span class="sxs-lookup"><span data-stu-id="b6349-170">The `CreateSchoolBL` method creates an instance of the repository class that you created for the unit test project, which it then passes to a new instance of the business-logic class.</span></span> <span data-ttu-id="b6349-171">Metoda pak používá třídu obchodní logiky vložit tři oddělení, které můžete použít v testu metody.</span><span class="sxs-lookup"><span data-stu-id="b6349-171">The method then uses the business-logic class to insert three departments that you can use in test methods.</span></span>

<span data-ttu-id="b6349-172">Zkušební metody ověřte, že třídu obchodní logiky vyvolá výjimku, pokud se někdo pokusí vložit nový oddělení pomocí stejného správce jako existující oddělení, nebo pokud se někdo pokusí aktualizovat oddělení správce nastavit na ID osoby kdo je již správce jiného oddělení.</span><span class="sxs-lookup"><span data-stu-id="b6349-172">The test methods verify that the business-logic class throws an exception if someone tries to insert a new department with the same administrator as an existing department, or if someone tries to update a department's administrator by setting it to the ID of a person who is already the administrator of another department.</span></span>

<span data-ttu-id="b6349-173">Ještě jste nevytvořili třídy výjimek, tak nebude zkompilovat tento kód.</span><span class="sxs-lookup"><span data-stu-id="b6349-173">You haven't created the exception class yet, so this code will not compile.</span></span> <span data-ttu-id="b6349-174">Aby mohl zkompilovat, klikněte pravým tlačítkem na `DuplicateAdministratorException` a vyberte **generování**a potom **třída**.</span><span class="sxs-lookup"><span data-stu-id="b6349-174">To get it to compile, right-click `DuplicateAdministratorException` and select **Generate**, and then **Class**.</span></span>

<span data-ttu-id="b6349-175">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="b6349-175">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image13.png)</span></span>

<span data-ttu-id="b6349-176">Tím se vytvoří třídu v k testovacímu projektu, který můžete odstranit po vytvoření třídy výjimek v hlavní projekt.</span><span class="sxs-lookup"><span data-stu-id="b6349-176">This creates a class in the test project which you can delete after you've created the exception class in the main project.</span></span> <span data-ttu-id="b6349-177">a implementovat obchodní logiku.</span><span class="sxs-lookup"><span data-stu-id="b6349-177">and implemented the business logic.</span></span>

<span data-ttu-id="b6349-178">Spusťte projekt test.</span><span class="sxs-lookup"><span data-stu-id="b6349-178">Run the test project.</span></span> <span data-ttu-id="b6349-179">Podle očekávání, testy nezdaří.</span><span class="sxs-lookup"><span data-stu-id="b6349-179">As expected, the tests fail.</span></span>

<span data-ttu-id="b6349-180">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="b6349-180">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image15.png)</span></span>

## <a name="adding-business-logic-to-make-a-test-pass"></a><span data-ttu-id="b6349-181">Přidání obchodní logiku, aby průchodu testu</span><span class="sxs-lookup"><span data-stu-id="b6349-181">Adding Business Logic to Make a Test Pass</span></span>

<span data-ttu-id="b6349-182">Dále budete implementovat obchodní logiku, aby nebylo možné nastavit jako správce oddělení někoho, kdo je již správce jiného oddělení.</span><span class="sxs-lookup"><span data-stu-id="b6349-182">Next, you'll implement the business logic that makes it impossible to set as the administrator of a department someone who is already administrator of another department.</span></span> <span data-ttu-id="b6349-183">Budete výjimku z vrstvy obchodní logiky a když uživatel upravuje oddělení a klikne na tlačítko ji catch v prezentační vrstvě **aktualizace** po výběru uživatele, který je již správce.</span><span class="sxs-lookup"><span data-stu-id="b6349-183">You'll throw an exception from the business-logic layer, and then catch it in the presentation layer if a user edits a department and clicks **Update** after selecting someone who is already an administrator.</span></span> <span data-ttu-id="b6349-184">(Můžete také odebrat vyučující z rozevíracího seznamu, kteří jsou již správci před vykreslení stránky, ale tady se používá k práci s vrstvu obchodní logiky.)</span><span class="sxs-lookup"><span data-stu-id="b6349-184">(You could also remove instructors from the drop-down list who are already administrators before you render the page, but the purpose here is to work with the business-logic layer.)</span></span>

<span data-ttu-id="b6349-185">Začněte vytvořením třídy výjimky, která budete výjimku při pokusu uživatele, aby lektorem správce více než jednom oddělení.</span><span class="sxs-lookup"><span data-stu-id="b6349-185">Start by creating the exception class that you'll throw when a user tries to make an instructor the administrator of more than one department.</span></span> <span data-ttu-id="b6349-186">V hlavním projektu vytvořte nový soubor – třída v *BLL* složky, pojmenujte ji *DuplicateAdministratorException.cs*a existujícího kódu nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="b6349-186">In the main project, create a new class file in the *BLL* folder, name it *DuplicateAdministratorException.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample7.cs)]

<span data-ttu-id="b6349-187">Nyní odstranit dočasnou *DuplicateAdministratorException.cs* soubor, který jste vytvořili v k testovacímu projektu dříve aby mohl zkompilovat.</span><span class="sxs-lookup"><span data-stu-id="b6349-187">Now delete the temporary *DuplicateAdministratorException.cs* file that you created in the test project earlier in order to be able to compile.</span></span>

<span data-ttu-id="b6349-188">V hlavní projekt, otevřete *SchoolBL.cs* souboru a přidejte následující metodu, která obsahuje logiku ověření.</span><span class="sxs-lookup"><span data-stu-id="b6349-188">In the main project, open the *SchoolBL.cs* file and add the following method that contains the validation logic.</span></span> <span data-ttu-id="b6349-189">(Kód odkazuje na metodu, která vytvoříte později).</span><span class="sxs-lookup"><span data-stu-id="b6349-189">(The code refers to a method that you'll create later.)</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample8.cs)]

<span data-ttu-id="b6349-190">Budete volat tuto metodu, při vložení nebo aktualizace `Department` entity, aby bylo možné zkontrolujte, zda jiný oddělení již má stejné správce.</span><span class="sxs-lookup"><span data-stu-id="b6349-190">You'll call this method when you're inserting or updating `Department` entities in order to check whether another department already has the same administrator.</span></span>

<span data-ttu-id="b6349-191">Kód volá metody na hledání databáze `Department` entity, která má stejný `Administrator` hodnotu vlastnosti jako entity se přidají nebo aktualizují.</span><span class="sxs-lookup"><span data-stu-id="b6349-191">The code calls a method to search the database for a `Department` entity that has the same `Administrator` property value as the entity being inserted or updated.</span></span> <span data-ttu-id="b6349-192">Pokud je takový nalezen, kód vyvolá výjimku.</span><span class="sxs-lookup"><span data-stu-id="b6349-192">If one is found, the code throws an exception.</span></span> <span data-ttu-id="b6349-193">Kontrola žádné ověření je nutné, pokud entity se přidají nebo aktualizují neobsahuje žádné `Administrator` hodnota a žádná výjimka je vyvolána, pokud metoda je volána v průběhu aktualizace a `Department` entity nalezených shod `Department` aktualizaci entity.</span><span class="sxs-lookup"><span data-stu-id="b6349-193">No validation check is required if the entity being inserted or updated has no `Administrator` value, and no exception is thrown if the method is called during an update and the `Department` entity found matches the `Department` entity being updated.</span></span>

<span data-ttu-id="b6349-194">Volejte metodu nové z `Insert` a `Update` metody:</span><span class="sxs-lookup"><span data-stu-id="b6349-194">Call the new method from the `Insert` and `Update` methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample9.cs)]

<span data-ttu-id="b6349-195">V *ISchoolRepository.cs*, přidejte následující deklarace pro nová metoda přístupu k datům:</span><span class="sxs-lookup"><span data-stu-id="b6349-195">In *ISchoolRepository.cs*, add the following declaration for the new data-access method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample10.cs)]

<span data-ttu-id="b6349-196">V *SchoolRepository.cs*, přidejte následující `using` příkaz:</span><span class="sxs-lookup"><span data-stu-id="b6349-196">In *SchoolRepository.cs*, add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample11.cs)]

<span data-ttu-id="b6349-197">V *SchoolRepository.cs*, přidejte následující metodu nové přístup k datům:</span><span class="sxs-lookup"><span data-stu-id="b6349-197">In *SchoolRepository.cs*, add the following new data-access method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample12.cs)]

<span data-ttu-id="b6349-198">Tento kód načte `Department` entity, které mají zadaný správce.</span><span class="sxs-lookup"><span data-stu-id="b6349-198">This code retrieves `Department` entities that have a specified administrator.</span></span> <span data-ttu-id="b6349-199">Pouze jeden oddělení má nalezen (pokud existuje).</span><span class="sxs-lookup"><span data-stu-id="b6349-199">Only one department should be found (if any).</span></span> <span data-ttu-id="b6349-200">Však žádné omezení je integrovaná do databáze, je návratový typ kolekce, v případě, že se nacházejí více oddělení.</span><span class="sxs-lookup"><span data-stu-id="b6349-200">However, because no constraint is built into the database, the return type is a collection in case multiple departments are found.</span></span>

<span data-ttu-id="b6349-201">Ve výchozím nastavení pokud kontext objektu entity načte z databáze, se uchovává informace o jejich v jeho správce stavu objektu.</span><span class="sxs-lookup"><span data-stu-id="b6349-201">By default, when the object context retrieves entities from the database, it keeps track of them in its object state manager.</span></span> <span data-ttu-id="b6349-202">`MergeOption.NoTracking` Parametr určuje, že toto sledování nebudou provést pro tento dotaz.</span><span class="sxs-lookup"><span data-stu-id="b6349-202">The `MergeOption.NoTracking` parameter specifies that this tracking will not be done for this query.</span></span> <span data-ttu-id="b6349-203">To je nezbytné, protože dotaz může vrátit přesné entity, který se pokoušíte aktualizovat, a potom se budou moci připojit dané entity.</span><span class="sxs-lookup"><span data-stu-id="b6349-203">This is necessary because the query might return the exact entity that you're trying to update, and then you would not be able to attach that entity.</span></span> <span data-ttu-id="b6349-204">Například pokud chcete upravit do historie oddělení *Departments.aspx* stránky a nechte beze změny správce, tento dotaz vrátí oddělení historie.</span><span class="sxs-lookup"><span data-stu-id="b6349-204">For example, if you edit the History department in the *Departments.aspx* page and leave the administrator unchanged, this query will return the History department.</span></span> <span data-ttu-id="b6349-205">Pokud `NoTracking` není nastaven, kontext objektu by už máte entity oddělení historie v jeho správce stavu objektu.</span><span class="sxs-lookup"><span data-stu-id="b6349-205">If `NoTracking` is not set, the object context would already have the History department entity in its object state manager.</span></span> <span data-ttu-id="b6349-206">Pak když připojíte entity oddělení historie, který se znovu vytvoří ze zobrazení stavu, kontext objektu by způsobí výjimku, která uvádí, že `"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key"`.</span><span class="sxs-lookup"><span data-stu-id="b6349-206">Then when you attach the History department entity that's re-created from view state, the object context would throw an exception that says `"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key"`.</span></span>

<span data-ttu-id="b6349-207">(Jako alternativu k určení `MergeOption.NoTracking`, můžete vytvořit nový objekt kontextu pouze pro tento dotaz.</span><span class="sxs-lookup"><span data-stu-id="b6349-207">(As an alternative to specifying `MergeOption.NoTracking`, you could create a new object context just for this query.</span></span> <span data-ttu-id="b6349-208">Vzhledem k tomu, že nový kontext objektu by měla mít vlastní správce stavu objektu, by žádné konflikt při volání `Attach` metoda.</span><span class="sxs-lookup"><span data-stu-id="b6349-208">Because the new object context would have its own object state manager, there would be no conflict when you call the `Attach` method.</span></span> <span data-ttu-id="b6349-209">Nový objekt kontextu by sdílet metadata a připojení k databázi s původní objekt kontextu, takže snížení výkonu tohoto alternativní přístupu by být minimální.</span><span class="sxs-lookup"><span data-stu-id="b6349-209">The new object context would share metadata and database connection with the original object context, so the performance penalty of this alternate approach would be minimal.</span></span> <span data-ttu-id="b6349-210">Přístup zobrazeny zde, ale zavádí `NoTracking` možnost, která budete užitečné v jiných kontextech.</span><span class="sxs-lookup"><span data-stu-id="b6349-210">The approach shown here, however, introduces the `NoTracking` option, which you'll find useful in other contexts.</span></span> <span data-ttu-id="b6349-211">`NoTracking` Popsané možnost Další novější kurzu této série.)</span><span class="sxs-lookup"><span data-stu-id="b6349-211">The `NoTracking` option is discussed further in a later tutorial in this series.)</span></span>

<span data-ttu-id="b6349-212">V k testovacímu projektu, přidejte nová metoda přístupu k datům na *MockSchoolRepository.cs*:</span><span class="sxs-lookup"><span data-stu-id="b6349-212">In the test project, add the new data-access method to *MockSchoolRepository.cs*:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample13.cs)]

<span data-ttu-id="b6349-213">Tento kód používá LINQ provést stejný výběr dat, `ContosoUniversity` projektu úložiště používá technologii LINQ to Entities pro.</span><span class="sxs-lookup"><span data-stu-id="b6349-213">This code uses LINQ to perform the same data selection that the `ContosoUniversity` project repository uses LINQ to Entities for.</span></span>

<span data-ttu-id="b6349-214">K testovacímu projektu spusťte znovu.</span><span class="sxs-lookup"><span data-stu-id="b6349-214">Run the test project again.</span></span> <span data-ttu-id="b6349-215">Tentokrát jsou testy úspěšné.</span><span class="sxs-lookup"><span data-stu-id="b6349-215">This time the tests pass.</span></span>

<span data-ttu-id="b6349-216">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="b6349-216">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image17.png)</span></span>

## <a name="handling-objectdatasource-exceptions"></a><span data-ttu-id="b6349-217">Zpracování výjimek ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="b6349-217">Handling ObjectDataSource Exceptions</span></span>

<span data-ttu-id="b6349-218">V `ContosoUniversity` projektu, spusťte *Departments.aspx* stránky a pokuste se změnit správce pro oddělení na uživatele, který je již správce jiného oddělení.</span><span class="sxs-lookup"><span data-stu-id="b6349-218">In the `ContosoUniversity` project, run the *Departments.aspx* page and try to change the administrator for a department to someone who is already administrator for another department.</span></span> <span data-ttu-id="b6349-219">(Nezapomeňte, že můžete upravit pouze oddělení, které jste přidali během tohoto kurzu, protože databáze je předem zaveden s neplatnými daty.) Zobrazí se následující chybová stránka serveru:</span><span class="sxs-lookup"><span data-stu-id="b6349-219">(Remember that you can only edit departments that you added during this tutorial, because the database comes preloaded with invalid data.) You get the following server error page:</span></span>

<span data-ttu-id="b6349-220">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="b6349-220">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image19.png)</span></span>

<span data-ttu-id="b6349-221">Nechcete, aby uživatelům zobrazit tento druh chybovou stránku, takže je nutné přidat kód pro ošetření chyb.</span><span class="sxs-lookup"><span data-stu-id="b6349-221">You don't want users to see this kind of error page, so you need to add error-handling code.</span></span> <span data-ttu-id="b6349-222">Otevřete *Departments.aspx* a zadejte obslužnou rutinu pro `OnUpdated` události `DepartmentsObjectDataSource`.</span><span class="sxs-lookup"><span data-stu-id="b6349-222">Open *Departments.aspx* and specify a handler for the `OnUpdated` event of the `DepartmentsObjectDataSource`.</span></span> <span data-ttu-id="b6349-223">`ObjectDataSource` Počáteční značce nyní podobá následujícímu příkladu.</span><span class="sxs-lookup"><span data-stu-id="b6349-223">The `ObjectDataSource` opening tag now resembles the following example.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample14.aspx)]

<span data-ttu-id="b6349-224">V *Departments.aspx.cs*, přidejte následující `using` příkaz:</span><span class="sxs-lookup"><span data-stu-id="b6349-224">In *Departments.aspx.cs*, add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample15.cs)]

<span data-ttu-id="b6349-225">Přidejte následující obslužnou rutinu pro `Updated` událostí:</span><span class="sxs-lookup"><span data-stu-id="b6349-225">Add the following handler for the `Updated` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample16.cs)]

<span data-ttu-id="b6349-226">Pokud `ObjectDataSource` řízení zachytí výjimku při pokusu o provedení aktualizace, pak předá výjimku v argumentu události (`e`) k této obslužné rutiny.</span><span class="sxs-lookup"><span data-stu-id="b6349-226">If the `ObjectDataSource` control catches an exception when it tries to perform the update, it passes the exception in the event argument (`e`) to this handler.</span></span> <span data-ttu-id="b6349-227">Kód v obslužné rutině zkontroluje, pokud výjimka je výjimka duplicitní správce.</span><span class="sxs-lookup"><span data-stu-id="b6349-227">The code in the handler checks to see if the exception is the duplicate administrator exception.</span></span> <span data-ttu-id="b6349-228">Pokud se jedná, kód vytvoří validátoru ovládací prvek, který obsahuje chybovou zprávu pro `ValidationSummary` ovládacího prvku pro zobrazení.</span><span class="sxs-lookup"><span data-stu-id="b6349-228">If it is, the code creates a validator control that contains an error message for the `ValidationSummary` control to display.</span></span>

<span data-ttu-id="b6349-229">Spuštění stránky a pokusí se někdo znovu správce dvě oddělení.</span><span class="sxs-lookup"><span data-stu-id="b6349-229">Run the page and attempt to make someone the administrator of two departments again.</span></span> <span data-ttu-id="b6349-230">Tato doba `ValidationSummary` ovládací prvek zobrazí chybovou zprávu.</span><span class="sxs-lookup"><span data-stu-id="b6349-230">This time the `ValidationSummary` control displays an error message.</span></span>

<span data-ttu-id="b6349-231">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="b6349-231">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image21.png)</span></span>

<span data-ttu-id="b6349-232">Ujistěte se, podobně jako změny *DepartmentsAdd.aspx* stránky.</span><span class="sxs-lookup"><span data-stu-id="b6349-232">Make similar changes to the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="b6349-233">V *DepartmentsAdd.aspx*, zadejte obslužnou rutinu pro `OnInserted` události `DepartmentsObjectDataSource`.</span><span class="sxs-lookup"><span data-stu-id="b6349-233">In *DepartmentsAdd.aspx*, specify a handler for the `OnInserted` event of the `DepartmentsObjectDataSource`.</span></span> <span data-ttu-id="b6349-234">Výsledný kód bude podobat následujícímu příkladu.</span><span class="sxs-lookup"><span data-stu-id="b6349-234">The resulting markup will resemble the following example.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample17.aspx)]

<span data-ttu-id="b6349-235">V *DepartmentsAdd.aspx.cs*, přidání stejné `using` příkaz:</span><span class="sxs-lookup"><span data-stu-id="b6349-235">In *DepartmentsAdd.aspx.cs*, add the same `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample18.cs)]

<span data-ttu-id="b6349-236">Přidejte následující obslužné rutiny události:</span><span class="sxs-lookup"><span data-stu-id="b6349-236">Add the following event handler:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample19.cs)]

<span data-ttu-id="b6349-237">Nyní můžete otestovat *DepartmentsAdd.aspx.cs* a ověřte, že také správně zpracovává pokusy o nastavení jedna osoba správce více než jeden oddělení.</span><span class="sxs-lookup"><span data-stu-id="b6349-237">You can now test the *DepartmentsAdd.aspx.cs* page to verify that it also correctly handles attempts to make one person the administrator of more than one department.</span></span>

<span data-ttu-id="b6349-238">Tím dokončíte Úvod k implementaci použitému vzoru pro použití `ObjectDataSource` ovládacího prvku pomocí rozhraní Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="b6349-238">This completes the introduction to implementing the repository pattern for using the `ObjectDataSource` control with the Entity Framework.</span></span> <span data-ttu-id="b6349-239">Další informace o použitému vzoru úložišť a testovatelnosti, najdete v dokumentu White Paper MSDN [testovatelnosti a Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx).</span><span class="sxs-lookup"><span data-stu-id="b6349-239">For more information about the repository pattern and testability, see the MSDN whitepaper [Testability and Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx).</span></span>

<span data-ttu-id="b6349-240">V následujícím kurzu uvidíte, jak přidat řazení a filtrování funkce do aplikace.</span><span class="sxs-lookup"><span data-stu-id="b6349-240">In the following tutorial you'll see how to add sorting and filtering functionality to the application.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b6349-241">[Předchozí](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started.md)
> [další](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)</span><span class="sxs-lookup"><span data-stu-id="b6349-241">[Previous](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started.md)
[Next](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)</span></span>
