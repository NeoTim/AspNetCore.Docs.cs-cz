---
uid: identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
title: Migrace dat Universal zprostředkovatele členství a uživatelské profily mají být ASP.NET Identity (C#) | Microsoft Docs
author: rustd
description: Tento kurz popisuje kroky, které jsou potřebné k migraci uživatelů a rolí dat a data uživatelského profilu vytvořený Universal Providers stávající aplikace...
ms.author: aspnetcontent
manager: wpickett
ms.date: 12/13/2013
ms.topic: article
ms.assetid: 2e260430-d13c-4658-bd05-e256fc0d63b8
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 75d273d9fdb5d8ff0f7a910f42abe8bcce6e397d
ms.sourcegitcommit: e22097b84d26a812cd1380a6b2d12c93e522c125
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 06/22/2018
ms.locfileid: "36313997"
---
<a name="migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity-c"></a><span data-ttu-id="1684c-103">Migrace dat Universal zprostředkovatele členství a uživatelské profily mají být ASP.NET Identity (C#)</span><span class="sxs-lookup"><span data-stu-id="1684c-103">Migrating Universal Provider Data for Membership and User Profiles to ASP.NET Identity (C#)</span></span>
====================
<span data-ttu-id="1684c-104">podle [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Roberta Mcmurrayho](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="1684c-104">by [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="1684c-105">Tento kurz popisuje kroky, které jsou potřebné k migraci uživatelů a rolí dat a data uživatelského profilu vytvořené pomocí stávající aplikace do modelu identitu ASP.NET Universal Providers.</span><span class="sxs-lookup"><span data-stu-id="1684c-105">This tutorial describes the steps that are necessary to migrate user and role data and user profile data created using Universal Providers of an existing application to the ASP.NET Identity model.</span></span> <span data-ttu-id="1684c-106">Přístup se zde uvedeným k migraci dat profilu uživatele lze v aplikaci s také členství SQL.</span><span class="sxs-lookup"><span data-stu-id="1684c-106">The approach mentioned here to migrate user profile data can be used in an application with SQL membership as well.</span></span>


<span data-ttu-id="1684c-107">S verzí sady Visual Studio 2013, ASP.NET team zavedly nový systém ASP.NET Identity, které si můžete přečíst informace o tomto vydání [zde](../../index.md).</span><span class="sxs-lookup"><span data-stu-id="1684c-107">With the release of Visual Studio 2013, the ASP.NET team introduced a new ASP.NET Identity system, and you can read more about that release [here](../../index.md).</span></span> <span data-ttu-id="1684c-108">Následující na článek migrace webových aplikací z [členství SQL do nového systému Identity](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), tento článek ukazuje kroky při migraci stávajících aplikací, které následují modelu poskytovatelé pro správu uživatelů a rolí do nového modelu Identity.</span><span class="sxs-lookup"><span data-stu-id="1684c-108">Following up on the article to migrate web applications from [SQL Membership to the new Identity system](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), this article illustrates the steps to migrate existing applications that follow the Providers model for user and role management to the new Identity model.</span></span> <span data-ttu-id="1684c-109">Fokus tohoto kurzu bude hlavně na migraci dat profilu uživatele se bezproblémově připojí do nového systému.</span><span class="sxs-lookup"><span data-stu-id="1684c-109">The focus of this tutorial will be primarily on migrating the user profile data to seamlessly hook it into the new system.</span></span> <span data-ttu-id="1684c-110">Informace o migraci uživatelů a rolí je podobné pro členství SQL.</span><span class="sxs-lookup"><span data-stu-id="1684c-110">Migrating user and role information is similar for SQL membership.</span></span> <span data-ttu-id="1684c-111">Přístup k migraci dat profilu a potom lze v aplikaci s také členství SQL.</span><span class="sxs-lookup"><span data-stu-id="1684c-111">The approach followed to migrate profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="1684c-112">Jako příklad spustíme s webové aplikace vytvořený pomocí Visual Studio 2012, která používá model poskytovatelů.</span><span class="sxs-lookup"><span data-stu-id="1684c-112">As an example, we will start with a web app created using Visual Studio 2012 which uses the Providers model.</span></span> <span data-ttu-id="1684c-113">Jsme budete pak přidat kód pro správu profilů, zaregistrovat uživatele, přidat data profilu pro uživatele, migraci schématu databáze a poté změňte aplikaci používat systém identit pro správu uživatelů a rolí.</span><span class="sxs-lookup"><span data-stu-id="1684c-113">We'll then add code for profile management, register a user, add profile data for the users, migrate the database schema, and then change the application to use the Identity system for user and role management.</span></span> <span data-ttu-id="1684c-114">Jako test migrace uživatelé vytvořený Universal Providers by měli být schopni se přihlásit a noví uživatelé musí být možné zaregistrovat.</span><span class="sxs-lookup"><span data-stu-id="1684c-114">As a test of migration, users created using Universal Providers should be able to log in and new users should be able to register.</span></span>

> [!NOTE]
> <span data-ttu-id="1684c-115">Můžete najít úplnou ukázku najdete na adrese [ https://github.com/suhasj/UniversalProviders-Identity-Migrations ](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span><span class="sxs-lookup"><span data-stu-id="1684c-115">You can find the complete sample at [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span></span>


## <a name="profile-data-migration-summary"></a><span data-ttu-id="1684c-116">Souhrn migrace dat profilu</span><span class="sxs-lookup"><span data-stu-id="1684c-116">Profile data migration summary</span></span>

<span data-ttu-id="1684c-117">Před zahájením s byla migrace, dejte nám se podívejte na možnosti ukládání dat profilu v modelu poskytovatelů.</span><span class="sxs-lookup"><span data-stu-id="1684c-117">Before starting with the migrations, let us look at the experience of storing profile data in the Providers model.</span></span> <span data-ttu-id="1684c-118">Data profilu pro aplikaci, kterou uživatelé mohou být uloženy ve více způsobů, nejběžnější mezi nimi probíhá pomocí integrované profilu zprostředkovatele dodaný spolu s Universal Providers.</span><span class="sxs-lookup"><span data-stu-id="1684c-118">Profile data for application users can be stored in multiple ways, the most common among them being using the inbuilt profile providers shipped along with the Universal Providers.</span></span> <span data-ttu-id="1684c-119">By mělo zahrnovat kroky</span><span class="sxs-lookup"><span data-stu-id="1684c-119">The steps would include</span></span>

1. <span data-ttu-id="1684c-120">Přidejte třídu, která obsahuje vlastnosti, které používají k ukládání dat profilu.</span><span class="sxs-lookup"><span data-stu-id="1684c-120">Add a class that has properties used to store Profile data.</span></span>
2. <span data-ttu-id="1684c-121">Přidejte třídu, která rozšiřuje 'ProfileBase' a implementuje metody k získání výše uvedená data profilu pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="1684c-121">Add a class that extends 'ProfileBase' and implements methods to get the above profile data for the user.</span></span>
3. <span data-ttu-id="1684c-122">Povolit použití výchozí profil zprostředkovatele v *web.config* souboru a definovat třídu deklarované v kroku 2 #, který se má použít při přístupu ke informace o profilu.</span><span class="sxs-lookup"><span data-stu-id="1684c-122">Enable using default profile providers in the *web.config* file and define the class declared in step #2 to be used in accessing profile information.</span></span>

<span data-ttu-id="1684c-123">Informace o profilu se ukládají jako serializovaný xml a binární data v tabulce 'profily, v databázi.</span><span class="sxs-lookup"><span data-stu-id="1684c-123">The profile information is stored as serialized xml and binary data in the 'Profiles' table in the database.</span></span>

<span data-ttu-id="1684c-124">Po migraci aplikaci, aby používala nový systém ASP.NET Identity, je informace o profilu deserializovat a uloženy jako vlastnosti na třídu uživatelů.</span><span class="sxs-lookup"><span data-stu-id="1684c-124">After migrating the application to use the new ASP.NET Identity system, the profile information is deserialized and stored as properties on the user class.</span></span> <span data-ttu-id="1684c-125">Každou vlastnost pak lze mapovat na sloupce v tabulce uživatelských.</span><span class="sxs-lookup"><span data-stu-id="1684c-125">Each property can then be mapped onto columns in the user table.</span></span> <span data-ttu-id="1684c-126">Výhoda zde spočívá v tom, že vlastnosti bylo možné pracovat přímo pomocí třídu uživatelů kromě nemá k serializaci nebo deserializaci dat informace čas při k ní přistupují.</span><span class="sxs-lookup"><span data-stu-id="1684c-126">The advantage here is that the properties can be worked on directly using the user class in addition to not having to serialize/deserialize data information each time when accessing it.</span></span>

## <a name="getting-started"></a><span data-ttu-id="1684c-127">Začínáme</span><span class="sxs-lookup"><span data-stu-id="1684c-127">Getting Started</span></span>

1. <span data-ttu-id="1684c-128">Vytvoření nové aplikace webových formulářů ASP.NET 4.5 v sadě Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="1684c-128">Create a new ASP.NET 4.5 Web Forms application in Visual Studio 2012.</span></span> <span data-ttu-id="1684c-129">Aktuální Ukázka používá šablony webových formulářů, ale můžete také použít aplikaci MVC.</span><span class="sxs-lookup"><span data-stu-id="1684c-129">The current sample uses the Web Forms template, but you could use MVC Application as well.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="1684c-130">Vytvořte novou složku 'modely, k ukládání informací o profilu</span><span class="sxs-lookup"><span data-stu-id="1684c-130">Create a new folder 'Models' to store profile information</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.png)
3. <span data-ttu-id="1684c-131">Jako příklad dejte nám uložte datum narození, Město, výšky a váhu uživatele v profilu.</span><span class="sxs-lookup"><span data-stu-id="1684c-131">As an example, let us store the date of birth, city, height and weight of the user in profile.</span></span> <span data-ttu-id="1684c-132">Výška a váhy jsou uloženy jako vlastní třídu s názvem 'PersonalStats'.</span><span class="sxs-lookup"><span data-stu-id="1684c-132">The height and weight are stored as a custom class called 'PersonalStats'.</span></span> <span data-ttu-id="1684c-133">K ukládání a načítání profil, potřebujeme třídu, která rozšiřuje 'ProfileBase'.</span><span class="sxs-lookup"><span data-stu-id="1684c-133">To store and retrieve the profile, we need a class that extends 'ProfileBase'.</span></span> <span data-ttu-id="1684c-134">Umožňuje vytvořit novou třídu, AppProfile' Pokud chcete získat a ukládání informací o profilu.</span><span class="sxs-lookup"><span data-stu-id="1684c-134">Let's create a new class 'AppProfile' to get and store profile information.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample1.cs)]
4. <span data-ttu-id="1684c-135">Povolit v profilu *web.config* souboru.</span><span class="sxs-lookup"><span data-stu-id="1684c-135">Enable profile in the *web.config* file.</span></span> <span data-ttu-id="1684c-136">Zadejte název třídy, který se má použít pro ukládání a načítání informace o uživateli, které jsou vytvořené v kroku #3.</span><span class="sxs-lookup"><span data-stu-id="1684c-136">Enter the class name to be used to store/retrieve user information created in step #3.</span></span>

    [!code-xml[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample2.xml)]
5. <span data-ttu-id="1684c-137">Přidáte stránku webové formuláře ve složce "Účtem" získat data profilu od uživatele a uložte ho.</span><span class="sxs-lookup"><span data-stu-id="1684c-137">Add a web forms page in 'Account' folder to get the profile data from the user and store it.</span></span> <span data-ttu-id="1684c-138">Klikněte pravým tlačítkem na projekt a vyberte možnost "Přidat novou položku".</span><span class="sxs-lookup"><span data-stu-id="1684c-138">Right click on project and select 'Add new Item'.</span></span> <span data-ttu-id="1684c-139">Přidání nové stránky webových formulářů s stránky předlohy 'AddProfileData.aspx'.</span><span class="sxs-lookup"><span data-stu-id="1684c-139">Add a new webforms page with master page 'AddProfileData.aspx'.</span></span> <span data-ttu-id="1684c-140">V části "MainContent, zkopírujte následující:</span><span class="sxs-lookup"><span data-stu-id="1684c-140">Copy the following in the 'MainContent' section:</span></span>

    [!code-html[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample3.html)]

   <span data-ttu-id="1684c-141">Přidejte následující kód v kódu:</span><span class="sxs-lookup"><span data-stu-id="1684c-141">Add the following code in the code behind:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample4.cs)]

   <span data-ttu-id="1684c-142">Přidáte obor názvů, pod které AppProfile třída definována, chcete-li odebrat chyby kompilace.</span><span class="sxs-lookup"><span data-stu-id="1684c-142">Add the namespace under which AppProfile class is defined to remove the compilation errors.</span></span>
6. <span data-ttu-id="1684c-143">Spusťte aplikaci a vytvořit nového uživatele s uživatelským jménem "**olduser'.**</span><span class="sxs-lookup"><span data-stu-id="1684c-143">Run the app and create a new user with username '**olduser'.**</span></span> <span data-ttu-id="1684c-144">Přejděte na stránku 'AddProfileData' a přidejte informace o profilu pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="1684c-144">Navigate to the 'AddProfileData' page and add profile information for the user.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.png)

<span data-ttu-id="1684c-145">Můžete ověřit, že jsou data uložena jako serializovaný xml v tabulce 'profily, pomocí okna Průzkumníka serveru.</span><span class="sxs-lookup"><span data-stu-id="1684c-145">You can verify that the data is stored as serialized xml in the 'Profiles' table using the Server Explorer window.</span></span> <span data-ttu-id="1684c-146">V sadě Visual Studio z nabídky, zobrazení, zvolte 'Průzkumníka serveru'.</span><span class="sxs-lookup"><span data-stu-id="1684c-146">In Visual Studio, from 'View' menu, choose 'Server Explorer'.</span></span> <span data-ttu-id="1684c-147">Měla by existovat datové připojení pro databázi definované v *web.config* souboru.</span><span class="sxs-lookup"><span data-stu-id="1684c-147">There should be a data connection for the database defined in the *web.config* file.</span></span> <span data-ttu-id="1684c-148">Kliknutím na datové připojení zobrazí různé dílčí kategorie.</span><span class="sxs-lookup"><span data-stu-id="1684c-148">Clicking on the data connection shows different sub categories.</span></span> <span data-ttu-id="1684c-149">Rozbalte 'Tabulky' zobrazit různých tabulek v databázi, potom klikněte pravým tlačítkem na 'profily, a zvolte 'Zobrazit Data tabulky' Chcete-li zobrazit data profilu uložená v tabulce profilů.</span><span class="sxs-lookup"><span data-stu-id="1684c-149">Expand 'Tables' to show the different tables in your database, then right click on 'Profiles' and choose 'Show Table Data' to view the profile data stored in the Profiles table.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.png)

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image4.png)

## <a name="migrating-database-schema"></a><span data-ttu-id="1684c-150">Migrace schématu databáze</span><span class="sxs-lookup"><span data-stu-id="1684c-150">Migrating database schema</span></span>

<span data-ttu-id="1684c-151">Chcete-li pracovat s systém identit existující databázi, je potřeba aktualizovat schéma v databázi Identity pro podporu pole, kterou jsme přidali do původní databáze.</span><span class="sxs-lookup"><span data-stu-id="1684c-151">To make the existing database work with the Identity system, we need to update the schema in the Identity database to support the fields we added to the original database.</span></span> <span data-ttu-id="1684c-152">To lze provést pomocí skriptů SQL k vytvoření nové tabulky a zkopírovat informace.</span><span class="sxs-lookup"><span data-stu-id="1684c-152">This can be done using SQL scripts to create new tables and copy the existing information.</span></span> <span data-ttu-id="1684c-153">V okně 'Průzkumníka serveru, rozbalte možnost "DefaultConnection' k zobrazení tabulek.</span><span class="sxs-lookup"><span data-stu-id="1684c-153">In the 'Server Explorer' window, expand the 'DefaultConnection' to display the tables.</span></span> <span data-ttu-id="1684c-154">Klikněte pravým tlačítkem na tabulky a vyberte možnost 'nový dotaz.</span><span class="sxs-lookup"><span data-stu-id="1684c-154">Right click Tables and select 'New Query'</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image5.png)

<span data-ttu-id="1684c-155">Vložte skript SQL z [ https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt ](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) a potom ho spusťte.</span><span class="sxs-lookup"><span data-stu-id="1684c-155">Paste the SQL script from [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) and run it.</span></span> <span data-ttu-id="1684c-156">Pokud 'objekt DefaultConnection, aktualizaci, vidíme, aby byly přidány nové tabulky.</span><span class="sxs-lookup"><span data-stu-id="1684c-156">If the 'DefaultConnection' is refreshed, we can see that the new tables are added.</span></span> <span data-ttu-id="1684c-157">Můžete zkontrolovat data uvnitř tabulek, které chcete zobrazit, že byla migrována informace.</span><span class="sxs-lookup"><span data-stu-id="1684c-157">You can check the data inside the tables to see that the information has been migrated.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image6.png)

## <a name="migrating-the-application-to-use-aspnet-identity"></a><span data-ttu-id="1684c-158">Migrace aplikace pro používání ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="1684c-158">Migrating the application to use ASP.NET Identity</span></span>

1. <span data-ttu-id="1684c-159">Instalace balíčků Nuget, které jsou potřebné pro ASP.NET Identity:</span><span class="sxs-lookup"><span data-stu-id="1684c-159">Install the Nuget packages needed for ASP.NET Identity:</span></span>

    - <span data-ttu-id="1684c-160">Microsoft.AspNet.Identity.EntityFramework</span><span class="sxs-lookup"><span data-stu-id="1684c-160">Microsoft.AspNet.Identity.EntityFramework</span></span>
    - <span data-ttu-id="1684c-161">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="1684c-161">Microsoft.AspNet.Identity.Owin</span></span>
    - <span data-ttu-id="1684c-162">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="1684c-162">Microsoft.Owin.Host.SystemWeb</span></span>
    - <span data-ttu-id="1684c-163">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="1684c-163">Microsoft.Owin.Security.Facebook</span></span>
    - <span data-ttu-id="1684c-164">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="1684c-164">Microsoft.Owin.Security.Google</span></span>
    - <span data-ttu-id="1684c-165">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="1684c-165">Microsoft.Owin.Security.MicrosoftAccount</span></span>
    - <span data-ttu-id="1684c-166">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="1684c-166">Microsoft.Owin.Security.Twitter</span></span>

   <span data-ttu-id="1684c-167">Další informace o spravovat balíčky Nuget najdete [sem](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span><span class="sxs-lookup"><span data-stu-id="1684c-167">More information on managing Nuget packages can be found [here](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span></span>
2. <span data-ttu-id="1684c-168">Pro práci s existujícími daty v tabulce, potřebujeme vytvořit model třídy, které mapování zpět do tabulky a propojte je v systému Identity.</span><span class="sxs-lookup"><span data-stu-id="1684c-168">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="1684c-169">V rámci Identity kontraktu třídy modelu buď musí implementovat rozhraní definované v knihovně dll Identity.Core nebo můžete rozšířit stávající provádění těchto rozhraní, které jsou k dispozici v Microsoft.AspNet.Identity.EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="1684c-169">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span> <span data-ttu-id="1684c-170">Použijeme existujících tříd pro roli, přihlášení uživatele a deklarace identity uživatelů.</span><span class="sxs-lookup"><span data-stu-id="1684c-170">We will be using the existing classes for role, user logins and user claims.</span></span> <span data-ttu-id="1684c-171">Je potřeba použít vlastního uživatele pro naše ukázka.</span><span class="sxs-lookup"><span data-stu-id="1684c-171">We need to use a custom user for our sample.</span></span> <span data-ttu-id="1684c-172">Klikněte pravým tlačítkem na projekt a vytvořte novou složku 'IdentityModels'.</span><span class="sxs-lookup"><span data-stu-id="1684c-172">Right click on the project and create new folder 'IdentityModels'.</span></span> <span data-ttu-id="1684c-173">Přidejte novou třídu "Uživatelem", jak je uvedeno níže:</span><span class="sxs-lookup"><span data-stu-id="1684c-173">Add a new 'User' class as shown below:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample5.cs)]

   <span data-ttu-id="1684c-174">Všimněte si, ProfileInfo je nyní vlastnost v třídě uživatele.</span><span class="sxs-lookup"><span data-stu-id="1684c-174">Notice that the 'ProfileInfo' is now a property on the user class.</span></span> <span data-ttu-id="1684c-175">Proto jsme můžete použít třídu uživatele přímo pracovat s daty profilu.</span><span class="sxs-lookup"><span data-stu-id="1684c-175">Hence we can use the user class to directly work with profile data.</span></span>

<span data-ttu-id="1684c-176">Zkopírujte soubory v **IdentityModels** a **IdentityAccount** složek ze zdroje stahování ( [ https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations ](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span><span class="sxs-lookup"><span data-stu-id="1684c-176">Copy the files in the **IdentityModels** and **IdentityAccount** folders from the download source ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span></span> <span data-ttu-id="1684c-177">Tyto mají zbývající třídy modelu a potřebné pro správu rolí pomocí rozhraní API ASP.NET Identity uživatelů a nové stránky.</span><span class="sxs-lookup"><span data-stu-id="1684c-177">These have the remaining model classes and the new pages needed for user and role management using the ASP.NET Identity APIs.</span></span> <span data-ttu-id="1684c-178">Metoda používaná je podobný členství SQL a naleznete podrobné vysvětlení [zde](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="1684c-178">The approach used is similar to the SQL Membership and the detailed explanation can be found [here](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span></span>

[!INCLUDE[](../../../includes/identity/alter-command-exception.md)]

## <a name="copying-profile-data-to-the-new-tables"></a><span data-ttu-id="1684c-179">Kopírování dat profilu do nové tabulky</span><span class="sxs-lookup"><span data-stu-id="1684c-179">Copying Profile data to the new tables</span></span>

<span data-ttu-id="1684c-180">Jak už bylo zmíněno dříve, je potřeba deserializovat xml data v tabulkách profily a uložte ho sloupce tabulky AspNetUsers.</span><span class="sxs-lookup"><span data-stu-id="1684c-180">As mentioned earlier, we need to deserialize the xml data in the Profiles tables and store it in the columns of the AspNetUsers table.</span></span> <span data-ttu-id="1684c-181">Nové sloupce byly vytvořeny v tabulce uživatelů v předchozím kroku, takže již zbývá k naplnění tyto sloupce s potřebná data.</span><span class="sxs-lookup"><span data-stu-id="1684c-181">The new columns were created in the users table in the previous step so all that is left is to populate those columns with the necessary data.</span></span> <span data-ttu-id="1684c-182">K tomuto účelu použijeme konzolovou aplikaci, která se spustí jednou k naplnění nově vytvořený sloupců v tabulce uživatelů.</span><span class="sxs-lookup"><span data-stu-id="1684c-182">To do this, we will use a console application which is run once to populate the newly created columns in the users table.</span></span>

1. <span data-ttu-id="1684c-183">Vytvořte novou konzolovou aplikaci v existujícímu řešení.</span><span class="sxs-lookup"><span data-stu-id="1684c-183">Create a new console application in the exiting solution.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.jpg)
2. <span data-ttu-id="1684c-184">Nainstalujte nejnovější verzi balíčku Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="1684c-184">Install the latest version of the Entity Framework package.</span></span>
3. <span data-ttu-id="1684c-185">Přidáte webovou aplikaci vytvořili výše jako odkaz na konzolové aplikace.</span><span class="sxs-lookup"><span data-stu-id="1684c-185">Add the web application created above as a reference to the console application.</span></span> <span data-ttu-id="1684c-186">Uděláte to klikněte pravým tlačítkem na projekt a potom "Přidat odkazy", pak řešení, potom klikněte na projekt a klikněte na tlačítko OK.</span><span class="sxs-lookup"><span data-stu-id="1684c-186">To do this right click on Project, then 'Add References', then Solution, then click on the project and click OK.</span></span>
4. <span data-ttu-id="1684c-187">Kopírování níže uvedeného kódu ve třídě Program.cs.</span><span class="sxs-lookup"><span data-stu-id="1684c-187">Copy the below code in the Program.cs class.</span></span> <span data-ttu-id="1684c-188">Tato logika čte data profilu pro každého uživatele, serializuje jako 'ProfileInfo' objekt a uloží je zpět do databáze.</span><span class="sxs-lookup"><span data-stu-id="1684c-188">This logic reads profile data for each user, serializes it as 'ProfileInfo' object and stores it back to the database.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample6.cs)]

   <span data-ttu-id="1684c-189">Některé modely použité jsou definovány ve složce 'IdentityModels' projekt webové aplikace, musí obsahovat odpovídající obory názvů.</span><span class="sxs-lookup"><span data-stu-id="1684c-189">Some of the models used are defined in the 'IdentityModels' folder of the web application project, so you must include the corresponding namespaces.</span></span>
5. <span data-ttu-id="1684c-190">Ve výše uvedeném kódu funguje na soubor databáze v aplikaci\_vytvořit složku Data projektu webové aplikace v předchozích krocích.</span><span class="sxs-lookup"><span data-stu-id="1684c-190">The above code works on the database file in the App\_Data folder of the web application project created in the previous steps.</span></span> <span data-ttu-id="1684c-191">Chcete-li který, aktualizujte připojovací řetězec v souboru app.config v konzolové aplikace s připojovací řetězec v souboru web.config webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="1684c-191">To reference that, update the connection string in the app.config file of the console application with the connection string in the web.config of the web application.</span></span> <span data-ttu-id="1684c-192">Zadejte také úplnou fyzickou cestu ve vlastnosti 'AttachDbFilename'.</span><span class="sxs-lookup"><span data-stu-id="1684c-192">Also provide the complete physical path in the 'AttachDbFilename' property.</span></span>
6. <span data-ttu-id="1684c-193">Otevřete příkazový řádek a přejděte do složky bin výše konzolové aplikace.</span><span class="sxs-lookup"><span data-stu-id="1684c-193">Open a command prompt and navigate to the bin folder of the above console application.</span></span> <span data-ttu-id="1684c-194">Spuštění spustitelného souboru a prohlédněte si výstup protokolu, jak je znázorněno na následujícím obrázku.</span><span class="sxs-lookup"><span data-stu-id="1684c-194">Run the executable and review the log output as shown in the following image.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.jpg)
7. <span data-ttu-id="1684c-195">Otevřete v tabulce 'AspNetUsers' v Průzkumníku serveru a ověřit data v nové sloupce, které mají vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="1684c-195">Open the 'AspNetUsers' table in the Server Explorer and verify the data in the new columns that hold the properties.</span></span> <span data-ttu-id="1684c-196">Je třeba aktualizovat s odpovídající hodnoty vlastností.</span><span class="sxs-lookup"><span data-stu-id="1684c-196">They should be updated with the corresponding property values.</span></span>

## <a name="verify-functionality"></a><span data-ttu-id="1684c-197">Ověřte funkčnost</span><span class="sxs-lookup"><span data-stu-id="1684c-197">Verify functionality</span></span>

<span data-ttu-id="1684c-198">Pomocí stránky nově přidané členství, které jsou implementovány pomocí ASP.NET Identity k přihlášení uživatele z databáze staré.</span><span class="sxs-lookup"><span data-stu-id="1684c-198">Use the newly added membership pages that are implemented using ASP.NET Identity to login a user from the old database.</span></span> <span data-ttu-id="1684c-199">Uživatel by měl být moct přihlásit pomocí stejných přihlašovacích údajů.</span><span class="sxs-lookup"><span data-stu-id="1684c-199">The user should be able to log in using the same credentials.</span></span> <span data-ttu-id="1684c-200">Vyzkoušejte jiné funkce jako je přidání OAuth, vytváření nového uživatele, změna hesla, přidání rolí, přidání uživatelů do rolí, atd.</span><span class="sxs-lookup"><span data-stu-id="1684c-200">Try the other functionalities like adding OAuth, creating a new user, changing a password, adding roles, add users to roles, etc.</span></span>

<span data-ttu-id="1684c-201">Data profilu pro původního uživatele a noví uživatelé musí načíst a uložené v tabulce uživatelů.</span><span class="sxs-lookup"><span data-stu-id="1684c-201">The Profile data for the old user and the new users should be retrieved and stored in the users table.</span></span> <span data-ttu-id="1684c-202">Staré tabulky by už odkazovat.</span><span class="sxs-lookup"><span data-stu-id="1684c-202">The old table should no longer be referenced.</span></span>

## <a name="conclusion"></a><span data-ttu-id="1684c-203">Závěr</span><span class="sxs-lookup"><span data-stu-id="1684c-203">Conclusion</span></span>

<span data-ttu-id="1684c-204">Článek popisuje proces migrace webových aplikací, které používají model zprostředkovatele pro členství ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="1684c-204">The article described the process of migrating web applications that used the provider model for membership to ASP.NET Identity.</span></span> <span data-ttu-id="1684c-205">Článek dále uvedených migrace data profilu pro uživatele k jazyka do systém identit.</span><span class="sxs-lookup"><span data-stu-id="1684c-205">The article additionally outlined migrating profile data for users to be hooked into the Identity system.</span></span> <span data-ttu-id="1684c-206">Nechejte prosím komentáře níže odpovědi na otázky a problémy došlo při migraci vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="1684c-206">Please leave comments below for questions and issues encountered when you migrate your app.</span></span>

<span data-ttu-id="1684c-207">*Díky Rick Anderson a Roberta Mcmurrayho kontroly článek.*</span><span class="sxs-lookup"><span data-stu-id="1684c-207">*Thanks to Rick Anderson and Robert McMurray for reviewing the article.*</span></span>
