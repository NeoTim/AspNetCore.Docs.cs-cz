---
uid: identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
title: Potvrzení účtu a obnovení hesla s ASP.NET Identity (C#) | Dokumentace Microsoftu
author: HaoK
description: Před tímto kurzem, které by se měla Dokončit nejdříve vytvořte zabezpečenou webovou aplikaci ASP.NET MVC 5 s přihlášením, resetovat heslo a potvrzení e-mailu. V tomto kurzu...
ms.author: riande
ms.date: 03/26/2015
ms.assetid: 8d54180d-f826-4df7-b503-7debf5ed9fb3
msc.legacyurl: /identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 77a3e9d5e8b2698d2464e33520d779febd4533bd
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/16/2018
ms.locfileid: "41756727"
---
<a name="account-confirmation-and-password-recovery-with-aspnet-identity-c"></a><span data-ttu-id="aeadc-104">Potvrzení účtu a obnovení hesla s ASP.NET Identity (C#)</span><span class="sxs-lookup"><span data-stu-id="aeadc-104">Account Confirmation and Password Recovery with ASP.NET Identity (C#)</span></span>
====================
<span data-ttu-id="aeadc-105">podle [Haovi společnosti ani](https://github.com/HaoK), [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="aeadc-105">by [Hao Kung](https://github.com/HaoK), [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://github.com/Rick-Anderson), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="aeadc-106">Před zahájením tohoto kurzu byste měli nejprve dokončit [vytvořit zabezpečenou webovou aplikaci ASP.NET MVC 5 s přihlášením, resetovat heslo a potvrzení e-mailu](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span><span class="sxs-lookup"><span data-stu-id="aeadc-106">Before doing this tutorial you should first complete [Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span> <span data-ttu-id="aeadc-107">Tento kurz obsahuje další podrobnosti a obsahuje pokyny k nastavení e-mailu pro místní účet potvrzení a umožnit uživatelům resetovat zapomenuté heslo v ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="aeadc-107">This tutorial contains more details and will show you how to set up email for local account confirmation and allow users to reset their forgotten password in ASP.NET Identity.</span></span> <span data-ttu-id="aeadc-108">Tento článek zapsal Rick Anderson ([@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)), Pranav Rastogi ([@rustd](https://twitter.com/rustd)), ani Haovi společnosti a Suhas Joshi.</span><span class="sxs-lookup"><span data-stu-id="aeadc-108">This article was written by Rick Anderson ([@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)), Pranav Rastogi ([@rustd](https://twitter.com/rustd)), Hao Kung, and Suhas Joshi.</span></span> <span data-ttu-id="aeadc-109">Ukázka NuGet zapsal primárně ani Haovi společnosti.</span><span class="sxs-lookup"><span data-stu-id="aeadc-109">The NuGet sample was written primarily by Hao Kung.</span></span>


<span data-ttu-id="aeadc-110">Místní uživatelský účet vyžaduje, aby uživatel muset vytvořit heslo pro účet a toto heslo (zabezpečené) uložená ve webové aplikaci.</span><span class="sxs-lookup"><span data-stu-id="aeadc-110">A local user account requires the user to create a password for the account, and that password is stored (securely) in the web app.</span></span> <span data-ttu-id="aeadc-111">ASP.NET Identity podporuje také účtů na sociálních sítích, které nevyžadují uživateli vytvořit heslo aplikace.</span><span class="sxs-lookup"><span data-stu-id="aeadc-111">ASP.NET Identity also supports social accounts, which don't require the user to create a password for the app.</span></span> <span data-ttu-id="aeadc-112">[Účtů na sociálních sítích](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) třetích stran (jako jsou Google, Twitter, Facebook nebo Microsoft) použít k ověřování uživatelů.</span><span class="sxs-lookup"><span data-stu-id="aeadc-112">[Social accounts](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) use a third party (such as Google, Twitter, Facebook or Microsoft) to authenticate users.</span></span> <span data-ttu-id="aeadc-113">Toto téma obsahuje následující:</span><span class="sxs-lookup"><span data-stu-id="aeadc-113">This topic covers the following:</span></span>

- <span data-ttu-id="aeadc-114">[Vytvoření aplikace ASP.NET MVC](#createMvc) a seznamte se s funkcemi ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="aeadc-114">[Create an ASP.NET MVC app](#createMvc) and explore ASP.NET Identity features.</span></span>
- [<span data-ttu-id="aeadc-115">Ukázka Identity sestavení</span><span class="sxs-lookup"><span data-stu-id="aeadc-115">Building the Identity sample</span></span>](#build)
- [<span data-ttu-id="aeadc-116">Nastavení e-mailové potvrzení</span><span class="sxs-lookup"><span data-stu-id="aeadc-116">Set up email confirmation</span></span>](#email)

<span data-ttu-id="aeadc-117">Novým uživatelům registrovat jejich e-mailový alias, který vytvoří místní účet.</span><span class="sxs-lookup"><span data-stu-id="aeadc-117">New users register their email alias, which creates a local account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image1.png)

<span data-ttu-id="aeadc-118">Kliknutím na tlačítko zaregistrovat odešle e-mail s potvrzením obsahující ověřovací token do svých e-mailovou adresu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-118">Clicking the Register button sends a confirmation email containing a validation token to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image2.png)

<span data-ttu-id="aeadc-119">Uživateli se odešle e-mailu s potvrzovacím tokenem pro svůj účet.</span><span class="sxs-lookup"><span data-stu-id="aeadc-119">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image3.png)

<span data-ttu-id="aeadc-120">Kliknutím na odkaz bude obsahovat potvrzení účtu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-120">Clicking the link confirms the account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image4.png)

<a id="passwordReset"></a>

## <a name="password-recoveryreset"></a><span data-ttu-id="aeadc-121">Obnovení/obnovení hesla</span><span class="sxs-lookup"><span data-stu-id="aeadc-121">Password recovery/reset</span></span>

<span data-ttu-id="aeadc-122">Místní uživatelé zapomenou své heslo může mít token zabezpečení odeslaných e-mailový účet, což jim umožňuje resetovat jejich hesla.</span><span class="sxs-lookup"><span data-stu-id="aeadc-122">Local users who forget their password can have a security token sent to their email account, enabling them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image5.png)  
  
<span data-ttu-id="aeadc-123">Uživatel bude brzy dostanete e-mail s odkazem, což jim umožní obnovit své heslo.</span><span class="sxs-lookup"><span data-stu-id="aeadc-123">The user will soon get an email with a link allowing them to reset their password.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image6.png)  
<span data-ttu-id="aeadc-124">Kliknutím na odkaz přejdou na stránku pro resetování.</span><span class="sxs-lookup"><span data-stu-id="aeadc-124">Clicking the link will take them to the Reset page.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image7.png)  
  
<span data-ttu-id="aeadc-125">Kliknutím **resetování** bude tlačítko potvrďte heslo se resetovalo.</span><span class="sxs-lookup"><span data-stu-id="aeadc-125">Clicking the **Reset** button will confirm the password has been reset.</span></span>  
  
![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image8.png)

<a id="createMvc"></a>

## <a name="create-an-aspnet-web-app"></a><span data-ttu-id="aeadc-126">Vytvoření webové aplikace v ASP.NET</span><span class="sxs-lookup"><span data-stu-id="aeadc-126">Create an ASP.NET Web app</span></span>

<span data-ttu-id="aeadc-127">Začněte tím, že instalaci a používání [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) nebo [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="aeadc-127">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="aeadc-128">Instalace sady Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) nebo vyšší.</span><span class="sxs-lookup"><span data-stu-id="aeadc-128">Install Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) or higher.</span></span>

> [!NOTE]
> <span data-ttu-id="aeadc-129">Upozornění: Je nutné nainstalovat Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) k dokončení tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-129">Warning: You must install Visual Studio [2013 Update 2](https://go.microsoft.com/fwlink/?LinkId=390521) to complete this tutorial.</span></span>


1. <span data-ttu-id="aeadc-130">Vytvoření nového projektu ASP.NET Web a vyberte šablonu MVC.</span><span class="sxs-lookup"><span data-stu-id="aeadc-130">Create a new ASP.NET Web project and select the MVC template.</span></span> <span data-ttu-id="aeadc-131">Webové formuláře také podporuje ASP.NET Identity, takže může podle podobných kroků ve webové aplikaci formulářů.</span><span class="sxs-lookup"><span data-stu-id="aeadc-131">Web Forms also supports ASP.NET Identity, so you could follow similar steps in a web forms app.</span></span>
2. <span data-ttu-id="aeadc-132">Ponechte výchozí ověřování jako **jednotlivé uživatelské účty**.</span><span class="sxs-lookup"><span data-stu-id="aeadc-132">Leave the default authentication as **Individual User Accounts**.</span></span>
3. <span data-ttu-id="aeadc-133">Spuštění aplikace, klikněte na tlačítko **zaregistrovat** propojit a zaregistrovat uživatele.</span><span class="sxs-lookup"><span data-stu-id="aeadc-133">Run the app, click the **Register** link and register a user.</span></span> <span data-ttu-id="aeadc-134">V tomto okamžiku je pouze ověření na e-mailu [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) atribut.</span><span class="sxs-lookup"><span data-stu-id="aeadc-134">At this point, the only validation on the email is with the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute.</span></span>
4. <span data-ttu-id="aeadc-135">V Průzkumníku serveru přejděte do **Data Connections\DefaultConnection\Tables\AspNetUsers**, klikněte pravým tlačítkem myši a vyberte **Otevřít definici tabulky**.</span><span class="sxs-lookup"><span data-stu-id="aeadc-135">In Server Explorer, navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span>

    <span data-ttu-id="aeadc-136">Na následujícím obrázku `AspNetUsers` schématu:</span><span class="sxs-lookup"><span data-stu-id="aeadc-136">The following image shows the `AspNetUsers` schema:</span></span>

    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image9.png)
5. <span data-ttu-id="aeadc-137">Klikněte pravým tlačítkem na **AspNetUsers** tabulce a vybrat **zobrazit Data tabulky**.</span><span class="sxs-lookup"><span data-stu-id="aeadc-137">Right click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image10.png)  
  
   <span data-ttu-id="aeadc-138">V tomto okamžiku není potvrzena e-mailu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-138">At this point the email has not been confirmed.</span></span>

<span data-ttu-id="aeadc-139">Výchozí úložiště dat pro ASP.NET Identity je Entity Framework, ale můžete je nakonfigurovat pomocí jiných úložišť dat a přidat další pole.</span><span class="sxs-lookup"><span data-stu-id="aeadc-139">The default data store for ASP.NET Identity is Entity Framework, but you can configure it to use other data stores and to add additional fields.</span></span> <span data-ttu-id="aeadc-140">Zobrazit [další prostředky](#addRes) oddílu na konci tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-140">See [Additional Resources](#addRes) section at the end of this tutorial.</span></span>

<span data-ttu-id="aeadc-141">[Třídy pro spuštění OWIN](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) se volá, když aplikace se spustí a vyvolá `ConfigureAuth` metoda *aplikace\_Start\Startup.Auth.cs*, který nakonfiguruje kanál OWIN a inicializuje ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="aeadc-141">The [OWIN startup class](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) ( *Startup.cs* ) is called when the app starts and invokes the `ConfigureAuth` method in *App\_Start\Startup.Auth.cs*, which configures the OWIN pipeline and initializes ASP.NET Identity.</span></span> <span data-ttu-id="aeadc-142">Zkontrolujte `ConfigureAuth` metody.</span><span class="sxs-lookup"><span data-stu-id="aeadc-142">Examine the `ConfigureAuth` method.</span></span> <span data-ttu-id="aeadc-143">Každý `CreatePerOwinContext` volání zaregistruje zpětné volání (uložené v `OwinContext`), která bude volána jednou za žádost o vytvoření instance zadaného typu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-143">Each `CreatePerOwinContext` call registers a callback (saved in the `OwinContext`) that will be called once per request to create an instance of the specified type.</span></span> <span data-ttu-id="aeadc-144">Můžete nastavit zarážky v konstruktoru a `Create` metoda každého typu (`ApplicationDbContext, ApplicationUserManager`) a ověřit, se nazývají s každým požadavkem.</span><span class="sxs-lookup"><span data-stu-id="aeadc-144">You can set a break point in the constructor and `Create` method of each type (`ApplicationDbContext, ApplicationUserManager`) and verify they are called on each request.</span></span> <span data-ttu-id="aeadc-145">Na instanci `ApplicationDbContext` a `ApplicationUserManager` je uložen v kontextu OWIN, který se dá dostat v celé aplikaci.</span><span class="sxs-lookup"><span data-stu-id="aeadc-145">A instance of `ApplicationDbContext` and `ApplicationUserManager` is stored in the OWIN context, which can be accessed throughout the application.</span></span> <span data-ttu-id="aeadc-146">ASP.NET Identity zavěšení do kanálu OWIN prostřednictvím middlewaru souboru cookie.</span><span class="sxs-lookup"><span data-stu-id="aeadc-146">ASP.NET Identity hooks into the OWIN pipeline through cookie middleware.</span></span> <span data-ttu-id="aeadc-147">Další informace najdete v tématu [za správu životního cyklu požadavku pro třídu objektu UserManager. v ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span><span class="sxs-lookup"><span data-stu-id="aeadc-147">For more information, see [Per request lifetime management for UserManager class in ASP.NET Identity](https://blogs.msdn.com/b/webdev/archive/2014/02/12/per-request-lifetime-management-for-usermanager-class-in-asp-net-identity.aspx).</span></span>

<span data-ttu-id="aeadc-148">Pokud změníte profil zabezpečení, je generována a uložené v nové razítko zabezpečení `SecurityStamp` pole *AspNetUsers* tabulky.</span><span class="sxs-lookup"><span data-stu-id="aeadc-148">When you change your security profile, a new security stamp is generated and stored in the `SecurityStamp` field of the *AspNetUsers* table.</span></span> <span data-ttu-id="aeadc-149">Všimněte si, `SecurityStamp` pole se liší od soubor cookie zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="aeadc-149">Note, the `SecurityStamp` field is different from the security cookie.</span></span> <span data-ttu-id="aeadc-150">Soubor cookie zabezpečení není uložený v `AspNetUsers` tabulky (nebo kdekoli jinde v Identity DB).</span><span class="sxs-lookup"><span data-stu-id="aeadc-150">The security cookie is not stored in the `AspNetUsers` table (or anywhere else in the Identity DB).</span></span> <span data-ttu-id="aeadc-151">Token souboru cookie zabezpečení je podepsaný držitelem, pomocí [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) a je vytvořen s `UserId, SecurityStamp` a informace doby vypršení platnosti.</span><span class="sxs-lookup"><span data-stu-id="aeadc-151">The security cookie token is self-signed using [DPAPI](https://msdn.microsoft.com/library/system.security.cryptography.protecteddata.aspx) and is created with the `UserId, SecurityStamp` and expiration time information.</span></span>

<span data-ttu-id="aeadc-152">Middlewaru souboru cookie. zkontroluje soubor cookie s každým požadavkem.</span><span class="sxs-lookup"><span data-stu-id="aeadc-152">The cookie middleware checks the cookie on each request.</span></span> <span data-ttu-id="aeadc-153">`SecurityStampValidator` Metodu `Startup` třídy volání databáze a zkontroluje razítko zabezpečení pravidelně uvedené s `validateInterval`.</span><span class="sxs-lookup"><span data-stu-id="aeadc-153">The `SecurityStampValidator` method in the `Startup` class hits the DB and checks security stamp periodically, as specified with the `validateInterval`.</span></span> <span data-ttu-id="aeadc-154">Tato situace nastane pouze každých 30 minut (v našem příkladu) nezměníte svůj profil zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="aeadc-154">This only happens every 30 minutes (in our sample) unless you change your security profile.</span></span> <span data-ttu-id="aeadc-155">Chcete-li minimalizovat cest k databázi bylo zvoleno intervalu 30 minut.</span><span class="sxs-lookup"><span data-stu-id="aeadc-155">The 30 minute interval was chosen to minimize trips to the database.</span></span> <span data-ttu-id="aeadc-156">V tématu Moje [kurz dvojúrovňové ověřování](index.md) další podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="aeadc-156">See my [two-factor authentication tutorial](index.md) for more details.</span></span>

<span data-ttu-id="aeadc-157">Za komentáře v kódu `UseCookieAuthentication` metoda podporuje ověřování souborů cookie.</span><span class="sxs-lookup"><span data-stu-id="aeadc-157">Per the comments in the code, the `UseCookieAuthentication` method supports cookie authentication.</span></span> <span data-ttu-id="aeadc-158">`SecurityStamp` Pole a přidružený kód poskytuje další vrstvu zabezpečení, které vaše aplikace, pokud změníte svoje heslo, budete přihlášeni mimo prohlížeč, který jste přihlášení.</span><span class="sxs-lookup"><span data-stu-id="aeadc-158">The `SecurityStamp` field and associated code provides an extra layer of security to your app, when you change your password, you will be logged out of the browser you logged in with.</span></span> <span data-ttu-id="aeadc-159">`SecurityStampValidator.OnValidateIdentity` Metoda umožní aplikaci ověřit token zabezpečení při přihlášení uživatele, který se používá, když změníte heslo nebo pomocí externího přihlášení.</span><span class="sxs-lookup"><span data-stu-id="aeadc-159">The `SecurityStampValidator.OnValidateIdentity` method enables the app to validate the security token when the user logs in, which is used when you change a password or use the external login.</span></span> <span data-ttu-id="aeadc-160">To je potřeba zajistit, že nejsou zneplatněny žádné tokeny (soubory cookie), vygenerované pomocí starého hesla.</span><span class="sxs-lookup"><span data-stu-id="aeadc-160">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="aeadc-161">Ukázkový projekt změníte, které uživatelské heslo pak nový token je generován pro uživatele, nejsou zneplatněny žádné předchozí tokeny a `SecurityStamp` pole se aktualizuje.</span><span class="sxs-lookup"><span data-stu-id="aeadc-161">In the sample project, if you change the users password then a new token is generated for the user, any previous tokens are invalidated and the `SecurityStamp` field is updated.</span></span>

<span data-ttu-id="aeadc-162">Systém identit lze nakonfigurovat aplikaci tak když se změní na profil zabezpečení uživatelů (například když uživatel změní své heslo nebo změny přidružené přihlášení (například Facebook, Google, účet Microsoft, atd.), je uživatel přihlášen mimo všechny instance prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="aeadc-162">The Identity system allow you to configure your app so when the users security profile changes (for example, when the user changes their password or changes associated login (such as from Facebook, Google, Microsoft account, etc.), the user is logged out of all browser instances.</span></span> <span data-ttu-id="aeadc-163">Například následujícím obrázku je [jednotné odhlášení ukázka](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) aplikaci, která umožňuje uživateli Odhlásit všechny instance prohlížeče (v tomto případě IE, Firefox a Chrome) kliknutím na jedno tlačítko.</span><span class="sxs-lookup"><span data-stu-id="aeadc-163">For example, the image below shows the [Single signout sample](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app, which allows the user to sign out of all browser instances (in this case, IE, Firefox and Chrome) by clicking one button.</span></span> <span data-ttu-id="aeadc-164">Ukázku můžete také umožňuje pouze odhlaste se z instance určitého webového prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="aeadc-164">Alternatively, the sample allows you to only log out of a specific browser instance.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image11.png)

<span data-ttu-id="aeadc-165">[Jednotné odhlášení ukázka](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) aplikace ukazuje, jak ASP.NET Identity umožňuje znovu vygenerovat token zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="aeadc-165">The [Single signout sample](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/SingleSignOutSample/readme.txt) app shows how ASP.NET Identity allows you to regenerate the security token.</span></span> <span data-ttu-id="aeadc-166">To je potřeba zajistit, že nejsou zneplatněny žádné tokeny (soubory cookie), vygenerované pomocí starého hesla.</span><span class="sxs-lookup"><span data-stu-id="aeadc-166">This is needed to ensure that any tokens (cookies) generated with the old password are invalidated.</span></span> <span data-ttu-id="aeadc-167">Tato funkce poskytuje vyšší úroveň zabezpečení, které vaše aplikace; Pokud změníte svoje heslo, které se odhlásíte kde přihlášení do této aplikace.</span><span class="sxs-lookup"><span data-stu-id="aeadc-167">This feature provides an extra layer of security to your application; when you change your password, you will be logged out where you have logged into this application.</span></span>

<span data-ttu-id="aeadc-168">*Aplikace\_Start\IdentityConfig.cs* soubor obsahuje `ApplicationUserManager`, `EmailService` a `SmsService` třídy.</span><span class="sxs-lookup"><span data-stu-id="aeadc-168">The *App\_Start\IdentityConfig.cs* file contains the `ApplicationUserManager`, `EmailService` and `SmsService` classes.</span></span> <span data-ttu-id="aeadc-169">`EmailService` a `SmsService` třídy každý implementují `IIdentityMessageService` rozhraní, takže budete mít v každé třídě konfigurace e-mailu a SMS běžné metody.</span><span class="sxs-lookup"><span data-stu-id="aeadc-169">The `EmailService` and `SmsService` classes each implement the `IIdentityMessageService` interface, so you have common methods in each class to configure email and SMS.</span></span> <span data-ttu-id="aeadc-170">Tento kurz vysvětluje pouze přidání e-mailové oznámení prostřednictvím [SendGrid](http://sendgrid.com/), můžete poslat e-mailu pomocí protokolu SMTP a další mechanismy.</span><span class="sxs-lookup"><span data-stu-id="aeadc-170">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms.</span></span>

<span data-ttu-id="aeadc-171">`Startup` Třída také obsahuje kotle talíře přidání přihlašování přes sociální sítě (Facebook, Twitter, atd.), najdete v mé kurzu [aplikaci MVC 5 s nástroji služby Facebook, Twitter, LinkedIn a Google OAuth2 přihlašování](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) pro další informace.</span><span class="sxs-lookup"><span data-stu-id="aeadc-171">The `Startup` class also contains boiler plate to add social logins (Facebook, Twitter, etc.), see my tutorial [MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) for more info.</span></span>

<span data-ttu-id="aeadc-172">Zkontrolujte `ApplicationUserManager` třídu, která obsahuje informace o identitě uživatelů a konfiguruje následující funkce:</span><span class="sxs-lookup"><span data-stu-id="aeadc-172">Examine the `ApplicationUserManager` class, which contains the users identity information and configures the following features:</span></span>

- <span data-ttu-id="aeadc-173">Požadavky na sílu hesla.</span><span class="sxs-lookup"><span data-stu-id="aeadc-173">Password strength requirements.</span></span>
- <span data-ttu-id="aeadc-174">Uživatel uzamčení (pokusy a čas).</span><span class="sxs-lookup"><span data-stu-id="aeadc-174">User lock out (attempts and time).</span></span>
- <span data-ttu-id="aeadc-175">Dvoufaktorové ověřování (2FA).</span><span class="sxs-lookup"><span data-stu-id="aeadc-175">Two-factor authentication (2FA).</span></span> <span data-ttu-id="aeadc-176">Můžu v další kurz zabývat 2FA a SMS.</span><span class="sxs-lookup"><span data-stu-id="aeadc-176">I'll cover 2FA and SMS in another tutorial.</span></span>
- <span data-ttu-id="aeadc-177">Zapojování e-mailu a služby SMS.</span><span class="sxs-lookup"><span data-stu-id="aeadc-177">Hooking up the email and SMS services.</span></span> <span data-ttu-id="aeadc-178">(I zabývat SMS v jiném kurzu).</span><span class="sxs-lookup"><span data-stu-id="aeadc-178">(I'll cover SMS in another tutorial).</span></span>

<span data-ttu-id="aeadc-179">`ApplicationUserManager` Třídy je odvozen z obecného `UserManager<ApplicationUser>` třídy.</span><span class="sxs-lookup"><span data-stu-id="aeadc-179">The `ApplicationUserManager` class derives from the generic `UserManager<ApplicationUser>` class.</span></span> <span data-ttu-id="aeadc-180">`ApplicationUser` je odvozen od [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span><span class="sxs-lookup"><span data-stu-id="aeadc-180">`ApplicationUser` derives from [IdentityUser](https://msdn.microsoft.com/library/microsoft.aspnet.identity.entityframework.identityuser.aspx).</span></span> <span data-ttu-id="aeadc-181">`IdentityUser` je odvozen od obecného `IdentityUser` třídy:</span><span class="sxs-lookup"><span data-stu-id="aeadc-181">`IdentityUser` derives from the generic `IdentityUser` class:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample1.cs)]

<span data-ttu-id="aeadc-182">Výše uvedené vlastnosti shodovat s vlastností v `AspNetUsers` tabulky uvedené výše.</span><span class="sxs-lookup"><span data-stu-id="aeadc-182">The properties above coincide with the properties in the `AspNetUsers` table, shown above.</span></span>

<span data-ttu-id="aeadc-183">Obecné argumenty na `IUser` umožňují odvození třídy pomocí různých typů pro primární klíč.</span><span class="sxs-lookup"><span data-stu-id="aeadc-183">Generic arguments on `IUser` enable you to derive a class using different types for the primary key.</span></span> <span data-ttu-id="aeadc-184">Zobrazit [ChangePK](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/ChangePK/readme.txt) vzorku, který ukazuje, jak změnit primární klíč z řetězce na int nebo identifikátor GUID.</span><span class="sxs-lookup"><span data-stu-id="aeadc-184">See the [ChangePK](https://aspnet.codeplex.com/SourceControl/latest#Samples/Identity/ChangePK/readme.txt) sample which shows how to change the primary key from string to int or GUID.</span></span>

### <a name="applicationuser"></a><span data-ttu-id="aeadc-185">Uživatelů</span><span class="sxs-lookup"><span data-stu-id="aeadc-185">ApplicationUser</span></span>

<span data-ttu-id="aeadc-186">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`) je definován v *Models\IdentityModels.cs* jako:</span><span class="sxs-lookup"><span data-stu-id="aeadc-186">`ApplicationUser` (`public class ApplicationUserManager : UserManager<ApplicationUser>`) is defined in *Models\IdentityModels.cs* as:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample2.cs?highlight=8-9)]

<span data-ttu-id="aeadc-187">Výše uvedený zvýrazněný kód generuje [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span><span class="sxs-lookup"><span data-stu-id="aeadc-187">The highlighted code above generates a [ClaimsIdentity](https://msdn.microsoft.com/library/system.security.claims.claimsidentity.aspx).</span></span> <span data-ttu-id="aeadc-188">ASP.NET Identity a ověřování souborů Cookie OWIN jsou založené na deklaracích, proto rozhraní framework vyžaduje aplikaci, která vygeneruje `ClaimsIdentity` pro daného uživatele.</span><span class="sxs-lookup"><span data-stu-id="aeadc-188">ASP.NET Identity and OWIN Cookie Authentication are claims-based, therefore the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="aeadc-189">`ClaimsIdentity` obsahuje informace o všech deklarací identity pro uživatele, jako je například uživatelské jméno, věk a ke kterým rolím uživatel patří.</span><span class="sxs-lookup"><span data-stu-id="aeadc-189">`ClaimsIdentity` has information about all the claims for the user, such as the user's name, age and what roles the user belongs to.</span></span> <span data-ttu-id="aeadc-190">Můžete také přidat další deklarace identity pro uživatele v této fázi.</span><span class="sxs-lookup"><span data-stu-id="aeadc-190">You can also add more claims for the user at this stage.</span></span>

<span data-ttu-id="aeadc-191">OWIN `AuthenticationManager.SignIn` metoda předá `ClaimsIdentity` a přihlásí uživatel:</span><span class="sxs-lookup"><span data-stu-id="aeadc-191">The OWIN `AuthenticationManager.SignIn` method passes in the `ClaimsIdentity` and signs in the user:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample3.cs?highlight=4-6)]

<span data-ttu-id="aeadc-192">[Aplikace MVC 5 s Facebook, Twitter, LinkedIn a Google OAuth2 přihlašování](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) ukazuje, jak můžete přidat další vlastnosti `ApplicationUser` třídy.</span><span class="sxs-lookup"><span data-stu-id="aeadc-192">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) shows how you can add additional properties to the `ApplicationUser` class.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="aeadc-193">Potvrzení e-mailu</span><span class="sxs-lookup"><span data-stu-id="aeadc-193">Email confirmation</span></span>

<span data-ttu-id="aeadc-194">Je vhodné pro potvrzení e-mailu novému uživateli zaregistrovat k ověření, nejsou zosobnění někdo jiný (to znamená, že se ještě nezaregistrovali někoho jiného e-mailu).</span><span class="sxs-lookup"><span data-stu-id="aeadc-194">It's a good idea to confirm the email a new user register with to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="aeadc-195">Předpokládejme, že jste měli diskusní fórum, chcete zabránit `"bob@example.com"` registroval jako `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="aeadc-195">Suppose you had a discussion forum, you would want to prevent `"bob@example.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="aeadc-196">Bez potvrzení e-mailu `"joe@contoso.com"` může získat nežádoucí e-mailu vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="aeadc-196">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="aeadc-197">Předpokládejme, že Bob neúmyslně zaregistrovaný jako `"bib@example.com"` a kdyby si všimli, že nebudou moci používat obnovit heslo, protože aplikace nemá správnou e-mailovou.</span><span class="sxs-lookup"><span data-stu-id="aeadc-197">Suppose Bob accidently registered as `"bib@example.com"` and hadn't noticed it, he wouldn't be able to use password recover because the app doesn't have his correct email.</span></span> <span data-ttu-id="aeadc-198">Potvrzení e-mailu zajišťuje pouze omezenou ochranu před roboty a neposkytuje ochranu z určené spammery, mají mnoho pracovní e-mailu aliasů můžete použít k registraci. V následující ukázce, nebudou moct změnit svoje heslo, dokud svůj účet potvrzený uživatele (podle jejich kliknutím na odkaz potvrzení přijatá v e-mailový účet, zaregistrovat.) Tento pracovní postup můžete použít k ostatním scénářům, třeba odeslání odkazu k potvrzení a k resetování hesla na nové účty vytvořené správcem odesílání e-mailu uživatele při změnily jejich profil a tak dále.</span><span class="sxs-lookup"><span data-stu-id="aeadc-198">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers, they have many working email aliases they can use to register.In the sample below, the user won't be able to change their password until their account has been confirmed (by them clicking on a confirmation link received on the email account they registered with.) You can apply this work flow to other scenarios, for example sending a link to confirm and reset the password on new accounts created by the administrator, sending the user an email when they have changed their profile and so on.</span></span> <span data-ttu-id="aeadc-199">Obvykle chcete novým uživatelům zabránit v účtování žádná data k webu předtím, než byly potvrzeny e-mailem, textovou zprávu SMS nebo jiný mechanismus.</span><span class="sxs-lookup"><span data-stu-id="aeadc-199">You generally want to prevent new users from posting any data to your web site before they have been confirmed by email, a SMS text message or another mechanism.</span></span> <a id="build"></a>

## <a name="building-a-more-complete-sample"></a><span data-ttu-id="aeadc-200">Vytváření ucelenější ukázku</span><span class="sxs-lookup"><span data-stu-id="aeadc-200">Building a more complete sample</span></span>

<span data-ttu-id="aeadc-201">V této části použijete ke stažení ucelenější ukázku, kterou pak ve spolupráci s NuGet.</span><span class="sxs-lookup"><span data-stu-id="aeadc-201">In this section, you'll use NuGet to download a more complete sample we will work with.</span></span>

1. <span data-ttu-id="aeadc-202">Vytvořte nový ***prázdný*** webový projekt ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="aeadc-202">Create a new ***empty*** ASP.NET Web project.</span></span>
2. <span data-ttu-id="aeadc-203">V konzole Správce balíčků zadejte následující příkazy:</span><span class="sxs-lookup"><span data-stu-id="aeadc-203">In the Package Manager Console, enter the following the following commands:</span></span> 

    [!code-console[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample4.cmd)]

   <span data-ttu-id="aeadc-204">V tomto kurzu použijeme [SendGrid](http://sendgrid.com/) k odesílání e-mailu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-204">In this tutorial, we'll use [SendGrid](http://sendgrid.com/) to send email.</span></span> <span data-ttu-id="aeadc-205">`Identity.Samples` Balíček nainstaluje budeme pracovat s kódem.</span><span class="sxs-lookup"><span data-stu-id="aeadc-205">The `Identity.Samples` package installs the code we will be working with.</span></span>
3. <span data-ttu-id="aeadc-206">Nastavte [projektu pro použití protokolu SSL](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="aeadc-206">Set the [project to use SSL](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
4. <span data-ttu-id="aeadc-207">Otestujte vytvoření místního účtu spuštěním aplikace, že kliknete na **zaregistrovat** propojit a účtování registračním formuláři.</span><span class="sxs-lookup"><span data-stu-id="aeadc-207">Test local account creation by running the app, clicking on the **Register** link, and posting the registration form.</span></span>
5. <span data-ttu-id="aeadc-208">Klikněte na odkaz e-mailu ukázku, což simuluje e-mailové potvrzení.</span><span class="sxs-lookup"><span data-stu-id="aeadc-208">Click the demo email link, which simulates email confirmation.</span></span>
6. <span data-ttu-id="aeadc-209">Odebrat je ukázka e-mailu odkaz potvrzovací kód z ukázkového ( `ViewBag.Link` kód v účet kontroleru.</span><span class="sxs-lookup"><span data-stu-id="aeadc-209">Remove the demo email link confirmation code from the sample (The `ViewBag.Link` code in the account controller.</span></span> <span data-ttu-id="aeadc-210">Zobrazit `DisplayEmail` a `ForgotPasswordConfirmation` metody akce a zobrazeními razor).</span><span class="sxs-lookup"><span data-stu-id="aeadc-210">See the `DisplayEmail` and `ForgotPasswordConfirmation` action methods and razor views ).</span></span>

> [!NOTE]
> <span data-ttu-id="aeadc-211">Upozornění: Pokud změníte některá nastavení zabezpečení v této ukázce, výroby aplikací bude chtít projít auditu zabezpečení, která explicitně volá provedené změny.</span><span class="sxs-lookup"><span data-stu-id="aeadc-211">Warning: If you change any of the security settings in this sample, productions apps will need to undergo a security audit that explicitly calls the changes made.</span></span>


## <a name="examine-the-code-in-appstartidentityconfigcs"></a><span data-ttu-id="aeadc-212">Zkoumání kódu v aplikaci\_Start\IdentityConfig.cs</span><span class="sxs-lookup"><span data-stu-id="aeadc-212">Examine the code in App\_Start\IdentityConfig.cs</span></span>

<span data-ttu-id="aeadc-213">Vzorek ukazuje, jak vytvořit účet a přidejte ji tak *správce* role.</span><span class="sxs-lookup"><span data-stu-id="aeadc-213">The sample shows how to create an account and add it to the *Admin* role.</span></span> <span data-ttu-id="aeadc-214">E-mailu v ukázce by měl nahraďte e-mailu, který budete používat pro účet správce.</span><span class="sxs-lookup"><span data-stu-id="aeadc-214">You should replace the email in the sample with the email you will be using for the admin account.</span></span> <span data-ttu-id="aeadc-215">Nejjednodušší způsob teď chcete vytvořit účet správce, je prostřednictvím kódu programu v `Seed` metody.</span><span class="sxs-lookup"><span data-stu-id="aeadc-215">The easiest way right now to create an administrator account is programmatically in the `Seed` method.</span></span> <span data-ttu-id="aeadc-216">Věříme, že budete mít v budoucnu nástroj, který vám umožní vytvořit a správy uživatelů a rolí.</span><span class="sxs-lookup"><span data-stu-id="aeadc-216">We hope to have a tool in the future that will allow you to create and administer users and roles.</span></span> <span data-ttu-id="aeadc-217">Vzorový kód vám umožní vytvořit a spravovat uživatele a role, ale nejprve musíte mít účet správce ke spuštění role a stránky pro správu uživatelů.</span><span class="sxs-lookup"><span data-stu-id="aeadc-217">The sample code does let you create and manage users and roles, but you must first have an administrators account to run the roles and user admin pages.</span></span> <span data-ttu-id="aeadc-218">V této ukázce se vytvoří účet správce při nasadí databáze.</span><span class="sxs-lookup"><span data-stu-id="aeadc-218">In this sample, the admin account is created when the DB is seeded.</span></span>

<span data-ttu-id="aeadc-219">Změnit heslo a změňte název na účet, kam budete dostávat e-mailová oznámení.</span><span class="sxs-lookup"><span data-stu-id="aeadc-219">Change the password and change the name to an account where you can receive email notifications.</span></span>

> [!WARNING]
> <span data-ttu-id="aeadc-220">Zabezpečení – nikdy ukládání citlivých dat ve zdrojovém kódu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-220">Security - Never store sensitive data in your source code.</span></span>

<span data-ttu-id="aeadc-221">Jak už bylo zmíněno dříve, `app.CreatePerOwinContext` volání ve třídě spuštění přidá zpětná volání, aby `Create` metoda aplikace databáze obsahu, správce a role správce tříd uživatelů.</span><span class="sxs-lookup"><span data-stu-id="aeadc-221">As mentioned previously, the `app.CreatePerOwinContext` call in the startup class adds callbacks to the `Create` method of the app DB content, user manager and role manger classes.</span></span> <span data-ttu-id="aeadc-222">Volání kanálu OWIN `Create` metodu na tyto třídy pro každý požadavek a uložený kontext pro každou třídu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-222">The OWIN pipeline calls the `Create` method on these classes for each request and stores the context for each class.</span></span> <span data-ttu-id="aeadc-223">Kontroler účtů zveřejňuje správce uživatele z kontextu protokolu HTTP (který obsahuje kontext OWIN):</span><span class="sxs-lookup"><span data-stu-id="aeadc-223">The account controller exposes the user manager from the HTTP context (which contains the OWIN context):</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample5.cs)]

<span data-ttu-id="aeadc-224">Když se uživatel zaregistruje místní účet, `HTTP Post Register` volání metody:</span><span class="sxs-lookup"><span data-stu-id="aeadc-224">When a user registers a local account, the `HTTP Post Register` method is called:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample6.cs)]

<span data-ttu-id="aeadc-225">Výše uvedený kód používá model dat k vytvoření nového uživatelského účtu pomocí e-mailu a heslo, které zadáte.</span><span class="sxs-lookup"><span data-stu-id="aeadc-225">The code above uses the model data to create a new user account using the email and password entered.</span></span> <span data-ttu-id="aeadc-226">Pokud e-mailový alias je v úložišti dat, vytvoření účtu se nepovedlo a znovu se zobrazí formulář.</span><span class="sxs-lookup"><span data-stu-id="aeadc-226">If the email alias is in the data store, account creation fails and the form is displayed again.</span></span> <span data-ttu-id="aeadc-227">`GenerateEmailConfirmationTokenAsync` Metoda vytvoří zabezpečené potvrzovací token a uloží jej v úložišti dat ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="aeadc-227">The `GenerateEmailConfirmationTokenAsync` method creates a secure confirmation token and stores it in the ASP.NET Identity data store.</span></span> <span data-ttu-id="aeadc-228">[Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) metoda vytvoří odkaz, který obsahuje `UserId` a potvrzovací token.</span><span class="sxs-lookup"><span data-stu-id="aeadc-228">The [Url.Action](https://msdn.microsoft.com/library/dd505232(v=vs.118).aspx) method creates a link containing the `UserId` and confirmation token.</span></span> <span data-ttu-id="aeadc-229">Tento odkaz se pak pošle e-mailem uživateli, může uživatel kliknout na odkaz v jejich e-mailová aplikace potvrďte svůj účet.</span><span class="sxs-lookup"><span data-stu-id="aeadc-229">This link is then emailed to the user, the user can click on the link in their email app to confirm their account.</span></span>

<a id="email"></a>

## <a name="set-up-email-confirmation"></a><span data-ttu-id="aeadc-230">Nastavení e-mailové potvrzení</span><span class="sxs-lookup"><span data-stu-id="aeadc-230">Set up email confirmation</span></span>

<span data-ttu-id="aeadc-231">Přejděte [Azure SendGrid registrační stránku](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) a bezplatná registrace účtu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-231">Go to the [Azure SendGrid sign up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free account.</span></span> <span data-ttu-id="aeadc-232">Přidejte kód, podobně jako následující příkaz pro konfiguraci služby SendGrid:</span><span class="sxs-lookup"><span data-stu-id="aeadc-232">Add code similar to the following to configure SendGrid:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample7.cs?highlight=5)]

> [!NOTE]
> <span data-ttu-id="aeadc-233">E-mailoví klienti často přijímají pouze textové zprávy (žádné HTML).</span><span class="sxs-lookup"><span data-stu-id="aeadc-233">Email clients frequently accept only text messages (no HTML).</span></span> <span data-ttu-id="aeadc-234">Byste měli poskytnout zprávu v text nebo HTML.</span><span class="sxs-lookup"><span data-stu-id="aeadc-234">You should provide the message in text and HTML.</span></span> <span data-ttu-id="aeadc-235">V příkladu SendGrid výše, používá se k tomu `myMessage.Text` a `myMessage.Html` výše uvedeném kódu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-235">In the SendGrid sample above, this is done with the `myMessage.Text` and `myMessage.Html` code shown above.</span></span>


<span data-ttu-id="aeadc-236">Následující kód ukazuje, jak odeslat e-mailům prostřednictvím [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) třídy where `message.Body` vrátí pouze na odkaz.</span><span class="sxs-lookup"><span data-stu-id="aeadc-236">The following code shows how to send email using the [MailMessage](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) class where `message.Body` returns only the link.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample8.cs)]

> [!WARNING]
> <span data-ttu-id="aeadc-237">Zabezpečení – nikdy ukládání citlivých dat ve zdrojovém kódu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-237">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="aeadc-238">Účet a přihlašovací údaje jsou uložené v nastavení appSetting.</span><span class="sxs-lookup"><span data-stu-id="aeadc-238">The account and credentials are stored in the appSetting.</span></span> <span data-ttu-id="aeadc-239">V Azure, můžete bezpečně uložit tyto hodnoty na **[konfigurovat](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** karta na portálu Azure portal.</span><span class="sxs-lookup"><span data-stu-id="aeadc-239">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="aeadc-240">Zobrazit [osvědčené postupy pro nasazení hesel a dalších citlivých dat do ASP.NET a Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span><span class="sxs-lookup"><span data-stu-id="aeadc-240">See [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span></span>


<span data-ttu-id="aeadc-241">Zadání přihlašovacích údajů Sendgridu, spusťte aplikaci, se registrují v e-mailový alias můžete kliknout na odkaz potvrďte e-mailu.</span><span class="sxs-lookup"><span data-stu-id="aeadc-241">Enter your SendGrid credentials, run the app, register with an email alias can click the confirm link in your email.</span></span> <span data-ttu-id="aeadc-242">Chcete zjistit, jak to můžete udělat pomocí vaší [Outlook.com](http://outlook.com) e-mailový účet, najdete v článku Jan Atten [jazyka C# konfigurace SMTP pro hostitel SMTP Outlook.Com](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) a jeho[ASP.NET Identity 2.0: nastavení ověření účtu a povolení dvoufaktorového](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) příspěvky.</span><span class="sxs-lookup"><span data-stu-id="aeadc-242">To see how to do this with your [Outlook.com](http://outlook.com) email account, see John Atten's [C# SMTP Configuration for Outlook.Com SMTP Host](http://typecastexception.com/post/2013/12/20/C-SMTP-Configuration-for-OutlookCom-SMTP-Host.aspx) and his[ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) posts.</span></span>

<span data-ttu-id="aeadc-243">Jakmile uživatel klikne **zaregistrovat** tlačítko na jejich e-mailovou adresu přijde potvrzovací e-mail obsahující ověřovací token.</span><span class="sxs-lookup"><span data-stu-id="aeadc-243">Once a user clicks the **Register** button a confirmation email containing a validation token is sent to their email address.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image12.png)

<span data-ttu-id="aeadc-244">Uživateli se odešle e-mailu s potvrzovacím tokenem pro svůj účet.</span><span class="sxs-lookup"><span data-stu-id="aeadc-244">The user is sent an email with a confirmation token for their account.</span></span>

![](account-confirmation-and-password-recovery-with-aspnet-identity/_static/image13.png)

## <a name="examine-the-code"></a><span data-ttu-id="aeadc-245">Prozkoumejte kód</span><span class="sxs-lookup"><span data-stu-id="aeadc-245">Examine the code</span></span>

<span data-ttu-id="aeadc-246">Následující kód ukazuje `POST ForgotPassword` metody.</span><span class="sxs-lookup"><span data-stu-id="aeadc-246">The following code shows the `POST ForgotPassword` method.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample9.cs)]

<span data-ttu-id="aeadc-247">Metoda se bez upozornění selže, pokud nebyl potvrzen e-mail uživatele.</span><span class="sxs-lookup"><span data-stu-id="aeadc-247">The method fails silently if the user email has not been confirmed.</span></span> <span data-ttu-id="aeadc-248">Pokud chyba byla publikována pro neplatná e-mailovou adresu, uživateli se zlými úmysly může pomocí těchto informací najít platné ID (e-mailu aliasy) vůči útokům.</span><span class="sxs-lookup"><span data-stu-id="aeadc-248">If an error was posted for an invalid email address, malicious users could use that information to find valid userId (email aliases) to attack.</span></span>

<span data-ttu-id="aeadc-249">Následující kód ukazuje `ConfirmEmail` metoda ve kontroler účtů, která je volána, když uživatel klikne na potvrzení odkaz v e-mailu k nim:</span><span class="sxs-lookup"><span data-stu-id="aeadc-249">The following code shows the `ConfirmEmail` method in the account controller that is called when the user clicks the confirmation link in the email sent to them:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample10.cs)]

<span data-ttu-id="aeadc-250">Jakmile se použil token zapomenutého hesla, je neplatná.</span><span class="sxs-lookup"><span data-stu-id="aeadc-250">Once a forgotten password token has been used, it's invalidated.</span></span> <span data-ttu-id="aeadc-251">Následující změny kódu v `Create` – metoda (v *aplikace\_Start\IdentityConfig.cs* souboru) nastaví tokeny vyprší za 3 hodiny.</span><span class="sxs-lookup"><span data-stu-id="aeadc-251">The following code change in the `Create` method (in the *App\_Start\IdentityConfig.cs* file) sets the tokens to expire in 3 hours.</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample11.cs?highlight=6-8)]

<span data-ttu-id="aeadc-252">Pomocí výše uvedený kód zapomenutého hesla a tokenů potvrzení e-mailu vyprší za 3 hodiny.</span><span class="sxs-lookup"><span data-stu-id="aeadc-252">With the code above, the forgotten password and the email confirmation tokens will expire in 3 hours.</span></span> <span data-ttu-id="aeadc-253">Výchozí hodnota `TokenLifespan` je za jeden den.</span><span class="sxs-lookup"><span data-stu-id="aeadc-253">The default `TokenLifespan` is one day.</span></span>

<span data-ttu-id="aeadc-254">Následující kód ukazuje metodu potvrzení e-mailu:</span><span class="sxs-lookup"><span data-stu-id="aeadc-254">The following code shows the email confirmation method:</span></span>

[!code-csharp[Main](account-confirmation-and-password-recovery-with-aspnet-identity/samples/sample12.cs)]

 <span data-ttu-id="aeadc-255">Aby vaše aplikace lépe zabezpečit, podporuje ASP.NET Identity Dvojúrovňového ověřování (2FA).</span><span class="sxs-lookup"><span data-stu-id="aeadc-255">To make your app more secure, ASP.NET Identity supports Two-Factor authentication (2FA).</span></span> <span data-ttu-id="aeadc-256">Naleznete v tématu [identitu ASP.NET 2.0: nastavení ověření účtu a povolení dvoufaktorového](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) podle Atten Jan.</span><span class="sxs-lookup"><span data-stu-id="aeadc-256">See [ASP.NET Identity 2.0: Setting Up Account Validation and Two-Factor Authorization](http://typecastexception.com/post/2014/04/20/ASPNET-Identity-20-Setting-Up-Account-Validation-and-Two-Factor-Authorization.aspx) by John Atten.</span></span> <span data-ttu-id="aeadc-257">I když uzamčení účtu lze nastavit na selhání pokusů o přihlášení hesel, tento přístup umožňuje vaše přihlašovací údaje náchylné k [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) uzamčení.</span><span class="sxs-lookup"><span data-stu-id="aeadc-257">Although you can set account lockout on login password attempt failures, that approach makes your login susceptible to [DOS](http://en.wikipedia.org/wiki/Denial-of-service_attack) lockouts.</span></span> <span data-ttu-id="aeadc-258">Doporučujeme že použít uzamčení účtu jenom pomocí 2FA.</span><span class="sxs-lookup"><span data-stu-id="aeadc-258">We recommend you use account lockout only with 2FA.</span></span>  
<a id="addRes"></a>

## <a name="additional-resources"></a><span data-ttu-id="aeadc-259">Další prostředky</span><span class="sxs-lookup"><span data-stu-id="aeadc-259">Additional Resources</span></span>

- [<span data-ttu-id="aeadc-260">Přehled poskytovatelů vlastního úložiště pro ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="aeadc-260">Overview of Custom Storage Providers for ASP.NET Identity</span></span>](../extensibility/overview-of-custom-storage-providers-for-aspnet-identity.md)
- <span data-ttu-id="aeadc-261">[Aplikace MVC 5 s Facebook, Twitter, LinkedIn a Google OAuth2 přihlašování](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) také ukazuje, jak přidat informace o profilu do tabulky uživatelů.</span><span class="sxs-lookup"><span data-stu-id="aeadc-261">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](../../../mvc/overview/security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) also shows how to add profile information to the users table.</span></span>
- <span data-ttu-id="aeadc-262">[ASP.NET MVC a Identity 2.0: Základy práce s](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) podle Atten Jan.</span><span class="sxs-lookup"><span data-stu-id="aeadc-262">[ASP.NET MVC and Identity 2.0: Understanding the Basics](http://typecastexception.com/post/2014/04/20/ASPNET-MVC-and-Identity-20-Understanding-the-Basics.aspx) by John Atten.</span></span>
- [<span data-ttu-id="aeadc-263">Úvod do ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="aeadc-263">Introduction to ASP.NET Identity</span></span>](../getting-started/introduction-to-aspnet-identity.md)
- <span data-ttu-id="aeadc-264">[Oznamujeme vydání verze RTM technologie ASP.NET identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) napsal Pranav Rastogi.</span><span class="sxs-lookup"><span data-stu-id="aeadc-264">[Announcing RTM of ASP.NET Identity 2.0.0](https://blogs.msdn.com/b/webdev/archive/2014/03/20/test-announcing-rtm-of-asp-net-identity-2-0-0.aspx) by Pranav Rastogi.</span></span>
