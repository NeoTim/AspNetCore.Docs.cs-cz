---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: Přidání ASP.NET Identity pro prázdný nebo existující webových formulářů projekt | Microsoft Docs
author: raquelsa
description: V tomto kurzu se dozvíte, jak přidat do aplikace ASP.NET ASP.NET Identity (nový systém členství pro technologii ASP.NET). Při vytváření nové webové formuláře nebo MVC...
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/23/2013
ms.topic: article
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: 8961e596f0d6cc4810e2439be1ec2915bddb8c78
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/06/2018
---
<a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="e7c1b-104">Přidání ASP.NET Identity pro prázdný nebo existující webových formulářů projektu</span><span class="sxs-lookup"><span data-stu-id="e7c1b-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>
====================
<span data-ttu-id="e7c1b-105">podle [Raquel Soares De Almeida](https://github.com/raquelsa)</span><span class="sxs-lookup"><span data-stu-id="e7c1b-105">by [Raquel Soares De Almeida](https://github.com/raquelsa)</span></span>

> <span data-ttu-id="e7c1b-106">V tomto kurzu se dozvíte, jak přidat [ASP.NET Identity](introduction-to-aspnet-identity.md) (nový systém členství pro technologii ASP.NET) pro aplikace ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-106">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="e7c1b-107">Když vytvoříte nový projekt webové formuláře nebo MVC v Visual Studio 2013 RTM s jednotlivých účtů, Visual Studio se nainstalujte všechny požadované balíčky a přidat všechny potřebné třídy pro vás.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-107">When you create a new Web Forms or MVC project in Visual Studio 2013 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="e7c1b-108">V tomto kurzu bude znázorňují postup pro přidání podpory ASP.NET Identity existující projekt webové formuláře nebo nový prázdný projekt.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-108">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="e7c1b-109">I se popisují všechny balíčky NuGet, které je třeba nainstalovat a třídy, je nutné přidat.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-109">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="e7c1b-110">Pro nové uživatele registrace a přihlášení při zvýraznění všechna rozhraní API hlavní vstupní bod pro správu uživatelů a ověřování budou přejít přes ukázkové webové formuláře.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-110">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="e7c1b-111">Tato ukázka použije výchozí implementace ASP.NET Identity pro úložiště dat SQL, který je založený na rozhraní Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-111">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="e7c1b-112">V tomto kurzu budeme používat LocalDB pro databázi SQL.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-112">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 
> <span data-ttu-id="e7c1b-113">V tomto kurzu byla zapsána Raquel Soares De Almeida a Rick Anderson ( [ @RickAndMSFT ](https://twitter.com/#!/RickAndMSFT) ).</span><span class="sxs-lookup"><span data-stu-id="e7c1b-113">This tutorial was written by Raquel Soares De Almeida and Rick Anderson ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT) ).</span></span>


## <a name="getting-started-aspnet-identity"></a><span data-ttu-id="e7c1b-114">Začínáme s ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="e7c1b-114">Getting Started ASP.NET Identity</span></span>

1. <span data-ttu-id="e7c1b-115">Začněte tím, že instalace a spuštění [Visual Studio Express 2013 pro Web](https://go.microsoft.com/fwlink/?LinkId=299058) nebo [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="e7c1b-115">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span>
2. <span data-ttu-id="e7c1b-116">Klikněte na tlačítko **nový projekt** od začátku stránky, nebo můžete použít nabídku a vyberte **soubor**a potom **nový projekt**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-116">Click **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="e7c1b-117">Vyberte **Visual C# i** n v levém podokně, pak **webové** a pak vyberte **webové aplikace ASP.NET**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-117">Select **Visual C# i** n the left pane, then **Web** and then select **ASP.NET Web Application**.</span></span> <span data-ttu-id="e7c1b-118">Název projektu "WebFormsIdentity" a pak klikněte na **OK**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-118">Name your project "WebFormsIdentity" and then click **OK**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image1.png)
4. <span data-ttu-id="e7c1b-119">V **nový projekt ASP.NET** dialogovém okně, vyberte **prázdný** šablony.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-119">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
   <span data-ttu-id="e7c1b-120">Upozornění **změna ověřování** tlačítko je zakázané a žádné ověřování podpora je k dispozici v této šabloně.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-120">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="e7c1b-121">Šablony webových formulářů, MVC a webového rozhraní API umožňují vyberte metodu ověřování.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-121">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span> <span data-ttu-id="e7c1b-122">Další informace najdete v tématu [Přehled ověřování](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span><span class="sxs-lookup"><span data-stu-id="e7c1b-122">For more information, see [Overview of Authentication](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span></span>

## <a name="adding-identity-packages-to-your-app"></a><span data-ttu-id="e7c1b-123">Přidání Identity balíčky do vaší aplikace</span><span class="sxs-lookup"><span data-stu-id="e7c1b-123">Adding Identity Packages to your App</span></span>

<span data-ttu-id="e7c1b-124">V Průzkumníku řešení klikněte pravým tlačítkem na projekt a vyberte **spravovat balíčky NuGet**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-124">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="e7c1b-125">V dialogovém okně hledání textového pole zadejte "*Identity.E*".</span><span class="sxs-lookup"><span data-stu-id="e7c1b-125">In the search text box dialog, type "*Identity.E*".</span></span> <span data-ttu-id="e7c1b-126">Kliknutím na tlačítko Instalovat pro tento balíček.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-126">Click install for this package.</span></span>   
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image3.png)  
  
<span data-ttu-id="e7c1b-127">Všimněte si, že tento balíček nainstaluje balíčky závislost: EntityFramework a Microsoft ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-127">Note that this package will install the dependency packages: EntityFramework and Microsoft ASP.NET Identity Core.</span></span>

## <a name="adding-web-forms-to-register-users"></a><span data-ttu-id="e7c1b-128">Přidání webové formuláře k registraci uživatelů</span><span class="sxs-lookup"><span data-stu-id="e7c1b-128">Adding Web Forms to Register Users</span></span>

1. <span data-ttu-id="e7c1b-129">V **Průzkumníku řešení**, klikněte pravým tlačítkem na projekt a klikněte na **přidat**a potom **webového formuláře**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-129">In **Solution Explorer**, right-click your project and click **Add**, and then **Web Form**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="e7c1b-130">V **zadejte název položky** dialogové okno, název nového webového formuláře **zaregistrovat**a pak klikněte na tlačítko **OK**</span><span class="sxs-lookup"><span data-stu-id="e7c1b-130">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then click **OK**</span></span>
3. <span data-ttu-id="e7c1b-131">Nahraďte kód v vygenerovaného *Register.aspx* souboru pomocí kódu níže.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-131">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="e7c1b-132">Změny kódu jsou vyznačené.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-132">The code changes are highlighted.</span></span>   

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="e7c1b-133">Toto je právě zjednodušené verzi *Register.aspx* soubor, který se vytvoří při vytvoření nového projektu webových formulářů ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-133">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="e7c1b-134">Výše uvedený kód přidá pole formuláře a tlačítko k registraci nového uživatele.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-134">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="e7c1b-135">Otevřete *Register.aspx.cs* a obsah souboru nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="e7c1b-135">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="e7c1b-136">Výše uvedený kód je zjednodušenou verzi *Register.aspx.cs* soubor, který se vytvoří při vytvoření nového projektu webových formulářů ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-136">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="e7c1b-137">*IdentityUser* třída je výchozí implementace objektu EntityFramework *IUser* rozhraní.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-137">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="e7c1b-138">*IUser* rozhraní je minimální rozhraní pro uživatele na ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-138">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="e7c1b-139">*Objektu UserStore* třída je výchozí implementace objektu EntityFramework úložiště uživatele.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-139">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="e7c1b-140">Tato třída implementuje minimální rozhraní ASP.NET Identity Core: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* a *IUserRoleStore* .</span><span class="sxs-lookup"><span data-stu-id="e7c1b-140">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="e7c1b-141">*Objekt UserManager* rozhraní API, které automaticky uloží změny související s uživateli zpřístupňuje – třída *objektu UserStore*.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-141">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="e7c1b-142">*IdentityResult* třída reprezentuje výsledek operace identity.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-142">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="e7c1b-143">V **Průzkumníku řešení**, klikněte pravým tlačítkem na projekt a klikněte na **přidat**, **přidat složku ASP.NET** a potom **aplikace\_Data**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-143">In **Solution Explorer**, right-click your project and click **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="e7c1b-144">Otevřete *Web.config* souboru a přidejte připojovací řetězec pro databázi použijeme uložit informace o uživateli.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-144">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="e7c1b-145">Databázi vytvoří za běhu pomocí objektu EntityFramework pro Identity entity.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-145">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="e7c1b-146">Připojovací řetězec je podobná vytvořené pro vás, když vytvoříte nový projekt webové formuláře.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-146">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="e7c1b-147">Zvýrazněný kód ukazuje značky, že měli byste přidat:</span><span class="sxs-lookup"><span data-stu-id="e7c1b-147">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="e7c1b-148">Pro Visual Studio 2015 nebo vyšší, nahraďte `(localdb)\v11.0` s `(localdb)\MSSQLLocalDB` v připojovacím řetězci.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-148">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="e7c1b-149">Klikněte pravým tlačítkem na soubor *Register.aspx* v projektu a vyberte **nastavit jako úvodní stránku**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-149">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="e7c1b-150">Stisknutím kombinace kláves Ctrl + F5 sestavení a spuštění webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-150">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="e7c1b-151">Zadejte nové uživatelské jméno a heslo a potom klikněte na **zaregistrovat**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-151">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="e7c1b-152">ASP.NET Identity má podporu pro ověření a v této ukázce můžete ověřit, výchozí chování na uživatele a heslo validátory, které pocházejí z Identity základní balíček.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-152">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="e7c1b-153">Výchozí validátor pro uživatele (`UserValidator`) má vlastnost `AllowOnlyAlphanumericUserNames` , nemá výchozí hodnotu nastavit na `true`.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-153">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="e7c1b-154">Výchozí validátor pro heslo (`MinimumLengthValidator`) zajišťuje, že heslo má alespoň 6 znaků.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-154">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="e7c1b-155">Tyto validátory jsou vlastnosti na `UserManager` , je možné přepsat, pokud chcete mít vlastního ověřování</span><span class="sxs-lookup"><span data-stu-id="e7c1b-155">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verifying-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="e7c1b-156">Ověření LocalDb Identity databáze a tabulky generované rozhraní Entity Framework</span><span class="sxs-lookup"><span data-stu-id="e7c1b-156">Verifying the LocalDb Identity Database and Tables Generated by Entity Framework</span></span>

1. <span data-ttu-id="e7c1b-157">V **zobrazení** nabídky, klikněte na tlačítko **Průzkumníka serveru**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-157">In the **View** menu, click **Server Explorer**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="e7c1b-158">Rozbalte položku **objekt DefaultConnection (WebFormsIdentity)**, rozbalte položku **tabulky**, klikněte pravým tlačítkem na **AspNetUsers** a klikněte na tlačítko **zobrazit Data tabulky**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-158">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right click **AspNetUsers** and click **Show Table Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configuring-the-application-for-owin-authentication"></a><span data-ttu-id="e7c1b-159">Konfigurace aplikace pro ověřování OWIN.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-159">Configuring the application for OWIN authentication</span></span>

<span data-ttu-id="e7c1b-160">V tuto chvíli jsme doplnili jenom podporu pro vytváření uživatelů.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-160">At this point we have only added support for creating users.</span></span> <span data-ttu-id="e7c1b-161">Teď přidáme ukazují, jak jsme přidat ověřování se přihlášení uživatele.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-161">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="e7c1b-162">ASP.NET Identity používá Microsoft OWIN ověřovací middleware pro ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-162">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="e7c1b-163">Soubor cookie ověřování souborů Cookie OWIN a deklarace identity ověřování založené na mechanismu, který může používat libovolnou architekturu hostované na [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) nebo služby IIS.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-163">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="e7c1b-164">V tomto modelu lze použít stejné balíčky ověřování napříč více rozhraní, včetně ASP.NET MVC a webových formulářů.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-164">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="e7c1b-165">Další informace o projektu Katana a jak spustit middlewaru v lhostejné najdete v tématu hostitele [Začínáme s projektem Katana](https://msdn.microsoft.com/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="e7c1b-165">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span></span>

## <a name="installing-authentication-packages-to-your-application"></a><span data-ttu-id="e7c1b-166">Instalace balíčků ověřování do aplikace</span><span class="sxs-lookup"><span data-stu-id="e7c1b-166">Installing authentication packages to your application</span></span>

1. <span data-ttu-id="e7c1b-167">V Průzkumníku řešení klikněte pravým tlačítkem na projekt a vyberte **spravovat balíčky NuGet**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-167">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="e7c1b-168">V dialogovém okně hledání textového pole zadejte "*Identity.Owin*".</span><span class="sxs-lookup"><span data-stu-id="e7c1b-168">In the search text box dialog, type "*Identity.Owin*".</span></span> <span data-ttu-id="e7c1b-169">Kliknutím na tlačítko Instalovat pro tento balíček.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-169">Click install for this package.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image10.png)
2. <span data-ttu-id="e7c1b-170">Vyhledejte balíček ***Microsoft.Owin.Host.SystemWeb*** a nainstalujte ji.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-170">Search for package ***Microsoft.Owin.Host.SystemWeb*** and install it.</span></span>   

    > [!NOTE]
    > <span data-ttu-id="e7c1b-171">**Microsoft.Aspnet.Identity.Owin** balíček obsahuje sadu OWIN rozšíření třídy pro správu a konfiguraci middleware ověřování OWIN, který se má používat balíčky ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-171">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>  
    > <span data-ttu-id="e7c1b-172">**Microsoft.Owin.Host.SystemWeb** balíček obsahuje serveru OWIN, která umožňuje aplikacím na základě OWIN běží ve službě IIS pomocí kanál požadavku.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-172">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="e7c1b-173">Další informace najdete v části [integrované kanálu OWIN Middleware v IIS](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="e7c1b-173">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="adding-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="e7c1b-174">Přidání OWIN při spuštění a třídy konfigurace ověřování</span><span class="sxs-lookup"><span data-stu-id="e7c1b-174">Adding OWIN Startup and Authentication Configuration Classes</span></span>

1. <span data-ttu-id="e7c1b-175">V **Průzkumníku řešení**, klikněte pravým tlačítkem na projekt, klikněte na **přidat**a potom **přidat novou položku**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-175">In **Solution Explorer**, right-click your project, click **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="e7c1b-176">V dialogovém okně hledání textového pole zadejte "*owin*".</span><span class="sxs-lookup"><span data-stu-id="e7c1b-176">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="e7c1b-177">Název třídy "*spuštění*" a klikněte na tlačítko **přidat**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-177">Name the class "*Startup*" and click **Add**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="e7c1b-178">V souboru Startup.cs přidáte zvýrazněný uvedené níže, aby konfigurace ověřování souborů cookie OWIN.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-178">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="e7c1b-179">Tato třída obsahuje `OwinStartup` atribut pro zadání třídy pro spuštění OWIN.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-179">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="e7c1b-180">Každá aplikace OWIN obsahuje třídu, spuštění, kde můžete určit komponenty pro kanálu aplikace.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-180">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="e7c1b-181">V tématu [OWIN při spuštění třída detekce](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) Další informace o tomto modelu.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-181">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="adding-web-forms-for-registering-and-logging-in-users"></a><span data-ttu-id="e7c1b-182">Přidání webové formuláře pro registraci a přihlašování uživatelů</span><span class="sxs-lookup"><span data-stu-id="e7c1b-182">Adding Web Forms for Registering and Logging in Users</span></span>

1. <span data-ttu-id="e7c1b-183">Otevřete *Register.cs* souboru a přidejte následující kód, který bude přihlášení uživatele, pokud registrace úspěšná.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-183">Open the *Register.cs* file and add the following code which will log in the user when registration succeeds.</span></span> <span data-ttu-id="e7c1b-184">Změny se zvýrazněnou níže.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-184">The changes are highlighted below.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="e7c1b-185">Vzhledem k tomu, že jsou deklarace identity na základě systému ASP.NET Identity a ověřování souborů Cookie OWIN, vyžaduje rozhraní vývojáři aplikace k vygenerování [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-185">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="e7c1b-186">ClaimsIdentity obsahuje informace o všech deklarací identity pro uživatele, například jaké role uživatel patří.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-186">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="e7c1b-187">V této fázi můžete také přidat další deklarace pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-187">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="e7c1b-188">Uživatel může přihlásit pomocí třídě z OWIN a volání `SignIn` a předávání v ClaimsIdentity, jak je uvedeno výše.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-188">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="e7c1b-189">Tento kód se přihlásit uživatele a vygenerujte soubor cookie také.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-189">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="e7c1b-190">Toto volání se podobá [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) používané [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) modulu.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-190">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="e7c1b-191">V **Průzkumníku řešení**, klikněte pravým tlačítkem myši klikněte na váš projekt **přidat**a potom **webového formuláře**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-191">In **Solution Explorer**, right-click your project click **Add**, and then **Web Form**.</span></span> <span data-ttu-id="e7c1b-192">Název webového formuláře **přihlášení**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-192">Name the web form **Login**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="e7c1b-193">Nahraďte obsah *Login.aspx* soubor s následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="e7c1b-193">Replace the contents of the *Login.aspx* file with the following code:</span></span>  

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="e7c1b-194">Nahraďte obsah *Login.aspx.cs* soubor s následující:</span><span class="sxs-lookup"><span data-stu-id="e7c1b-194">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>  

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="e7c1b-195">`Page_Load` Nyní kontroluje stav aktuálního uživatele a provede akci na základě jeho `Context.User.Identity.IsAuthenticated` stavu.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-195">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>  
    >     <span data-ttu-id="e7c1b-196">**Zobrazit protokolováno v uživatelské jméno** : Microsoft ASP.NET Identity Framework přidala rozšiřující metody na [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) který umožňuje získat `UserName` a `UserId` pro přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-196">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="e7c1b-197">Tyto rozšiřující metody jsou definovány v `Microsoft.AspNet.Identity.Core` sestavení.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-197">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="e7c1b-198">Tyto rozšiřující metody jsou náhradou [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="e7c1b-198">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="e7c1b-199">Metoda přihlášení:</span><span class="sxs-lookup"><span data-stu-id="e7c1b-199">SignIn method:</span></span>   
    >     <span data-ttu-id="e7c1b-200">`This` Metoda nahrazuje předchozí `CreateUser_Click` metoda v této ukázkové a nyní přihlásí uživatel po úspěšném vytvoření uživatele.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-200">`This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >  <span data-ttu-id="e7c1b-201">Rozhraní Microsoft OWIN přidala rozšiřující metody na `System.Web.HttpContext` , které umožňuje získat odkaz na `IOwinContext`.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-201">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="e7c1b-202">Tyto rozšiřující metody jsou definovány v `Microsoft.Owin.Host.SystemWeb` sestavení.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-202">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="e7c1b-203">`OwinContext` Třídy zpřístupňuje `IAuthenticationManager` vlastnost, která představuje funkce middlewaru ověřování dostupné u aktuálního požadavku.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-203">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span>  
    >  <span data-ttu-id="e7c1b-204">Uživatel může přihlásit pomocí `AuthenticationManager` z OWIN a volání `SignIn` a předejte `ClaimsIdentity` jako v příkladu nahoře.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-204">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn`  and passing in the `ClaimsIdentity`  as shown above.</span></span>   
    >  <span data-ttu-id="e7c1b-205">Protože ASP.NET Identity a ověřování souborů Cookie OWIN jsou založené na deklaracích identity systému rozhraní framework vyžaduje, aby aplikace ke generování `ClaimsIdentity` pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-205">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span>   
    >  <span data-ttu-id="e7c1b-206">`ClaimsIdentity` Nemá informace o všech deklarací identity pro uživatele, například jaké role uživatel patří.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-206">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="e7c1b-207">Můžete také přidat další deklarace pro uživatele v této fázi</span><span class="sxs-lookup"><span data-stu-id="e7c1b-207">You can also add more claims for the user at this stage</span></span>  
    >  <span data-ttu-id="e7c1b-208">Tento kód se přihlásit uživatele a vygenerujte soubor cookie také.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-208">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="e7c1b-209">Toto volání se podobá [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) používané [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) modulu.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-209">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="e7c1b-210">`SignOut` Metoda:</span><span class="sxs-lookup"><span data-stu-id="e7c1b-210">`SignOut` method:</span></span>   
    >  <span data-ttu-id="e7c1b-211">Získá odkaz na `AuthenticationManager` z OWIN a volání `SignOut`.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-211">Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="e7c1b-212">Toto je obdobou [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) metodu používanou [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) modulu.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-212">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="e7c1b-213">Stiskněte klávesu **kombinaci kláves Ctrl + F5** sestavení a spuštění webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-213">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="e7c1b-214">Zadejte nové uživatelské jméno a heslo a potom klikněte na **zaregistrovat**.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-214">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
   <span data-ttu-id="e7c1b-215">Poznámka: V tomto okamžiku nového uživatele je vytvořen a přihlášení.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-215">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="e7c1b-216">Klikněte na **odhlášení** tlačítko. Budete přesměrováni do protokolu v podobě.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-216">Click on **Log out** button.You will be redirected to the Log in form.</span></span>
7. <span data-ttu-id="e7c1b-217">Zadejte neplatné uživatelské jméno nebo heslo a klikněte na tlačítko **přihlásit** tlačítko.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-217">Enter an invalid user name or password and Click on **Log in** button.</span></span>   
   <span data-ttu-id="e7c1b-218">`UserManager.Find` Metoda vrátí hodnotu null a chybová zpráva: " *neplatné uživatelské jméno nebo heslo* " se zobrazí.</span><span class="sxs-lookup"><span data-stu-id="e7c1b-218">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
