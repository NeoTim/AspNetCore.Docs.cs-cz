---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
title: Kód nejprve Migration a nasazení s Entity Framework v aplikaci ASP.NET MVC | Dokumentace Microsoftu
author: tdykstra
description: Contoso University ukázkovou webovou aplikaci ukazuje, jak vytvářet aplikace ASP.NET MVC 5 pomocí sady Visual Studio a Entity Framework 6 Code First...
ms.author: riande
ms.date: 10/08/2018
ms.assetid: d4dfc435-bda6-4621-9762-9ba270f8de4e
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 5c926c61cec5c7de43e2c3f0e377023b8ee799d0
ms.sourcegitcommit: a4dcca4f1cb81227c5ed3c92dc0e28be6e99447b
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/10/2018
ms.locfileid: "48913018"
---
<a name="code-first-migrations-and-deployment-with-the-entity-framework-in-an-aspnet-mvc-application"></a><span data-ttu-id="e9932-103">Kód první Migration a nasazení s Entity Framework v aplikaci ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="e9932-103">Code First migrations and deployment with the Entity Framework in an ASP.NET MVC application</span></span>
====================
<span data-ttu-id="e9932-104">podle [Petr Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="e9932-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="e9932-105">Stáhnout dokončený projekt</span><span class="sxs-lookup"><span data-stu-id="e9932-105">Download Completed Project</span></span>](http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8)

> <span data-ttu-id="e9932-106">Ukázková webová aplikace Contoso University ukazuje, jak vytvářet aplikace ASP.NET MVC 5 pomocí Entity Framework 6 kód první a Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e9932-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 5 applications using the Entity Framework 6 Code First and Visual Studio.</span></span> <span data-ttu-id="e9932-107">Informace o této sérii kurzů, naleznete v tématu [z prvního kurzu této série](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="e9932-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>

<span data-ttu-id="e9932-108">Zatím aplikace je spuštěné místně v rámci služby IIS Express na vašem vývojovém počítači.</span><span class="sxs-lookup"><span data-stu-id="e9932-108">So far the application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="e9932-109">Aplikace skutečný zpřístupnit ostatním uživatelům používat přes Internet, musíte nasadit na web poskytovatele hostitelských služeb.</span><span class="sxs-lookup"><span data-stu-id="e9932-109">To make a real application available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="e9932-110">V tomto kurzu nasadíte aplikaci Contoso University do cloudu v Azure.</span><span class="sxs-lookup"><span data-stu-id="e9932-110">In this tutorial, you'll deploy the Contoso University application to the cloud in Azure.</span></span>

<span data-ttu-id="e9932-111">Tento kurz obsahuje následující části:</span><span class="sxs-lookup"><span data-stu-id="e9932-111">The tutorial contains the following sections:</span></span>

- <span data-ttu-id="e9932-112">Povolení migrace Code First.</span><span class="sxs-lookup"><span data-stu-id="e9932-112">Enable Code First Migrations.</span></span> <span data-ttu-id="e9932-113">Funkce migrace umožňuje změnit datový model a vaše změny nasadí do produkčního prostředí o aktualizaci schématu databáze, aniž by bylo nutné vyřadit a znovu vytvořit databázi.</span><span class="sxs-lookup"><span data-stu-id="e9932-113">The Migrations feature enables you to change the data model and deploy your changes to production by updating the database schema without having to drop and re-create the database.</span></span>
- <span data-ttu-id="e9932-114">Nasazení do Azure.</span><span class="sxs-lookup"><span data-stu-id="e9932-114">Deploy to Azure.</span></span> <span data-ttu-id="e9932-115">Tento krok je nepovinný; Zbývající kurzech můžete pokračovat bez nutnosti nasazení projektu.</span><span class="sxs-lookup"><span data-stu-id="e9932-115">This step is optional; you can continue with the remaining tutorials without having deployed the project.</span></span>

<span data-ttu-id="e9932-116">Doporučujeme použít proces průběžné integrace se správou zdrojového kódu pro nasazení, ale v tomto kurzu ale nenajdete, tato témata.</span><span class="sxs-lookup"><span data-stu-id="e9932-116">We recommend that you use a continuous integration process with source control for deployment, but this tutorial does not cover those topics.</span></span> <span data-ttu-id="e9932-117">Další informace najdete v tématu [správy zdrojového kódu](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) a [kontinuální integrace](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) kapitoly [vytváření skutečných cloudových aplikací s využitím Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction).</span><span class="sxs-lookup"><span data-stu-id="e9932-117">For more information, see the [source control](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) and [continuous integration](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) chapters of [Building Real-World Cloud Apps with Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction).</span></span>

## <a name="enable-code-first-migrations"></a><span data-ttu-id="e9932-118">Povolení migrace Code First</span><span class="sxs-lookup"><span data-stu-id="e9932-118">Enable Code First migrations</span></span>

<span data-ttu-id="e9932-119">Při vývoji nových aplikací, datového modelu mění často a pokaždé, když změny modelu, získá synchronizován s databází.</span><span class="sxs-lookup"><span data-stu-id="e9932-119">When you develop a new application, your data model changes frequently, and each time the model changes, it gets out of sync with the database.</span></span> <span data-ttu-id="e9932-120">Nakonfigurovali jste automaticky vyřadit a znovu vytvořit databázi pokaždé, když změníte datový model Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="e9932-120">You have configured the Entity Framework to automatically drop and re-create the database each time you change the data model.</span></span> <span data-ttu-id="e9932-121">Při přidání, odebrání, nebo změnit tříd entit nebo změnit váš `DbContext` třídy, při příštím spuštění aplikace automaticky odstraní existující databázi, vytvoří nový, který odpovídá modelu a nasazení se nasazuje s testovací data.</span><span class="sxs-lookup"><span data-stu-id="e9932-121">When you add, remove, or change entity classes or change your `DbContext` class, the next time you run the application it automatically deletes your existing database, creates a new one that matches the model, and seeds it with test data.</span></span>

<span data-ttu-id="e9932-122">Tato metoda zachování databáze synchronizované s datovým modelem funguje dobře, dokud nasadit aplikaci do produkčního prostředí.</span><span class="sxs-lookup"><span data-stu-id="e9932-122">This method of keeping the database in sync with the data model works well until you deploy the application to production.</span></span> <span data-ttu-id="e9932-123">Když aplikace běží v produkčním prostředí, je obvykle ukládá data, která chcete zachovat, a nechcete ztratit všechno, co pokaždé, když provedete změny, např. přidejte nový sloupec.</span><span class="sxs-lookup"><span data-stu-id="e9932-123">When the application is running in production, it is usually storing data that you want to keep, and you don't want to lose everything each time you make a change such as adding a new column.</span></span> <span data-ttu-id="e9932-124">[Migrace Code First](https://msdn.microsoft.com/data/jj591621) funkce tento problém řeší tím, že Code First pro aktualizaci schématu databáze místo vyřadit a znovu vytvořit databázi.</span><span class="sxs-lookup"><span data-stu-id="e9932-124">The [Code First Migrations](https://msdn.microsoft.com/data/jj591621) feature solves this problem by enabling Code First to update the database schema instead of dropping and re-creating the database.</span></span> <span data-ttu-id="e9932-125">V tomto kurzu budete nasazovat aplikaci a příprava, který vám umožní migraci.</span><span class="sxs-lookup"><span data-stu-id="e9932-125">In this tutorial, you'll deploy the application, and to prepare for that you'll enable Migrations.</span></span>

1. <span data-ttu-id="e9932-126">Zakázat inicializátoru, který jste nastavili dříve okomentováním odpovídajícího nebo odstraněním `contexts` element, který jste přidali do souboru Web.config aplikace.</span><span class="sxs-lookup"><span data-stu-id="e9932-126">Disable the initializer that you set up earlier by commenting out or deleting the `contexts` element that you added to the application Web.config file.</span></span>

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.xml?highlight=2,6)]
2. <span data-ttu-id="e9932-127">Také v aplikaci *Web.config* změňte název databáze v připojovacím řetězci ContosoUniversity2.</span><span class="sxs-lookup"><span data-stu-id="e9932-127">Also in the application *Web.config* file, change the name of the database in the connection string to ContosoUniversity2.</span></span>

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.xml?highlight=2)]

    <span data-ttu-id="e9932-128">Tato změna nastaví projekt tak, aby první migraci vytvoří novou databázi.</span><span class="sxs-lookup"><span data-stu-id="e9932-128">This change sets up the project so that the first migration creates a new database.</span></span> <span data-ttu-id="e9932-129">Tato akce není povinná, ale zobrazí se vám později důvod, proč je vhodné.</span><span class="sxs-lookup"><span data-stu-id="e9932-129">This isn't required but you'll see later why it's a good idea.</span></span>
3. <span data-ttu-id="e9932-130">Z **nástroje** nabídce vyberte možnost **Správce balíčků NuGet** > **Konzola správce balíčků**.</span><span class="sxs-lookup"><span data-stu-id="e9932-130">From the **Tools** menu, select **NuGet Package Manager** > **Package Manager Console**.</span></span>

1. <span data-ttu-id="e9932-131">Na `PM>` řádku zadejte následující příkazy:</span><span class="sxs-lookup"><span data-stu-id="e9932-131">At the `PM>` prompt enter the following commands:</span></span>

    ```text
    enable-migrations
    add-migration InitialCreate
    ```

    ![příkaz povolení migrace](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

    <span data-ttu-id="e9932-133">`enable-migrations` Příkaz vytvoří *migrace* složky v projektu ContosoUniversity a umístí v této složce *Configuration.cs* souboru, který můžete upravit konfiguraci migrace.</span><span class="sxs-lookup"><span data-stu-id="e9932-133">The `enable-migrations` command creates a *Migrations* folder in the ContosoUniversity project, and it puts in that folder a *Configuration.cs* file that you can edit to configure Migrations.</span></span>

    <span data-ttu-id="e9932-134">(Pokud předchozí krok, který nasměruje můžete změnit název databáze, migrace se najít existující databázi a automaticky provést `add-migration` příkazu.</span><span class="sxs-lookup"><span data-stu-id="e9932-134">(If you missed the step above that directs you to change the database name, Migrations will find the existing database and automatically do the `add-migration` command.</span></span> <span data-ttu-id="e9932-135">Který je v pořádku, že stačí znamená to, že před nasazením databáze nebude spuštění testu migrace kódu.</span><span class="sxs-lookup"><span data-stu-id="e9932-135">That's okay, it just means you won't run a test of the migrations code before you deploy the database.</span></span> <span data-ttu-id="e9932-136">Později při spuštění `update-database` příkaz nic se nestane, protože databáze již existuje.)</span><span class="sxs-lookup"><span data-stu-id="e9932-136">Later when you run the `update-database` command nothing will happen because the database already exists.)</span></span>

    ![Migrace složky](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

    <span data-ttu-id="e9932-138">Jako inicializátor třídy, která jste viděli dříve, `Configuration` třída zahrnuje `Seed` metoda.</span><span class="sxs-lookup"><span data-stu-id="e9932-138">Like the initializer class that you saw earlier, the `Configuration` class includes a `Seed` method.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cs)]

    <span data-ttu-id="e9932-139">Účelem [počáteční hodnoty](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) metodou je vám umožní vložit nebo aktualizovat data testu po Code First vytvoří nebo aktualizuje databázi.</span><span class="sxs-lookup"><span data-stu-id="e9932-139">The purpose of the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method is to enable you to insert or update test data after Code First creates or updates the database.</span></span> <span data-ttu-id="e9932-140">Metoda je volána při vytvoření databáze a pokaždé, když je schéma databáze se aktualizuje po změně datového modelu.</span><span class="sxs-lookup"><span data-stu-id="e9932-140">The method is called when the database is created and every time the database schema is updated after a data model change.</span></span>

### <a name="set-up-the-seed-method"></a><span data-ttu-id="e9932-141">Nastavit Seed – metoda</span><span class="sxs-lookup"><span data-stu-id="e9932-141">Set up the Seed method</span></span>

<span data-ttu-id="e9932-142">Když vyřadit a znovu vytvořit databázi u každé změny datového modelu, můžete použít třídu inicializátor `Seed` metoda vložit testovací data, protože po každé změně modelu databázi vyřadit a všechny testovací data se ztratí.</span><span class="sxs-lookup"><span data-stu-id="e9932-142">When you drop and re-create the database for every data model change, you use the initializer class's `Seed` method to insert test data, because after every model change the database is dropped and all the test data is lost.</span></span> <span data-ttu-id="e9932-143">Pomocí migrace Code First, testovací data se uchovávají po provedení změn databáze, takže včetně testovací data v [počáteční hodnoty](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) metodu není obvykle nutné.</span><span class="sxs-lookup"><span data-stu-id="e9932-143">With Code First Migrations, test data is retained after database changes, so including test data in the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method is typically not necessary.</span></span> <span data-ttu-id="e9932-144">Ve skutečnosti nechcete, aby `Seed` metoda k vložení dat testu, pokud budete používat migrace nasazení databáze do produkčního prostředí, protože `Seed` metoda bude spuštěna v produkčním prostředí.</span><span class="sxs-lookup"><span data-stu-id="e9932-144">In fact, you don't want the `Seed` method to insert test data if you'll be using Migrations to deploy the database to production, because the `Seed` method will run in production.</span></span> <span data-ttu-id="e9932-145">V takovém případě má `Seed` metoda k vložení do databáze pouze data, která budete potřebovat v produkčním prostředí.</span><span class="sxs-lookup"><span data-stu-id="e9932-145">In that case, you want the `Seed` method to insert into the database only the data that you need in production.</span></span> <span data-ttu-id="e9932-146">Například může být vhodné zahrnout názvy skutečné oddělení v databázi `Department` tabulky, když se aplikace zpřístupní v produkčním prostředí.</span><span class="sxs-lookup"><span data-stu-id="e9932-146">For example, you might want the database to include actual department names in the `Department` table when the application becomes available in production.</span></span>

<span data-ttu-id="e9932-147">Pro účely tohoto kurzu budete používat migrace pro nasazení, ale vaše `Seed` metoda bude přesto vložit testovací data pro snazší zjistit, jak funguje funkčnost aplikace, aniž byste museli ručně vložit velké množství dat.</span><span class="sxs-lookup"><span data-stu-id="e9932-147">For this tutorial, you'll be using Migrations for deployment, but your `Seed` method will insert test data anyway in order to make it easier to see how application functionality works without having to manually insert a lot of data.</span></span>

1. <span data-ttu-id="e9932-148">Nahraďte obsah *Configuration.cs* souboru následujícím kódem, který načte testovací data do nové databáze.</span><span class="sxs-lookup"><span data-stu-id="e9932-148">Replace the contents of the *Configuration.cs* file with the following code, which loads test data into the new database.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs)]

    <span data-ttu-id="e9932-149">[Počáteční hodnoty](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) metoda přijímá jako vstupní parametr objekt kontextu databáze, a kód v metodě používá tento objekt k přidání nové entity do databáze.</span><span class="sxs-lookup"><span data-stu-id="e9932-149">The [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method takes the database context object as an input parameter, and the code in the method uses that object to add new entities to the database.</span></span> <span data-ttu-id="e9932-150">Pro každý typ entity kód vytvoří kolekci nové entity, se přidají do příslušné [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) vlastnost a uloží změny do databáze.</span><span class="sxs-lookup"><span data-stu-id="e9932-150">For each entity type, the code creates a collection of new entities, adds them to the appropriate [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) property, and then saves the changes to the database.</span></span> <span data-ttu-id="e9932-151">Není nutné volat [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) metoda po každé skupiny entit, jako se zde provádí, ale způsobem, který pomáhá při hledání příčiny problému, pokud dojde k výjimce, zatímco kód zapisuje do databáze.</span><span class="sxs-lookup"><span data-stu-id="e9932-151">It isn't necessary to call the [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) method after each group of entities, as is done here, but doing that helps you locate the source of a problem if an exception occurs while the code is writing to the database.</span></span>

    <span data-ttu-id="e9932-152">Některé příkazy, které vkládají data používají [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) metody k provedení operace "upsert".</span><span class="sxs-lookup"><span data-stu-id="e9932-152">Some of the statements that insert data use the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method to perform an "upsert" operation.</span></span> <span data-ttu-id="e9932-153">Protože `Seed` metoda se spustí pokaždé, když spustíte `update-database` příkazu, obvykle po každou migraci dat, nemůže právě vložit, protože se snažíte přidat řádky už budou tam po první migrace, který vytvoří databázi.</span><span class="sxs-lookup"><span data-stu-id="e9932-153">Because the `Seed` method runs every time you execute the `update-database` command, typically after each migration, you can't just insert data, because the rows you are trying to add will already be there after the first migration that creates the database.</span></span> <span data-ttu-id="e9932-154">Operace "upsert", zabraňuje chybám, které by mohlo dojít, pokud se pokusíte vložit řádek, který již existuje, ale ***přepíše*** všechny změny dat, který může mít provedené při testování aplikace.</span><span class="sxs-lookup"><span data-stu-id="e9932-154">The "upsert" operation prevents errors that would happen if you try to insert a row that already exists, but it ***overrides*** any changes to data that you may have made while testing the application.</span></span> <span data-ttu-id="e9932-155">Pomocí testovacích dat v některých tabulkách nechcete provést: v některých případech při změně dat při testování chcete své změny zůstat po aktualizacích databáze.</span><span class="sxs-lookup"><span data-stu-id="e9932-155">With test data in some tables you might not want that to happen: in some cases when you change data while testing you want your changes to remain after database updates.</span></span> <span data-ttu-id="e9932-156">V takovém případě ji chcete vložit podmíněné operace: Vložit řádek jenom v případě, že ještě neexistuje.</span><span class="sxs-lookup"><span data-stu-id="e9932-156">In that case you want to do a conditional insert operation: insert a row only if it doesn't already exist.</span></span> <span data-ttu-id="e9932-157">Seed – metoda používá oba přístupy.</span><span class="sxs-lookup"><span data-stu-id="e9932-157">The Seed method uses both approaches.</span></span>

    <span data-ttu-id="e9932-158">První parametr předána [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) metody určuje vlastnost, která má použít ke kontrole, jestli řádek již existuje.</span><span class="sxs-lookup"><span data-stu-id="e9932-158">The first parameter passed to the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method specifies the property to use to check if a row already exists.</span></span> <span data-ttu-id="e9932-159">Pro testovací data studentů, které poskytujete `LastName` vlastnost lze použít pro tento účel, protože je jedinečný název každé poslední v seznamu:</span><span class="sxs-lookup"><span data-stu-id="e9932-159">For the test student data that you are providing, the `LastName` property can be used for this purpose since each last name in the list is unique:</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cs)]

    <span data-ttu-id="e9932-160">Tento kód předpokládá, že poslední názvy musí být jedinečné.</span><span class="sxs-lookup"><span data-stu-id="e9932-160">This code assumes that last names are unique.</span></span> <span data-ttu-id="e9932-161">Pokud chcete ručně přidat studenta s duplicitním názvem poslední, získáte následující výjimku při příštím provedení migrace:</span><span class="sxs-lookup"><span data-stu-id="e9932-161">If you manually add a student with a duplicate last name, you'll get the following exception the next time you perform a migration:</span></span>

    <span data-ttu-id="e9932-162">**Posloupnost obsahuje více než jeden prvek.**</span><span class="sxs-lookup"><span data-stu-id="e9932-162">**Sequence contains more than one element**</span></span>

    <span data-ttu-id="e9932-163">Informace o tom, jak zpracování redundantních dat, jako je například dvou studentů s názvem "Alexander Carsonovy" najdete v tématu [financování a ladění Entity Framework (EF) databází](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) na blogu Ricka Andersona.</span><span class="sxs-lookup"><span data-stu-id="e9932-163">For information about how to handle redundant data such as two students named "Alexander Carson", see [Seeding and Debugging Entity Framework (EF) DBs](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) on Rick Anderson's blog.</span></span> <span data-ttu-id="e9932-164">Další informace o `AddOrUpdate` metodu, najdete v článku [postará metodou AddOrUpdate 4.3 EF](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) na blogu Julie Lerman.</span><span class="sxs-lookup"><span data-stu-id="e9932-164">For more information about the `AddOrUpdate` method, see [Take care with EF 4.3 AddOrUpdate Method](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) on Julie Lerman's blog.</span></span>

    <span data-ttu-id="e9932-165">Kód, který vytvoří `Enrollment` entity předpokládá, že máte `ID` hodnotu entit v `students` kolekcí, i když jste nenastavili tuto vlastnost v kódu, který vytvoří kolekci.</span><span class="sxs-lookup"><span data-stu-id="e9932-165">The code that creates `Enrollment` entities assumes you have the `ID` value in the entities in the `students` collection, although you didn't set that property in the code that creates the collection.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs?highlight=2)]

    <span data-ttu-id="e9932-166">Můžete použít `ID` vlastnost zde protože `ID` hodnotu při volání `SaveChanges` pro `students` kolekce.</span><span class="sxs-lookup"><span data-stu-id="e9932-166">You can use the `ID` property here because the `ID` value is set when you call `SaveChanges` for the `students` collection.</span></span> <span data-ttu-id="e9932-167">EF automaticky získá hodnotu primárního klíče, když se vloží entitu do databáze, a aktualizuje `ID` vlastnost entity v paměti.</span><span class="sxs-lookup"><span data-stu-id="e9932-167">EF automatically gets the primary key value when it inserts an entity into the database, and it updates the `ID` property of the entity in memory.</span></span>

    <span data-ttu-id="e9932-168">Kód, který přidá všechny `Enrollment` entita, která má `Enrollments` nepoužívá sadu entit `AddOrUpdate` metoda.</span><span class="sxs-lookup"><span data-stu-id="e9932-168">The code that adds each `Enrollment` entity to the `Enrollments` entity set doesn't use the `AddOrUpdate` method.</span></span> <span data-ttu-id="e9932-169">Zkontroluje, jestli entita již existuje a vloží entitu, pokud neexistuje.</span><span class="sxs-lookup"><span data-stu-id="e9932-169">It checks if an entity already exists and inserts the entity if it doesn't exist.</span></span> <span data-ttu-id="e9932-170">Tento přístup se zachovat změny provedené na podnikové úrovni registraci pomocí aplikace uživatelského rozhraní.</span><span class="sxs-lookup"><span data-stu-id="e9932-170">This approach will preserve changes you make to an enrollment grade by using the application UI.</span></span> <span data-ttu-id="e9932-171">Kód prochází každý člen `Enrollment` [seznamu](https://msdn.microsoft.com/library/6sh2ey19.aspx) a pokud registrace nebyl nalezen v databázi, přidá přihlášení k databázi.</span><span class="sxs-lookup"><span data-stu-id="e9932-171">The code loops through each member of the `Enrollment`[List](https://msdn.microsoft.com/library/6sh2ey19.aspx) and if the enrollment is not found in the database, it adds the enrollment to the database.</span></span> <span data-ttu-id="e9932-172">Při prvním aktualizaci databáze, databáze se bude prázdný, tak přidá každý registrace.</span><span class="sxs-lookup"><span data-stu-id="e9932-172">The first time you update the database, the database will be empty, so it will add each enrollment.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

2. <span data-ttu-id="e9932-173">Sestavte projekt.</span><span class="sxs-lookup"><span data-stu-id="e9932-173">Build the project.</span></span>

### <a name="execute-the-first-migration"></a><span data-ttu-id="e9932-174">Spuštění první migrace</span><span class="sxs-lookup"><span data-stu-id="e9932-174">Execute the first migration</span></span>

<span data-ttu-id="e9932-175">Při spouštění `add-migration` příkazu migrace vygeneruje kód, který by vytvořila databázi úplně od začátku.</span><span class="sxs-lookup"><span data-stu-id="e9932-175">When you executed the `add-migration` command, Migrations generated the code that would create the database from scratch.</span></span> <span data-ttu-id="e9932-176">Tento kód je také v *migrace* složku, v souboru s názvem  *&lt;časové razítko&gt;\_InitialCreate.cs*.</span><span class="sxs-lookup"><span data-stu-id="e9932-176">This code is also in the *Migrations* folder, in the file named *&lt;timestamp&gt;\_InitialCreate.cs*.</span></span> <span data-ttu-id="e9932-177">`Up` Metodu `InitialCreate` třída vytvoří databázové tabulky, které odpovídají sady entit datového modelu a `Down` je metoda odstraní.</span><span class="sxs-lookup"><span data-stu-id="e9932-177">The `Up` method of the `InitialCreate` class creates the database tables that correspond to the data model entity sets, and the `Down` method deletes them.</span></span>

[!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="e9932-178">Migrace volání `Up` metody k implementaci změn datových modelů pro migraci.</span><span class="sxs-lookup"><span data-stu-id="e9932-178">Migrations calls the `Up` method to implement the data model changes for a migration.</span></span> <span data-ttu-id="e9932-179">Po zadání příkazu vrácení zpět aktualizace, volání migrace `Down` metody.</span><span class="sxs-lookup"><span data-stu-id="e9932-179">When you enter a command to roll back the update, Migrations calls the `Down` method.</span></span>

<span data-ttu-id="e9932-180">Toto je počáteční migraci, která byla vytvořena, když jste zadali `add-migration InitialCreate` příkazu.</span><span class="sxs-lookup"><span data-stu-id="e9932-180">This is the initial migration that was created when you entered the `add-migration InitialCreate` command.</span></span> <span data-ttu-id="e9932-181">Parametr (`InitialCreate` v příkladu) se používá pro soubor pojmenujte a může být cokoliv, co chcete; obvykle zvolíte slovo nebo slovní spojení, které shrnuje, co se provádí v migraci.</span><span class="sxs-lookup"><span data-stu-id="e9932-181">The parameter (`InitialCreate` in the example) is used for the file name and can be whatever you want; you typically choose a word or phrase that summarizes what is being done in the migration.</span></span> <span data-ttu-id="e9932-182">Můžete například pojmenovat pozdější migraci &quot;AddDepartmentTable&quot;.</span><span class="sxs-lookup"><span data-stu-id="e9932-182">For example, you might name a later migration &quot;AddDepartmentTable&quot;.</span></span>

<span data-ttu-id="e9932-183">Pokud jste vytvořili počáteční migraci databáze již existuje, vygeneruje kód pro vytvoření databáze, ale nemusí spustit, protože databáze již odpovídá datového modelu.</span><span class="sxs-lookup"><span data-stu-id="e9932-183">If you created the initial migration when the database already exists, the database creation code is generated but it doesn't have to run because the database already matches the data model.</span></span> <span data-ttu-id="e9932-184">Když nasadíte aplikaci do jiného prostředí, kde databáze neexistuje ale tento kód spustí k vytvoření databáze, proto je vhodné se nejdřív otestovat.</span><span class="sxs-lookup"><span data-stu-id="e9932-184">When you deploy the app to another environment where the database doesn't exist yet, this code will run to create your database, so it's a good idea to test it first.</span></span> <span data-ttu-id="e9932-185">To je důvod, proč jste změnili název databáze v připojovacím řetězci dříve&mdash;tak, aby migrace můžete vytvořit nový úplně od začátku.</span><span class="sxs-lookup"><span data-stu-id="e9932-185">That's why you changed the name of the database in the connection string earlier&mdash;so that migrations can create a new one from scratch.</span></span>

1. <span data-ttu-id="e9932-186">V **Konzola správce balíčků** okno, zadejte následující příkaz:</span><span class="sxs-lookup"><span data-stu-id="e9932-186">In the **Package Manager Console** window, enter the following command:</span></span>

    `update-database`

    ![](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image3.png)

    <span data-ttu-id="e9932-187">`update-database` Příkaz spustí `Up` spustí metodu pro vytvoření databáze a pak ho `Seed` metoda k naplnění databáze.</span><span class="sxs-lookup"><span data-stu-id="e9932-187">The `update-database` command runs the `Up` method to create the database and then it runs the `Seed` method to populate the database.</span></span> <span data-ttu-id="e9932-188">Stejný postup se spustí automaticky v produkčním prostředí po nasazení aplikace, jak uvidíte v následující části.</span><span class="sxs-lookup"><span data-stu-id="e9932-188">The same process will run automatically in production after you deploy the application, as you'll see in the following section.</span></span>
2. <span data-ttu-id="e9932-189">Použití **Průzkumníka serveru** ke kontrole databáze, stejně jako v prvním kurzu a spuštění aplikace pro ověření, že vše stále funguje stejně jako předtím.</span><span class="sxs-lookup"><span data-stu-id="e9932-189">Use **Server Explorer** to inspect the database as you did in the first tutorial, and run the application to verify that everything still works the same as before.</span></span>

## <a name="deploy-to-azure"></a><span data-ttu-id="e9932-190">Nasazení do Azure</span><span class="sxs-lookup"><span data-stu-id="e9932-190">Deploy to Azure</span></span>

<span data-ttu-id="e9932-191">Zatím aplikace je spuštěné místně v rámci služby IIS Express na vašem vývojovém počítači.</span><span class="sxs-lookup"><span data-stu-id="e9932-191">So far the application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="e9932-192">Chcete-li k dispozici pro ostatní použití přes Internet, musíte nasadit na web poskytovatele hostitelských služeb.</span><span class="sxs-lookup"><span data-stu-id="e9932-192">To make it available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="e9932-193">V této části kurzu budete ji nasadit do Azure.</span><span class="sxs-lookup"><span data-stu-id="e9932-193">In this section of the tutorial, you'll deploy it to Azure.</span></span> <span data-ttu-id="e9932-194">Tato část je volitelná. Můžete to přeskočit a pokračovat v následujícím kurzu, nebo můžete si přizpůsobit pokyny v této části pro jiného poskytovatele hostitelských služeb podle vašeho výběru.</span><span class="sxs-lookup"><span data-stu-id="e9932-194">This section is optional; you can skip this and continue with the following tutorial, or you can adapt the instructions in this section for a different hosting provider of your choice.</span></span>

### <a name="use-code-first-migrations-to-deploy-the-database"></a><span data-ttu-id="e9932-195">Pomocí migrace Code First pro nasazení databáze</span><span class="sxs-lookup"><span data-stu-id="e9932-195">Use Code First migrations to deploy the database</span></span>

<span data-ttu-id="e9932-196">Pokud chcete nasadit databázi, budete používat migrace Code First.</span><span class="sxs-lookup"><span data-stu-id="e9932-196">To deploy the database, you'll use Code First Migrations.</span></span> <span data-ttu-id="e9932-197">Když vytvoříte profil publikování, který použijete ke konfiguraci nastavení pro nasazení ze sady Visual Studio, vyberte zaškrtávací políčko s názvem **aktualizace databáze**.</span><span class="sxs-lookup"><span data-stu-id="e9932-197">When you create the publish profile that you use to configure settings for deploying from Visual Studio, you'll select a check box labeled **Update Database**.</span></span> <span data-ttu-id="e9932-198">Toto nastavení způsobí, že proces nasazení pro automatickou konfiguraci aplikace *Web.config* souboru na cílovém serveru tak, aby používala Code First `MigrateDatabaseToLatestVersion` inicializátor třídy.</span><span class="sxs-lookup"><span data-stu-id="e9932-198">This setting causes the deployment process to automatically configure the application *Web.config* file on the destination server so that Code First uses the `MigrateDatabaseToLatestVersion` initializer class.</span></span>

<span data-ttu-id="e9932-199">Visual Studio nebude dělat nic s databází během procesu nasazení, zatímco kopíruje váš projekt na cílový server.</span><span class="sxs-lookup"><span data-stu-id="e9932-199">Visual Studio doesn't do anything with the database during the deployment process while it is copying your project to the destination server.</span></span> <span data-ttu-id="e9932-200">Při spuštění aplikace nasazené a přistupuje k databázi po nasazení poprvé, Code First zkontroluje, jestli databáze se shoduje s datovým modelem.</span><span class="sxs-lookup"><span data-stu-id="e9932-200">When you run the deployed application and it accesses the database for the first time after deployment, Code First checks if the database matches the data model.</span></span> <span data-ttu-id="e9932-201">Pokud dojde k neshodě, Code First automaticky vytvoří databáze (pokud ještě neexistuje) nebo aktualizuje schéma databáze na nejnovější verzi (Pokud je databáze existuje, ale neodpovídá modelu).</span><span class="sxs-lookup"><span data-stu-id="e9932-201">If there's a mismatch, Code First automatically creates the database (if it doesn't exist yet) or updates the database schema to the latest version (if a database exists but doesn't match the model).</span></span> <span data-ttu-id="e9932-202">Pokud aplikace implementuje migrace `Seed` metody, metoda spustí po vytvoření databáze nebo schéma se aktualizuje.</span><span class="sxs-lookup"><span data-stu-id="e9932-202">If the application implements a Migrations `Seed` method, the method runs after the database is created or the schema is updated.</span></span>

<span data-ttu-id="e9932-203">Vaše migrace `Seed` metoda vloží testovací data.</span><span class="sxs-lookup"><span data-stu-id="e9932-203">Your Migrations `Seed` method inserts test data.</span></span> <span data-ttu-id="e9932-204">Pokud se nasazení do produkčního prostředí, je třeba změnit `Seed` metodu tak, že pouze vkládá nějaká data, která má být vložen do provozní databáze.</span><span class="sxs-lookup"><span data-stu-id="e9932-204">If you were deploying to a production environment, you would have to change the `Seed` method so that it only inserts data that you want to be inserted into your production database.</span></span> <span data-ttu-id="e9932-205">Aktuální model dat můžete například mít skutečné kurzů, ale fiktivní studenty v databázi vývoj.</span><span class="sxs-lookup"><span data-stu-id="e9932-205">For example, in your current data model you might want to have real courses but fictional students in the development database.</span></span> <span data-ttu-id="e9932-206">Můžete napsat `Seed` má metoda načíst i při vývoji a poté komentář fiktivní studenty, před nasazením do produkčního prostředí.</span><span class="sxs-lookup"><span data-stu-id="e9932-206">You can write a `Seed` method to load both in development, and then comment out the fictional students before you deploy to production.</span></span> <span data-ttu-id="e9932-207">Nebo můžete napsat `Seed` má metoda načíst pouze kurzů a zadejte fiktivní studenty v testovací databázi ručně pomocí uživatelského rozhraní aplikace.</span><span class="sxs-lookup"><span data-stu-id="e9932-207">Or you can write a `Seed` method to load only courses, and enter the fictional students in the test database manually by using the application's UI.</span></span>

### <a name="get-an-azure-account"></a><span data-ttu-id="e9932-208">Vytvoření účtu Azure</span><span class="sxs-lookup"><span data-stu-id="e9932-208">Get an Azure account</span></span>

<span data-ttu-id="e9932-209">Budete potřebovat účet Azure.</span><span class="sxs-lookup"><span data-stu-id="e9932-209">You'll need an Azure account.</span></span> <span data-ttu-id="e9932-210">Pokud ho ještě nemáte, ale máte předplatné sady Visual Studio, můžete si [aktivovat výhody předplatného](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/
).</span><span class="sxs-lookup"><span data-stu-id="e9932-210">If you don't already have one, but you do have a Visual Studio subscription, you can [activate your subscription benefits](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/
).</span></span> <span data-ttu-id="e9932-211">V opačném případě můžete vytvořit bezplatného zkušebního účtu stačí pár minut.</span><span class="sxs-lookup"><span data-stu-id="e9932-211">Otherwise, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="e9932-212">Podrobnosti najdete v tématu [bezplatnou zkušební verzi Azure](https://azure.microsoft.com/free/).</span><span class="sxs-lookup"><span data-stu-id="e9932-212">For details, see [Azure Free Trial](https://azure.microsoft.com/free/).</span></span>

### <a name="create-a-web-site-and-a-sql-database-in-azure"></a><span data-ttu-id="e9932-213">Vytvoření webu a SQL database v Azure</span><span class="sxs-lookup"><span data-stu-id="e9932-213">Create a web site and a SQL database in Azure</span></span>

<span data-ttu-id="e9932-214">Webové aplikace v Azure se spustí ve sdíleném hostování prostředí, což znamená, že běží na virtuálních počítačích (VM), které jsou sdíleny s jinými klienty Azure.</span><span class="sxs-lookup"><span data-stu-id="e9932-214">Your web app in Azure will run in a shared hosting environment, which means it runs on virtual machines (VMs) that are shared with other Azure clients.</span></span> <span data-ttu-id="e9932-215">Sdílené hostitelského prostředí je s nízkými náklady způsob, jak začít pracovat v cloudu.</span><span class="sxs-lookup"><span data-stu-id="e9932-215">A shared hosting environment is a low-cost way to get started in the cloud.</span></span> <span data-ttu-id="e9932-216">Později hodnota se zvyšuje webový provoz, aplikace můžete škálovat podle potřeby spouští na vyhrazených virtuálních počítačích.</span><span class="sxs-lookup"><span data-stu-id="e9932-216">Later, if your web traffic increases, the application can scale to meet the need by running on dedicated VMs.</span></span> <span data-ttu-id="e9932-217">Další informace o cenové možnosti pro službu Azure App Service, [ceny služeb App Service](https://azure.microsoft.com/pricing/details/app-service/).</span><span class="sxs-lookup"><span data-stu-id="e9932-217">To learn more about Pricing Options for Azure App Service, read [App Service pricing](https://azure.microsoft.com/pricing/details/app-service/).</span></span>

<span data-ttu-id="e9932-218">Budete nasazovat databázi do Azure SQL database.</span><span class="sxs-lookup"><span data-stu-id="e9932-218">You'll deploy the database to Azure SQL database.</span></span> <span data-ttu-id="e9932-219">SQL database je služba relační databáze založené na cloudu, která je založená na technologiích systému SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e9932-219">SQL database is a cloud-based relational database service that is built on SQL Server technologies.</span></span> <span data-ttu-id="e9932-220">Nástroje a aplikace, které fungují s SQL serverem se také fungují s SQL database.</span><span class="sxs-lookup"><span data-stu-id="e9932-220">Tools and applications that work with SQL Server also work with SQL database.</span></span>

1. <span data-ttu-id="e9932-221">V [portálu pro správu Azure](https://portal.azure.com), zvolte **vytvořit prostředek** v levé kartě a klikněte na tlačítko **zobrazit všechny** na **nový** podokna (nebo *okno*) zobrazíte všechny dostupné prostředky.</span><span class="sxs-lookup"><span data-stu-id="e9932-221">In the [Azure Management Portal](https://portal.azure.com), choose **Create a resource** in the left tab and then choose **See all** on the **New** pane (or *blade*) to see all available resources.</span></span> <span data-ttu-id="e9932-222">Zvolte **Web App + SQL** v **webové** část **všechno, co** okno.</span><span class="sxs-lookup"><span data-stu-id="e9932-222">Choose **Web App + SQL** in the **Web** section of the **Everything** blade.</span></span> <span data-ttu-id="e9932-223">Nakonec vyberte **vytvořit**.</span><span class="sxs-lookup"><span data-stu-id="e9932-223">Finally, choose **Create**.</span></span>

    ![Vytvoření prostředku na webu Azure portal](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/create-azure-resource.png)

   <span data-ttu-id="e9932-225">Formulář pro vytvoření nového **nový Web App + SQL** otevře prostředků.</span><span class="sxs-lookup"><span data-stu-id="e9932-225">The form to create a new **New Web App + SQL** resource opens.</span></span>

2. <span data-ttu-id="e9932-226">Zadejte řetězec **název aplikace** pole použít jako jedinečná adresa URL pro vaši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="e9932-226">Enter a string in the **App name** box to use as the unique URL for your application.</span></span> <span data-ttu-id="e9932-227">Úplná adresa URL bude obsahovat co zde zadáte plus výchozí doménu služby Azure App Services (. azurewebsites.net).</span><span class="sxs-lookup"><span data-stu-id="e9932-227">The complete URL will consist of what you enter here plus the default domain of Azure App Services (.azurewebsites.net).</span></span> <span data-ttu-id="e9932-228">Pokud **název aplikace** se už používá, Průvodce vás upozorní červeným *název aplikace není k dispozici* zprávy.</span><span class="sxs-lookup"><span data-stu-id="e9932-228">If the **App name** is already taken, the Wizard notifies you with a red *The app name is not available* message.</span></span> <span data-ttu-id="e9932-229">Pokud **název aplikace** je k dispozici, zobrazí se zelené zaškrtnutí.</span><span class="sxs-lookup"><span data-stu-id="e9932-229">If the **App name** is available, you see a green checkmark.</span></span>

    ![Vytvoření s odkazem databáze na portálu pro správu](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/create-web-app-sql-resource.png)

3. <span data-ttu-id="e9932-231">V **předplatné** vyberte předplatné Azure, ve kterém chcete **služby App Service** uložená.</span><span class="sxs-lookup"><span data-stu-id="e9932-231">In the **Subscription** box, choose the Azure Subscription in which you want the **App Service** to reside.</span></span>

4. <span data-ttu-id="e9932-232">V **skupiny prostředků** textového pole, vyberte skupinu prostředků nebo vytvořte novou.</span><span class="sxs-lookup"><span data-stu-id="e9932-232">In the **Resource Group** text box, choose a Resource Group or create a new one.</span></span> <span data-ttu-id="e9932-233">Toto nastavení určuje datové centrum, kterého webu se spustí v.</span><span class="sxs-lookup"><span data-stu-id="e9932-233">This setting specifies which data center your web site will run in.</span></span> <span data-ttu-id="e9932-234">Další informace o skupinách prostředků najdete v tématu [skupiny prostředků](/azure/azure-resource-manager/resource-group-overview#resource-groups).</span><span class="sxs-lookup"><span data-stu-id="e9932-234">For more information about Resource Groups, see [Resource groups](/azure/azure-resource-manager/resource-group-overview#resource-groups).</span></span>

5. <span data-ttu-id="e9932-235">Vytvořte nový **plán služby App Service** kliknutím *oddílu služby App Service*, **vytvořit nový**a vyplňte **plán služby App Service** (může mít stejný název jako App Service), **umístění**, a **cenová úroveň** (je bezplatnou možností).</span><span class="sxs-lookup"><span data-stu-id="e9932-235">Create a new **App Service Plan** by clicking the *App Service section*, **Create New**, and fill in **App Service plan** (can be same name as App Service), **Location**, and **Pricing tier** (there is a free option).</span></span>

6. <span data-ttu-id="e9932-236">Klikněte na tlačítko **SQL Database**a klikněte na tlačítko **vytvořit novou databázi** nebo vyberte existující databázi.</span><span class="sxs-lookup"><span data-stu-id="e9932-236">Click **SQL Database**, and then choose **Create a new database** or select an existing database.</span></span>

    ![](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/new-sql-database.png)

7. <span data-ttu-id="e9932-237">V **název** pole, zadejte název pro vaši databázi.</span><span class="sxs-lookup"><span data-stu-id="e9932-237">In the **Name** box, enter a name for your database.</span></span>
8. <span data-ttu-id="e9932-238">Klikněte na tlačítko **cílový Server** a potom vyberte **vytvořit nový server**.</span><span class="sxs-lookup"><span data-stu-id="e9932-238">Click the **Target Server** box, and then select **Create a new server**.</span></span> <span data-ttu-id="e9932-239">Dříve vytvořený server, je můžete vybrat tento server ze seznamu dostupných serverů.</span><span class="sxs-lookup"><span data-stu-id="e9932-239">Alternatively, if you previously created a server, you can select that server from list of available servers.</span></span>
9. <span data-ttu-id="e9932-240">Zvolte **cenová úroveň** zvolte *Free*.</span><span class="sxs-lookup"><span data-stu-id="e9932-240">Choose **Pricing tier** section, choose *Free*.</span></span> <span data-ttu-id="e9932-241">Pokud jsou potřeba další prostředky, je možné škálovat databáze v čase.</span><span class="sxs-lookup"><span data-stu-id="e9932-241">If additional resources are needed, the database can be scaled up at any time.</span></span> <span data-ttu-id="e9932-242">Další informace o cenách pro Azure SQL najdete v tématu [cenami služby Azure SQL Database](https://azure.microsoft.com/pricing/details/sql-database/managed/).</span><span class="sxs-lookup"><span data-stu-id="e9932-242">To learn more on Azure SQL Pricing, see [Azure SQL Database pricing](https://azure.microsoft.com/pricing/details/sql-database/managed/).</span></span>
10. <span data-ttu-id="e9932-243">Upravit [kolace](/sql/relational-databases/collations/collation-and-unicode-support) podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="e9932-243">Modify [collation](/sql/relational-databases/collations/collation-and-unicode-support) as needed.</span></span>
11. <span data-ttu-id="e9932-244">Zadejte správce **uživatelské jméno správce SQL** a **heslo správce SQL**.</span><span class="sxs-lookup"><span data-stu-id="e9932-244">Enter an administrator **SQL Admin Username** and **SQL Admin Password**.</span></span>

   - <span data-ttu-id="e9932-245">Pokud jste vybrali **nová databáze SQL serveru**, zadejte nový název a heslo, které budete potřebovat později při přístupu k databázi.</span><span class="sxs-lookup"><span data-stu-id="e9932-245">If you selected **New SQL Database server**, define a new name and password that you'll use later when you access the database.</span></span>
   - <span data-ttu-id="e9932-246">Pokud jste vybrali serveru, který jste vytvořili dříve, zadejte přihlašovací údaje pro tento server.</span><span class="sxs-lookup"><span data-stu-id="e9932-246">If you selected a server that you created previously, enter credentials for that server.</span></span>

12. <span data-ttu-id="e9932-247">Shromažďování telemetrie je možné povolit pro službu App Service pomocí služby Application Insights.</span><span class="sxs-lookup"><span data-stu-id="e9932-247">Telemetry collection can be enabled for App Service using Application Insights.</span></span> <span data-ttu-id="e9932-248">S málo konfigurace Application Insights shromažďuje cenné událost, výjimky, závislosti, žádosti a informace o trasování.</span><span class="sxs-lookup"><span data-stu-id="e9932-248">With little configuration, Application Insights collects valuable event, exception, dependency, request, and trace information.</span></span> <span data-ttu-id="e9932-249">Další informace o Application Insights najdete v tématu [Azure Monitor](https://azure.microsoft.com/services/monitor/).</span><span class="sxs-lookup"><span data-stu-id="e9932-249">To learn more about Application Insights, see [Azure Monitor](https://azure.microsoft.com/services/monitor/).</span></span>
13. <span data-ttu-id="e9932-250">Klikněte na tlačítko **vytvořit** v dolní části k označení, že budete hotovi.</span><span class="sxs-lookup"><span data-stu-id="e9932-250">Click **Create** at the bottom to indicate that you're finished.</span></span>

    <span data-ttu-id="e9932-251">Vrátí na portálu pro správu na stránce řídicího panelu a **oznámení** oblasti v horní části stránky se zobrazuje, že se vytváří web.</span><span class="sxs-lookup"><span data-stu-id="e9932-251">The Management Portal returns to the Dashboard page, and the **Notifications** area at the top of the page shows that the site is being created.</span></span> <span data-ttu-id="e9932-252">Po chvíli (obvykle během méně než minutu) je oznámení, že nasazení proběhlo úspěšně.</span><span class="sxs-lookup"><span data-stu-id="e9932-252">After a while (typically less than a minute), there's a notification that the Deployment succeeded.</span></span> <span data-ttu-id="e9932-253">V navigačním panelu na levé straně se zobrazí nová služba App Service v **App Services** oddílu a nová databáze SQL se zobrazí v **databází SQL** oddílu.</span><span class="sxs-lookup"><span data-stu-id="e9932-253">In the navigation bar at the left, the new App Service appears in the **App Services** section and the new SQL database appears in the **SQL databases** section.</span></span>

### <a name="deploy-the-app-to-azure"></a><span data-ttu-id="e9932-254">Nasazení aplikace do Azure</span><span class="sxs-lookup"><span data-stu-id="e9932-254">Deploy the app to Azure</span></span>

1. <span data-ttu-id="e9932-255">Ve Visual Studiu klikněte pravým tlačítkem na projekt v **Průzkumníka řešení** a vyberte **publikovat** v místní nabídce.</span><span class="sxs-lookup"><span data-stu-id="e9932-255">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>

    ![Publikování položky nabídky v Průzkumníku řešení](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image10.png)

2. <span data-ttu-id="e9932-257">Na **vyberte cíl publikování** zvolte **služby App Service** a potom **vybrat existující**a klikněte na tlačítko **publikovat**.</span><span class="sxs-lookup"><span data-stu-id="e9932-257">On the **Pick a publish target** page, choose **App Service** and then **Select Existing**, and then choose **Publish**.</span></span>

    ![Vyberte cílové stránky publikování](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/publish-select-existing-azure-app-service.png)

3. <span data-ttu-id="e9932-259">Pokud jste nepřidali dříve vašeho předplatného Azure v sadě Visual Studio, proveďte kroky na obrazovce.</span><span class="sxs-lookup"><span data-stu-id="e9932-259">If you haven't previously added your Azure subscription in Visual Studio, perform the steps on the screen.</span></span> <span data-ttu-id="e9932-260">Tyto kroky aktivují sady Visual Studio pro připojení k vašemu předplatnému Azure tak, která seznam **App Services** bude obsahovat vaše webová stránka.</span><span class="sxs-lookup"><span data-stu-id="e9932-260">These steps enable Visual Studio to connect to your Azure subscription so that the list of **App Services** will include your web site.</span></span>

4. <span data-ttu-id="e9932-261">Na **služby App Service** stránky, vyberte **předplatné** jste přidali do služby App Service.</span><span class="sxs-lookup"><span data-stu-id="e9932-261">On the **App Service** page, select the **Subscription** you added the App Service to.</span></span> <span data-ttu-id="e9932-262">V části **zobrazení**vyberte **skupiny prostředků**.</span><span class="sxs-lookup"><span data-stu-id="e9932-262">Under **View**, select **Resource Group**.</span></span> <span data-ttu-id="e9932-263">Rozbalte skupinu zdrojů, kterou jste přidali služby App a pak vyberte aplikace služby.</span><span class="sxs-lookup"><span data-stu-id="e9932-263">Expand the resource group you added the App Service to, and then select the App Service.</span></span> <span data-ttu-id="e9932-264">Zvolte **OK** Chcete-li publikovat aplikace.</span><span class="sxs-lookup"><span data-stu-id="e9932-264">Choose **OK** to publish the app.</span></span>

    ![Vyberte službu App Service](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/app-service-page.png)

5. <span data-ttu-id="e9932-266">**Výstup** okno zobrazuje, jaké akce nasazení byly provedeny a oznámí úspěšné dokončení nasazení.</span><span class="sxs-lookup"><span data-stu-id="e9932-266">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span>

    ![V okně Výstup hlášením úspěšného nasazení](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/publish-output.png)

6. <span data-ttu-id="e9932-268">Po úspěšném nasazení na adresu URL nasazené webové stránky automaticky otevře výchozí prohlížeč.</span><span class="sxs-lookup"><span data-stu-id="e9932-268">Upon successful deployment, the default browser automatically opens to the URL of the deployed web site.</span></span>

    ![Students_index_page_with_paging](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/cloud-app-browser.png)

    <span data-ttu-id="e9932-270">Vaše aplikace je nyní spuštěna v cloudu.</span><span class="sxs-lookup"><span data-stu-id="e9932-270">Your app is now running in the cloud.</span></span>

<span data-ttu-id="e9932-271">V tomto okamžiku *SchoolContext* databáze byla vytvořena v databázi Azure SQL, protože jste vybrali **provést první přenesení kódu (spuštění na spuštění aplikace)**.</span><span class="sxs-lookup"><span data-stu-id="e9932-271">At this point, the *SchoolContext* database has been created in the Azure SQL database because you selected **Execute Code First Migrations (runs on app start)**.</span></span> <span data-ttu-id="e9932-272">*Web.config* soubor v nasazený web byl změněn tak, aby [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) inicializátor prvním spuštění kódu čtení nebo zápis dat v databázi (která se stalo Pokud jste vybrali **studenty** kartu):</span><span class="sxs-lookup"><span data-stu-id="e9932-272">The *Web.config* file in the deployed web site has been changed so that the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer runs the first time your code reads or writes data in the database (which happened when you selected the **Students** tab):</span></span>

![Výňatek souboru Web.config](https://asp.net/media/4367421/mig.png)

<span data-ttu-id="e9932-274">Proces nasazení vytvoří taky nový připojovací řetězec *(SchoolContext\_DatabasePublish*) pro migrace Code First pro aktualizaci schématu databáze a synchronizace replik indexů databáze.</span><span class="sxs-lookup"><span data-stu-id="e9932-274">The deployment process also created a new connection string *(SchoolContext\_DatabasePublish*) for Code First Migrations to use for updating the database schema and seeding the database.</span></span>

![Připojovací řetězec v souboru Web.config](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image26.png)

<span data-ttu-id="e9932-276">Můžete najít nasazenou verzi souboru Web.config na vašem počítači v *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. Můžete přistupovat nasazeném *Web.config* vlastní soubor pomocí protokolu FTP.</span><span class="sxs-lookup"><span data-stu-id="e9932-276">You can find the deployed version of the Web.config file on your own computer in *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. You can access the deployed *Web.config* file itself by using FTP.</span></span> <span data-ttu-id="e9932-277">Pokyny najdete v tématu [nasazení webu ASP.NET pomocí sady Visual Studio: nasazení aktualizace kódu](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update).</span><span class="sxs-lookup"><span data-stu-id="e9932-277">For instructions, see [ASP.NET Web Deployment using Visual Studio: Deploying a Code Update](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update).</span></span> <span data-ttu-id="e9932-278">Postupujte podle pokynů, které začínají znakem "Pokud chcete použít nástroj FTP, potřebujete tři věci: adresa URL protokolu FTP, uživatelské jméno a heslo."</span><span class="sxs-lookup"><span data-stu-id="e9932-278">Follow the instructions that start with "To use an FTP tool, you need three things: the FTP URL, the user name, and the password."</span></span>

> [!NOTE]
> <span data-ttu-id="e9932-279">Webové aplikace neimplementuje zabezpečení, takže každý, kdo najde adresu URL mohou změnit data.</span><span class="sxs-lookup"><span data-stu-id="e9932-279">The web app doesn't implement security, so anyone who finds the URL can change the data.</span></span> <span data-ttu-id="e9932-280">Pokyny k zabezpečení webového serveru naleznete v tématu [zabezpečení technologie ASP.NET MVC aplikace s databází členství, OAuth a SQL Azure nasadit](/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="e9932-280">For instructions on how to secure the web site, see [Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL database to Azure](/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="e9932-281">Můžete zabránit ostatním uživatelům webu pomocí zastavení služby pomocí portálu pro správu Azure nebo **Server Explorer** v sadě Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e9932-281">You can prevent other people from using the site by stopping the service using the Azure Management Portal or **Server Explorer** in Visual Studio.</span></span>

![Položka nabídky služeb app ukončit](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/server-explorer-stop-app-service.png)

## <a name="advanced-migrations-scenarios"></a><span data-ttu-id="e9932-283">Scénáře migrace pro pokročilé</span><span class="sxs-lookup"><span data-stu-id="e9932-283">Advanced migrations scenarios</span></span>

<span data-ttu-id="e9932-284">Pokud se nasazení databáze spuštěním migrace automaticky, jak je znázorněno v tomto kurzu a provádíte nasazení na web, který běží na několika serverech, získáte víc serverů, které chcete spustit migrace ve stejnou dobu.</span><span class="sxs-lookup"><span data-stu-id="e9932-284">If you deploy a database by running migrations automatically as shown in this tutorial, and you are deploying to a web site that runs on multiple servers, you could get multiple servers trying to run migrations at the same time.</span></span> <span data-ttu-id="e9932-285">Migrace jsou atomické, takže pokud dva servery, zkuste spustit stejný migrace, jeden proběhne úspěšně a druhé se nepodaří (za předpokladu, že operace nelze provádět dvakrát).</span><span class="sxs-lookup"><span data-stu-id="e9932-285">Migrations are atomic, so if two servers try to run the same migration, one will succeed and the other will fail (assuming the operations can't be done twice).</span></span> <span data-ttu-id="e9932-286">V tomto scénáři Pokud chcete se vyhnout těmto problémům, můžete volat migrace ručně a nastavit váš vlastní kód tak, aby ho situace nastane pouze jednou.</span><span class="sxs-lookup"><span data-stu-id="e9932-286">In that scenario if you want to avoid those issues, you can call migrations manually and set up your own code so that it only happens once.</span></span> <span data-ttu-id="e9932-287">Další informace naleznete v tématu [systémem a skriptování při přenesení kódu](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) na blogu Rowan Miller a [Migrate.exe](/ef/ef6/modeling/code-first/migrations/migrate-exe) (pro provádění migrace z příkazového řádku).</span><span class="sxs-lookup"><span data-stu-id="e9932-287">For more information, see [Running and Scripting Migrations from Code](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) on Rowan Miller's blog and [Migrate.exe](/ef/ef6/modeling/code-first/migrations/migrate-exe) (for executing migrations from the command line).</span></span>

<span data-ttu-id="e9932-288">Informace o dalších scénářů migrace najdete v tématu [migrace záznam dění na monitoru řady](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx).</span><span class="sxs-lookup"><span data-stu-id="e9932-288">For information about other migrations scenarios, see [Migrations Screencast Series](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx).</span></span>

## <a name="code-first-initializers"></a><span data-ttu-id="e9932-289">Kód první inicializátory</span><span class="sxs-lookup"><span data-stu-id="e9932-289">Code First initializers</span></span>

<span data-ttu-id="e9932-290">V části nasazení viděli [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) používán inicializátoru.</span><span class="sxs-lookup"><span data-stu-id="e9932-290">In the deployment section, you saw the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer being used.</span></span> <span data-ttu-id="e9932-291">Kód nejprve také poskytuje jiné inicializátory, včetně [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (výchozí), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (který jste použili dříve) a [ DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span><span class="sxs-lookup"><span data-stu-id="e9932-291">Code First also provides other initializers, including [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (the default), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (which you used earlier) and [DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span></span> <span data-ttu-id="e9932-292">`DropCreateAlways` Inicializátor může být užitečné pro nastavení podmínky pro testování částí.</span><span class="sxs-lookup"><span data-stu-id="e9932-292">The `DropCreateAlways` initializer can be useful for setting up conditions for unit tests.</span></span> <span data-ttu-id="e9932-293">Můžete je zapsat také vlastních inicializátory a může volat inicializátor explicitně Pokud nechcete čekat, dokud se čte z aplikace nebo zapisuje do databáze.</span><span class="sxs-lookup"><span data-stu-id="e9932-293">You can also write your own initializers, and you can call an initializer explicitly if you don't want to wait until the application reads from or writes to the database.</span></span>

<span data-ttu-id="e9932-294">Další informace o inicializátory, naleznete v tématu [Principy inicializátory databáze v Entity Framework Code First](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) a kapitola 6 knihu [programování rozhraní Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) podle Julie Lerman a Rowan Miller.</span><span class="sxs-lookup"><span data-stu-id="e9932-294">For more information about initializers, see [Understanding Database Initializers in Entity Framework Code First](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) and chapter 6 of the book [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) by Julie Lerman and Rowan Miller.</span></span>

## <a name="summary"></a><span data-ttu-id="e9932-295">Souhrn</span><span class="sxs-lookup"><span data-stu-id="e9932-295">Summary</span></span>

<span data-ttu-id="e9932-296">V tomto kurzu jste zjistili, jak povolit migrace a nasazení aplikace.</span><span class="sxs-lookup"><span data-stu-id="e9932-296">In this tutorial, you learned how to enable migrations and deploy the application.</span></span> <span data-ttu-id="e9932-297">V dalším kurzu se zobrazí za přibližně pohledu na pokročilejší témata tak, že rozbalíte datového modelu.</span><span class="sxs-lookup"><span data-stu-id="e9932-297">In the next tutorial, you'll begin looking at more advanced topics by expanding the data model.</span></span>

<span data-ttu-id="e9932-298">Jak vám v tomto kurzu líbilo a co můžeme zlepšit nám prosím zpětnou vazbu.</span><span class="sxs-lookup"><span data-stu-id="e9932-298">Please leave feedback on how you liked this tutorial and what we could improve.</span></span>

<span data-ttu-id="e9932-299">Odkazy na další zdroje Entity Framework lze nalézt v [přístup k datům ASP.NET – doporučené zdroje informací](xref:whitepapers/aspnet-data-access-content-map).</span><span class="sxs-lookup"><span data-stu-id="e9932-299">Links to other Entity Framework resources can be found in [ASP.NET Data Access - Recommended Resources](xref:whitepapers/aspnet-data-access-content-map).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e9932-300">[Předchozí](xref:mvc/overview/getting-started/getting-started-with-ef-using-mvc/connection-resiliency-and-command-interception-with-the-entity-framework-in-an-asp-net-mvc-application)
> [další](xref:mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-a-more-complex-data-model-for-an-asp-net-mvc-application)</span><span class="sxs-lookup"><span data-stu-id="e9932-300">[Previous](xref:mvc/overview/getting-started/getting-started-with-ef-using-mvc/connection-resiliency-and-command-interception-with-the-entity-framework-in-an-asp-net-mvc-application)
[Next](xref:mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-a-more-complex-data-model-for-an-asp-net-mvc-application)</span></span>
