---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: Vytvoření modelu s obchodní pravidlo ověření | Microsoft Docs
author: microsoft
description: Krok 3 ukazuje, jak vytvořit model, že jsme pomocí obou dotazu a aktualizaci databáze pro naši aplikaci NerdDinner.
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/27/2010
ms.topic: article
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: c5a482474fd2f41836f70952306ada5cd9136455
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/06/2018
ms.locfileid: "30874938"
---
<a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="9472d-103">Vytvoření modelu s obchodní pravidlo ověření</span><span class="sxs-lookup"><span data-stu-id="9472d-103">Build a Model with Business Rule Validations</span></span>
====================
<span data-ttu-id="9472d-104">podle [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="9472d-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="9472d-105">Stáhnout PDF</span><span class="sxs-lookup"><span data-stu-id="9472d-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="9472d-106">Toto je krok 3 bezplatný [kurz aplikace "NerdDinner"](introducing-the-nerddinner-tutorial.md) , nevystavíte slabé stránky zabezpečení – prostřednictvím postup sestavení malá, ale dokončení, webové aplikace pomocí ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="9472d-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="9472d-107">Krok 3 ukazuje, jak vytvořit model, že jsme pomocí obou dotazu a aktualizaci databáze pro naši aplikaci NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="9472d-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="9472d-108">Pokud používáte ASP.NET MVC 3, doporučujeme provedením [získávání spuštěna s MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) nebo [MVC Hudba úložiště](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) kurzy.</span><span class="sxs-lookup"><span data-stu-id="9472d-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="9472d-109">NerdDinner krok 3: Vytvoření modelu</span><span class="sxs-lookup"><span data-stu-id="9472d-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="9472d-110">Ve model-view-controller framework termín "model" odkazuje na objekty, které představují data, aplikace a také odpovídající logiku domény, který se integruje s jeho ověření a obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="9472d-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="9472d-111">Model je v mnoha směrech "vysílat" aplikace založené na MVC a jako ukážeme později zásadně jednotky chování ho.</span><span class="sxs-lookup"><span data-stu-id="9472d-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="9472d-112">Rozhraní ASP.NET MVC podporuje používání technologií pro přístup k žádné dat a mohou zvolit z mnoha různých bohaté možnosti dat .NET pro implementaci jejich modely, včetně: technologie LINQ to Entities, technologie LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM nebo právě nezpracovaná ADO. NET DataReaders nebo datové sady.</span><span class="sxs-lookup"><span data-stu-id="9472d-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="9472d-113">Pro naši aplikaci NerdDinner jsme se chystáte použít technologie LINQ to SQL k vytvoření jednoduchého modelu, který odpovídá poměrně úzce naše návrhu databáze a přidá některé vlastní ověřovací logiku a obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="9472d-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="9472d-114">Třídy úložiště, která pomáhá rychle abstraktní bude potom implementaci implementace trvalosti dat od ostatních aplikací a umožňuje nám snadno jednotky otestovat.</span><span class="sxs-lookup"><span data-stu-id="9472d-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="9472d-115">Technologie LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="9472d-115">LINQ to SQL</span></span>

<span data-ttu-id="9472d-116">Technologie LINQ to SQL je ORM (objekt relační mapper), který se dodává jako součást rozhraní .NET 3.5.</span><span class="sxs-lookup"><span data-stu-id="9472d-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="9472d-117">Technologie LINQ to SQL poskytuje snadný způsob, jak mapovat na třídy rozhraní .NET, které jsme můžete kód proti databázových tabulek.</span><span class="sxs-lookup"><span data-stu-id="9472d-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="9472d-118">Pro naši aplikaci NerdDinner použijeme ji k mapování tabulek večeří a zasílání zpráv rysy v rámci naší databáze na večeři a zasílání zpráv rysy třídy.</span><span class="sxs-lookup"><span data-stu-id="9472d-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="9472d-119">Sloupce tabulky večeří a zasílání zpráv rysy bude odpovídat vlastnosti třídy večeři a zasílání zpráv rysy.</span><span class="sxs-lookup"><span data-stu-id="9472d-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="9472d-120">Každý objekt večeři a zasílání zpráv rysy bude reprezentovat samostatný řádek v rámci večeří nebo zasílání zpráv rysy tabulky v databázi.</span><span class="sxs-lookup"><span data-stu-id="9472d-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="9472d-121">Technologie LINQ to SQL umožňuje vyhnout se nutnosti ručně vytvořit příkazy SQL se načítají a aktualizují večeři a zasílání zpráv rysy objekty s daty databáze.</span><span class="sxs-lookup"><span data-stu-id="9472d-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="9472d-122">Místo toho budeme definovat třídy večeři a zasílání zpráv rysy, jak jsou mapovány do/z databáze a vztahy mezi nimi.</span><span class="sxs-lookup"><span data-stu-id="9472d-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="9472d-123">Technologie LINQ to SQL se pak dojde stará se o generování odpovídající logiky provádění SQL pro použití v době běhu, když jsme komunikovat a jejich použití.</span><span class="sxs-lookup"><span data-stu-id="9472d-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="9472d-124">Podpora jazyka LINQ v jazyce Visual Basic a C# jsme můžete použít k zápisu výrazovou dotazy, které načíst večeři a zasílání zpráv rysy objekty z databáze.</span><span class="sxs-lookup"><span data-stu-id="9472d-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="9472d-125">To minimalizuje množství dat kód potřebujeme k zápisu, a umožňuje vytvářet skutečně vyčištění aplikace.</span><span class="sxs-lookup"><span data-stu-id="9472d-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="9472d-126">Přidání třídy LINQ to SQL pro naše projektu</span><span class="sxs-lookup"><span data-stu-id="9472d-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="9472d-127">Jsme budete začněte tím, že kliknete pravým tlačítkem na složku "Modely" v rámci naší projekt a vyberte **Add -&gt;nová položka** příkazu v nabídce:</span><span class="sxs-lookup"><span data-stu-id="9472d-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="9472d-128">Otevře se dialog "Přidat novou položku".</span><span class="sxs-lookup"><span data-stu-id="9472d-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="9472d-129">Jsme budete filtrovat podle kategorie "Data" a vyberte šablonu "LINQ pro třídy SQL" v něm:</span><span class="sxs-lookup"><span data-stu-id="9472d-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="9472d-130">Jsme budete název položky "NerdDinner" a klikněte na tlačítko "Přidat".</span><span class="sxs-lookup"><span data-stu-id="9472d-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="9472d-131">Visual Studio se přidá soubor NerdDinner.dbml naše \Models adresáře a pak otevřete LINQ to SQL Návrhář relací objektů:</span><span class="sxs-lookup"><span data-stu-id="9472d-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="9472d-132">Vytváření tříd modelu dat s LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="9472d-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="9472d-133">Technologie LINQ to SQL umožňuje rychle vytvořit třídy modelu dat z existujícího schématu databáze.</span><span class="sxs-lookup"><span data-stu-id="9472d-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="9472d-134">Úkolů to jsme budete NerdDinner databázi otevřít v Průzkumníku serveru a vyberte tabulky, chceme modelu v něm:</span><span class="sxs-lookup"><span data-stu-id="9472d-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="9472d-135">Jsme můžete přetahovat tabulky do LINQ na plochu návrháře SQL.</span><span class="sxs-lookup"><span data-stu-id="9472d-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="9472d-136">Při provádění této LINQ to SQL se automaticky vytvoří večeři a zasílání zpráv rysy třídy pomocí schématu tabulek (pomocí vlastnosti třídy, které jsou mapovány na sloupce tabulky databáze):</span><span class="sxs-lookup"><span data-stu-id="9472d-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="9472d-137">Ve výchozím nastavení technologie LINQ to SQL návrhář automaticky "převádí do množného čísla" názvy tabulek a sloupců při vytváření třídy, na základě schématu databáze.</span><span class="sxs-lookup"><span data-stu-id="9472d-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="9472d-138">Například: "Večeří" tabulky v našem příkladu výše výsledkem třídu "Večeři".</span><span class="sxs-lookup"><span data-stu-id="9472d-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="9472d-139">Tato třída pojmenování pomáhá, aby naše modely v souladu s zásady vytváření názvů v rozhraní .NET a obvykle najít této s návrháře opravu to si vhodné (zejména při přidávání spoustu tabulky).</span><span class="sxs-lookup"><span data-stu-id="9472d-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="9472d-140">Pokud chcete název třídy nebo vlastnost, která generuje návrháře, i když můžete vždy přepsat a změňte jej na libovolný název, který má být.</span><span class="sxs-lookup"><span data-stu-id="9472d-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="9472d-141">To provedete tak, že upravíte entity nebo vlastnost název v řádku v Návrháři nebo změnou prostřednictvím mřížku vlastností.</span><span class="sxs-lookup"><span data-stu-id="9472d-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="9472d-142">Ve výchozím nastavení technologie LINQ to SQL Návrhář také zkontroluje, zda obsahuje primární klíč, cizí klíče relace tabulek a na jejich základě automaticky vytvoří výchozí "vztah přidružení" mezi třídami jiného modelu, který vytváří.</span><span class="sxs-lookup"><span data-stu-id="9472d-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="9472d-143">Například když jsme přetáhnout večeří a zasílání zpráv rysy tabulky do LINQ to SQL Návrháře vztah jeden mnoho přidružení mezi nimi byl vyvozen na základě skutečnosti, že v tabulce zasílání zpráv rysy měl cizího klíče do tabulky večeří (to je indikován na šipku v Návrhář):</span><span class="sxs-lookup"><span data-stu-id="9472d-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="9472d-144">Výše uvedené přidružení způsobí, že LINQ to SQL pro zasílání zpráv rysy třídu, která vývojářům můžete použít pro přístup k večeři spojené s danou zasílání zpráv rysy přidání silného typu vlastnosti "Večeři".</span><span class="sxs-lookup"><span data-stu-id="9472d-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="9472d-145">Může to způsobit také třídy pro večeři "RSVPs" vlastnosti kolekce, která umožňuje vývojářům načíst a aktualizovat zasílání zpráv rysy objekty přidružené k určité večeři.</span><span class="sxs-lookup"><span data-stu-id="9472d-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="9472d-146">Když jsme vytvořit nový objekt zasílání zpráv rysy a přidat jej do kolekce večeři RSVPs, níže můžete zobrazit příklad technologie intellisense v sadě Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="9472d-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="9472d-147">Všimněte si, jak technologie LINQ to SQL automaticky přidá kolekci "RSVPs" na objektu večeři:</span><span class="sxs-lookup"><span data-stu-id="9472d-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="9472d-148">Přidáním objekt zasílání zpráv rysy do kolekce večeři RSVPs jsme informace o tom, LINQ to SQL pro přidružení cizího klíče vztah mezi večeře a zasílání zpráv rysy řádek v naší databázi:</span><span class="sxs-lookup"><span data-stu-id="9472d-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="9472d-149">Pokud chcete způsob, jakým má návrháře modelován nebo s názvem přidružení tabulky, můžete ho přepsat.</span><span class="sxs-lookup"><span data-stu-id="9472d-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="9472d-150">Právě klikněte na šipku přidružení v návrháři a otevřete jeho vlastnosti prostřednictvím mřížku vlastností přejmenovat, odstranit nebo upravit.</span><span class="sxs-lookup"><span data-stu-id="9472d-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="9472d-151">Pro naši aplikaci NerdDinner ale pravidla přidružení výchozí fungují dobře u datových tříd modelu, které jsme vytváření a můžeme jednoduše použít výchozí chování.</span><span class="sxs-lookup"><span data-stu-id="9472d-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="9472d-152">NerdDinnerDataContext Class</span><span class="sxs-lookup"><span data-stu-id="9472d-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="9472d-153">Třídy rozhraní .NET, které představují modely a databáze vztahy definované pomocí LINQ to SQL návrhář automaticky vytvoří sada Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="9472d-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="9472d-154">LINQ to SQL DataContext třídy se také generuje pro každou technologii LINQ to SQL Návrháře soubory přidané do řešení.</span><span class="sxs-lookup"><span data-stu-id="9472d-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="9472d-155">Protože jsme pojmenovali naše technologie LINQ to SQL třída položku "NerdDinner", bude mít název "NerdDinnerDataContext" třídě DataContext vytvořena.</span><span class="sxs-lookup"><span data-stu-id="9472d-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="9472d-156">Tato třída NerdDinnerDataContext je primární způsob, jakým jsme bude komunikovat s databází.</span><span class="sxs-lookup"><span data-stu-id="9472d-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="9472d-157">Naše třída NerdDinnerDataContext zpřístupňuje dvě vlastnosti - "Večeří" a "RSVPs" - představující dvě tabulky, které jsme modelován v databázi.</span><span class="sxs-lookup"><span data-stu-id="9472d-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="9472d-158">Jsme vám pomůže C# zápis dotazů LINQ s tyto vlastnosti objekty večeři a zasílání zpráv rysy dotazu a načíst z databáze.</span><span class="sxs-lookup"><span data-stu-id="9472d-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="9472d-159">Následující kód ukazuje, jak vytvořit instanci objektu NerdDinnerDataContext a provést dotaz LINQ proti ho k získání posloupnost večeří, ke kterým došlo v budoucnu.</span><span class="sxs-lookup"><span data-stu-id="9472d-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="9472d-160">Visual Studio poskytuje úplné intellisense při zápisu dotaz LINQ, a objektů vrácených z něj jsou silného typu a také podporu technologie intellisense:</span><span class="sxs-lookup"><span data-stu-id="9472d-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="9472d-161">Kromě toho, že nám se dotázat na objekty večeři a zasílání zpráv rysy, NerdDinnerDataContext také automaticky zjišťuje všechny změny, které následně provedeme večeři a zasílání zpráv rysy objekty, které jsme načíst jeho prostřednictvím.</span><span class="sxs-lookup"><span data-stu-id="9472d-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="9472d-162">Tato funkce jsme vám pomůže snadno uložte změny zpět do databáze – bez nutnosti psaní jakéhokoli explicitní aktualizace kódu SQL.</span><span class="sxs-lookup"><span data-stu-id="9472d-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="9472d-163">Například následující kód ukazuje, jak použít dotaz LINQ načíst jediný objekt večeři z databáze, aktualizovat dvě vlastnosti večeři a potom uložte změny zpět do databáze:</span><span class="sxs-lookup"><span data-stu-id="9472d-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="9472d-164">Objekt NerdDinnerDataContext v kódu výše automaticky sledovat vlastnost změny provedené v večeři objekt, který jsme načítají.</span><span class="sxs-lookup"><span data-stu-id="9472d-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="9472d-165">Když jsme volat metodu "SubmitChanges()", provede odpovídající "Aktualizovat" příkazu SQL k databázi a zachovat aktualizovanými hodnotami.</span><span class="sxs-lookup"><span data-stu-id="9472d-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="9472d-166">Vytvoření třídy DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="9472d-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="9472d-167">Pro malé aplikace je někdy jemné do mají řadiče pracovat přímo v technologii LINQ to SQL DataContext třídy a vložit dotazů LINQ v rámci do řadičů.</span><span class="sxs-lookup"><span data-stu-id="9472d-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="9472d-168">Jak získat větší aplikace, ale tento přístup stane nevhodnou pro údržbu a testování.</span><span class="sxs-lookup"><span data-stu-id="9472d-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="9472d-169">Také může vést k nám duplikování stejné dotazů LINQ na více místech.</span><span class="sxs-lookup"><span data-stu-id="9472d-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="9472d-170">Jeden z přístupů, můžete usnadnit aplikace udržovat a testování je použití vzoru "úložiště".</span><span class="sxs-lookup"><span data-stu-id="9472d-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="9472d-171">Třídy úložiště pomáhá zapouzdření dat dotazování a logiku trvalosti a rychle přehledů podrobnosti implementace trvalosti dat z aplikace.</span><span class="sxs-lookup"><span data-stu-id="9472d-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="9472d-172">Kromě vytváření čisticí kód aplikace, pomocí vzoru úložiště můžete usnadňují implementace úložiště dat v budoucnu změnit a lze zefektivnit testování aplikace bez nutnosti skutečné databáze částí.</span><span class="sxs-lookup"><span data-stu-id="9472d-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="9472d-173">Pro naši aplikaci NerdDinner budeme definovat třídu DinnerRepository s pod podpis:</span><span class="sxs-lookup"><span data-stu-id="9472d-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="9472d-174">*Poznámka: Dále v této kapitole jsme budete extrahovat rozhraní IDinnerRepository z této třídy a povolte vkládání závislostí s ním na našem řadiče. Na začátku ale přidáme spuštění jednoduché a právě pracovat přímo s třídou DinnerRepository.*</span><span class="sxs-lookup"><span data-stu-id="9472d-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="9472d-175">K implementaci této třídy jsme budete klikněte pravým tlačítkem na složku naše "Modely" a zvolte **Add -&gt;nová položka** příkazu nabídky.</span><span class="sxs-lookup"><span data-stu-id="9472d-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="9472d-176">V dialogovém okně "Přidat novou položku" jsme budete vyberte šablonu "Třída" a "DinnerRepository.cs" název souboru:</span><span class="sxs-lookup"><span data-stu-id="9472d-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="9472d-177">Pak můžeme implementovat naše DinnerRespository třídy pomocí následující kód:</span><span class="sxs-lookup"><span data-stu-id="9472d-177">We can then implement our DinnerRespository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="9472d-178">Načítání, aktualizaci, vkládání a odstraňování pomocí DinnerRepository – třída</span><span class="sxs-lookup"><span data-stu-id="9472d-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="9472d-179">Teď, vytvořili jsme Naše třída DinnerRepository, podíváme se na několik příkladů kódu, které ukazují běžné úkoly, které jsme s ním může dělat:</span><span class="sxs-lookup"><span data-stu-id="9472d-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="9472d-180">Dotazování příklady</span><span class="sxs-lookup"><span data-stu-id="9472d-180">Querying Examples</span></span>

<span data-ttu-id="9472d-181">Následující kód načte jeden večeři pomocí DinnerID hodnoty:</span><span class="sxs-lookup"><span data-stu-id="9472d-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>


[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="9472d-182">Následující kód načte všechny nadcházející večeří a smyčky přes ně:</span><span class="sxs-lookup"><span data-stu-id="9472d-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="9472d-183">Vložení a aktualizace příklady</span><span class="sxs-lookup"><span data-stu-id="9472d-183">Insert and Update Examples</span></span>

<span data-ttu-id="9472d-184">Následující kód ukazuje, přidávání dvě nové večeří.</span><span class="sxs-lookup"><span data-stu-id="9472d-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="9472d-185">Dodatky nebo změny do úložiště nejsou potvrzené do databáze, dokud v něm je volána metoda "Save()".</span><span class="sxs-lookup"><span data-stu-id="9472d-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="9472d-186">Technologie LINQ to SQL automaticky sbalí všechny změny v databázové transakci – tak, aby všechny změny dojít nebo žádná z nich dělat, když se uloží naše úložiště:</span><span class="sxs-lookup"><span data-stu-id="9472d-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="9472d-187">Následující kód načte existujícího objektu večeři a upraví dvě vlastnosti na něm.</span><span class="sxs-lookup"><span data-stu-id="9472d-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="9472d-188">Změny se potvrdí zpět do databáze při volání metody "Save()" v našem úložišti:</span><span class="sxs-lookup"><span data-stu-id="9472d-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="9472d-189">Následující kód načte večeři a pak do ní přidá odpověď.</span><span class="sxs-lookup"><span data-stu-id="9472d-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="9472d-190">Dělá to pomocí kolekce RSVPs objektu večeři technologie LINQ to SQL pro nám vytvořit, (protože mezi těmito dvěma v databázi existuje vztah primární klíč/cizí klíč).</span><span class="sxs-lookup"><span data-stu-id="9472d-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="9472d-191">Tato změna je trvalá zpět do databáze jako nový řádek tabulky zasílání zpráv rysy při volání metody "Save()" v úložišti:</span><span class="sxs-lookup"><span data-stu-id="9472d-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="9472d-192">Odstranit příklad</span><span class="sxs-lookup"><span data-stu-id="9472d-192">Delete Example</span></span>

<span data-ttu-id="9472d-193">Následující kód načte existujícího objektu večeři a pak označí pro odstranění.</span><span class="sxs-lookup"><span data-stu-id="9472d-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="9472d-194">Při volání metody "Save()" na úložiště se bude potvrďte odstranění zpět do databáze:</span><span class="sxs-lookup"><span data-stu-id="9472d-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="9472d-195">Ověřování a obchodní logice pravidla integrování třídy modelu</span><span class="sxs-lookup"><span data-stu-id="9472d-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="9472d-196">Integrace ověření a obchodní pravidlo, že logika je klíčovou součástí jakékoli aplikace, která pracuje s daty.</span><span class="sxs-lookup"><span data-stu-id="9472d-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="9472d-197">Ověření schématu</span><span class="sxs-lookup"><span data-stu-id="9472d-197">Schema Validation</span></span>

<span data-ttu-id="9472d-198">Když třídy modelu jsou definovány pomocí LINQ to SQL designer, datové typy vlastností v třídy modelu dat odpovídat datové typy databázové tabulky.</span><span class="sxs-lookup"><span data-stu-id="9472d-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="9472d-199">Například: Pokud je sloupec "EventDate" v tabulce večeří "datetime", třída modelu dat vytvořených technologie LINQ to SQL bude typu "Datum a čas" (což je předdefinovaný datový typ rozhraní .NET).</span><span class="sxs-lookup"><span data-stu-id="9472d-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="9472d-200">To znamená, že pokud se pokusíte přiřadit celé číslo nebo logickou hodnotu k němu z kódu a bude vyvolat chybu automaticky pokusíte implicitně převést typu není platný řetězec na jeho za běhu bude docházet k chybám kompilace.</span><span class="sxs-lookup"><span data-stu-id="9472d-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="9472d-201">Technologie LINQ to SQL se také automaticky zpracovává útěku hodnot SQL pro vás při použití řetězce – které pomáhá chránit před útoky vkládání SQL při používání.</span><span class="sxs-lookup"><span data-stu-id="9472d-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="9472d-202">Ověřování a obchodní logika pravidla</span><span class="sxs-lookup"><span data-stu-id="9472d-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="9472d-203">Ověření schématu je užitečné jako první krok, ale stačí jen zřídka.</span><span class="sxs-lookup"><span data-stu-id="9472d-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="9472d-204">Většina scénářů reálného vyžaduje možnost určit bohatší logiku ověření, můžete span více vlastností, spouštění kódu a často mají sledování stavu modelu (například: ho Probíhá vytváření/aktualizovat/odstraněný, nebo v rámci stavu specifické pro doménu jako "archivovaný").</span><span class="sxs-lookup"><span data-stu-id="9472d-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="9472d-205">Existuje mnoho různých různé vzorce a rozhraní, které lze použít k definování a použít pravidla ověřování na třídy modelu a existuje několik .NET na základě architektury odhlašování došlo použitého usnadní to.</span><span class="sxs-lookup"><span data-stu-id="9472d-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="9472d-206">Můžete použít prakticky některý z nich v rámci aplikace ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="9472d-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="9472d-207">Pro účely aplikace NerdDinner použijeme relativně jednoduché a jednoduché vzor kde zveřejňujeme IsValid – vlastnosti a metody GetRuleViolations() na našich večeři objekt modelu.</span><span class="sxs-lookup"><span data-stu-id="9472d-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="9472d-208">IsValid – vlastnost vrátí hodnotu PRAVDA nebo NEPRAVDA v závislosti na tom, jestli jsou všechny platné pravidel ověřování a business.</span><span class="sxs-lookup"><span data-stu-id="9472d-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="9472d-209">Metoda GetRuleViolations() vrátí seznam všech chyb pravidlo.</span><span class="sxs-lookup"><span data-stu-id="9472d-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="9472d-210">Jsme budete implementovat IsValid a GetRuleViolations() pro náš model večeři přidáním "konkrétní třídu" do našich projektu.</span><span class="sxs-lookup"><span data-stu-id="9472d-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="9472d-211">Částečné třídy lze použít k přidání metody nebo vlastnosti nebo události na třídy spravuje pomocí návrháře VS (podobně jako třída večeři generované LINQ to SQL designer) a vyhnout nástroj z messing naše kódem.</span><span class="sxs-lookup"><span data-stu-id="9472d-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="9472d-212">Jsme můžete přidat nové částečné třídy do našich projektu kliknutím pravým tlačítkem na složku \Models a potom vyberte příkaz nabídky "Přidat novou položku".</span><span class="sxs-lookup"><span data-stu-id="9472d-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="9472d-213">Pak můžeme zvolte šablonu "Třída" v dialogovém okně "Přidat novou položku" a pojmenujte ji Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="9472d-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="9472d-214">Klepnutím na tlačítko "Přidat" Přidat soubor Dinner.cs naše projektu a otevřete jej v prostředí IDE.</span><span class="sxs-lookup"><span data-stu-id="9472d-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="9472d-215">Potom jsme můžete implementovat s použitím framework základní pravidlo a ověření vynucení níže uvedeného kódu:</span><span class="sxs-lookup"><span data-stu-id="9472d-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="9472d-216">Několik poznámky o ve výše uvedeném kódu:</span><span class="sxs-lookup"><span data-stu-id="9472d-216">A few notes about the above code:</span></span>

- <span data-ttu-id="9472d-217">Třída večeři začíná "částečné" klíčové slovo – to znamená, kód jsou v něm obsažena bude technologií LINQ to SQL Návrháře v kombinaci s třídě vygeneruje udržovat a zkompilovat do jedné třídy.</span><span class="sxs-lookup"><span data-stu-id="9472d-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="9472d-218">Třída RuleViolation je pomocná třída, kterou přidáme do projektu, který umožňuje nám poskytnout další podrobnosti o porušení pravidel.</span><span class="sxs-lookup"><span data-stu-id="9472d-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="9472d-219">Metoda Dinner.GetRuleViolations() způsobí, že naše ověření a obchodní pravidla, která vyhodnotí (jsme budete implementovat krátce).</span><span class="sxs-lookup"><span data-stu-id="9472d-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="9472d-220">Poté vrátí zpět posloupnost RuleViolation objekty, které poskytují další podrobnosti o chybách, pravidlo.</span><span class="sxs-lookup"><span data-stu-id="9472d-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="9472d-221">Vlastnost Dinner.IsValid poskytuje užitečné pomocné vlastnost, která označuje, zda má objekt večeři žádné aktivní RuleViolations.</span><span class="sxs-lookup"><span data-stu-id="9472d-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="9472d-222">Ho lze proaktivně zkontrolovat vývojáři pomocí objektu večeři v kdykoli (a nevyvolá výjimku).</span><span class="sxs-lookup"><span data-stu-id="9472d-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="9472d-223">Částečné metody Dinner.OnValidate() je háku poskytující technologie LINQ to SQL, které umožňuje upozorněni kdykoliv objekt večeři je nastavit jako trvalý, v databázi.</span><span class="sxs-lookup"><span data-stu-id="9472d-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="9472d-224">Naše implementace OnValidate() výše zajistí, že večeře nemá žádné RuleViolations před uložením.</span><span class="sxs-lookup"><span data-stu-id="9472d-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="9472d-225">Pokud je v neplatném stavu, vyvolá výjimku, což způsobí LINQ to SQL ji přerušit.</span><span class="sxs-lookup"><span data-stu-id="9472d-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="9472d-226">Tento přístup poskytuje jednoduché rozhraní, které budeme integrovat ověření a obchodní pravidla do.</span><span class="sxs-lookup"><span data-stu-id="9472d-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="9472d-227">Nyní Pojďme přidat níže pravidla, která metoda naše GetRuleViolations():</span><span class="sxs-lookup"><span data-stu-id="9472d-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="9472d-228">Vrátit posloupnost žádné RuleViolations používáme "výnos vrátit" funkce jazyka C#.</span><span class="sxs-lookup"><span data-stu-id="9472d-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="9472d-229">První šesti pravidla kontroly výše jednoduše vynutit, aby vlastnosti řetězce na našem večeři nemůže být null nebo prázdný.</span><span class="sxs-lookup"><span data-stu-id="9472d-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="9472d-230">Poslední pravidlo je o něco zajímavějšího a volání PhoneValidator.IsValidNumber() Pomocná metoda, jsme do projektu můžete přidat naše ověřit, jestli ContactPhone číslo formát odpovídá večeře na zemi.</span><span class="sxs-lookup"><span data-stu-id="9472d-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="9472d-231">Můžeme použít. Podpora je NET regulární výraz k implementaci tuto telefonickou podporu ověřování.</span><span class="sxs-lookup"><span data-stu-id="9472d-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="9472d-232">Níže je jednoduchá implementace PhoneValidator, která může přidáme pro naše projekt, který umožňuje nám přidat jednotlivé země Regex vzor kontroly:</span><span class="sxs-lookup"><span data-stu-id="9472d-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="9472d-233">Ověření zpracování a obchodní logiku porušení</span><span class="sxs-lookup"><span data-stu-id="9472d-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="9472d-234">Teď, když přidali jsme výše ověření a obchodní pravidlo kód, kdykoli pokusíme se vytvořit nebo aktualizovat večeři, naše ověřovací logiku pravidla vyhodnotit a vynutit.</span><span class="sxs-lookup"><span data-stu-id="9472d-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="9472d-235">Vývojářům psát kód jako dole proaktivně určit, jestli je objekt večeři platný a načíst seznam všech porušení v něm bez vyvolání jakékoli výjimky:</span><span class="sxs-lookup"><span data-stu-id="9472d-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="9472d-236">Pokud jsme pokus o uložení večeři v neplatném stavu, bude vyvolána výjimka, když jsme volat metodu Save() u DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="9472d-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="9472d-237">K tomu dochází, protože technologie LINQ to SQL automaticky volá metodu částečné naše Dinner.OnValidate(), než ho uloží večeři změny a jsme přidali kód pro Dinner.OnValidate() k vyvolána výjimka, pokud v večeře neexistuje žádné porušení pravidel.</span><span class="sxs-lookup"><span data-stu-id="9472d-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="9472d-238">Můžeme tuto výjimku zachytit a reaktivně načítat seznam porušení vyřešit:</span><span class="sxs-lookup"><span data-stu-id="9472d-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="9472d-239">Protože naše ověření a obchodní pravidla jsou implementované v rámci naší vrstva modelu a ne v rámci vrstvě uživatelského rozhraní, budou použity se použije ve všech scénářích v naší aplikaci.</span><span class="sxs-lookup"><span data-stu-id="9472d-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="9472d-240">Jsme později můžete změnit nebo přidat obchodní pravidla a nastavit všechny kód funguje s objekty naše večeři respektovat je.</span><span class="sxs-lookup"><span data-stu-id="9472d-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="9472d-241">S flexibilně změnit obchodní pravidla na jednom místě, bez nutnosti tyto změny ripple v celé aplikaci a logika uživatelského rozhraní, je znak správně vytvořená aplikace a výhody, která představuje rozhraní MVC pomáhá podporovat.</span><span class="sxs-lookup"><span data-stu-id="9472d-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="9472d-242">Další krok</span><span class="sxs-lookup"><span data-stu-id="9472d-242">Next Step</span></span>

<span data-ttu-id="9472d-243">My jste nyní model, který jsme vám pomůže dotazy na data a aktualizace našich databáze.</span><span class="sxs-lookup"><span data-stu-id="9472d-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="9472d-244">Umožňuje přidat některé řadiče a zobrazení pro projekt, který jsme můžete použít k vytvoření HTML uživatelské rozhraní kolem něj.</span><span class="sxs-lookup"><span data-stu-id="9472d-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9472d-245">[Předchozí](create-a-database.md)
> [další](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="9472d-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
