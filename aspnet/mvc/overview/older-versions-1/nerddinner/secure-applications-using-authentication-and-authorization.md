---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Zabezpečení aplikací s použitím ověřování a autorizace | Microsoft Docs
author: microsoft
description: Krok 9 ukazuje, jak přidat ověřování a autorizace pro zabezpečení naše aplikace NerdDinner tak, aby uživatelé potřebují k registraci a přihlaste se k webu pro vytvoření...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/27/2010
ms.topic: article
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 4a9b1e6d7d453bd8dc5a61b1f1cec4617af7d693
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/06/2018
---
<a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="a51ed-103">Zabezpečení aplikací s použitím ověřování a autorizace</span><span class="sxs-lookup"><span data-stu-id="a51ed-103">Secure Applications Using Authentication and Authorization</span></span>
====================
<span data-ttu-id="a51ed-104">podle [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="a51ed-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="a51ed-105">Stáhnout PDF</span><span class="sxs-lookup"><span data-stu-id="a51ed-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="a51ed-106">Toto je kroku 9 bezplatný [kurz aplikace "NerdDinner"](introducing-the-nerddinner-tutorial.md) , nevystavíte slabé stránky zabezpečení – prostřednictvím postup sestavení malá, ale dokončení, webové aplikace pomocí ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="a51ed-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="a51ed-107">Krok 9 ukazuje, jak přidat ověřování a autorizace pro zabezpečení naše aplikace NerdDinner tak, aby uživatelé potřebují k registraci a přihlaste se k webu pro vytvoření nové večeří a pouze uživatele, který je hostitelem večeři ho můžete upravit později.</span><span class="sxs-lookup"><span data-stu-id="a51ed-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="a51ed-108">Pokud používáte ASP.NET MVC 3, doporučujeme provedením [získávání spuštěna s MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) nebo [MVC Hudba úložiště](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) kurzy.</span><span class="sxs-lookup"><span data-stu-id="a51ed-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="a51ed-109">NerdDinner krok 9: Ověřování a autorizace</span><span class="sxs-lookup"><span data-stu-id="a51ed-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="a51ed-110">Nyní naše NerdDinner aplikace uděluje každý, kdo návštěvou webu umožňuje vytvářet a upravovat podrobnosti o všech večeři.</span><span class="sxs-lookup"><span data-stu-id="a51ed-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="a51ed-111">Umožňuje změnit tak, aby uživatelé potřebují k registraci a přihlaste se k webu k vytvoření nové večeří a přidat omezení tak, aby pouze uživatele, který je hostitelem večeři můžete později upravovat.</span><span class="sxs-lookup"><span data-stu-id="a51ed-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="a51ed-112">Chcete-li povolit tuto funkci použijeme ověřování a autorizace pro zabezpečení naše aplikace.</span><span class="sxs-lookup"><span data-stu-id="a51ed-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="a51ed-113">Principy ověřování a autorizace</span><span class="sxs-lookup"><span data-stu-id="a51ed-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="a51ed-114">*Ověřování* je proces identifikace a ověření identity klienta přístupu k aplikaci.</span><span class="sxs-lookup"><span data-stu-id="a51ed-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="a51ed-115">PUT jednodušeji, je o identifikaci "kdo koncový uživatel je při návštěvě webu".</span><span class="sxs-lookup"><span data-stu-id="a51ed-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="a51ed-116">ASP.NET podporuje více způsobů k ověřování uživatelů prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="a51ed-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="a51ed-117">Nejběžnější metoda ověření používaná pro internetové webové aplikace, nazývá "Ověřování pomocí formulářů".</span><span class="sxs-lookup"><span data-stu-id="a51ed-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="a51ed-118">Ověřování pomocí formulářů umožňuje vývojáři vytvářet formuláře HTML přihlášení v rámci své aplikace a ověřte uživatelské jméno nebo heslo, které koncovým odešle proti databáze nebo jiného úložiště přihlašovacích údajů heslo.</span><span class="sxs-lookup"><span data-stu-id="a51ed-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="a51ed-119">Pokud je správná kombinace uživatelského jména a hesla, vývojář na požádání ASP.NET vystavit šifrovaného souboru cookie HTTP k identifikaci uživatele napříč budoucí požadavky.</span><span class="sxs-lookup"><span data-stu-id="a51ed-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="a51ed-120">Jsme budete pomocí naší aplikaci NerdDinner ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="a51ed-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="a51ed-121">*Autorizace* je proces pro určení toho, zda ověřený uživatel má oprávnění pro přístup k určitému adresu URL nebo prostředku nebo provedení několika akcí.</span><span class="sxs-lookup"><span data-stu-id="a51ed-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="a51ed-122">Například v naší aplikaci NerdDinner jsme budete chtít autorizovat, přístup pouze uživatelé, kteří jsou přihlášeni */večeří/vytvořit* adresy URL a vytvořit nové večeří.</span><span class="sxs-lookup"><span data-stu-id="a51ed-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="a51ed-123">Také jsme budete chtít přidat logiku ověřování, aby pouze uživatele, který je hostitelem večeři jej mohli upravit – a všem ostatním uživatelům odepřít přístup pro úpravy.</span><span class="sxs-lookup"><span data-stu-id="a51ed-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="a51ed-124">Ověřování pomocí formulářů a AccountController</span><span class="sxs-lookup"><span data-stu-id="a51ed-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="a51ed-125">Výchozí šablona projektu sady Visual Studio pro architekturu ASP.NET MVC automaticky povolí ověřování pomocí formulářů, při vytvoření nové aplikace ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="a51ed-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="a51ed-126">Také automaticky přidá na předem vytvořený účet přihlašovací stránky implementace do projektu – které skutečně usnadňuje integraci zabezpečení v rámci lokality.</span><span class="sxs-lookup"><span data-stu-id="a51ed-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="a51ed-127">Když není ověřený uživatel k ní přistupují Site.master stránku zobrazí odkaz "Přihlášení" v pravé horní lokality:</span><span class="sxs-lookup"><span data-stu-id="a51ed-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="a51ed-128">Kliknutím na odkaz "Přihlášení" trvá uživateli */Account/přihlášení* adresy URL:</span><span class="sxs-lookup"><span data-stu-id="a51ed-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="a51ed-129">Návštěvníci, kteří se nezaregistrovali, můžete provést kliknutím na odkaz "Register" – to bude trvat, aby */Account/registrace* adresy URL a povolení jejich zadejte podrobnosti o účtu:</span><span class="sxs-lookup"><span data-stu-id="a51ed-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="a51ed-130">Klepnutím na tlačítko "Register" bude vytvoření nového uživatele v rámci systému členství technologie ASP.NET a ověření uživatele na webu pomocí ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="a51ed-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="a51ed-131">Pokud je uživatel přihlášený, Site.master změní pravé horní části stránky a výstup "Vítejte [username]!"</span><span class="sxs-lookup"><span data-stu-id="a51ed-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="a51ed-132">zprávy a vykreslí "Odhlásit uživatele" odkaz místo "přihlášení" jednu.</span><span class="sxs-lookup"><span data-stu-id="a51ed-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="a51ed-133">Kliknutím na odkaz "Protokolu vypnuto" neodhlásí uživatele:</span><span class="sxs-lookup"><span data-stu-id="a51ed-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="a51ed-134">Výše uvedené funkce přihlášení, odhlášení a registrace je implementována v rámci AccountController třídy, která byla přidána do našich projekt Visual Studio vytvoření projektu.</span><span class="sxs-lookup"><span data-stu-id="a51ed-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="a51ed-135">Uživatelské rozhraní pro AccountController je implementovaná pomocí šablon zobrazení v adresáři \Views\Account:</span><span class="sxs-lookup"><span data-stu-id="a51ed-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="a51ed-136">Třída AccountController používá systém ověřování ASP.NET pomocí formulářů k vydávání šifrované ověřovací soubory cookie a rozhraní API členství technologie ASP.NET pro ukládání a ověřit uživatelská jména a hesla.</span><span class="sxs-lookup"><span data-stu-id="a51ed-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="a51ed-137">Rozhraní API členství technologie ASP.NET je rozšiřitelný a umožňuje žádné přihlašovací údaje úložiště hesel má být použit.</span><span class="sxs-lookup"><span data-stu-id="a51ed-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="a51ed-138">ASP.NET se dodává s implementací předdefinované členství zprostředkovatele, které ukládání uživatelského jména a hesla v databázi SQL a do služby Active Directory.</span><span class="sxs-lookup"><span data-stu-id="a51ed-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="a51ed-139">Nakonfigurujeme poskytovatele, kterého členství v naší aplikaci NerdDinner měli používat otevřením souboru "web.config" v kořenovém adresáři projektu a hledá &lt;členství&gt; část v něm.</span><span class="sxs-lookup"><span data-stu-id="a51ed-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="a51ed-140">Výchozí soubor web.config po vytvoření projektu přidáno registruje zprostředkovatele členství SQL a nakonfiguruje ho na použití připojovacího řetězce s názvem "ApplicationServices" a zadejte umístění databáze.</span><span class="sxs-lookup"><span data-stu-id="a51ed-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="a51ed-141">Připojovací řetězec "ApplicationServices" výchozí (který je zadán v rámci &lt;connectionStrings&gt; části souboru web.config) je nakonfigurovaný na použití SQL Express.</span><span class="sxs-lookup"><span data-stu-id="a51ed-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="a51ed-142">Odkazuje na databázi SQL Express s názvem "ASPNETDB. MDF"v části aplikace" aplikace\_Data "directory.</span><span class="sxs-lookup"><span data-stu-id="a51ed-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="a51ed-143">Pokud tato databáze neexistuje prvním rozhraní API členství slouží v aplikaci, ASP.NET automaticky vytvořit databázi a zřídit schéma databáze příslušné členství v něm:</span><span class="sxs-lookup"><span data-stu-id="a51ed-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="a51ed-144">Pokud místo použití SQL Express jsme chtěli použít plná instance systému SQL Server (nebo připojení ke vzdálené databázi), všechny by potřebujeme úkolů je aktualizovat připojovací řetězec "ApplicationServices" v souboru web.config a ujistěte se, že schéma odpovídající členství přidala k databázi, kterou se odkazuje na.</span><span class="sxs-lookup"><span data-stu-id="a51ed-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="a51ed-145">Můžete spustit "aspnet\_regsql.exe" nástroj v adresáři \Windows\Microsoft.NET\Framework\v2.0.50727\ přidat příslušného schématu pro členství a další služby aplikace ASP.NET do databáze.</span><span class="sxs-lookup"><span data-stu-id="a51ed-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="a51ed-146">Autorizace večeří nebo vytvořit adresu URL, pomocí filtru [Authorize]</span><span class="sxs-lookup"><span data-stu-id="a51ed-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="a51ed-147">Nebyly k dispozici psaní jakéhokoli kódu povolení zabezpečeného ověřování a účet správy implementace NerdDinner aplikace.</span><span class="sxs-lookup"><span data-stu-id="a51ed-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="a51ed-148">Uživatelé mohou registrovat nové účty s naše aplikace a přihlášení/odhlášení lokality.</span><span class="sxs-lookup"><span data-stu-id="a51ed-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="a51ed-149">Nyní jsme můžete přidat logiku ověřování do aplikace a používat ověřování stavu a uživatelské jméno návštěvníky řídit, co mohou a nemůže provádět v rámci lokality.</span><span class="sxs-lookup"><span data-stu-id="a51ed-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="a51ed-150">Začněme přidáním autorizace logiku do metody akce "Vytvořit" naše DinnersController třídy.</span><span class="sxs-lookup"><span data-stu-id="a51ed-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="a51ed-151">Konkrétně, který bude vyžadovat jsme uživatele, kteří používají */večeří/vytvořit* adresu URL, musíte být přihlášení.</span><span class="sxs-lookup"><span data-stu-id="a51ed-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="a51ed-152">Pokud uživatel není přihlášený jsme budete přesměrování je na přihlašovací stránku tak, aby se můžete přihlásit.</span><span class="sxs-lookup"><span data-stu-id="a51ed-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="a51ed-153">Implementace této logiky je velmi snadné.</span><span class="sxs-lookup"><span data-stu-id="a51ed-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="a51ed-154">Jsme úkolů stačí přidat atribut filtru [autorizovat] na našem metody akce vytvořit takto:</span><span class="sxs-lookup"><span data-stu-id="a51ed-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="a51ed-155">ASP.NET MVC podporuje možnost vytvářet "filtry akce", které lze použít k implementaci opakovaně použitelné logiku, která může být použita deklarativně na metody akce.</span><span class="sxs-lookup"><span data-stu-id="a51ed-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="a51ed-156">Filtr [autorizovat] je jedním z filtrů vestavěná akce poskytované ASP.NET MVC a umožňuje vývojář deklarativně použít autorizační pravidla řadiče třídy a metody akce.</span><span class="sxs-lookup"><span data-stu-id="a51ed-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="a51ed-157">Při použití bez parametrů (jako výše) vynucuje [autorizovat] filtru, musíte být přihlášení uživatele, který vytvořil požadavek metody akce – a se automaticky přesměruje v prohlížeči adresu URL pro přihlášení Pokud nejsou.</span><span class="sxs-lookup"><span data-stu-id="a51ed-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="a51ed-158">Při provádění této přesměrování jako argument řetězce dotazu byla předána původně požadovanou URL adresu (například: / Account/přihlášení? ReturnUrl = % 2fDinners % 2fCreate).</span><span class="sxs-lookup"><span data-stu-id="a51ed-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="a51ed-159">AccountController se pak přesměruje uživatele zpět na původně požadovanou URL adresu po jejich přihlášení.</span><span class="sxs-lookup"><span data-stu-id="a51ed-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="a51ed-160">Filtr [autorizovat] volitelně podporuje možnost zadejte "Uživatelé" nebo "Role" vlastnost, která umožňuje vyžadovat, že je uživatel i přihlášen v a v seznamu povolených uživatelů nebo členem role zabezpečení povolené.</span><span class="sxs-lookup"><span data-stu-id="a51ed-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="a51ed-161">Následující kód například pouze umožňuje dvě konkrétní uživatele, "scottgu" a "billg", přístup k večeří nebo vytvořit adresu URL:</span><span class="sxs-lookup"><span data-stu-id="a51ed-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="a51ed-162">Vložení konkrétní uživatelská jména kódu obvykle používat poměrně zrušení udržovatelný.</span><span class="sxs-lookup"><span data-stu-id="a51ed-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="a51ed-163">Lepším řešením je definovat vyšší úrovně "role" kód zjišťuje proti a potom k mapování uživatelů do role pomocí databáze nebo systému služby active directory (povolení skutečného uživatelského seznamu mapování ukládaly externě z kódu).</span><span class="sxs-lookup"><span data-stu-id="a51ed-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="a51ed-164">Technologie ASP.NET obsahuje předdefinovaná role správy rozhraní API a také sadu předdefinovaných zprostředkovatelů rolí (včetně těch, které jsou pro SQL a služby Active Directory), které vám mohou pomoci provést toto mapování uživatelů a rolí.</span><span class="sxs-lookup"><span data-stu-id="a51ed-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="a51ed-165">Potom jsme může aktualizujte kód a Povolit jenom uživatelé v rámci role konkrétní "admin" přístup k večeří nebo vytvořit adresu URL:</span><span class="sxs-lookup"><span data-stu-id="a51ed-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="a51ed-166">Při vytváření pomocí vlastnosti User.Identity.Name večeří</span><span class="sxs-lookup"><span data-stu-id="a51ed-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="a51ed-167">Můžeme načíst uživatelské jméno aktuálně přihlášeného uživatele žádost pomocí vlastnosti User.Identity.Name zveřejněné na základní třídy Kontroleru.</span><span class="sxs-lookup"><span data-stu-id="a51ed-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="a51ed-168">Starší při implementovali jsme verze HTTP POST metody akce naše Create() jsme měli pevně zakódované vlastnost "HostedBy" večeři statický řetězec.</span><span class="sxs-lookup"><span data-stu-id="a51ed-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="a51ed-169">Jsme můžete nyní aktualizovat tento kód, aby místo toho použijte vlastnost User.Identity.Name, jakož i automaticky přidat odpověď pro vytváření večeře hostitele:</span><span class="sxs-lookup"><span data-stu-id="a51ed-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="a51ed-170">Protože atribut [autorizovat] jsme přidali metodu Create(), ASP.NET MVC zajistí, že provedení metody akce pouze pokud je přihlášení uživatele, kteří navštěvují večeří nebo vytvořit adresu URL na webu.</span><span class="sxs-lookup"><span data-stu-id="a51ed-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="a51ed-171">Hodnota vlastnosti User.Identity.Name jako takový bude vždy obsahovat platné uživatelské jméno.</span><span class="sxs-lookup"><span data-stu-id="a51ed-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="a51ed-172">Při úpravě pomocí vlastnosti User.Identity.Name večeří</span><span class="sxs-lookup"><span data-stu-id="a51ed-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="a51ed-173">Teď umožňuje přidat některé autorizace logiky, která omezuje uživatele tak, aby mohou upravovat pouze vlastnosti večeří, které jsou hostiteli sami.</span><span class="sxs-lookup"><span data-stu-id="a51ed-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="a51ed-174">Usnadní to, nejprve přidáme metodu helper "IsHostedBy(username)" naše objekt večeři (v rámci Dinner.cs třídu, kterou jsme vytvořili výše).</span><span class="sxs-lookup"><span data-stu-id="a51ed-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="a51ed-175">Tato pomocná metoda vrátí hodnotu PRAVDA nebo NEPRAVDA v závislosti na jestli zadané uživatelské jméno odpovídá vlastnost večeři HostedBy a zapouzdří logice nezbytným k provedení porovnání velká a malá písmena řetězce je:</span><span class="sxs-lookup"><span data-stu-id="a51ed-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="a51ed-176">Potom přidáme [autorizovat] atribut do metody akce Edit() v rámci naší DinnersController třídy.</span><span class="sxs-lookup"><span data-stu-id="a51ed-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="a51ed-177">Tím bude zajištěno, že uživatelé musíte být přihlášení k žádosti */Dinners/Edit / [id]* adresy URL.</span><span class="sxs-lookup"><span data-stu-id="a51ed-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="a51ed-178">Kód jsme poté můžete přidat do našich upravit metody, které používá Dinner.IsHostedBy(username) pomocnou metodu k ověření, že přihlášeného uživatele odpovídá večeři hostitele.</span><span class="sxs-lookup"><span data-stu-id="a51ed-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="a51ed-179">Pokud uživatel není hostiteli, jsme budete zobrazit "InvalidOwner" a ukončení požadavku.</span><span class="sxs-lookup"><span data-stu-id="a51ed-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="a51ed-180">Kód k tomu vypadá níže:</span><span class="sxs-lookup"><span data-stu-id="a51ed-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="a51ed-181">Jsme klikněte pravým tlačítkem na \Views\Dinners adresář a vyberte Přidat -&gt;zobrazit příkaz nabídky k vytvoření nového zobrazení "InvalidOwner".</span><span class="sxs-lookup"><span data-stu-id="a51ed-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="a51ed-182">Budete ho s naplníme následující chybová zpráva:</span><span class="sxs-lookup"><span data-stu-id="a51ed-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="a51ed-183">A teď když se uživatel pokusí upravit večeři, které budou nevlastníte, že budete získat chybová zpráva:</span><span class="sxs-lookup"><span data-stu-id="a51ed-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="a51ed-184">Stejný postup jsme můžete opakovat pro Delete() metody akce v kontroleru zamknout oprávnění k odstraňování večeří také a ujistěte se, že pouze hostitel večeři můžete odstranit.</span><span class="sxs-lookup"><span data-stu-id="a51ed-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="a51ed-185">Zobrazení nebo skrytí upravit a odstranit odkazy</span><span class="sxs-lookup"><span data-stu-id="a51ed-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="a51ed-186">Jsme se propojení na metodu akce upravit a odstranit naše DinnersController třídy z našich podrobnosti adresy URL:</span><span class="sxs-lookup"><span data-stu-id="a51ed-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="a51ed-187">Aktuálně jsou jsme se zobrazuje upravit a odstranit odkazy na akce bez ohledu na to, zda je hostitel večeře návštěvník na adresu URL podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="a51ed-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="a51ed-188">Umožňuje změnit tak, aby odkazy se zobrazí, pouze pokud je vlastníkem večeře hostujícími uživatele.</span><span class="sxs-lookup"><span data-stu-id="a51ed-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="a51ed-189">Details() metody akce v rámci naší DinnersController načte objekt večeři a předává je jako objekt modelu pro naše zobrazit šablonu:</span><span class="sxs-lookup"><span data-stu-id="a51ed-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="a51ed-190">Aktualizujeme naše zobrazení šablony podmíněně zobrazit či skrýt odkazy upravit a odstranit pomocí Dinner.IsHostedBy() Pomocná metoda jako níže:</span><span class="sxs-lookup"><span data-stu-id="a51ed-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="a51ed-191">Další kroky</span><span class="sxs-lookup"><span data-stu-id="a51ed-191">Next Steps</span></span>

<span data-ttu-id="a51ed-192">Nyní podíváme, jak můžeme provést aktivaci ověřeným uživatelům zasílání zpráv rysy pro večeří pomocí rozhraní AJAX.</span><span class="sxs-lookup"><span data-stu-id="a51ed-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a51ed-193">[Předchozí](implement-efficient-data-paging.md)
> [další](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="a51ed-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
