---
title: Sestavování progresivních webových aplikací pomocí ASP.NET CoreBlazor WebAssembly
author: guardrex
description: Naučte se vytvářet Blazor progresivní webové aplikace (PWA), které používají moderní funkce prohlížeče, aby se chovala jako desktopová aplikace.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 06/10/2020
no-loc:
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: 237a8fceb75ba724625f018cf94c8d5bc5acfdad
ms.sourcegitcommit: d65a027e78bf0b83727f975235a18863e685d902
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 06/26/2020
ms.locfileid: "85402582"
---
# <a name="build-progressive-web-applications-with-aspnet-core-blazor-webassembly"></a><span data-ttu-id="78637-103">Sestavování progresivních webových aplikací pomocí ASP.NET CoreBlazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="78637-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="78637-104">Pomocí [Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="78637-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

<span data-ttu-id="78637-105">Progresivní webová aplikace (PWA) je obvykle jediná stránková aplikace (SPA), která používá moderní rozhraní API a možnosti prohlížeče, aby se choval jako desktopová aplikace.</span><span class="sxs-lookup"><span data-stu-id="78637-105">A Progressive Web Application (PWA) is usually a Single Page Application (SPA) that uses modern browser APIs and capabilities to behave like a desktop app.</span></span> Blazor WebAssembly<span data-ttu-id="78637-106">je webová platforma webové aplikace založená na standardech, takže může používat libovolné rozhraní API prohlížeče, včetně rozhraní API PWA potřebných pro následující funkce:</span><span class="sxs-lookup"><span data-stu-id="78637-106"> is a standards-based client-side web app platform, so it can use any browser API, including PWA APIs required for the following capabilities:</span></span>

* <span data-ttu-id="78637-107">Pracujete offline a okamžitě se načítají nezávisle na rychlosti sítě.</span><span class="sxs-lookup"><span data-stu-id="78637-107">Working offline and loading instantly, independent of network speed.</span></span>
* <span data-ttu-id="78637-108">Spuštění ve vlastním okně aplikace, ne pouze v okně prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="78637-108">Running in its own app window, not just a browser window.</span></span>
* <span data-ttu-id="78637-109">Spouští se z nabídky Start v operačním systému hostitele, ukotvení nebo na domovské obrazovce.</span><span class="sxs-lookup"><span data-stu-id="78637-109">Being launched from the host's operating system start menu, dock, or home screen.</span></span>
* <span data-ttu-id="78637-110">Příjem nabízených oznámení ze serveru back-end, a to i v případě, že uživatel aplikaci nepoužívá.</span><span class="sxs-lookup"><span data-stu-id="78637-110">Receiving push notifications from a backend server, even while the user isn't using the app.</span></span>
* <span data-ttu-id="78637-111">Automatické aktualizace na pozadí.</span><span class="sxs-lookup"><span data-stu-id="78637-111">Automatically updating in the background.</span></span>

<span data-ttu-id="78637-112">K popisu takových aplikací se používá slovo *progresivní* :</span><span class="sxs-lookup"><span data-stu-id="78637-112">The word *progressive* is used to describe such apps because:</span></span>

* <span data-ttu-id="78637-113">Uživatel může aplikaci nejprve vyhledat a používat v rámci webového prohlížeče jako jakékoli jiné zabezpečené ověřování hesla.</span><span class="sxs-lookup"><span data-stu-id="78637-113">A user might first discover and use the app within their web browser like any other SPA.</span></span>
* <span data-ttu-id="78637-114">Později uživatel postupuje jeho instalaci v operačním systému a povolení nabízených oznámení.</span><span class="sxs-lookup"><span data-stu-id="78637-114">Later, the user progresses to installing it in their OS and enabling push notifications.</span></span>

## <a name="create-a-project-from-the-pwa-template"></a><span data-ttu-id="78637-115">Vytvoření projektu ze šablony PWA</span><span class="sxs-lookup"><span data-stu-id="78637-115">Create a project from the PWA template</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="78637-116">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="78637-116">Visual Studio</span></span>](#tab/visual-studio)

<span data-ttu-id="78637-117">Pokud vytváříte novou \*\* Blazor WebAssembly aplikaci\*\* v dialogovém okně **vytvořit nový projekt** , zaškrtněte políčko **progresivní webová aplikace** :</span><span class="sxs-lookup"><span data-stu-id="78637-117">When creating a new **Blazor WebAssembly App** in the **Create a New Project** dialog, select the **Progressive Web Application** check box:</span></span>

![Zaškrtávací políčko progresivní webová aplikace je zaškrtnuto v dialogovém okně Nový projekt aplikace Visual Studio.](progressive-web-app/_static/image1.png)

<!--

# [Visual Studio for Mac](#tab/visual-studio-mac)

-->

# <a name="visual-studio-code--net-core-cli"></a>[<span data-ttu-id="78637-119">Visual Studio Code/.NET Core CLI</span><span class="sxs-lookup"><span data-stu-id="78637-119">Visual Studio Code / .NET Core CLI</span></span>](#tab/visual-studio-code+netcore-cli)

<span data-ttu-id="78637-120">Vytvořte projekt PWA v příkazovém prostředí s `--pwa` přepínačem:</span><span class="sxs-lookup"><span data-stu-id="78637-120">Create a PWA project in a command shell with the `--pwa` switch:</span></span>

```dotnetcli
dotnet new blazorwasm -o MyNewProject --pwa
```

---

<span data-ttu-id="78637-121">V případě potřeby lze aplikaci PWA nakonfigurovat pro aplikaci vytvořenou z hostované šablony ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="78637-121">Optionally, PWA can be configured for an app created from the ASP.NET Core Hosted template.</span></span> <span data-ttu-id="78637-122">Scénář aplikace PWA je nezávislý na modelu hostování.</span><span class="sxs-lookup"><span data-stu-id="78637-122">The PWA scenario is independent of the hosting model.</span></span>

## <a name="installation-and-app-manifest"></a><span data-ttu-id="78637-123">Instalace a manifest aplikace</span><span class="sxs-lookup"><span data-stu-id="78637-123">Installation and app manifest</span></span>

<span data-ttu-id="78637-124">Při návštěvě aplikace vytvořené pomocí šablony PWA mají uživatelé možnost instalovat aplikaci do nabídky Start, Dock nebo Home v operačním systému.</span><span class="sxs-lookup"><span data-stu-id="78637-124">When visiting an app created using the PWA template, users have the option of installing the app into their OS's start menu, dock, or home screen.</span></span> <span data-ttu-id="78637-125">Způsob, jakým je tato možnost uvedená, závisí na prohlížeči uživatele.</span><span class="sxs-lookup"><span data-stu-id="78637-125">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="78637-126">Při použití prohlížečů založených na desktopových Chromech, jako je například Edge nebo Chrome, se na panelu Adresa URL zobrazí tlačítko **Přidat** .</span><span class="sxs-lookup"><span data-stu-id="78637-126">When using desktop Chromium-based browsers, such as Edge or Chrome, an **Add** button appears within the URL bar.</span></span> <span data-ttu-id="78637-127">Jakmile uživatel vybere tlačítko **Přidat** , obdrží potvrzovací dialog:</span><span class="sxs-lookup"><span data-stu-id="78637-127">After the user selects the **Add** button, they receive a confirmation dialog:</span></span>

![Diaglog potvrzení na Google Chrome prezentuje uživateli tlačítko pro instalaci aplikace MyBlazorPwa.](progressive-web-app/_static/image2.png)

<span data-ttu-id="78637-129">V systému iOS můžou Návštěvníci nainstalovat aplikaci PWA pomocí tlačítka pro **sdílení** v prohlížeči Safari a její možnosti **Přidat do homescreen** .</span><span class="sxs-lookup"><span data-stu-id="78637-129">On iOS, visitors can install the PWA using Safari's **Share** button and its **Add to Homescreen** option.</span></span> <span data-ttu-id="78637-130">V Chrome pro Android by uživatelé měli vybrat tlačítko **nabídky** v pravém horním rohu a potom **Přidat na domovskou obrazovku**.</span><span class="sxs-lookup"><span data-stu-id="78637-130">On Chrome for Android, users should select the **Menu** button in the upper-right corner, followed by **Add to Home screen**.</span></span>

<span data-ttu-id="78637-131">Po instalaci se aplikace zobrazí ve vlastním okně bez adresního řádku:</span><span class="sxs-lookup"><span data-stu-id="78637-131">Once installed, the app appears in its own window without an address bar:</span></span>

![Aplikace MyBlazorPwa běží na Google Chrome bez adresního řádku.](progressive-web-app/_static/image3.png)

<span data-ttu-id="78637-133">Chcete-li přizpůsobit název okna, barevné schéma, ikonu nebo jiné podrobnosti, Prohlédněte si `manifest.json` soubor v `wwwroot` adresáři projektu.</span><span class="sxs-lookup"><span data-stu-id="78637-133">To customize the window's title, color scheme, icon, or other details, see the `manifest.json` file in the project's `wwwroot` directory.</span></span> <span data-ttu-id="78637-134">Schéma tohoto souboru je definováno webovými standardy.</span><span class="sxs-lookup"><span data-stu-id="78637-134">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="78637-135">Další informace najdete v tématu [MDN web Docs: manifest webové aplikace](https://developer.mozilla.org/docs/Web/Manifest).</span><span class="sxs-lookup"><span data-stu-id="78637-135">For more information, see [MDN web docs: Web App Manifest](https://developer.mozilla.org/docs/Web/Manifest).</span></span>

## <a name="offline-support"></a><span data-ttu-id="78637-136">Podpora offline</span><span class="sxs-lookup"><span data-stu-id="78637-136">Offline support</span></span>

<span data-ttu-id="78637-137">Ve výchozím nastavení mají aplikace vytvořené pomocí možnosti šablony PWA podporu pro spuštění offline.</span><span class="sxs-lookup"><span data-stu-id="78637-137">By default, apps created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="78637-138">Uživatel musí nejdřív aplikaci navštívit, zatímco je online.</span><span class="sxs-lookup"><span data-stu-id="78637-138">A user must first visit the app while they're online.</span></span> <span data-ttu-id="78637-139">Prohlížeč automaticky stáhne a zapíše do mezipaměti všechny prostředky, které jsou potřeba pro práci offline.</span><span class="sxs-lookup"><span data-stu-id="78637-139">The browser automatically downloads and caches all of the resources required to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="78637-140">Vývojová podpora by vedla ke konfliktu s obvyklým vývojovým cyklem provádění změn a jejich testování.</span><span class="sxs-lookup"><span data-stu-id="78637-140">Development support would interfere with the usual development cycle of making changes and testing them.</span></span> <span data-ttu-id="78637-141">Podpora offline je proto povolená jenom pro *publikované* aplikace.</span><span class="sxs-lookup"><span data-stu-id="78637-141">Therefore, offline support is only enabled for *published* apps.</span></span> 

> [!WARNING]
> <span data-ttu-id="78637-142">Pokud máte v úmyslu distribuovat offline s povolenou aplikaci PWA, je k dispozici [několik důležitých upozornění a aspektů](#caveats-for-offline-pwas).</span><span class="sxs-lookup"><span data-stu-id="78637-142">If you intend to distribute an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas).</span></span> <span data-ttu-id="78637-143">Tyto scénáře jsou podstatou pro offline PWAs a nespecifická pro Blazor .</span><span class="sxs-lookup"><span data-stu-id="78637-143">These scenarios are inherent to offline PWAs and not specific to Blazor.</span></span> <span data-ttu-id="78637-144">Nezapomeňte si tyto upozornění přečíst a pochopit před tím, než začnete vytvářet předpoklady pro fungování offline aplikace.</span><span class="sxs-lookup"><span data-stu-id="78637-144">Be sure to read and understand these caveats before making assumptions about how your offline-enabled app will work.</span></span>

<span data-ttu-id="78637-145">Pokud chcete zjistit, jak funguje podpora offline:</span><span class="sxs-lookup"><span data-stu-id="78637-145">To see how offline support works:</span></span>

1. <span data-ttu-id="78637-146">Publikujte aplikaci.</span><span class="sxs-lookup"><span data-stu-id="78637-146">Publish the app.</span></span> <span data-ttu-id="78637-147">Další informace naleznete v tématu <xref:blazor/host-and-deploy/index#publish-the-app>.</span><span class="sxs-lookup"><span data-stu-id="78637-147">For more information, see <xref:blazor/host-and-deploy/index#publish-the-app>.</span></span>
1. <span data-ttu-id="78637-148">Nasaďte aplikaci na server, který podporuje protokol HTTPS, a získejte přístup k aplikaci v prohlížeči pomocí zabezpečené adresy HTTPS.</span><span class="sxs-lookup"><span data-stu-id="78637-148">Deploy the app to a server that supports HTTPS, and access the app in a browser at its secure HTTPS address.</span></span>
1. <span data-ttu-id="78637-149">Otevřete vývojové nástroje v prohlížeči a ověřte, zda je na kartě **aplikace** zaregistrován *pracovní proces služby* pro hostitele:</span><span class="sxs-lookup"><span data-stu-id="78637-149">Open the browser's dev tools and verify that a *Service Worker* is registered for the host on the **Application** tab:</span></span>

   ![Karta aplikace Google Chrome Developer Tools zobrazuje aktivované a běžící pracovní proces služby.](progressive-web-app/_static/image4.png)

1. <span data-ttu-id="78637-151">Znovu načtěte stránku a prověřte kartu **síť** . **pracovní proces služby** nebo **mezipaměť paměti** jsou uvedené jako zdroje pro všechny prostředky stránky:</span><span class="sxs-lookup"><span data-stu-id="78637-151">Reload the page and examine the **Network** tab. **Service Worker** or **memory cache** are listed as the sources for all of the page's assets:</span></span>

   ![Karta sítě Google Chrome Developer Tools zobrazuje zdroje pro všechny prostředky stránky.](progressive-web-app/_static/image5.png)

1. <span data-ttu-id="78637-153">Chcete-li ověřit, že prohlížeč není závislý na síťovém přístupu pro načtení aplikace, postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="78637-153">To verify that the browser isn't dependent on network access to load the app, either:</span></span>

   * <span data-ttu-id="78637-154">Vypněte webový server a podívejte se, jak aplikace nadále funguje normálně, což zahrnuje opětovné načtení stránky.</span><span class="sxs-lookup"><span data-stu-id="78637-154">Shut down the web server and see how the app continues to function normally, which includes page reloads.</span></span> <span data-ttu-id="78637-155">Podobně aplikace funguje normálně i v případě, že dojde k pomalému připojení k síti.</span><span class="sxs-lookup"><span data-stu-id="78637-155">Likewise, the app continues to function normally when there's a slow network connection.</span></span>
   * <span data-ttu-id="78637-156">Poskytněte prohlížeči simulaci offline režimu na kartě **síť** :</span><span class="sxs-lookup"><span data-stu-id="78637-156">Instruct the browser to simulate offline mode in the **Network** tab:</span></span>

   ![Karta sítě Google Chrome Developer Tools s rozevíracím seznamem režimu prohlížeče se změní z online na offline.](progressive-web-app/_static/image6.png)

<span data-ttu-id="78637-158">Podpora offline pomocí pracovního procesu služby je webový standard, který není specifický pro Blazor .</span><span class="sxs-lookup"><span data-stu-id="78637-158">Offline support using a service worker is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="78637-159">Další informace o pracovních procesech služby najdete v tématu [MDN web Docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="78637-159">For more information on service workers, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span> <span data-ttu-id="78637-160">Další informace o běžných způsobech použití pro pracovníky služeb najdete v tématu [Google Web: životní cyklus pracovního procesu služby](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="78637-160">To learn more about common usage patterns for service workers, see [Google Web: The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

Blazor<span data-ttu-id="78637-161">Šablona PWA vytvoří dva pracovní pracovní soubory služby:</span><span class="sxs-lookup"><span data-stu-id="78637-161">'s PWA template produces two service worker files:</span></span>

* <span data-ttu-id="78637-162">`wwwroot/service-worker.js`, který se používá při vývoji.</span><span class="sxs-lookup"><span data-stu-id="78637-162">`wwwroot/service-worker.js`, which is used during development.</span></span>
* <span data-ttu-id="78637-163">`wwwroot/service-worker.published.js`, který se používá po publikování aplikace.</span><span class="sxs-lookup"><span data-stu-id="78637-163">`wwwroot/service-worker.published.js`, which is used after the app is published.</span></span>

<span data-ttu-id="78637-164">Chcete-li sdílet logiku mezi dvěma pracovními soubory služby, vezměte v úvahu následující postup:</span><span class="sxs-lookup"><span data-stu-id="78637-164">To share logic between the two service worker files, consider the following approach:</span></span>

* <span data-ttu-id="78637-165">Přidejte třetí soubor JavaScriptu pro uložení běžné logiky.</span><span class="sxs-lookup"><span data-stu-id="78637-165">Add a third JavaScript file to hold the common logic.</span></span>
* <span data-ttu-id="78637-166">Použijte [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) k načtení běžné logiky do obou souborů pracovních procesů.</span><span class="sxs-lookup"><span data-stu-id="78637-166">Use [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load the common logic into both service worker files.</span></span>

### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="78637-167">Strategie prvního načtení mezipaměti</span><span class="sxs-lookup"><span data-stu-id="78637-167">Cache-first fetch strategy</span></span>

<span data-ttu-id="78637-168">Vestavěný `service-worker.published.js` pracovník služby vyřeší požadavky pomocí strategie *mezipaměti-First* .</span><span class="sxs-lookup"><span data-stu-id="78637-168">The built-in `service-worker.published.js` service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="78637-169">To znamená, že pracovní proces služby dává přednost vrácení obsahu v mezipaměti bez ohledu na to, jestli má uživatel přístup k síti nebo novější obsah dostupný na serveru.</span><span class="sxs-lookup"><span data-stu-id="78637-169">This means that the service worker prefers to return cached content, regardless of whether the user has network access or newer content is available on the server.</span></span>

<span data-ttu-id="78637-170">Strategie pro první mezipaměť je užitečná z těchto důvodů:</span><span class="sxs-lookup"><span data-stu-id="78637-170">The cache-first strategy is valuable because:</span></span>

* <span data-ttu-id="78637-171">**Zajišťuje spolehlivost.**</span><span class="sxs-lookup"><span data-stu-id="78637-171">**It ensures reliability.**</span></span> <span data-ttu-id="78637-172">Přístup k síti není logický stav.</span><span class="sxs-lookup"><span data-stu-id="78637-172">Network access isn't a boolean state.</span></span> <span data-ttu-id="78637-173">Uživatel není jednoduše online nebo offline:</span><span class="sxs-lookup"><span data-stu-id="78637-173">A user isn't simply online or offline:</span></span>

  * <span data-ttu-id="78637-174">Zařízení uživatele může předpokládat, že je online, ale síť může být tak pomalá, aby nedošlo k nepraktickému čekání.</span><span class="sxs-lookup"><span data-stu-id="78637-174">The user's device may assume it's online, but the network might be so slow as to be impractical to wait for.</span></span>
  * <span data-ttu-id="78637-175">Síť může u některých adres URL vracet neplatné výsledky, například když je k dispozici nějaký portál WIFI, který aktuálně blokuje nebo přesměrovává určité požadavky.</span><span class="sxs-lookup"><span data-stu-id="78637-175">The network might return invalid results for certain URLs, such as when there's a captive WIFI portal that's currently blocking or redirecting certain requests.</span></span>
  
  <span data-ttu-id="78637-176">Důvodem je, že `navigator.onLine` rozhraní API prohlížeče není spolehlivé a nemělo by být závislé na.</span><span class="sxs-lookup"><span data-stu-id="78637-176">This is why the browser's `navigator.onLine` API isn't reliable and shouldn't be depended upon.</span></span>

* <span data-ttu-id="78637-177">**Zajišťuje správnost.**</span><span class="sxs-lookup"><span data-stu-id="78637-177">**It ensures correctness.**</span></span> <span data-ttu-id="78637-178">Při sestavování mezipaměti offline prostředků používá pracovník služby k zajištění toho, aby získal úplný a vysoce konzistentní snímek prostředků v jednom čase.</span><span class="sxs-lookup"><span data-stu-id="78637-178">When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="78637-179">Tato mezipaměť se pak použije jako atomická jednotka.</span><span class="sxs-lookup"><span data-stu-id="78637-179">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="78637-180">Neexistuje žádný bod, který požaduje síť pro novější prostředky, protože jediné požadované verze jsou ty, které jsou už uložené v mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="78637-180">There's no point asking the network for newer resources, since the only versions required are the ones already cached.</span></span> <span data-ttu-id="78637-181">Cokoli jiného nekonzistence rizik a nekompatibilita (například pokus o použití verzí sestavení .NET, která nebyla zkompilována dohromady).</span><span class="sxs-lookup"><span data-stu-id="78637-181">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that weren't compiled together).</span></span>

### <a name="background-updates"></a><span data-ttu-id="78637-182">Aktualizace na pozadí</span><span class="sxs-lookup"><span data-stu-id="78637-182">Background updates</span></span>

<span data-ttu-id="78637-183">V rámci duševního modelu si můžete představit, jak se v režimu offline, tak jak se chová jako mobilní aplikace, které se dají nainstalovat.</span><span class="sxs-lookup"><span data-stu-id="78637-183">As a mental model, you can think of an offline-first PWA as behaving like a mobile app that can be installed.</span></span> <span data-ttu-id="78637-184">Aplikace se okamžitě spustí bez ohledu na připojení k síti, ale nainstalovaná logika aplikace pochází z snímku v čase, který nemusí být nejnovější verze.</span><span class="sxs-lookup"><span data-stu-id="78637-184">The app starts up immediately regardless of network connectivity, but the installed app logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="78637-185">BlazorŠablona PWA vytváří aplikace, které se automaticky pokusí o aktualizaci na pozadí, kdykoli uživatel navštíví a má fungující síťové připojení.</span><span class="sxs-lookup"><span data-stu-id="78637-185">The Blazor PWA template produces apps that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="78637-186">Způsob funguje takto:</span><span class="sxs-lookup"><span data-stu-id="78637-186">The way this works is as follows:</span></span>

* <span data-ttu-id="78637-187">Během kompilace projekt generuje *manifest assetů pracovního procesu služby*.</span><span class="sxs-lookup"><span data-stu-id="78637-187">During compilation, the project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="78637-188">Ve výchozím nastavení se volá `service-worker-assets.js` .</span><span class="sxs-lookup"><span data-stu-id="78637-188">By default, this is called `service-worker-assets.js`.</span></span> <span data-ttu-id="78637-189">Manifest obsahuje seznam všech statických prostředků, které aplikace vyžaduje, aby fungovala offline, například sestavení .NET, soubory JavaScriptu a CSS, včetně jejich hodnot hash obsahu.</span><span class="sxs-lookup"><span data-stu-id="78637-189">The manifest lists all the static resources that the app requires to function offline, such as .NET assemblies, JavaScript files, and CSS, including their content hashes.</span></span> <span data-ttu-id="78637-190">Seznam prostředků je načten pracovním procesem služby, aby věděl, které prostředky se mají ukládat do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="78637-190">The resource list is loaded by the service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="78637-191">Pokaždé, když uživatel navštíví aplikaci, prohlížeč znovu vyžádá `service-worker.js` a na `service-worker-assets.js` pozadí.</span><span class="sxs-lookup"><span data-stu-id="78637-191">Each time the user visits the app, the browser re-requests `service-worker.js` and `service-worker-assets.js` in the background.</span></span> <span data-ttu-id="78637-192">Soubory jsou porovnány bajtů-pro bajt s existujícím pracovním procesem nainstalovaného služby.</span><span class="sxs-lookup"><span data-stu-id="78637-192">The files are compared byte-for-byte with the existing installed service worker.</span></span> <span data-ttu-id="78637-193">Pokud server vrátí změněný obsah některého z těchto souborů, pokusí se pracovní proces služby nainstalovat novou verzi.</span><span class="sxs-lookup"><span data-stu-id="78637-193">If the server returns changed content for either of these files, the service worker attempts to install a new version of itself.</span></span>
* <span data-ttu-id="78637-194">Při instalaci nové verze samotné pracovní proces služby vytvoří novou a samostatnou mezipaměť pro offline prostředky a začne naplnit mezipaměť prostředky uvedenými v `service-worker-assets.js` .</span><span class="sxs-lookup"><span data-stu-id="78637-194">When installing a new version of itself, the service worker creates a new, separate cache for offline resources and starts populating the cache with resources listed in `service-worker-assets.js`.</span></span> <span data-ttu-id="78637-195">Tato logika je implementována ve `onInstall` funkci v rámci `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="78637-195">This logic is implemented in the `onInstall` function inside `service-worker.published.js`.</span></span>
* <span data-ttu-id="78637-196">Proces se úspěšně dokončí, když se všechny prostředky načtou bez chyb a všechny hodnoty hash obsahu se shodují.</span><span class="sxs-lookup"><span data-stu-id="78637-196">The process completes successfully when all of the resources are loaded without error and all content hashes match.</span></span> <span data-ttu-id="78637-197">V případě úspěchu nový pracovní proces služby vstoupí do stavu *čekání na aktivaci* .</span><span class="sxs-lookup"><span data-stu-id="78637-197">If successful, the new service worker enters a *waiting for activation* state.</span></span> <span data-ttu-id="78637-198">Jakmile uživatel aplikaci zavře (žádné zbývající karty aplikace nebo Windows), bude nový pracovní proces služby *aktivní* a použije se pro následné návštěvy aplikace.</span><span class="sxs-lookup"><span data-stu-id="78637-198">As soon as the user closes the app (no remaining app tabs or windows), the new service worker becomes *active* and is used for subsequent app visits.</span></span> <span data-ttu-id="78637-199">Původní pracovní proces služby a jeho mezipaměť se odstraní.</span><span class="sxs-lookup"><span data-stu-id="78637-199">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="78637-200">Pokud se proces neúspěšně nedokončí, nová instance pracovního procesu služby se zahodí.</span><span class="sxs-lookup"><span data-stu-id="78637-200">If the process doesn't complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="78637-201">V případě, že snad klient má lepší síťové připojení, které může dokončit požadavky, se proces aktualizace znovu pokusí o další návštěvu uživatele.</span><span class="sxs-lookup"><span data-stu-id="78637-201">The update process is attempted again on the user's next visit, when hopefully the client has a better network connection that can complete the requests.</span></span>

<span data-ttu-id="78637-202">Tento proces si upravíte úpravou logiky pracovního procesu služby.</span><span class="sxs-lookup"><span data-stu-id="78637-202">Customize this process by editing the service worker logic.</span></span> <span data-ttu-id="78637-203">Žádná z předchozích chování není specifická pro, Blazor ale je pouze výchozím prostředím poskytovaným možností šablony PWA.</span><span class="sxs-lookup"><span data-stu-id="78637-203">None of the preceding behavior is specific to Blazor but is merely the default experience provided by the PWA template option.</span></span> <span data-ttu-id="78637-204">Další informace najdete v tématu [MDN web Docs: API Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="78637-204">For more information, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span>

### <a name="how-requests-are-resolved"></a><span data-ttu-id="78637-205">Jak se řeší požadavky</span><span class="sxs-lookup"><span data-stu-id="78637-205">How requests are resolved</span></span>

<span data-ttu-id="78637-206">Jak je popsáno v části [strategie načítající mezipaměť](#cache-first-fetch-strategy) , výchozí pracovní proces služby používá strategii *cache-First* , což znamená, že se při dostupnosti pokusí o poskytování obsahu v mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="78637-206">As described in the [Cache-first fetch strategy](#cache-first-fetch-strategy) section, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="78637-207">Pokud není obsah uložený v mezipaměti pro určitou adresu URL, například při vyžádání dat z back-endu API, pracovní proces služby se vrátí na běžný síťový požadavek.</span><span class="sxs-lookup"><span data-stu-id="78637-207">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request.</span></span> <span data-ttu-id="78637-208">Pokud je server dostupný, požadavek na síť je úspěšný.</span><span class="sxs-lookup"><span data-stu-id="78637-208">The network request succeeds if the server is reachable.</span></span> <span data-ttu-id="78637-209">Tato logika je implementována uvnitř `onFetch` funkce v rámci `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="78637-209">This logic is implemented inside `onFetch` function within `service-worker.published.js`.</span></span>

<span data-ttu-id="78637-210">Pokud Razor komponenty aplikace spoléhají na požadavky na data z back-endové rozhraní API a chcete poskytnout uživatelsky přívětivé uživatelské prostředí pro neúspěšné požadavky z důvodu nedostupnosti sítě, implementujte logiku v rámci komponent aplikace.</span><span class="sxs-lookup"><span data-stu-id="78637-210">If the app's Razor components rely on requesting data from backend APIs and you want to provide a friendly user experience for failed requests due to network unavailability, implement logic within the app's components.</span></span> <span data-ttu-id="78637-211">Můžete například použít `try/catch` kolem <xref:System.Net.Http.HttpClient> požadavků.</span><span class="sxs-lookup"><span data-stu-id="78637-211">For example, use `try/catch` around <xref:System.Net.Http.HttpClient> requests.</span></span>

### <a name="support-server-rendered-pages"></a><span data-ttu-id="78637-212">Server podpory – vykreslené stránky</span><span class="sxs-lookup"><span data-stu-id="78637-212">Support server-rendered pages</span></span>

<span data-ttu-id="78637-213">Zvažte, co se stane, když uživatel poprvé přejde na adresu URL, například `/counter` nebo na jiný přímý odkaz v aplikaci.</span><span class="sxs-lookup"><span data-stu-id="78637-213">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link in the app.</span></span> <span data-ttu-id="78637-214">V těchto případech nechcete vracet obsah uložený v mezipaměti jako `/counter` , ale místo toho musí prohlížeč načíst obsah uložený v mezipaměti jako `/index.html` při spuštění Blazor WebAssembly aplikace.</span><span class="sxs-lookup"><span data-stu-id="78637-214">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly app.</span></span> <span data-ttu-id="78637-215">Tyto počáteční požadavky se označují jako požadavky na *navigaci* , a to na rozdíl od:</span><span class="sxs-lookup"><span data-stu-id="78637-215">These initial requests are known as *navigation* requests, as opposed to:</span></span>

* <span data-ttu-id="78637-216">`subresource`požadavky na obrázky, šablony stylů nebo jiné soubory.</span><span class="sxs-lookup"><span data-stu-id="78637-216">`subresource` requests for images, stylesheets, or other files.</span></span>
* <span data-ttu-id="78637-217">`fetch/XHR`požadavky na data rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="78637-217">`fetch/XHR` requests for API data.</span></span>

<span data-ttu-id="78637-218">Výchozí pracovní proces služby obsahuje zvláštní případovou logiku pro požadavky na navigaci.</span><span class="sxs-lookup"><span data-stu-id="78637-218">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="78637-219">Pracovník služby tyto požadavky vyřeší tak, že vrátí obsah uložený v mezipaměti pro `/index.html` , bez ohledu na požadovanou adresu URL.</span><span class="sxs-lookup"><span data-stu-id="78637-219">The service worker resolves the requests by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="78637-220">Tato logika je implementována ve `onFetch` funkci v rámci `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="78637-220">This logic is implemented in the `onFetch` function inside `service-worker.published.js`.</span></span>

<span data-ttu-id="78637-221">Pokud má vaše aplikace určité adresy URL, které musí vracet Server HTML vykreslený serverem, a neobsluhuje `/index.html` z mezipaměti, pak je potřeba upravit logiku pracovního procesu služby.</span><span class="sxs-lookup"><span data-stu-id="78637-221">If your app has certain URLs that must return server-rendered HTML, and not serve `/index.html` from the cache, then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="78637-222">Pokud všechny adresy URL obsahující `/Identity/` musí být zpracovávány jako běžné požadavky pouze online na server, pak změňte `service-worker.published.js` `onFetch` logiku.</span><span class="sxs-lookup"><span data-stu-id="78637-222">If all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify `service-worker.published.js` `onFetch` logic.</span></span> <span data-ttu-id="78637-223">Vyhledejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="78637-223">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="78637-224">Změňte kód následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="78637-224">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
    && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="78637-225">Pokud to neuděláte, nezávisle na připojení k síti zachytí pracovník služby požadavky na takové adresy URL a vyřeší je pomocí `/index.html` .</span><span class="sxs-lookup"><span data-stu-id="78637-225">If you don't do this, then regardless of network connectivity, the service worker intercepts requests for such URLs and resolves them using `/index.html`.</span></span>

### <a name="control-asset-caching"></a><span data-ttu-id="78637-226">Ukládání prostředků do mezipaměti ovládacích prvků</span><span class="sxs-lookup"><span data-stu-id="78637-226">Control asset caching</span></span>

<span data-ttu-id="78637-227">Pokud projekt definuje `ServiceWorkerAssetsManifest` vlastnost MSBuild, Blazor Nástroj pro vytváření vytvoří manifest assetů pracovního procesu služby se zadaným názvem.</span><span class="sxs-lookup"><span data-stu-id="78637-227">If your project defines the `ServiceWorkerAssetsManifest` MSBuild property, Blazor's build tooling generates a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="78637-228">Výchozí šablona PWA vytvoří soubor projektu obsahující následující vlastnost:</span><span class="sxs-lookup"><span data-stu-id="78637-228">The default PWA template produces a project file containing the following property:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="78637-229">Soubor je umístěn do `wwwroot` výstupního adresáře, takže prohlížeč může tento soubor načíst tak, že si vyžádá `/service-worker-assets.js` .</span><span class="sxs-lookup"><span data-stu-id="78637-229">The file is placed in the `wwwroot` output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="78637-230">Chcete-li zobrazit obsah tohoto souboru, otevřete `/bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js` v textovém editoru.</span><span class="sxs-lookup"><span data-stu-id="78637-230">To see the contents of this file, open `/bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js` in a text editor.</span></span> <span data-ttu-id="78637-231">Neupravujte ale soubor, protože se znovu vygeneroval u každého sestavení.</span><span class="sxs-lookup"><span data-stu-id="78637-231">However, don't edit the file, as it's regenerated on each build.</span></span>

<span data-ttu-id="78637-232">Ve výchozím nastavení tento manifest uvádí:</span><span class="sxs-lookup"><span data-stu-id="78637-232">By default, this manifest lists:</span></span>

* <span data-ttu-id="78637-233">Všechny Blazor prostředky spravované jako sestavení .NET a běhové soubory .NET WebAssembly vyžadované pro funkci offline.</span><span class="sxs-lookup"><span data-stu-id="78637-233">Any Blazor-managed resources, such as .NET assemblies and the .NET WebAssembly runtime files required to function offline.</span></span>
* <span data-ttu-id="78637-234">Všechny prostředky pro publikování v `wwwroot` adresáři aplikace, jako jsou obrázky, šablony stylů a soubory JavaScriptu, včetně statických webových prostředků poskytovaných externími projekty a balíčky NuGet.</span><span class="sxs-lookup"><span data-stu-id="78637-234">All resources for publishing to the app's `wwwroot` directory, such as images, stylesheets, and JavaScript files, including static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="78637-235">Úpravou logiky v nástroji můžete řídit, které z těchto prostředků jsou načteny a ukládány do mezipaměti pracovním procesem služby `onInstall` `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="78637-235">You can control which of these resources are fetched and cached by the service worker by editing the logic in `onInstall` in `service-worker.published.js`.</span></span> <span data-ttu-id="78637-236">Ve výchozím nastavení pracovní proces služby načítá a ukládá do mezipaměti soubory, které odpovídají typickým příponám názvů webových souborů, jako jsou `.html` ,, `.css` `.js` a a navíc `.wasm` typy souborů specifické pro Blazor WebAssembly ( `.dll` , `.pdb` ).</span><span class="sxs-lookup"><span data-stu-id="78637-236">By default, the service worker fetches and caches files matching typical web filename extensions such as `.html`, `.css`, `.js`, and `.wasm`, plus file types specific to Blazor WebAssembly (`.dll`, `.pdb`).</span></span>

<span data-ttu-id="78637-237">Chcete-li zahrnout další prostředky, které nejsou přítomny v `wwwroot` adresáři aplikace, definujte další `ItemGroup` položky MSBuild, jak je znázorněno v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="78637-237">To include additional resources that aren't present in the app's `wwwroot` directory, define extra MSBuild `ItemGroup` entries, as shown in the following example:</span></span>

```xml
<ItemGroup>
  <ServiceWorkerAssetsManifestItem Include="MyDirectory\AnotherFile.json"
    RelativePath="MyDirectory\AnotherFile.json" AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="78637-238">`AssetUrl`Metadata určují základní relativní adresu URL, kterou by měl prohlížeč použít při načítání prostředku do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="78637-238">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="78637-239">To může být nezávislé na původním názvu zdrojového souboru na disku.</span><span class="sxs-lookup"><span data-stu-id="78637-239">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="78637-240">Přidání `ServiceWorkerAssetsManifestItem` souboru nezpůsobí, že se soubor zveřejní v adresáři aplikace `wwwroot` .</span><span class="sxs-lookup"><span data-stu-id="78637-240">Adding a `ServiceWorkerAssetsManifestItem` doesn't cause the file to be published in the app's `wwwroot` directory.</span></span> <span data-ttu-id="78637-241">Výstup publikování musí být řízen samostatně.</span><span class="sxs-lookup"><span data-stu-id="78637-241">The publish output must be controlled separately.</span></span> <span data-ttu-id="78637-242">V `ServiceWorkerAssetsManifestItem` manifestu Asset Service Worker se zobrazí další položka.</span><span class="sxs-lookup"><span data-stu-id="78637-242">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="78637-243">Nabízená oznámení</span><span class="sxs-lookup"><span data-stu-id="78637-243">Push notifications</span></span>

<span data-ttu-id="78637-244">Stejně jako jakékoli jiné PWA Blazor WebAssembly může aplikace PWA přijímat nabízená oznámení ze serveru back-end.</span><span class="sxs-lookup"><span data-stu-id="78637-244">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="78637-245">Server může odesílat nabízená oznámení kdykoli, i když uživatel tuto aplikaci aktivně nepoužívá.</span><span class="sxs-lookup"><span data-stu-id="78637-245">The server can send push notifications at any time, even when the user isn't actively using the app.</span></span> <span data-ttu-id="78637-246">Nabízená oznámení lze například odeslat, když jiný uživatel provede příslušnou akci.</span><span class="sxs-lookup"><span data-stu-id="78637-246">For example, push notifications can be sent when a different user performs a relevant action.</span></span>

<span data-ttu-id="78637-247">Mechanismus pro odeslání nabízeného oznámení je zcela nezávislý na Blazor WebAssembly , protože ho implementuje back-end Server, který může používat jakoukoli technologii.</span><span class="sxs-lookup"><span data-stu-id="78637-247">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="78637-248">Pokud chcete zasílat nabízená oznámení ze serveru ASP.NET Core, zvažte [použití techniky, která je podobná metodě pořízené v neuvěřitelně Pizza Workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="78637-248">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to the approach taken in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="78637-249">Mechanismus pro příjem a zobrazování nabízených oznámení na klientovi je nezávislý na Blazor WebAssembly , protože je implementovaný v souboru JavaScriptu pracovníka služby.</span><span class="sxs-lookup"><span data-stu-id="78637-249">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker JavaScript file.</span></span> <span data-ttu-id="78637-250">Příklad najdete v tématu [přístup k použití v neuvěřitelně Pizza Workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="78637-250">For an example, see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="78637-251">Upozornění pro offline PWAs</span><span class="sxs-lookup"><span data-stu-id="78637-251">Caveats for offline PWAs</span></span>

<span data-ttu-id="78637-252">Ne všechny aplikace by se měly pokusit o podporu offline použití.</span><span class="sxs-lookup"><span data-stu-id="78637-252">Not all apps should attempt to support offline use.</span></span> <span data-ttu-id="78637-253">Podpora offline přináší značnou složitost, ale ne vždycky důležitá pro případy použití, které se vyžadují.</span><span class="sxs-lookup"><span data-stu-id="78637-253">Offline support adds significant complexity, while not always being relevant for the use cases required.</span></span>

<span data-ttu-id="78637-254">Podpora offline je obvykle relevantní pouze:</span><span class="sxs-lookup"><span data-stu-id="78637-254">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="78637-255">Pokud je primární úložiště dat místní pro prohlížeč.</span><span class="sxs-lookup"><span data-stu-id="78637-255">If the primary data store is local to the browser.</span></span> <span data-ttu-id="78637-256">Například přístup je relevantní v aplikaci s uživatelským rozhraním pro zařízení [IoT](https://en.wikipedia.org/wiki/Internet_of_things) , které ukládá data do `localStorage` nebo [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="78637-256">For example, the approach is relevant in an app with a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>
* <span data-ttu-id="78637-257">Pokud aplikace provede značnou práci, která načte a uloží data rozhraní API back-endu relevantní pro každého uživatele, aby mohli přecházet mezi daty v režimu offline.</span><span class="sxs-lookup"><span data-stu-id="78637-257">If the app performs a significant amount of work to fetch and cache the backend API data relevant to each user so that they can navigate through the data offline.</span></span> <span data-ttu-id="78637-258">Pokud je nutné, aby aplikace podporovala úpravy, je nutné sestavit systém pro sledování změn a synchronizaci dat s back-endu.</span><span class="sxs-lookup"><span data-stu-id="78637-258">If the app must support editing, a system for tracking changes and synchronizing data with the backend must be built.</span></span>
* <span data-ttu-id="78637-259">Pokud cílem je zaručit, že se aplikace načte hned bez ohledu na stav sítě.</span><span class="sxs-lookup"><span data-stu-id="78637-259">If the goal is to guarantee that the app loads immediately regardless of network conditions.</span></span> <span data-ttu-id="78637-260">Implementujte vhodné uživatelské prostředí kolem požadavků back-end rozhraní API, abyste zobrazili průběh požadavků a pracovali se řádným, když požadavky selžou kvůli nedostupnosti sítě.</span><span class="sxs-lookup"><span data-stu-id="78637-260">Implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when requests fail due to network unavailability.</span></span>

<span data-ttu-id="78637-261">Kromě toho musí PWAs s podporou offline řešit řadu dalších komplikací.</span><span class="sxs-lookup"><span data-stu-id="78637-261">Additionally, offline-capable PWAs must deal with a range of additional complications.</span></span> <span data-ttu-id="78637-262">Vývojáři by se měli pečlivě seznámit s upozorněními v následujících oddílech.</span><span class="sxs-lookup"><span data-stu-id="78637-262">Developers should carefully familiarize themselves with the caveats in the following sections.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="78637-263">Podpora offline pouze v případě publikování</span><span class="sxs-lookup"><span data-stu-id="78637-263">Offline support only when published</span></span>

<span data-ttu-id="78637-264">Během vývoje obvykle chcete zobrazit každou změnu, která se odrazí v prohlížeči, aniž byste museli procházet proces aktualizace na pozadí.</span><span class="sxs-lookup"><span data-stu-id="78637-264">During development you typically want to see each change reflected immediately in the browser without going through a background update process.</span></span> <span data-ttu-id="78637-265">Proto Blazor Šablona PWA povolí podporu offline pouze v případě, že je publikovaná.</span><span class="sxs-lookup"><span data-stu-id="78637-265">Therefore, Blazor's PWA template enables offline support only when published.</span></span>

<span data-ttu-id="78637-266">Při sestavování aplikace podporující offline není dostatečné testování aplikace ve vývojovém prostředí.</span><span class="sxs-lookup"><span data-stu-id="78637-266">When building an offline-capable app, it's not enough to test the app in the Development environment.</span></span> <span data-ttu-id="78637-267">Aby bylo možné pochopit, jak reaguje na různé síťové podmínky, musíte aplikaci otestovat v jejím publikovaném stavu.</span><span class="sxs-lookup"><span data-stu-id="78637-267">You must test the app in its published state to understand how it responds to different network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="78637-268">Dokončení aktualizace po navigaci uživatele z aplikace</span><span class="sxs-lookup"><span data-stu-id="78637-268">Update completion after user navigation away from app</span></span>

<span data-ttu-id="78637-269">Aktualizace se nedokončí, dokud uživatel nepřejde z aplikace na všech kartách.</span><span class="sxs-lookup"><span data-stu-id="78637-269">Updates don't complete until the user has navigated away from the app in all tabs.</span></span> <span data-ttu-id="78637-270">Jak je vysvětleno v části [aktualizace na pozadí](#background-updates) , po nasazení aktualizace do aplikace Prohlížeč načte aktualizované pracovní soubory služby pro zahájení procesu aktualizace.</span><span class="sxs-lookup"><span data-stu-id="78637-270">As explained in the [Background updates](#background-updates) section, after you deploy an update to the app, the browser fetches the updated service worker files to begin the update process.</span></span>

<span data-ttu-id="78637-271">Co překvapením mnoho vývojářů, i když se tato aktualizace dokončí, **neprojeví** se, dokud uživatel nepřejde na všechny karty.</span><span class="sxs-lookup"><span data-stu-id="78637-271">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="78637-272">**Není dostačující aktualizovat** kartu, která aplikaci zobrazuje, i v případě, že se jedná o jedinou kartu, na které se aplikace zobrazuje.</span><span class="sxs-lookup"><span data-stu-id="78637-272">It is **not** sufficient to refresh the tab displaying the app, even if it's the only tab displaying the app.</span></span> <span data-ttu-id="78637-273">Dokud nebude vaše aplikace zcela uzavřená, nový pracovní proces služby zůstane ve stavu *čekání na aktivaci* .</span><span class="sxs-lookup"><span data-stu-id="78637-273">Until your app is completely closed, the new service worker remains in the *waiting to activate* status.</span></span> <span data-ttu-id="78637-274">**Tato funkce není specifická pro Blazor , ale je spíše standardní chování webové platformy.**</span><span class="sxs-lookup"><span data-stu-id="78637-274">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="78637-275">To běžně vydává problémy vývojářům, kteří se pokoušejí testovat aktualizace pro pracovní pracovníky služby nebo offline prostředky v mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="78637-275">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="78637-276">Pokud se do vývojářských nástrojů v prohlížeči pokusíte vrátit se změnami, může se zobrazit něco jako v následujících případech:</span><span class="sxs-lookup"><span data-stu-id="78637-276">If you check in the browser's developer tools, you may see something like the following:</span></span>

![Karta aplikace Google Chrome zobrazuje, že pracovní proces služby aplikace čeká na aktivaci.](progressive-web-app/_static/image7.png)

<span data-ttu-id="78637-278">Pokud seznam "klienti", které jsou na kartách nebo ve Windows, který zobrazuje vaši aplikaci, není prázdný, pracovní proces pokračuje v čekání.</span><span class="sxs-lookup"><span data-stu-id="78637-278">For as long as the list of "clients," which are tabs or windows displaying your app, is nonempty, the worker continues waiting.</span></span> <span data-ttu-id="78637-279">Důvodem je, že pracovníci služby mají zaručenou konzistenci.</span><span class="sxs-lookup"><span data-stu-id="78637-279">The reason service workers do this is to guarantee consistency.</span></span> <span data-ttu-id="78637-280">Konzistence znamená, že všechny prostředky jsou načteny ze stejné atomické mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="78637-280">Consistency means that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="78637-281">Při testování se může stát, že kliknete na odkaz "skipWaiting", jak je znázorněno na předchozím snímku obrazovky, a pak znovu načíst stránku.</span><span class="sxs-lookup"><span data-stu-id="78637-281">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the preceding screenshot, then reload the page.</span></span> <span data-ttu-id="78637-282">Tuto akci můžete automatizovat pro všechny uživatele pomocí kódování pracovního procesu služby, který [přeskočí fázi čekání a okamžitě aktivuje při aktualizaci](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="78637-282">You can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="78637-283">Pokud přeskočíte čekací fázi, zajistíte tím záruku, že se prostředky vždy načítají konzistentně ze stejné instance mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="78637-283">If you skip the waiting phase, you're giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="78637-284">Uživatelé můžou spouštět všechny historické verze aplikace.</span><span class="sxs-lookup"><span data-stu-id="78637-284">Users may run any historical version of the app</span></span>

<span data-ttu-id="78637-285">Vývojáři na webu většinou očekávají, že uživatelé spouštějí jenom nejnovější nasazenou verzi své webové aplikace, protože to je v tradičním modelu pro distribuci webů normální.</span><span class="sxs-lookup"><span data-stu-id="78637-285">Web developers habitually expect that users only run the latest deployed version of their web app, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="78637-286">Ale offline první aplikace PWA je podobají na nativní mobilní aplikaci, kde uživatelé nemusí nutně používat nejnovější verzi.</span><span class="sxs-lookup"><span data-stu-id="78637-286">However, an offline-first PWA is more akin to a native mobile app, where users aren't necessarily running the latest version.</span></span>

<span data-ttu-id="78637-287">Jak je vysvětleno v části [aktualizace na pozadí](#background-updates) , poté, co nasadíte aktualizaci do vaší aplikace, **bude mít každý stávající uživatel nadále k dispozici předchozí verzi pro alespoň jednu další návštěvu** , protože tato aktualizace probíhá na pozadí a není aktivována, dokud uživatel nepřejde pryč.</span><span class="sxs-lookup"><span data-stu-id="78637-287">As explained in the [Background updates](#background-updates) section, after you deploy an update to your app, **each existing user continues to use a previous version for at least one further visit** because the update occurs in the background and isn't activated until the user thereafter navigates away.</span></span> <span data-ttu-id="78637-288">Předchozí používaná verze navíc nemusí nutně odpovídat předchozí verzi, kterou jste nasadili.</span><span class="sxs-lookup"><span data-stu-id="78637-288">Plus, the previous version being used isn't necessarily the previous one you deployed.</span></span> <span data-ttu-id="78637-289">Předchozí verze může být *libovolná* historická verze v závislosti na tom, kdy uživatel poslední aktualizaci dokončil.</span><span class="sxs-lookup"><span data-stu-id="78637-289">The previous version can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="78637-290">To může být problém, pokud části front-end a back-end aplikace v aplikaci vyžadují smlouvu o schématu pro požadavky rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="78637-290">This can be an issue if the frontend and backend parts of your app require agreement about the schema for API requests.</span></span> <span data-ttu-id="78637-291">Nekompatibilní změny schématu rozhraní API není nutné nasazovat, dokud nebudete mít jistotu, že všichni uživatelé byli upgradováni.</span><span class="sxs-lookup"><span data-stu-id="78637-291">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded.</span></span> <span data-ttu-id="78637-292">Případně můžete uživatelům zabránit v používání nekompatibilních starších verzí aplikace.</span><span class="sxs-lookup"><span data-stu-id="78637-292">Alternatively, block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="78637-293">Tento požadavek na scénář je stejný jako u nativních mobilních aplikací.</span><span class="sxs-lookup"><span data-stu-id="78637-293">This scenario requirement is the same as for native mobile apps.</span></span> <span data-ttu-id="78637-294">Pokud nasadíte zásadní změnu v rozhraních API serveru, klientská aplikace se pro uživatele, kteří ještě neaktualizovali, přeruší.</span><span class="sxs-lookup"><span data-stu-id="78637-294">If you deploy a breaking change in server APIs, the client app is broken for users who haven't yet updated.</span></span>

<span data-ttu-id="78637-295">Pokud je to možné, nesaďte nenasazené změny rozhraní API back-endu.</span><span class="sxs-lookup"><span data-stu-id="78637-295">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="78637-296">Pokud to musíte udělat, zvažte použití [rozhraní API pro standardní službu Service Worker](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) , jako je například ServiceWorkerRegistration, k určení, jestli je aplikace aktuální, a pokud ne, abyste zabránili použití.</span><span class="sxs-lookup"><span data-stu-id="78637-296">If you must do so, consider using [standard Service Worker APIs such as ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the app is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="78637-297">Rušení se stránkami vykreslenými serverem</span><span class="sxs-lookup"><span data-stu-id="78637-297">Interference with server-rendered pages</span></span>

<span data-ttu-id="78637-298">Jak je popsáno v části [vygenerované stránky serveru podpory](#support-server-rendered-pages) , pokud chcete obejít chování pracovního procesu služby `/index.html` při vracení obsahu pro všechny požadavky na navigaci, upravte logiku pracovního procesu služby.</span><span class="sxs-lookup"><span data-stu-id="78637-298">As described in the [Support server-rendered pages](#support-server-rendered-pages) section, if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="78637-299">Ve výchozím nastavení se veškerý obsah manifestu Asset Service Worker ukládá do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="78637-299">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="78637-300">Jak je popsáno v části [ukládání prostředků do mezipaměti](#control-asset-caching) , soubor `service-worker-assets.js` se vygeneruje během sestavování a zobrazí všechny prostředky, které musí pracovní proces služby načíst a Uložit do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="78637-300">As described in the [Control asset caching](#control-asset-caching) section, the file `service-worker-assets.js` is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="78637-301">Vzhledem k tomu, že tento seznam ve výchozím nastavení zahrnuje všechno, co se vygenerovalo `wwwroot` , včetně obsahu dodaných externími balíčky a projekty, je potřeba, abyste měli pozor, abyste do něj neumístili moc</span><span class="sxs-lookup"><span data-stu-id="78637-301">Since this list by default includes everything emitted to `wwwroot`, including content supplied by external packages and projects, you must be careful not to put too much content there.</span></span> <span data-ttu-id="78637-302">Pokud `wwwroot` adresář obsahuje miliony imagí, pracovní proces se pokusí je načíst a Uložit do mezipaměti, což spotřebovává nadměrné šířky pásma a pravděpodobně se neúspěšně dokončuje.</span><span class="sxs-lookup"><span data-stu-id="78637-302">If the `wwwroot` directory contains millions of images, the service worker tries to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="78637-303">Implementujte libovolnou logiku pro řízení, která podmnožina obsahu manifestu by měla být načtena a ukládána do mezipaměti úpravou `onInstall` funkce v `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="78637-303">Implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in `service-worker.published.js`.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="78637-304">Interakce s ověřováním</span><span class="sxs-lookup"><span data-stu-id="78637-304">Interaction with authentication</span></span>

<span data-ttu-id="78637-305">Šablonu aplikace PWA lze použít ve spojení s ověřováním.</span><span class="sxs-lookup"><span data-stu-id="78637-305">The PWA template can be used in conjunction with authentication.</span></span> <span data-ttu-id="78637-306">Aplikace PWA v režimu offline může podporovat ověřování i v případě, že uživatel má počáteční připojení k síti.</span><span class="sxs-lookup"><span data-stu-id="78637-306">An offline-capable PWA can also support authentication when the user has initial network connectivity.</span></span>

<span data-ttu-id="78637-307">Pokud uživatel nemá připojení k síti, nemůže ověřit ani získat přístupové tokeny.</span><span class="sxs-lookup"><span data-stu-id="78637-307">When a user doesn't have network connectivity, they can't authenticate or obtain access tokens.</span></span> <span data-ttu-id="78637-308">Ve výchozím nastavení se při pokusu o návštěvě přihlašovací stránky bez přístupu k síti zobrazí zpráva "Chyba sítě".</span><span class="sxs-lookup"><span data-stu-id="78637-308">By default, attempting to visit the login page without network access results in a "network error" message.</span></span> <span data-ttu-id="78637-309">Je třeba navrhnout tok uživatelského rozhraní, který uživateli umožňuje provádět užitečné úkoly v režimu offline bez pokusu o ověření uživatele nebo získání přístupových tokenů.</span><span class="sxs-lookup"><span data-stu-id="78637-309">You must design a UI flow that allows the user perform useful tasks while offline without attempting to authenticate the user or obtain access tokens.</span></span> <span data-ttu-id="78637-310">Alternativně můžete aplikaci navrhnout tak, aby se řádně nezdařila, když síť není dostupná.</span><span class="sxs-lookup"><span data-stu-id="78637-310">Alternatively, you can design the app to gracefully fail when the network isn't available.</span></span> <span data-ttu-id="78637-311">Pokud aplikaci nemůžete navrženou pro zpracování těchto scénářů, možná nebudete chtít povolit podporu offline.</span><span class="sxs-lookup"><span data-stu-id="78637-311">If the app can't be designed to handle these scenarios, you might not want to enable offline support.</span></span>

<span data-ttu-id="78637-312">Když je aplikace, která je navržená pro online nebo offline použití, znovu online:</span><span class="sxs-lookup"><span data-stu-id="78637-312">When an app that's designed for online and offline use is online again:</span></span>

* <span data-ttu-id="78637-313">Aplikace může vyžadovat zřízení nového přístupového tokenu.</span><span class="sxs-lookup"><span data-stu-id="78637-313">The app might need to provision a new access token.</span></span>
* <span data-ttu-id="78637-314">Aplikace musí zjistit, jestli je jiný uživatel přihlášený ke službě, aby mohl uplatnit operace na účet uživatele, který byl proveden v režimu offline.</span><span class="sxs-lookup"><span data-stu-id="78637-314">The app must detect if a different user is signed into the service so that it can apply operations to the user's account that were made while they were offline.</span></span>

<span data-ttu-id="78637-315">Vytvoření offline aplikace PWA, která komunikuje s ověřováním:</span><span class="sxs-lookup"><span data-stu-id="78637-315">To create an offline PWA app that interacts with authentication:</span></span>

* <span data-ttu-id="78637-316">Nahraďte <xref:Microsoft.AspNetCore.Components.WebAssembly.Authentication.AccountClaimsPrincipalFactory%601> objekt factory, který ukládá posledního přihlášeného uživatele, a použije uloženého uživatele, když je aplikace offline.</span><span class="sxs-lookup"><span data-stu-id="78637-316">Replace the <xref:Microsoft.AspNetCore.Components.WebAssembly.Authentication.AccountClaimsPrincipalFactory%601> with a factory that stores the last signed-in user and uses the stored user when the app is offline.</span></span>
* <span data-ttu-id="78637-317">Zařaďte operace do fronty, pokud je aplikace offline, a použijte je v případě, že se aplikace vrátí online.</span><span class="sxs-lookup"><span data-stu-id="78637-317">Queue operations while the app is offline and apply them when the app returns online.</span></span>
* <span data-ttu-id="78637-318">Při odhlášení vymazat uloženého uživatele.</span><span class="sxs-lookup"><span data-stu-id="78637-318">During sign out, clear the stored user.</span></span>

<span data-ttu-id="78637-319">[`CarChecker`](https://github.com/SteveSandersonMS/CarChecker)Ukázková aplikace předvádí předchozí přístupy.</span><span class="sxs-lookup"><span data-stu-id="78637-319">The [`CarChecker`](https://github.com/SteveSandersonMS/CarChecker) sample app demonstrates the the preceding approaches.</span></span> <span data-ttu-id="78637-320">Podívejte se na následující části aplikace:</span><span class="sxs-lookup"><span data-stu-id="78637-320">See the following parts of the app:</span></span>

* <span data-ttu-id="78637-321">`OfflineAccountClaimsPrincipalFactory` (`Client/Data/OfflineAccountClaimsPrincipalFactory.cs`)</span><span class="sxs-lookup"><span data-stu-id="78637-321">`OfflineAccountClaimsPrincipalFactory` (`Client/Data/OfflineAccountClaimsPrincipalFactory.cs`)</span></span>
* <span data-ttu-id="78637-322">`LocalVehiclesStore` (`Client/Data/LocalVehiclesStore.cs`)</span><span class="sxs-lookup"><span data-stu-id="78637-322">`LocalVehiclesStore` (`Client/Data/LocalVehiclesStore.cs`)</span></span>
* <span data-ttu-id="78637-323">`LoginStatus`součást ( `Client/Shared/LoginStatus.razor` )</span><span class="sxs-lookup"><span data-stu-id="78637-323">`LoginStatus` component (`Client/Shared/LoginStatus.razor`)</span></span>

## <a name="additional-resources"></a><span data-ttu-id="78637-324">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="78637-324">Additional resources</span></span>

* <span data-ttu-id="78637-325">[SignalRvyjednávání mezi zdroji pro ověřování](xref:blazor/fundamentals/additional-scenarios#signalr-cross-origin-negotiation-for-authentication)</span><span class="sxs-lookup"><span data-stu-id="78637-325">[SignalR cross-origin negotiation for authentication](xref:blazor/fundamentals/additional-scenarios#signalr-cross-origin-negotiation-for-authentication)</span></span>
