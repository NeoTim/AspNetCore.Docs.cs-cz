---
title: Razor Stránky s EF core v ASP.NET jádrem - CRUD - 2 z 8
author: rick-anderson
description: Ukazuje, jak vytvořit, číst, aktualizovat, odstranit pomocí EF Core.
ms.author: riande
ms.date: 07/22/2019
uid: data/ef-rp/crud
ms.openlocfilehash: 05519852fab22bd3ad5b77e3494b49191448286f
ms.sourcegitcommit: f7886fd2e219db9d7ce27b16c0dc5901e658d64e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/06/2020
ms.locfileid: "78665646"
---
# <a name="razor-pages-with-ef-core-in-aspnet-core---crud---2-of-8"></a><span data-ttu-id="54da0-103">Razor Stránky s EF core v ASP.NET jádrem - CRUD - 2 z 8</span><span class="sxs-lookup"><span data-stu-id="54da0-103">Razor Pages with EF Core in ASP.NET Core - CRUD - 2 of 8</span></span>

<span data-ttu-id="54da0-104">[Tom Dykstra](https://github.com/tdykstra), [Jon P Smith](https://twitter.com/thereformedprog), a Rick [Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="54da0-104">By [Tom Dykstra](https://github.com/tdykstra), [Jon P Smith](https://twitter.com/thereformedprog), and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

[!INCLUDE [about the series](~/includes/RP-EF/intro.md)]

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="54da0-105">V tomto kurzu je kód CRUD (vytvořit, číst, aktualizovat, odstranit) zkontrolován a přizpůsobit.</span><span class="sxs-lookup"><span data-stu-id="54da0-105">In this tutorial, the scaffolded CRUD (create, read, update, delete) code is reviewed and customized.</span></span>

## <a name="no-repository"></a><span data-ttu-id="54da0-106">Žádné úložiště</span><span class="sxs-lookup"><span data-stu-id="54da0-106">No repository</span></span>

<span data-ttu-id="54da0-107">Někteří vývojáři používají vrstvu služby nebo vzor úložiště k vytvoření vrstvy abstrakce mezi ujtou vrstvou (Razor Pages) a vrstvou přístupu k datům.</span><span class="sxs-lookup"><span data-stu-id="54da0-107">Some developers use a service layer or repository pattern to create an abstraction layer between the UI (Razor Pages) and the data access layer.</span></span> <span data-ttu-id="54da0-108">Tento výukový program to nedělá.</span><span class="sxs-lookup"><span data-stu-id="54da0-108">This tutorial doesn't do that.</span></span> <span data-ttu-id="54da0-109">Chcete-li minimalizovat složitost a udržet kurz zaměřený na EF Core, EF core kód je přidán přímo do tříd modelu stránky.</span><span class="sxs-lookup"><span data-stu-id="54da0-109">To minimize complexity and keep the tutorial focused on EF Core, EF Core code is added directly to the page model classes.</span></span> 

## <a name="update-the-details-page"></a><span data-ttu-id="54da0-110">Aktualizace stránky Podrobnosti</span><span class="sxs-lookup"><span data-stu-id="54da0-110">Update the Details page</span></span>

<span data-ttu-id="54da0-111">Kód scaffolded pro stránky Studenti neobsahuje data zápisu.</span><span class="sxs-lookup"><span data-stu-id="54da0-111">The scaffolded code for the Students pages doesn't include enrollment data.</span></span> <span data-ttu-id="54da0-112">V této části přidáte zápisy na stránku Podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="54da0-112">In this section, you add enrollments to the Details page.</span></span>

### <a name="read-enrollments"></a><span data-ttu-id="54da0-113">Čtení registrací</span><span class="sxs-lookup"><span data-stu-id="54da0-113">Read enrollments</span></span>

<span data-ttu-id="54da0-114">Chcete-li na stránce zobrazit údaje o zápisu studenta, musíte si je přečíst.</span><span class="sxs-lookup"><span data-stu-id="54da0-114">To display a student's enrollment data on the page, you need to read it.</span></span> <span data-ttu-id="54da0-115">Kód scaffolded v *Pages/Students/Details.cshtml.cs* čte pouze data studentů bez údajů o zápisu:</span><span class="sxs-lookup"><span data-stu-id="54da0-115">The scaffolded code in *Pages/Students/Details.cshtml.cs* reads only the Student data, without the Enrollment data:</span></span>

[!code-csharp[Main](intro/samples/cu30snapshots/2-crud/Pages/Students/Details1.cshtml.cs?name=snippet_OnGetAsync&highlight=8)]

<span data-ttu-id="54da0-116">Nahraďte metodu `OnGetAsync` následujícím kódem pro čtení dat zápisu pro vybraného studenta.</span><span class="sxs-lookup"><span data-stu-id="54da0-116">Replace the `OnGetAsync` method with the following code to read enrollment data for the selected student.</span></span> <span data-ttu-id="54da0-117">Změny jsou zvýrazněny.</span><span class="sxs-lookup"><span data-stu-id="54da0-117">The changes are highlighted.</span></span>

[!code-csharp[Main](intro/samples/cu30/Pages/Students/Details.cshtml.cs?name=snippet_OnGetAsync&highlight=8-12)]

<span data-ttu-id="54da0-118">[Include](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.include) a [ThenInclude](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.theninclude#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_ThenInclude__3_Microsoft_EntityFrameworkCore_Query_IIncludableQueryable___0_System_Collections_Generic_IEnumerable___1___System_Linq_Expressions_Expression_System_Func___1___2___) metody způsobit kontext `Student.Enrollments` načíst navigační vlastnost `Enrollment.Course` a v rámci každé registrace navigační vlastnost.</span><span class="sxs-lookup"><span data-stu-id="54da0-118">The [Include](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.include) and [ThenInclude](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.theninclude#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_ThenInclude__3_Microsoft_EntityFrameworkCore_Query_IIncludableQueryable___0_System_Collections_Generic_IEnumerable___1___System_Linq_Expressions_Expression_System_Func___1___2___) methods cause the context to load the `Student.Enrollments` navigation property, and within each enrollment the `Enrollment.Course` navigation property.</span></span> <span data-ttu-id="54da0-119">Tyto metody jsou podrobně zkoumány v kurzu [související čtení dat.](xref:data/ef-rp/read-related-data)</span><span class="sxs-lookup"><span data-stu-id="54da0-119">These methods are examined in detail in the [Reading related data](xref:data/ef-rp/read-related-data) tutorial.</span></span>

<span data-ttu-id="54da0-120">[AsNoTracking](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.asnotracking#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_AsNoTracking__1_System_Linq_IQueryable___0__) Metoda zlepšuje výkon ve scénářích, kde entity vrácené nejsou aktualizovány v aktuálním kontextu.</span><span class="sxs-lookup"><span data-stu-id="54da0-120">The [AsNoTracking](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.asnotracking#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_AsNoTracking__1_System_Linq_IQueryable___0__) method improves performance in scenarios where the entities returned are not updated in the current context.</span></span> <span data-ttu-id="54da0-121">`AsNoTracking`je popsána dále v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="54da0-121">`AsNoTracking` is discussed later in this tutorial.</span></span>

### <a name="display-enrollments"></a><span data-ttu-id="54da0-122">Zobrazit registrace</span><span class="sxs-lookup"><span data-stu-id="54da0-122">Display enrollments</span></span>

<span data-ttu-id="54da0-123">Nahraďte kód v *pages/students/details.cshtml* následujícím kódem, který zobrazí seznam registrací.</span><span class="sxs-lookup"><span data-stu-id="54da0-123">Replace the code in *Pages/Students/Details.cshtml* with the following code to display a list of enrollments.</span></span> <span data-ttu-id="54da0-124">Změny jsou zvýrazněny.</span><span class="sxs-lookup"><span data-stu-id="54da0-124">The changes are highlighted.</span></span>

[!code-cshtml[Main](intro/samples/cu30/Pages/Students/Details.cshtml?highlight=32-53)]

<span data-ttu-id="54da0-125">Předchozí kód smyčky prostřednictvím entit `Enrollments` v navigační vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="54da0-125">The preceding code loops through the entities in the `Enrollments` navigation property.</span></span> <span data-ttu-id="54da0-126">Pro každou registraci se zobrazí název kurzu a hodnocení.</span><span class="sxs-lookup"><span data-stu-id="54da0-126">For each enrollment, it displays the course title and the grade.</span></span> <span data-ttu-id="54da0-127">Název kurzu se načte z entity Kurz, `Course` která je uložena ve vlastnosti navigace entity Registrace.</span><span class="sxs-lookup"><span data-stu-id="54da0-127">The course title is retrieved from the Course entity that's stored in the `Course` navigation property of the Enrollments entity.</span></span>

<span data-ttu-id="54da0-128">Spusťte aplikaci, vyberte kartu **Studenti** a klikněte na odkaz **Podrobnosti** pro studenta.</span><span class="sxs-lookup"><span data-stu-id="54da0-128">Run the app, select the **Students** tab, and click the **Details** link for a student.</span></span> <span data-ttu-id="54da0-129">Zobrazí se seznam kurzů a hodnocení pro vybraného studenta.</span><span class="sxs-lookup"><span data-stu-id="54da0-129">The list of courses and grades for the selected student is displayed.</span></span>

### <a name="ways-to-read-one-entity"></a><span data-ttu-id="54da0-130">Způsoby čtení jedné entity</span><span class="sxs-lookup"><span data-stu-id="54da0-130">Ways to read one entity</span></span>

<span data-ttu-id="54da0-131">Generovaný kód používá [FirstOrDefaultAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.firstordefaultasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_FirstOrDefaultAsync__1_System_Linq_IQueryable___0__System_Threading_CancellationToken_) ke čtení jedné entity.</span><span class="sxs-lookup"><span data-stu-id="54da0-131">The generated code uses [FirstOrDefaultAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.firstordefaultasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_FirstOrDefaultAsync__1_System_Linq_IQueryable___0__System_Threading_CancellationToken_) to read one entity.</span></span> <span data-ttu-id="54da0-132">Tato metoda vrátí null, pokud není nic nalezeno; v opačném případě vrátí první nalezený řádek, který splňuje kritéria filtru dotazu.</span><span class="sxs-lookup"><span data-stu-id="54da0-132">This method returns null if nothing is found; otherwise, it returns the first row found that satisfies the query filter criteria.</span></span> <span data-ttu-id="54da0-133">`FirstOrDefaultAsync`je obecně lepší volbou než následující alternativy:</span><span class="sxs-lookup"><span data-stu-id="54da0-133">`FirstOrDefaultAsync` is generally a better choice than the following alternatives:</span></span>

* <span data-ttu-id="54da0-134">[SingleOrDefaultAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.singleordefaultasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_SingleOrDefaultAsync__1_System_Linq_IQueryable___0__System_Linq_Expressions_Expression_System_Func___0_System_Boolean___System_Threading_CancellationToken_) - vyvolá výjimku, pokud existuje více než jedna entita, která splňuje filtr dotazu.</span><span class="sxs-lookup"><span data-stu-id="54da0-134">[SingleOrDefaultAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.singleordefaultasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_SingleOrDefaultAsync__1_System_Linq_IQueryable___0__System_Linq_Expressions_Expression_System_Func___0_System_Boolean___System_Threading_CancellationToken_) - Throws an exception if there's more than one entity that satisfies the query filter.</span></span> <span data-ttu-id="54da0-135">Chcete-li zjistit, zda více než jeden `SingleOrDefaultAsync` řádek může být vrácena dotazem, pokusí se načíst více řádků.</span><span class="sxs-lookup"><span data-stu-id="54da0-135">To determine if more than one row could be returned by the query, `SingleOrDefaultAsync` tries to fetch multiple rows.</span></span> <span data-ttu-id="54da0-136">Tato práce navíc není nutná, pokud dotaz může vrátit pouze jednu entitu, jako při hledání na jedinečný klíč.</span><span class="sxs-lookup"><span data-stu-id="54da0-136">This extra work is unnecessary if the query can only return one entity, as when it searches on a unique key.</span></span>
* <span data-ttu-id="54da0-137">[FindAsync](/dotnet/api/microsoft.entityframeworkcore.dbcontext.findasync#Microsoft_EntityFrameworkCore_DbContext_FindAsync_System_Type_System_Object___) - Najde entitu s primárním klíčem (PK).</span><span class="sxs-lookup"><span data-stu-id="54da0-137">[FindAsync](/dotnet/api/microsoft.entityframeworkcore.dbcontext.findasync#Microsoft_EntityFrameworkCore_DbContext_FindAsync_System_Type_System_Object___) - Finds an entity with the primary key (PK).</span></span> <span data-ttu-id="54da0-138">Pokud entita s PK je sledována kontextem, je vrácena bez požadavku do databáze.</span><span class="sxs-lookup"><span data-stu-id="54da0-138">If an entity with the PK is being tracked by the context, it's returned without a request to the database.</span></span> <span data-ttu-id="54da0-139">Tato metoda je optimalizována pro vyhledat jednu `Include` `FindAsync`entitu, ale nelze volat s .</span><span class="sxs-lookup"><span data-stu-id="54da0-139">This method is optimized to look up a single entity, but you can't call `Include` with `FindAsync`.</span></span>  <span data-ttu-id="54da0-140">Takže pokud jsou zapotřebí související data, `FirstOrDefaultAsync` je lepší volbou.</span><span class="sxs-lookup"><span data-stu-id="54da0-140">So if related data is needed, `FirstOrDefaultAsync` is the better choice.</span></span>

### <a name="route-data-vs-query-string"></a><span data-ttu-id="54da0-141">Směrovat data vs. řetězec dotazu</span><span class="sxs-lookup"><span data-stu-id="54da0-141">Route data vs. query string</span></span>

<span data-ttu-id="54da0-142">Adresa URL stránky Podrobnosti je `https://localhost:<port>/Students/Details?id=1`.</span><span class="sxs-lookup"><span data-stu-id="54da0-142">The URL for the Details page is `https://localhost:<port>/Students/Details?id=1`.</span></span> <span data-ttu-id="54da0-143">Hodnota primárního klíče entity je v řetězci dotazu.</span><span class="sxs-lookup"><span data-stu-id="54da0-143">The entity's primary key value is in the query string.</span></span> <span data-ttu-id="54da0-144">Někteří vývojáři dávají přednost předání hodnoty `https://localhost:<port>/Students/Details/1`klíče v datech trasy: .</span><span class="sxs-lookup"><span data-stu-id="54da0-144">Some developers prefer to pass the key value in route data: `https://localhost:<port>/Students/Details/1`.</span></span> <span data-ttu-id="54da0-145">Další informace naleznete [v tématu Aktualizace generovaného kódu](xref:tutorials/razor-pages/da1#update-the-generated-code).</span><span class="sxs-lookup"><span data-stu-id="54da0-145">For more information, see [Update the generated code](xref:tutorials/razor-pages/da1#update-the-generated-code).</span></span>

## <a name="update-the-create-page"></a><span data-ttu-id="54da0-146">Aktualizace stránky Vytvořit</span><span class="sxs-lookup"><span data-stu-id="54da0-146">Update the Create page</span></span>

<span data-ttu-id="54da0-147">Kód scaffolded `OnPostAsync` pro vytvořit stránku je náchylný k [overpostování](#overposting).</span><span class="sxs-lookup"><span data-stu-id="54da0-147">The scaffolded `OnPostAsync` code for the Create page is vulnerable to [overposting](#overposting).</span></span> <span data-ttu-id="54da0-148">Nahraďte metodu `OnPostAsync` v *Pages/Students/Create.cshtml.cs* následujícím kódem.</span><span class="sxs-lookup"><span data-stu-id="54da0-148">Replace the `OnPostAsync` method in *Pages/Students/Create.cshtml.cs* with the following code.</span></span>

[!code-csharp[Main](intro/samples/cu30/Pages/Students/Create.cshtml.cs?name=snippet_OnPostAsync)]

<a name="TryUpdateModelAsync"></a>

### <a name="tryupdatemodelasync"></a><span data-ttu-id="54da0-149">TryUpdateModelAsync</span><span class="sxs-lookup"><span data-stu-id="54da0-149">TryUpdateModelAsync</span></span>

<span data-ttu-id="54da0-150">Předchozí kód vytvoří objekt Student a potom použije zaúčtovaná pole formuláře k aktualizaci vlastností objektu Student.</span><span class="sxs-lookup"><span data-stu-id="54da0-150">The preceding code creates a Student object and then uses posted form fields to update the Student object's properties.</span></span> <span data-ttu-id="54da0-151">Metoda [TryUpdateModelAsync:](/dotnet/api/microsoft.aspnetcore.mvc.controllerbase.tryupdatemodelasync#Microsoft_AspNetCore_Mvc_ControllerBase_TryUpdateModelAsync_System_Object_System_Type_System_String_)</span><span class="sxs-lookup"><span data-stu-id="54da0-151">The [TryUpdateModelAsync](/dotnet/api/microsoft.aspnetcore.mvc.controllerbase.tryupdatemodelasync#Microsoft_AspNetCore_Mvc_ControllerBase_TryUpdateModelAsync_System_Object_System_Type_System_String_) method:</span></span>

* <span data-ttu-id="54da0-152">Použije zaúčtované hodnoty formuláře z vlastnosti [PageContext](/dotnet/api/microsoft.aspnetcore.mvc.razorpages.pagemodel.pagecontext#Microsoft_AspNetCore_Mvc_RazorPages_PageModel_PageContext) v [modelu PageModel](/dotnet/api/microsoft.aspnetcore.mvc.razorpages.pagemodel).</span><span class="sxs-lookup"><span data-stu-id="54da0-152">Uses the posted form values from the [PageContext](/dotnet/api/microsoft.aspnetcore.mvc.razorpages.pagemodel.pagecontext#Microsoft_AspNetCore_Mvc_RazorPages_PageModel_PageContext) property in the [PageModel](/dotnet/api/microsoft.aspnetcore.mvc.razorpages.pagemodel).</span></span>
* <span data-ttu-id="54da0-153">Aktualizuje pouze uvedené`s => s.FirstMidName, s => s.LastName, s => s.EnrollmentDate`vlastnosti ( ).</span><span class="sxs-lookup"><span data-stu-id="54da0-153">Updates only the properties listed (`s => s.FirstMidName, s => s.LastName, s => s.EnrollmentDate`).</span></span>
* <span data-ttu-id="54da0-154">Vyhledá pole formuláře s předponou "student".</span><span class="sxs-lookup"><span data-stu-id="54da0-154">Looks for form fields with a "student" prefix.</span></span> <span data-ttu-id="54da0-155">Například, `Student.FirstMidName`.</span><span class="sxs-lookup"><span data-stu-id="54da0-155">For example, `Student.FirstMidName`.</span></span> <span data-ttu-id="54da0-156">Nerozlišuje se na malá a velká písmena.</span><span class="sxs-lookup"><span data-stu-id="54da0-156">It's not case sensitive.</span></span>
* <span data-ttu-id="54da0-157">Používá systém [vazby modelu](xref:mvc/models/model-binding) k převodu hodnot formuláře `Student` z řetězců na typy v modelu.</span><span class="sxs-lookup"><span data-stu-id="54da0-157">Uses the [model binding](xref:mvc/models/model-binding) system to convert form values from strings to the types in the `Student` model.</span></span> <span data-ttu-id="54da0-158">Například `EnrollmentDate` musí být převedenna DateTime.</span><span class="sxs-lookup"><span data-stu-id="54da0-158">For example, `EnrollmentDate` has to be converted to DateTime.</span></span>

<span data-ttu-id="54da0-159">Spusťte aplikaci a vytvořte studentskou entitu pro testování stránky Vytvořit.</span><span class="sxs-lookup"><span data-stu-id="54da0-159">Run the app, and create a student entity to test the Create page.</span></span>

## <a name="overposting"></a><span data-ttu-id="54da0-160">Přeúčtování</span><span class="sxs-lookup"><span data-stu-id="54da0-160">Overposting</span></span>

<span data-ttu-id="54da0-161">Použití `TryUpdateModel` k aktualizaci polí se zaúčtovaných hodnot je osvědčeným postupem zabezpečení, protože zabraňuje přeúčtování.</span><span class="sxs-lookup"><span data-stu-id="54da0-161">Using `TryUpdateModel` to update fields with posted values is a security best practice because it prevents overposting.</span></span> <span data-ttu-id="54da0-162">Předpokládejme například, že `Secret` entita Student obsahuje vlastnost, kterou by tato webová stránka neměla aktualizovat nebo přidat:</span><span class="sxs-lookup"><span data-stu-id="54da0-162">For example, suppose the Student entity includes a `Secret` property that this web page shouldn't update or add:</span></span>

[!code-csharp[Main](intro/samples/cu30snapshots/2-crud/Models/StudentZsecret.cs?name=snippet_Intro&highlight=7)]

<span data-ttu-id="54da0-163">I v případě, že `Secret` aplikace nemá pole na vytvoření nebo aktualizaci `Secret` Razor Page, hacker může nastavit hodnotu overpostování.</span><span class="sxs-lookup"><span data-stu-id="54da0-163">Even if the app doesn't have a `Secret` field on the create or update Razor Page, a hacker could set the `Secret` value by overposting.</span></span> <span data-ttu-id="54da0-164">Hacker by mohl použít nástroj, jako je Fiddler, nebo `Secret` napsat nějaký JavaScript, k odeslání hodnoty formuláře.</span><span class="sxs-lookup"><span data-stu-id="54da0-164">A hacker could use a tool such as Fiddler, or write some JavaScript, to post a `Secret` form value.</span></span> <span data-ttu-id="54da0-165">Původní kód neomezuje pole, která pořadač modelu používá při vytváření instance Student.</span><span class="sxs-lookup"><span data-stu-id="54da0-165">The original code doesn't limit the fields that the model binder uses when it creates a Student instance.</span></span>

<span data-ttu-id="54da0-166">Jakákoli hodnota, kterou `Secret` hacker zadal pro pole formuláře, je v databázi aktualizována.</span><span class="sxs-lookup"><span data-stu-id="54da0-166">Whatever value the hacker specified for the `Secret` form field is updated in the database.</span></span> <span data-ttu-id="54da0-167">Následující obrázek znázorňuje nástroj `Secret` Šumař, který přidává pole (s hodnotou "OverPost") k zaúčtovanéhodnotě formuláře.</span><span class="sxs-lookup"><span data-stu-id="54da0-167">The following image shows the Fiddler tool adding the `Secret` field (with the value "OverPost") to the posted form values.</span></span>

![Fiddler přidání tajné pole](../ef-mvc/crud/_static/fiddler.png)

<span data-ttu-id="54da0-169">Hodnota OverPost je úspěšně přidána `Secret` do vlastnosti vloženého řádku.</span><span class="sxs-lookup"><span data-stu-id="54da0-169">The value "OverPost" is successfully added to the `Secret` property of the inserted row.</span></span> <span data-ttu-id="54da0-170">To se stane, i když `Secret` návrhář aplikace nikdy nezamýšlel vlastnost nastavit pomocí vytvořit stránku.</span><span class="sxs-lookup"><span data-stu-id="54da0-170">That happens even though the app designer never intended the `Secret` property to be set with the Create page.</span></span>

### <a name="view-model"></a><span data-ttu-id="54da0-171">Zobrazit model</span><span class="sxs-lookup"><span data-stu-id="54da0-171">View model</span></span>

<span data-ttu-id="54da0-172">Zobrazit modely poskytují alternativní způsob, jak zabránit overpostování.</span><span class="sxs-lookup"><span data-stu-id="54da0-172">View models provide an alternative way to prevent overposting.</span></span>

<span data-ttu-id="54da0-173">Aplikační model se často nazývá model domény.</span><span class="sxs-lookup"><span data-stu-id="54da0-173">The application model is often called the domain model.</span></span> <span data-ttu-id="54da0-174">Model domény obvykle obsahuje všechny vlastnosti vyžadované odpovídající entitou v databázi.</span><span class="sxs-lookup"><span data-stu-id="54da0-174">The domain model typically contains all the properties required by the corresponding entity in the database.</span></span> <span data-ttu-id="54da0-175">Model zobrazení obsahuje pouze vlastnosti potřebné pro rozhraní, pro které se používá (například vytvořit stránku).</span><span class="sxs-lookup"><span data-stu-id="54da0-175">The view model contains only the properties needed for the UI that it is used for (for example, the Create page).</span></span>

<span data-ttu-id="54da0-176">Kromě modelu zobrazení některé aplikace používají model vazby nebo vstupní model k předání dat mezi třídou modelu stránky Razor Pages a prohlížečem.</span><span class="sxs-lookup"><span data-stu-id="54da0-176">In addition to the view model, some apps use a binding model or input model to pass data between the Razor Pages page model class and the browser.</span></span> 

<span data-ttu-id="54da0-177">Zvažte `Student` následující model zobrazení:</span><span class="sxs-lookup"><span data-stu-id="54da0-177">Consider the following `Student` view model:</span></span>

[!code-csharp[Main](intro/samples/cu30snapshots/2-crud/Models/StudentVM.cs)]

<span data-ttu-id="54da0-178">Následující kód používá `StudentVM` model zobrazení k vytvoření nového studenta:</span><span class="sxs-lookup"><span data-stu-id="54da0-178">The following code uses the `StudentVM` view model to create a new student:</span></span>

[!code-csharp[Main](intro/samples/cu30snapshots/2-crud/Pages/Students/CreateVM.cshtml.cs?name=snippet_OnPostAsync)]

<span data-ttu-id="54da0-179">Metoda [SetValues](/dotnet/api/microsoft.entityframeworkcore.changetracking.propertyvalues.setvalues#Microsoft_EntityFrameworkCore_ChangeTracking_PropertyValues_SetValues_System_Object_) nastaví hodnoty tohoto objektu čtením hodnot z jiného objektu [PropertyValues.](/dotnet/api/microsoft.entityframeworkcore.changetracking.propertyvalues)</span><span class="sxs-lookup"><span data-stu-id="54da0-179">The [SetValues](/dotnet/api/microsoft.entityframeworkcore.changetracking.propertyvalues.setvalues#Microsoft_EntityFrameworkCore_ChangeTracking_PropertyValues_SetValues_System_Object_) method sets the values of this object by reading values from another [PropertyValues](/dotnet/api/microsoft.entityframeworkcore.changetracking.propertyvalues) object.</span></span> <span data-ttu-id="54da0-180">`SetValues`používá odpovídající název vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="54da0-180">`SetValues` uses property name matching.</span></span> <span data-ttu-id="54da0-181">Typ modelu zobrazení nemusí souviset s typem modelu, musí mít pouze vlastnosti, které odpovídají.</span><span class="sxs-lookup"><span data-stu-id="54da0-181">The view model type doesn't need to be related to the model type, it just needs to have properties that match.</span></span>

<span data-ttu-id="54da0-182">Použití `StudentVM` vyžaduje [Create.cshtml](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/data/ef-rp/intro/samples/cu30snapshots/2-crud/Pages/Students/CreateVM.cshtml) aktualizovat `StudentVM` použít `Student`spíše než .</span><span class="sxs-lookup"><span data-stu-id="54da0-182">Using `StudentVM` requires [Create.cshtml](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/data/ef-rp/intro/samples/cu30snapshots/2-crud/Pages/Students/CreateVM.cshtml) be updated to use `StudentVM` rather than `Student`.</span></span>

## <a name="update-the-edit-page"></a><span data-ttu-id="54da0-183">Aktualizace stránky Úpravy</span><span class="sxs-lookup"><span data-stu-id="54da0-183">Update the Edit page</span></span>

<span data-ttu-id="54da0-184">V *části Stránky/Studenti/Edit.cshtml.cs*nahraďte metody `OnGetAsync` a `OnPostAsync` následujícím kódem.</span><span class="sxs-lookup"><span data-stu-id="54da0-184">In *Pages/Students/Edit.cshtml.cs*, replace the `OnGetAsync` and `OnPostAsync` methods with the following code.</span></span>

[!code-csharp[Main](intro/samples/cu30/Pages/Students/Edit.cshtml.cs?name=snippet_OnGetPost)]

<span data-ttu-id="54da0-185">Změny kódu jsou podobné stránce Vytvořit s několika výjimkami:</span><span class="sxs-lookup"><span data-stu-id="54da0-185">The code changes are similar to the Create page with a few exceptions:</span></span>

* <span data-ttu-id="54da0-186">`FirstOrDefaultAsync`byla nahrazena službou [FindAsync](/dotnet/api/microsoft.entityframeworkcore.dbset-1.findasync).</span><span class="sxs-lookup"><span data-stu-id="54da0-186">`FirstOrDefaultAsync` has been replaced with [FindAsync](/dotnet/api/microsoft.entityframeworkcore.dbset-1.findasync).</span></span> <span data-ttu-id="54da0-187">Pokud nemusíte zahrnout související data, `FindAsync` je efektivnější.</span><span class="sxs-lookup"><span data-stu-id="54da0-187">When you don't have to include related data, `FindAsync` is more efficient.</span></span>
* <span data-ttu-id="54da0-188">`OnPostAsync`má `id` parametr.</span><span class="sxs-lookup"><span data-stu-id="54da0-188">`OnPostAsync` has an `id` parameter.</span></span>
* <span data-ttu-id="54da0-189">Aktuální student je načíst z databáze, spíše než vytvořit prázdný student.</span><span class="sxs-lookup"><span data-stu-id="54da0-189">The current student is fetched from the database, rather than creating an empty student.</span></span>

<span data-ttu-id="54da0-190">Spusťte aplikaci a otestujte ji vytvořením a úpravou studenta.</span><span class="sxs-lookup"><span data-stu-id="54da0-190">Run the app, and test it by creating and editing a student.</span></span>

## <a name="entity-states"></a><span data-ttu-id="54da0-191">Stavy entity</span><span class="sxs-lookup"><span data-stu-id="54da0-191">Entity States</span></span>

<span data-ttu-id="54da0-192">Kontext databáze sleduje, zda entity v paměti jsou synchronizovány s jejich odpovídající řádky v databázi.</span><span class="sxs-lookup"><span data-stu-id="54da0-192">The database context keeps track of whether entities in memory are in sync with their corresponding rows in the database.</span></span> <span data-ttu-id="54da0-193">Tato informace o sledování určuje, co se stane, když [SaveChangesAsync](/dotnet/api/microsoft.entityframeworkcore.dbcontext.savechangesasync#Microsoft_EntityFrameworkCore_DbContext_SaveChangesAsync_System_Threading_CancellationToken_) je volána.</span><span class="sxs-lookup"><span data-stu-id="54da0-193">This tracking information determines what happens when [SaveChangesAsync](/dotnet/api/microsoft.entityframeworkcore.dbcontext.savechangesasync#Microsoft_EntityFrameworkCore_DbContext_SaveChangesAsync_System_Threading_CancellationToken_) is called.</span></span> <span data-ttu-id="54da0-194">Například při předání nové entity metodě [AddAsync](/dotnet/api/microsoft.entityframeworkcore.dbcontext.addasync) je stav této entity nastaven na [hodnotu Přidáno](/dotnet/api/microsoft.entityframeworkcore.entitystate#Microsoft_EntityFrameworkCore_EntityState_Added).</span><span class="sxs-lookup"><span data-stu-id="54da0-194">For example, when a new entity is passed to the [AddAsync](/dotnet/api/microsoft.entityframeworkcore.dbcontext.addasync) method, that entity's state is set to [Added](/dotnet/api/microsoft.entityframeworkcore.entitystate#Microsoft_EntityFrameworkCore_EntityState_Added).</span></span> <span data-ttu-id="54da0-195">Při `SaveChangesAsync` volání kontext databáze vydá příkaz SQL INSERT.</span><span class="sxs-lookup"><span data-stu-id="54da0-195">When `SaveChangesAsync` is called, the database context issues a SQL INSERT command.</span></span>

<span data-ttu-id="54da0-196">Účetní jednotka se může napletat v jednom z [následujících stavů](/dotnet/api/microsoft.entityframeworkcore.entitystate):</span><span class="sxs-lookup"><span data-stu-id="54da0-196">An entity may be in one of the [following states](/dotnet/api/microsoft.entityframeworkcore.entitystate):</span></span>

* <span data-ttu-id="54da0-197">`Added`: Entita v databázi ještě neexistuje.</span><span class="sxs-lookup"><span data-stu-id="54da0-197">`Added`: The entity doesn't yet exist in the database.</span></span> <span data-ttu-id="54da0-198">Metoda `SaveChanges` vydá příkaz INSERT.</span><span class="sxs-lookup"><span data-stu-id="54da0-198">The `SaveChanges` method issues an INSERT statement.</span></span>

* <span data-ttu-id="54da0-199">`Unchanged`: S touto entitou není nutné ukládat žádné změny.</span><span class="sxs-lookup"><span data-stu-id="54da0-199">`Unchanged`: No changes need to be saved with this entity.</span></span> <span data-ttu-id="54da0-200">Entita má tento stav při čtení z databáze.</span><span class="sxs-lookup"><span data-stu-id="54da0-200">An entity has this status when it's read from the database.</span></span>

* <span data-ttu-id="54da0-201">`Modified`: Některé nebo všechny hodnoty vlastností entity byly změněny.</span><span class="sxs-lookup"><span data-stu-id="54da0-201">`Modified`: Some or all of the entity's property values have been modified.</span></span> <span data-ttu-id="54da0-202">Metoda `SaveChanges` vydává příkaz UPDATE.</span><span class="sxs-lookup"><span data-stu-id="54da0-202">The `SaveChanges` method issues an UPDATE statement.</span></span>

* <span data-ttu-id="54da0-203">`Deleted`: Entita byla označena k odstranění.</span><span class="sxs-lookup"><span data-stu-id="54da0-203">`Deleted`: The entity has been marked for deletion.</span></span> <span data-ttu-id="54da0-204">Metoda `SaveChanges` vydává příkaz DELETE.</span><span class="sxs-lookup"><span data-stu-id="54da0-204">The `SaveChanges` method issues a DELETE statement.</span></span>

* <span data-ttu-id="54da0-205">`Detached`: Entita není sledována kontextem databáze.</span><span class="sxs-lookup"><span data-stu-id="54da0-205">`Detached`: The entity isn't being tracked by the database context.</span></span>

<span data-ttu-id="54da0-206">V aplikaci klasické pracovní plochy se změny stavu obvykle nastavují automaticky.</span><span class="sxs-lookup"><span data-stu-id="54da0-206">In a desktop app, state changes are typically set automatically.</span></span> <span data-ttu-id="54da0-207">Entita je přečtena, jsou provedeny změny a `Modified`stav entity se automaticky změní na .</span><span class="sxs-lookup"><span data-stu-id="54da0-207">An entity is read, changes are made, and the entity state is automatically changed to `Modified`.</span></span> <span data-ttu-id="54da0-208">Volání `SaveChanges` generuje příkaz SQL UPDATE, který aktualizuje pouze změněné vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="54da0-208">Calling `SaveChanges` generates a SQL UPDATE statement that updates only the changed properties.</span></span>

<span data-ttu-id="54da0-209">Ve webové aplikaci, `DbContext` která čte entitu a zobrazuje data, je uvolněna po vykreslení stránky.</span><span class="sxs-lookup"><span data-stu-id="54da0-209">In a web app, the `DbContext` that reads an entity and displays the data is disposed after a page is rendered.</span></span> <span data-ttu-id="54da0-210">Při volání `OnPostAsync` metody stránky je nový webový požadavek a s novou `DbContext`instancí .</span><span class="sxs-lookup"><span data-stu-id="54da0-210">When a page's `OnPostAsync` method is called, a new web request is made and with a new instance of the `DbContext`.</span></span> <span data-ttu-id="54da0-211">Opětovné čtení entity v tomto novém kontextu simuluje zpracování plochy.</span><span class="sxs-lookup"><span data-stu-id="54da0-211">Rereading the entity in that new context simulates desktop processing.</span></span>

## <a name="update-the-delete-page"></a><span data-ttu-id="54da0-212">Aktualizace stránky Odstranit</span><span class="sxs-lookup"><span data-stu-id="54da0-212">Update the Delete page</span></span>

<span data-ttu-id="54da0-213">V této části implementovat vlastní chybovou `SaveChanges` zprávu při volání nezdaří.</span><span class="sxs-lookup"><span data-stu-id="54da0-213">In this section, you implement a custom error message when the call to `SaveChanges` fails.</span></span>

<span data-ttu-id="54da0-214">Nahraďte kód v *Pages/Students/Delete.cshtml.cs* následujícím kódem.</span><span class="sxs-lookup"><span data-stu-id="54da0-214">Replace the code in *Pages/Students/Delete.cshtml.cs* with the following code.</span></span> <span data-ttu-id="54da0-215">Změny jsou zvýrazněny (kromě vyčištění `using` příkazů).</span><span class="sxs-lookup"><span data-stu-id="54da0-215">The changes are highlighted (other than cleanup of `using` statements).</span></span>

[!code-csharp[Main](intro/samples/cu30/Pages/Students/Delete.cshtml.cs?name=snippet_All&highlight=20,22,30,38-41,53-71)]

<span data-ttu-id="54da0-216">Předchozí kód přidá volitelný `saveChangesError` parametr `OnGetAsync` k podpisu metody.</span><span class="sxs-lookup"><span data-stu-id="54da0-216">The preceding code adds the optional parameter `saveChangesError` to the `OnGetAsync` method signature.</span></span> <span data-ttu-id="54da0-217">`saveChangesError`označuje, zda byla metoda volána po selhání odstranění objektu studenta.</span><span class="sxs-lookup"><span data-stu-id="54da0-217">`saveChangesError` indicates whether the method was called after a failure to delete the student object.</span></span> <span data-ttu-id="54da0-218">Operace odstranění může selhat z důvodu přechodných problémů se sítí.</span><span class="sxs-lookup"><span data-stu-id="54da0-218">The delete operation might fail because of transient network problems.</span></span> <span data-ttu-id="54da0-219">Přechodné síťové chyby jsou pravděpodobnější, když je databáze v cloudu.</span><span class="sxs-lookup"><span data-stu-id="54da0-219">Transient network errors are more likely when the database is in the cloud.</span></span> <span data-ttu-id="54da0-220">Parametr `saveChangesError` je false při `OnGetAsync` odstranění stránky je volána z ui.</span><span class="sxs-lookup"><span data-stu-id="54da0-220">The `saveChangesError` parameter is false when the Delete page `OnGetAsync` is called from the UI.</span></span> <span data-ttu-id="54da0-221">Když `OnGetAsync` je `OnPostAsync` volána (protože operace `saveChangesError` odstranění se nezdařilo), parametr je true.</span><span class="sxs-lookup"><span data-stu-id="54da0-221">When `OnGetAsync` is called by `OnPostAsync` (because the delete operation failed), the `saveChangesError` parameter is true.</span></span>

<span data-ttu-id="54da0-222">Metoda `OnPostAsync` načte vybranou entitu [Remove](/dotnet/api/microsoft.entityframeworkcore.dbcontext.remove#Microsoft_EntityFrameworkCore_DbContext_Remove_System_Object_) a pak zavolá metodu `Deleted`Remove a nastaví stav entity na .</span><span class="sxs-lookup"><span data-stu-id="54da0-222">The `OnPostAsync` method retrieves the selected entity, then calls the [Remove](/dotnet/api/microsoft.entityframeworkcore.dbcontext.remove#Microsoft_EntityFrameworkCore_DbContext_Remove_System_Object_) method to set the entity's status to `Deleted`.</span></span> <span data-ttu-id="54da0-223">Při `SaveChanges` volání je generován příkaz SQL DELETE.</span><span class="sxs-lookup"><span data-stu-id="54da0-223">When `SaveChanges` is called, a SQL DELETE command is generated.</span></span> <span data-ttu-id="54da0-224">Pokud `Remove` selže:</span><span class="sxs-lookup"><span data-stu-id="54da0-224">If `Remove` fails:</span></span>

* <span data-ttu-id="54da0-225">Je zachycena výjimka databáze.</span><span class="sxs-lookup"><span data-stu-id="54da0-225">The database exception is caught.</span></span>
* <span data-ttu-id="54da0-226">Metoda Delete `OnGetAsync` pages je `saveChangesError=true`volána pomocí .</span><span class="sxs-lookup"><span data-stu-id="54da0-226">The Delete pages `OnGetAsync` method is called with `saveChangesError=true`.</span></span>

<span data-ttu-id="54da0-227">Přidejte chybovou zprávu na stránku Odstranit holicí strojek *(Pages/Students/Delete.cshtml*):</span><span class="sxs-lookup"><span data-stu-id="54da0-227">Add an error message to the Delete Razor Page (*Pages/Students/Delete.cshtml*):</span></span>

[!code-cshtml[Main](intro/samples/cu30/Pages/Students/Delete.cshtml?highlight=10)]

<span data-ttu-id="54da0-228">Spusťte aplikaci a odstraňte studenta a otestujte stránku Delete.</span><span class="sxs-lookup"><span data-stu-id="54da0-228">Run the app and delete a student to test the Delete page.</span></span>

## <a name="next-steps"></a><span data-ttu-id="54da0-229">Další kroky</span><span class="sxs-lookup"><span data-stu-id="54da0-229">Next steps</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="54da0-230">[Předchozí kurz](xref:data/ef-rp/intro)
> [Další kurz](xref:data/ef-rp/sort-filter-page)</span><span class="sxs-lookup"><span data-stu-id="54da0-230">[Previous tutorial](xref:data/ef-rp/intro)
[Next tutorial](xref:data/ef-rp/sort-filter-page)</span></span>

::: moniker-end

::: moniker range="< aspnetcore-3.0"

<span data-ttu-id="54da0-231">V tomto kurzu je kód CRUD (vytvořit, číst, aktualizovat, odstranit) zkontrolován a přizpůsobit.</span><span class="sxs-lookup"><span data-stu-id="54da0-231">In this tutorial, the scaffolded CRUD (create, read, update, delete) code is reviewed and customized.</span></span>

<span data-ttu-id="54da0-232">Chcete-li minimalizovat složitost a zachovat tyto kurzy zaměřené na EF Core, EF core kód se používá v modelech stránky.</span><span class="sxs-lookup"><span data-stu-id="54da0-232">To minimize complexity and keep these tutorials focused on EF Core, EF Core code is used in the page models.</span></span> <span data-ttu-id="54da0-233">Někteří vývojáři používají vrstvu služby nebo vzor úložiště v aplikaci k vytvoření vrstvy abstrakce mezi ui (Razor Pages) a vrstvou přístupu k datům.</span><span class="sxs-lookup"><span data-stu-id="54da0-233">Some developers use a service layer or repository pattern in to create an abstraction layer between the UI (Razor Pages) and the data access layer.</span></span>

<span data-ttu-id="54da0-234">V tomto kurzu jsou zkontrolovány stránky Create, Edit, Delete a Details Razor ve složce *Students.*</span><span class="sxs-lookup"><span data-stu-id="54da0-234">In this tutorial, the Create, Edit, Delete, and Details Razor Pages in the *Students* folder are examined.</span></span>

<span data-ttu-id="54da0-235">Kód skládaný pomocí šaškáře používá následující vzorek pro stránky Vytvořit, Upravit a Odstranit:</span><span class="sxs-lookup"><span data-stu-id="54da0-235">The scaffolded code uses the following pattern for Create, Edit, and Delete pages:</span></span>

* <span data-ttu-id="54da0-236">Získejte a zobrazte požadovaná `OnGetAsync`data pomocí metody HTTP GET .</span><span class="sxs-lookup"><span data-stu-id="54da0-236">Get and display the requested data with the HTTP GET method `OnGetAsync`.</span></span>
* <span data-ttu-id="54da0-237">Uložte změny dat pomocí metody `OnPostAsync`HTTP POST .</span><span class="sxs-lookup"><span data-stu-id="54da0-237">Save changes to the data with the HTTP POST method `OnPostAsync`.</span></span>

<span data-ttu-id="54da0-238">Stránky Rejstřík a podrobnosti získají a zobrazí požadovaná data pomocí metody HTTP GET`OnGetAsync`</span><span class="sxs-lookup"><span data-stu-id="54da0-238">The Index and Details pages get and display the requested data with the HTTP GET method `OnGetAsync`</span></span>

## <a name="singleordefaultasync-vs-firstordefaultasync"></a><span data-ttu-id="54da0-239">SingleOrDefaultAsync vs. FirstOrDefaultAsync</span><span class="sxs-lookup"><span data-stu-id="54da0-239">SingleOrDefaultAsync vs. FirstOrDefaultAsync</span></span>

<span data-ttu-id="54da0-240">Generovaný kód používá [FirstOrDefaultAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.firstordefaultasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_FirstOrDefaultAsync__1_System_Linq_IQueryable___0__System_Threading_CancellationToken_), který je obecně upřednostňován před [SingleOrDefaultAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.singleordefaultasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_SingleOrDefaultAsync__1_System_Linq_IQueryable___0__System_Linq_Expressions_Expression_System_Func___0_System_Boolean___System_Threading_CancellationToken_).</span><span class="sxs-lookup"><span data-stu-id="54da0-240">The generated code uses [FirstOrDefaultAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.firstordefaultasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_FirstOrDefaultAsync__1_System_Linq_IQueryable___0__System_Threading_CancellationToken_), which is generally preferred over [SingleOrDefaultAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.singleordefaultasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_SingleOrDefaultAsync__1_System_Linq_IQueryable___0__System_Linq_Expressions_Expression_System_Func___0_System_Boolean___System_Threading_CancellationToken_).</span></span>

 <span data-ttu-id="54da0-241">`FirstOrDefaultAsync`je efektivnější `SingleOrDefaultAsync` než při načítání jedné entity:</span><span class="sxs-lookup"><span data-stu-id="54da0-241">`FirstOrDefaultAsync` is more efficient than `SingleOrDefaultAsync` at fetching one entity:</span></span>

* <span data-ttu-id="54da0-242">Pokud kód potřebuje ověřit, že není více než jedna entita vrácena z dotazu.</span><span class="sxs-lookup"><span data-stu-id="54da0-242">Unless the code needs to verify that there's not more than one entity returned from the query.</span></span>
* <span data-ttu-id="54da0-243">`SingleOrDefaultAsync`načte více dat a dělá zbytečnou práci.</span><span class="sxs-lookup"><span data-stu-id="54da0-243">`SingleOrDefaultAsync` fetches more data and does unnecessary work.</span></span>
* <span data-ttu-id="54da0-244">`SingleOrDefaultAsync`vyvolá výjimku, pokud existuje více než jedna entita, která odpovídá součásti filtru.</span><span class="sxs-lookup"><span data-stu-id="54da0-244">`SingleOrDefaultAsync` throws an exception if there's more than one entity that fits the filter part.</span></span>
* <span data-ttu-id="54da0-245">`FirstOrDefaultAsync`nevyvolá, pokud je více než jedna entita, která se hodí k části filtru.</span><span class="sxs-lookup"><span data-stu-id="54da0-245">`FirstOrDefaultAsync` doesn't throw if there's more than one entity that fits the filter part.</span></span>

<a name="FindAsync"></a>

### <a name="findasync"></a><span data-ttu-id="54da0-246">FindAsync</span><span class="sxs-lookup"><span data-stu-id="54da0-246">FindAsync</span></span>

<span data-ttu-id="54da0-247">Ve velké části kód scaffolded [FindAsync](/dotnet/api/microsoft.entityframeworkcore.dbcontext.findasync#Microsoft_EntityFrameworkCore_DbContext_FindAsync_System_Type_System_Object___) lze `FirstOrDefaultAsync`použít místo .</span><span class="sxs-lookup"><span data-stu-id="54da0-247">In much of the scaffolded code, [FindAsync](/dotnet/api/microsoft.entityframeworkcore.dbcontext.findasync#Microsoft_EntityFrameworkCore_DbContext_FindAsync_System_Type_System_Object___) can be used in place of `FirstOrDefaultAsync`.</span></span>

<span data-ttu-id="54da0-248">`FindAsync`:</span><span class="sxs-lookup"><span data-stu-id="54da0-248">`FindAsync`:</span></span>

* <span data-ttu-id="54da0-249">Najde entitu s primárním klíčem (PK).</span><span class="sxs-lookup"><span data-stu-id="54da0-249">Finds an entity with the primary key (PK).</span></span> <span data-ttu-id="54da0-250">Pokud entita s PK je sledována kontextem, je vrácena bez požadavku do DB.</span><span class="sxs-lookup"><span data-stu-id="54da0-250">If an entity with the PK is being tracked by the context, it's returned without a request to the DB.</span></span>
* <span data-ttu-id="54da0-251">Je jednoduché a stručné.</span><span class="sxs-lookup"><span data-stu-id="54da0-251">Is simple and concise.</span></span>
* <span data-ttu-id="54da0-252">Je optimalizován pro vyhledat jednu entitu.</span><span class="sxs-lookup"><span data-stu-id="54da0-252">Is optimized to look up a single entity.</span></span>
* <span data-ttu-id="54da0-253">V některých situacích může mít výhody perf, ale to se u typických webových aplikací stává jen zřídka.</span><span class="sxs-lookup"><span data-stu-id="54da0-253">Can have perf benefits in some situations, but that rarely happens for typical web apps.</span></span>
* <span data-ttu-id="54da0-254">Implicitně používá [FirstAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.firstasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_FirstAsync__1_System_Linq_IQueryable___0__System_Linq_Expressions_Expression_System_Func___0_System_Boolean___System_Threading_CancellationToken_) místo [SingleAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.singleasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_SingleAsync__1_System_Linq_IQueryable___0__System_Linq_Expressions_Expression_System_Func___0_System_Boolean___System_Threading_CancellationToken_).</span><span class="sxs-lookup"><span data-stu-id="54da0-254">Implicitly uses [FirstAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.firstasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_FirstAsync__1_System_Linq_IQueryable___0__System_Linq_Expressions_Expression_System_Func___0_System_Boolean___System_Threading_CancellationToken_) instead of [SingleAsync](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.singleasync#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_SingleAsync__1_System_Linq_IQueryable___0__System_Linq_Expressions_Expression_System_Func___0_System_Boolean___System_Threading_CancellationToken_).</span></span>

<span data-ttu-id="54da0-255">Ale pokud chcete `Include` jiné entity, `FindAsync` pak již není vhodné.</span><span class="sxs-lookup"><span data-stu-id="54da0-255">But if you want to `Include` other entities, then `FindAsync` is no longer appropriate.</span></span> <span data-ttu-id="54da0-256">To znamená, že budete `FindAsync` muset opustit a přesunout se do dotazu, jak vaše aplikace postupuje.</span><span class="sxs-lookup"><span data-stu-id="54da0-256">This means that you may need to abandon `FindAsync` and move to a query as your app progresses.</span></span>

## <a name="customize-the-details-page"></a><span data-ttu-id="54da0-257">Přizpůsobení stránky Podrobnosti</span><span class="sxs-lookup"><span data-stu-id="54da0-257">Customize the Details page</span></span>

<span data-ttu-id="54da0-258">Přejděte `Pages/Students` na stránku.</span><span class="sxs-lookup"><span data-stu-id="54da0-258">Browse to `Pages/Students` page.</span></span> <span data-ttu-id="54da0-259">Odkazy **Upravit**, **Podrobnosti**a **Odstranit** jsou generovány [pomocníkem značky ukotvení](xref:mvc/views/tag-helpers/builtin-th/anchor-tag-helper) v souboru *Pages/Students/Index.cshtml.*</span><span class="sxs-lookup"><span data-stu-id="54da0-259">The **Edit**, **Details**, and **Delete** links are generated by the [Anchor Tag Helper](xref:mvc/views/tag-helpers/builtin-th/anchor-tag-helper) in the *Pages/Students/Index.cshtml* file.</span></span>

[!code-cshtml[](intro/samples/cu21/Pages/Students/Index1.cshtml?name=snippet)]

<span data-ttu-id="54da0-260">Spusťte aplikaci a vyberte odkaz **Podrobnosti.**</span><span class="sxs-lookup"><span data-stu-id="54da0-260">Run the app and select a **Details** link.</span></span> <span data-ttu-id="54da0-261">Adresa URL je `http://localhost:5000/Students/Details?id=2`formuláře .</span><span class="sxs-lookup"><span data-stu-id="54da0-261">The URL is of the form `http://localhost:5000/Students/Details?id=2`.</span></span> <span data-ttu-id="54da0-262">ID studenta je předáno`?id=2`pomocí řetězce dotazu ( ).</span><span class="sxs-lookup"><span data-stu-id="54da0-262">The Student ID is passed using a query string (`?id=2`).</span></span>

<span data-ttu-id="54da0-263">Aktualizujte stránky Upravit, Podrobnosti a `"{id:int}"` Odstranit holicí strojek, abyste použili šablonu trasy.</span><span class="sxs-lookup"><span data-stu-id="54da0-263">Update the Edit, Details, and Delete Razor Pages to use the `"{id:int}"` route template.</span></span> <span data-ttu-id="54da0-264">Změňte direktivu stránky `@page` `@page "{id:int}"`pro každou z těchto stránek z na .</span><span class="sxs-lookup"><span data-stu-id="54da0-264">Change the page directive for each of these pages from `@page` to `@page "{id:int}"`.</span></span>

<span data-ttu-id="54da0-265">Požadavek na stránku se šablonou postupu {id:int}, která **neobsahuje** hodnotu celého postupu, vrátí chybu HTTP 404 (nebyl nalezen).</span><span class="sxs-lookup"><span data-stu-id="54da0-265">A request to the page with the "{id:int}" route template that does **not** include a integer route value returns an HTTP 404 (not found) error.</span></span> <span data-ttu-id="54da0-266">Například `http://localhost:5000/Students/Details` vrátí chybu 404.</span><span class="sxs-lookup"><span data-stu-id="54da0-266">For example, `http://localhost:5000/Students/Details` returns a 404 error.</span></span> <span data-ttu-id="54da0-267">Chcete-li, aby id `?` volitelné, připojit k omezení trasy:</span><span class="sxs-lookup"><span data-stu-id="54da0-267">To make the ID optional, append `?` to the route constraint:</span></span>

 ```cshtml
@page "{id:int?}"
```

<span data-ttu-id="54da0-268">Spusťte aplikaci, klikněte na odkaz Podrobnosti a ověřte, zda adresa URL předává ID jako data trasy (`http://localhost:5000/Students/Details/2`).</span><span class="sxs-lookup"><span data-stu-id="54da0-268">Run the app, click on a Details link, and verify the URL is passing the ID as route data (`http://localhost:5000/Students/Details/2`).</span></span>

<span data-ttu-id="54da0-269">Neměňte `@page` globálně `@page "{id:int}"`na , tím přerušíte odkazy na stránky Domů a Vytvořit.</span><span class="sxs-lookup"><span data-stu-id="54da0-269">Don't globally change `@page` to `@page "{id:int}"`, doing so breaks the links to the Home and Create pages.</span></span>

<!-- See https://github.com/aspnet/Scaffolding/issues/590 -->

### <a name="add-related-data"></a><span data-ttu-id="54da0-270">Přidání souvisejících dat</span><span class="sxs-lookup"><span data-stu-id="54da0-270">Add related data</span></span>

<span data-ttu-id="54da0-271">Kód scaffolded pro stránku Studentindex neobsahuje `Enrollments` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="54da0-271">The scaffolded code for the Students Index page doesn't include the `Enrollments` property.</span></span> <span data-ttu-id="54da0-272">V této části je `Enrollments` obsah kolekce zobrazen na stránce Podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="54da0-272">In this section, the contents of the `Enrollments` collection is displayed in the Details page.</span></span>

<span data-ttu-id="54da0-273">Metoda `OnGetAsync` *Pages/Students/Details.cshtml.cs* používá `FirstOrDefaultAsync` metodu k `Student` načtení jedné entity.</span><span class="sxs-lookup"><span data-stu-id="54da0-273">The `OnGetAsync` method of *Pages/Students/Details.cshtml.cs* uses the `FirstOrDefaultAsync` method to retrieve a single `Student` entity.</span></span> <span data-ttu-id="54da0-274">Přidejte následující zvýrazněný kód:</span><span class="sxs-lookup"><span data-stu-id="54da0-274">Add the following highlighted code:</span></span>

[!code-csharp[](intro/samples/cu21/Pages/Students/Details.cshtml.cs?name=snippet_Details&highlight=8-12)]

<span data-ttu-id="54da0-275">[Include](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.include) a [ThenInclude](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.theninclude#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_ThenInclude__3_Microsoft_EntityFrameworkCore_Query_IIncludableQueryable___0_System_Collections_Generic_IEnumerable___1___System_Linq_Expressions_Expression_System_Func___1___2___) metody způsobit kontext `Student.Enrollments` načíst navigační vlastnost `Enrollment.Course` a v rámci každé registrace navigační vlastnost.</span><span class="sxs-lookup"><span data-stu-id="54da0-275">The [Include](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.include) and [ThenInclude](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.theninclude#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_ThenInclude__3_Microsoft_EntityFrameworkCore_Query_IIncludableQueryable___0_System_Collections_Generic_IEnumerable___1___System_Linq_Expressions_Expression_System_Func___1___2___) methods cause the context to load the `Student.Enrollments` navigation property, and within each enrollment the `Enrollment.Course` navigation property.</span></span> <span data-ttu-id="54da0-276">Tyto metody jsou podrobně zkoumány v kurzu týkající se čtení dat.</span><span class="sxs-lookup"><span data-stu-id="54da0-276">These methods are examined in detail in the reading-related data tutorial.</span></span>

<span data-ttu-id="54da0-277">[AsNoTracking](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.asnotracking#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_AsNoTracking__1_System_Linq_IQueryable___0__) Metoda zlepšuje výkon ve scénářích, kdy entity vrácené nejsou aktualizovány v aktuálním kontextu.</span><span class="sxs-lookup"><span data-stu-id="54da0-277">The [AsNoTracking](/dotnet/api/microsoft.entityframeworkcore.entityframeworkqueryableextensions.asnotracking#Microsoft_EntityFrameworkCore_EntityFrameworkQueryableExtensions_AsNoTracking__1_System_Linq_IQueryable___0__) method improves performance in scenarios when the entities returned are not updated in the current context.</span></span> <span data-ttu-id="54da0-278">`AsNoTracking`je popsána dále v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="54da0-278">`AsNoTracking` is discussed later in this tutorial.</span></span>

### <a name="display-related-enrollments-on-the-details-page"></a><span data-ttu-id="54da0-279">Zobrazení souvisejících registrací na stránce Podrobnosti</span><span class="sxs-lookup"><span data-stu-id="54da0-279">Display related enrollments on the Details page</span></span>

<span data-ttu-id="54da0-280">Otevřít *stránky/Studenti/Details.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="54da0-280">Open *Pages/Students/Details.cshtml*.</span></span> <span data-ttu-id="54da0-281">Přidejte následující zvýrazněný kód, který zobrazí seznam registrací:</span><span class="sxs-lookup"><span data-stu-id="54da0-281">Add the following highlighted code to display a list of enrollments:</span></span>

[!code-cshtml[](intro/samples/cu21/Pages/Students/Details.cshtml?highlight=32-53)]

<span data-ttu-id="54da0-282">Pokud je odsazení kódu po vložení kódu nesprávné, opravte jej stisknutím kláves CTRL-K-D.</span><span class="sxs-lookup"><span data-stu-id="54da0-282">If code indentation is wrong after the code is pasted, press CTRL-K-D to correct it.</span></span>

<span data-ttu-id="54da0-283">Předchozí kód smyčky prostřednictvím entit `Enrollments` v navigační vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="54da0-283">The preceding code loops through the entities in the `Enrollments` navigation property.</span></span> <span data-ttu-id="54da0-284">Pro každou registraci se zobrazí název kurzu a hodnocení.</span><span class="sxs-lookup"><span data-stu-id="54da0-284">For each enrollment, it displays the course title and the grade.</span></span> <span data-ttu-id="54da0-285">Název kurzu se načte z entity Kurz, `Course` která je uložena ve vlastnosti navigace entity Registrace.</span><span class="sxs-lookup"><span data-stu-id="54da0-285">The course title is retrieved from the Course entity that's stored in the `Course` navigation property of the Enrollments entity.</span></span>

<span data-ttu-id="54da0-286">Spusťte aplikaci, vyberte kartu **Studenti** a klikněte na odkaz **Podrobnosti** pro studenta.</span><span class="sxs-lookup"><span data-stu-id="54da0-286">Run the app, select the **Students** tab, and click the **Details** link for a student.</span></span> <span data-ttu-id="54da0-287">Zobrazí se seznam kurzů a hodnocení pro vybraného studenta.</span><span class="sxs-lookup"><span data-stu-id="54da0-287">The list of courses and grades for the selected student is displayed.</span></span>

## <a name="update-the-create-page"></a><span data-ttu-id="54da0-288">Aktualizace stránky Vytvořit</span><span class="sxs-lookup"><span data-stu-id="54da0-288">Update the Create page</span></span>

<span data-ttu-id="54da0-289">Aktualizujte `OnPostAsync` metodu na *pages/students/create.cshtml.cs* pomocí následujícího kódu:</span><span class="sxs-lookup"><span data-stu-id="54da0-289">Update the `OnPostAsync` method in *Pages/Students/Create.cshtml.cs* with the following code:</span></span>

[!code-csharp[](intro/samples/cu21/Pages/Students/Create.cshtml.cs?name=snippet_OnPostAsync)]

<a name="TryUpdateModelAsync"></a>

### <a name="tryupdatemodelasync"></a><span data-ttu-id="54da0-290">TryUpdateModelAsync</span><span class="sxs-lookup"><span data-stu-id="54da0-290">TryUpdateModelAsync</span></span>

<span data-ttu-id="54da0-291">Zkontrolujte kód [TryUpdateModelAsync:](/dotnet/api/microsoft.aspnetcore.mvc.controllerbase.tryupdatemodelasync#Microsoft_AspNetCore_Mvc_ControllerBase_TryUpdateModelAsync_System_Object_System_Type_System_String_)</span><span class="sxs-lookup"><span data-stu-id="54da0-291">Examine the [TryUpdateModelAsync](/dotnet/api/microsoft.aspnetcore.mvc.controllerbase.tryupdatemodelasync#Microsoft_AspNetCore_Mvc_ControllerBase_TryUpdateModelAsync_System_Object_System_Type_System_String_) code:</span></span>

[!code-csharp[](intro/samples/cu21/Pages/Students/Create.cshtml.cs?name=snippet_TryUpdateModelAsync)]

<span data-ttu-id="54da0-292">V předchozím kódu `TryUpdateModelAsync<Student>` se pokusí `emptyStudent` aktualizovat objekt pomocí zaúčtovaných hodnot formuláře z vlastnosti [PageContext](/dotnet/api/microsoft.aspnetcore.mvc.razorpages.pagemodel.pagecontext#Microsoft_AspNetCore_Mvc_RazorPages_PageModel_PageContext) v [modelu PageModel](/dotnet/api/microsoft.aspnetcore.mvc.razorpages.pagemodel).</span><span class="sxs-lookup"><span data-stu-id="54da0-292">In the preceding code, `TryUpdateModelAsync<Student>` tries to update the `emptyStudent` object using the posted form values from the [PageContext](/dotnet/api/microsoft.aspnetcore.mvc.razorpages.pagemodel.pagecontext#Microsoft_AspNetCore_Mvc_RazorPages_PageModel_PageContext) property in the [PageModel](/dotnet/api/microsoft.aspnetcore.mvc.razorpages.pagemodel).</span></span> <span data-ttu-id="54da0-293">`TryUpdateModelAsync`aktualizuje pouze uvedené`s => s.FirstMidName, s => s.LastName, s => s.EnrollmentDate`vlastnosti ( ).</span><span class="sxs-lookup"><span data-stu-id="54da0-293">`TryUpdateModelAsync` only updates the properties listed (`s => s.FirstMidName, s => s.LastName, s => s.EnrollmentDate`).</span></span>

<span data-ttu-id="54da0-294">V předchozím vzorku:</span><span class="sxs-lookup"><span data-stu-id="54da0-294">In the preceding sample:</span></span>

* <span data-ttu-id="54da0-295">Druhý argument`"student", // Prefix`( ) je předpona používá k vyhledávání hodnot.</span><span class="sxs-lookup"><span data-stu-id="54da0-295">The second argument (`"student", // Prefix`) is the prefix uses to look up values.</span></span> <span data-ttu-id="54da0-296">Nerozlišuje se na malá a velká písmena.</span><span class="sxs-lookup"><span data-stu-id="54da0-296">It's not case sensitive.</span></span>
* <span data-ttu-id="54da0-297">Zaúčtované hodnoty formuláře jsou převedeny na typy v `Student` modelu pomocí [vazby modelu](xref:mvc/models/model-binding).</span><span class="sxs-lookup"><span data-stu-id="54da0-297">The posted form values are converted to the types in the `Student` model using [model binding](xref:mvc/models/model-binding).</span></span>

<a id="overpost"></a>

### <a name="overposting"></a><span data-ttu-id="54da0-298">Přeúčtování</span><span class="sxs-lookup"><span data-stu-id="54da0-298">Overposting</span></span>

<span data-ttu-id="54da0-299">Použití `TryUpdateModel` k aktualizaci polí se zaúčtovaných hodnot je osvědčeným postupem zabezpečení, protože zabraňuje přeúčtování.</span><span class="sxs-lookup"><span data-stu-id="54da0-299">Using `TryUpdateModel` to update fields with posted values is a security best practice because it prevents overposting.</span></span> <span data-ttu-id="54da0-300">Předpokládejme například, že `Secret` entita Student obsahuje vlastnost, kterou by tato webová stránka neměla aktualizovat nebo přidat:</span><span class="sxs-lookup"><span data-stu-id="54da0-300">For example, suppose the Student entity includes a `Secret` property that this web page shouldn't update or add:</span></span>

[!code-csharp[](intro/samples/cu21/Models/StudentZsecret.cs?name=snippet_Intro&highlight=7)]

<span data-ttu-id="54da0-301">I v případě, že `Secret` aplikace nemá pole na create / update `Secret` Razor Page, hacker může nastavit hodnotu overpostování.</span><span class="sxs-lookup"><span data-stu-id="54da0-301">Even if the app doesn't have a `Secret` field on the create/update Razor Page, a hacker could set the `Secret` value by overposting.</span></span> <span data-ttu-id="54da0-302">Hacker by mohl použít nástroj, jako je Fiddler, nebo `Secret` napsat nějaký JavaScript, k odeslání hodnoty formuláře.</span><span class="sxs-lookup"><span data-stu-id="54da0-302">A hacker could use a tool such as Fiddler, or write some JavaScript, to post a `Secret` form value.</span></span> <span data-ttu-id="54da0-303">Původní kód neomezuje pole, která pořadač modelu používá při vytváření instance Student.</span><span class="sxs-lookup"><span data-stu-id="54da0-303">The original code doesn't limit the fields that the model binder uses when it creates a Student instance.</span></span>

<span data-ttu-id="54da0-304">Jakákoli hodnota, kterou `Secret` hacker zadal pro pole formuláře, je v db aktualizována.</span><span class="sxs-lookup"><span data-stu-id="54da0-304">Whatever value the hacker specified for the `Secret` form field is updated in the DB.</span></span> <span data-ttu-id="54da0-305">Následující obrázek znázorňuje nástroj `Secret` Šumař, který přidává pole (s hodnotou "OverPost") k zaúčtovanéhodnotě formuláře.</span><span class="sxs-lookup"><span data-stu-id="54da0-305">The following image shows the Fiddler tool adding the `Secret` field (with the value "OverPost") to the posted form values.</span></span>

![Fiddler přidání tajné pole](../ef-mvc/crud/_static/fiddler.png)

<span data-ttu-id="54da0-307">Hodnota OverPost je úspěšně přidána `Secret` do vlastnosti vloženého řádku.</span><span class="sxs-lookup"><span data-stu-id="54da0-307">The value "OverPost" is successfully added to the `Secret` property of the inserted row.</span></span> <span data-ttu-id="54da0-308">Návrhář aplikace nikdy `Secret` nezamýšlel nastavit vlastnost pomocí stránky Vytvořit.</span><span class="sxs-lookup"><span data-stu-id="54da0-308">The app designer never intended the `Secret` property to be set with the Create page.</span></span>

<a name="vm"></a>

### <a name="view-model"></a><span data-ttu-id="54da0-309">Zobrazit model</span><span class="sxs-lookup"><span data-stu-id="54da0-309">View model</span></span>

<span data-ttu-id="54da0-310">Model zobrazení obvykle obsahuje podmnožinu vlastností zahrnutých v modelu používaném aplikací.</span><span class="sxs-lookup"><span data-stu-id="54da0-310">A view model typically contains a subset of the properties included in the model used by the application.</span></span> <span data-ttu-id="54da0-311">Aplikační model se často nazývá model domény.</span><span class="sxs-lookup"><span data-stu-id="54da0-311">The application model is often called the domain model.</span></span> <span data-ttu-id="54da0-312">Model domény obvykle obsahuje všechny vlastnosti vyžadované odpovídající entitou v DB.</span><span class="sxs-lookup"><span data-stu-id="54da0-312">The domain model typically contains all the properties required by the corresponding entity in the DB.</span></span> <span data-ttu-id="54da0-313">Model zobrazení obsahuje pouze vlastnosti potřebné pro vrstvu ui (například vytvořit stránku).</span><span class="sxs-lookup"><span data-stu-id="54da0-313">The view model contains only the properties needed for the UI layer (for example, the Create page).</span></span> <span data-ttu-id="54da0-314">Kromě modelu zobrazení některé aplikace používají model vazby nebo vstupní model k předání dat mezi třídou modelu stránky Razor Pages a prohlížečem.</span><span class="sxs-lookup"><span data-stu-id="54da0-314">In addition to the view model, some apps use a binding model or input model to pass data between the Razor Pages page model class and the browser.</span></span> <span data-ttu-id="54da0-315">Zvažte `Student` následující model zobrazení:</span><span class="sxs-lookup"><span data-stu-id="54da0-315">Consider the following `Student` view model:</span></span>

[!code-csharp[](intro/samples/cu21/Models/StudentVM.cs)]

<span data-ttu-id="54da0-316">Zobrazit modely poskytují alternativní způsob, jak zabránit overpostování.</span><span class="sxs-lookup"><span data-stu-id="54da0-316">View models provide an alternative way to prevent overposting.</span></span> <span data-ttu-id="54da0-317">Model pohledu obsahuje pouze vlastnosti, které mají být zobrazeny (zobrazeny) nebo aktualizovány.</span><span class="sxs-lookup"><span data-stu-id="54da0-317">The view model contains only the properties to view (display) or update.</span></span>

<span data-ttu-id="54da0-318">Následující kód používá `StudentVM` model zobrazení k vytvoření nového studenta:</span><span class="sxs-lookup"><span data-stu-id="54da0-318">The following code uses the `StudentVM` view model to create a new student:</span></span>

[!code-csharp[](intro/samples/cu21/Pages/Students/CreateVM.cshtml.cs?name=snippet_OnPostAsync)]

<span data-ttu-id="54da0-319">Metoda [SetValues](/dotnet/api/microsoft.entityframeworkcore.changetracking.propertyvalues.setvalues#Microsoft_EntityFrameworkCore_ChangeTracking_PropertyValues_SetValues_System_Object_) nastaví hodnoty tohoto objektu čtením hodnot z jiného objektu [PropertyValues.](/dotnet/api/microsoft.entityframeworkcore.changetracking.propertyvalues)</span><span class="sxs-lookup"><span data-stu-id="54da0-319">The [SetValues](/dotnet/api/microsoft.entityframeworkcore.changetracking.propertyvalues.setvalues#Microsoft_EntityFrameworkCore_ChangeTracking_PropertyValues_SetValues_System_Object_) method sets the values of this object by reading values from another [PropertyValues](/dotnet/api/microsoft.entityframeworkcore.changetracking.propertyvalues) object.</span></span> <span data-ttu-id="54da0-320">`SetValues`používá odpovídající název vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="54da0-320">`SetValues` uses property name matching.</span></span> <span data-ttu-id="54da0-321">Typ modelu zobrazení nemusí souviset s typem modelu, musí mít pouze vlastnosti, které odpovídají.</span><span class="sxs-lookup"><span data-stu-id="54da0-321">The view model type doesn't need to be related to the model type, it just needs to have properties that match.</span></span>

<span data-ttu-id="54da0-322">Použití `StudentVM` vyžaduje [CreateVM.cshtml](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/data/ef-rp/intro/samples/cu21/Pages/Students/CreateVM.cshtml) aktualizovat `StudentVM` použít `Student`spíše než .</span><span class="sxs-lookup"><span data-stu-id="54da0-322">Using `StudentVM` requires [CreateVM.cshtml](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/data/ef-rp/intro/samples/cu21/Pages/Students/CreateVM.cshtml) be updated to use `StudentVM` rather than `Student`.</span></span>

<span data-ttu-id="54da0-323">V Razor Pages `PageModel` je odvozená třída model pohledu.</span><span class="sxs-lookup"><span data-stu-id="54da0-323">In Razor Pages, the `PageModel` derived class is the view model.</span></span>

## <a name="update-the-edit-page"></a><span data-ttu-id="54da0-324">Aktualizace stránky Úpravy</span><span class="sxs-lookup"><span data-stu-id="54da0-324">Update the Edit page</span></span>

<span data-ttu-id="54da0-325">Aktualizujte model stránky pro stránku Úpravy.</span><span class="sxs-lookup"><span data-stu-id="54da0-325">Update the page model for the Edit page.</span></span> <span data-ttu-id="54da0-326">Hlavní změny jsou zvýrazněny:</span><span class="sxs-lookup"><span data-stu-id="54da0-326">The major changes are highlighted:</span></span>

[!code-csharp[](intro/samples/cu21/Pages/Students/Edit.cshtml.cs?name=snippet_OnPostAsync&highlight=20,36)]

<span data-ttu-id="54da0-327">Změny kódu jsou podobné stránce Vytvořit s několika výjimkami:</span><span class="sxs-lookup"><span data-stu-id="54da0-327">The code changes are similar to the Create page with a few exceptions:</span></span>

* <span data-ttu-id="54da0-328">`OnPostAsync`má volitelný `id` parametr.</span><span class="sxs-lookup"><span data-stu-id="54da0-328">`OnPostAsync` has an optional `id` parameter.</span></span>
* <span data-ttu-id="54da0-329">Aktuální student je načten z DB, spíše než vytvořit prázdný student.</span><span class="sxs-lookup"><span data-stu-id="54da0-329">The current student is fetched from the DB, rather than creating an empty student.</span></span>
* <span data-ttu-id="54da0-330">`FirstOrDefaultAsync`byla nahrazena službou [FindAsync](/dotnet/api/microsoft.entityframeworkcore.dbset-1.findasync).</span><span class="sxs-lookup"><span data-stu-id="54da0-330">`FirstOrDefaultAsync` has been replaced with [FindAsync](/dotnet/api/microsoft.entityframeworkcore.dbset-1.findasync).</span></span> <span data-ttu-id="54da0-331">`FindAsync`je dobrou volbou při výběru entity z primárního klíče.</span><span class="sxs-lookup"><span data-stu-id="54da0-331">`FindAsync` is a good choice when selecting an entity from the primary key.</span></span> <span data-ttu-id="54da0-332">Další informace naleznete v [tématu FindAsync.](#FindAsync)</span><span class="sxs-lookup"><span data-stu-id="54da0-332">See [FindAsync](#FindAsync) for more information.</span></span>

### <a name="test-the-edit-and-create-pages"></a><span data-ttu-id="54da0-333">Testování stránek Úpravy a vytváření</span><span class="sxs-lookup"><span data-stu-id="54da0-333">Test the Edit and Create pages</span></span>

<span data-ttu-id="54da0-334">Vytvořte a upravte několik studentských entit.</span><span class="sxs-lookup"><span data-stu-id="54da0-334">Create and edit a few student entities.</span></span>

## <a name="entity-states"></a><span data-ttu-id="54da0-335">Stavy entity</span><span class="sxs-lookup"><span data-stu-id="54da0-335">Entity States</span></span>

<span data-ttu-id="54da0-336">Kontext DB udržuje přehled o tom, zda jsou entity v paměti synchronizovány s odpovídajícími řádky v DB.</span><span class="sxs-lookup"><span data-stu-id="54da0-336">The DB context keeps track of whether entities in memory are in sync with their corresponding rows in the DB.</span></span> <span data-ttu-id="54da0-337">Informace o synchronizaci kontextu DB určuje, co se stane, když [saveChangesAsync](/dotnet/api/microsoft.entityframeworkcore.dbcontext.savechangesasync#Microsoft_EntityFrameworkCore_DbContext_SaveChangesAsync_System_Threading_CancellationToken_) je volána.</span><span class="sxs-lookup"><span data-stu-id="54da0-337">The DB context sync information determines what happens when [SaveChangesAsync](/dotnet/api/microsoft.entityframeworkcore.dbcontext.savechangesasync#Microsoft_EntityFrameworkCore_DbContext_SaveChangesAsync_System_Threading_CancellationToken_) is called.</span></span> <span data-ttu-id="54da0-338">Například při předání nové entity metodě [AddAsync](/dotnet/api/microsoft.entityframeworkcore.dbcontext.addasync) je stav této entity nastaven na [hodnotu Přidáno](/dotnet/api/microsoft.entityframeworkcore.entitystate#Microsoft_EntityFrameworkCore_EntityState_Added).</span><span class="sxs-lookup"><span data-stu-id="54da0-338">For example, when a new entity is passed to the [AddAsync](/dotnet/api/microsoft.entityframeworkcore.dbcontext.addasync) method, that entity's state is set to [Added](/dotnet/api/microsoft.entityframeworkcore.entitystate#Microsoft_EntityFrameworkCore_EntityState_Added).</span></span> <span data-ttu-id="54da0-339">Při `SaveChangesAsync` volání kontextu DB vydá příkaz SQL INSERT.</span><span class="sxs-lookup"><span data-stu-id="54da0-339">When `SaveChangesAsync` is called, the DB context issues a SQL INSERT command.</span></span>

<span data-ttu-id="54da0-340">Účetní jednotka se může napletat v jednom z [následujících stavů](/dotnet/api/microsoft.entityframeworkcore.entitystate):</span><span class="sxs-lookup"><span data-stu-id="54da0-340">An entity may be in one of the [following states](/dotnet/api/microsoft.entityframeworkcore.entitystate):</span></span>

* <span data-ttu-id="54da0-341">`Added`: Entita v databázi ještě neexistuje.</span><span class="sxs-lookup"><span data-stu-id="54da0-341">`Added`: The entity doesn't yet exist in the DB.</span></span> <span data-ttu-id="54da0-342">Metoda `SaveChanges` vydá příkaz INSERT.</span><span class="sxs-lookup"><span data-stu-id="54da0-342">The `SaveChanges` method issues an INSERT statement.</span></span>

* <span data-ttu-id="54da0-343">`Unchanged`: S touto entitou není nutné ukládat žádné změny.</span><span class="sxs-lookup"><span data-stu-id="54da0-343">`Unchanged`: No changes need to be saved with this entity.</span></span> <span data-ttu-id="54da0-344">Entita má tento stav při čtení z DB.</span><span class="sxs-lookup"><span data-stu-id="54da0-344">An entity has this status when it's read from the DB.</span></span>

* <span data-ttu-id="54da0-345">`Modified`: Některé nebo všechny hodnoty vlastností entity byly změněny.</span><span class="sxs-lookup"><span data-stu-id="54da0-345">`Modified`: Some or all of the entity's property values have been modified.</span></span> <span data-ttu-id="54da0-346">Metoda `SaveChanges` vydává příkaz UPDATE.</span><span class="sxs-lookup"><span data-stu-id="54da0-346">The `SaveChanges` method issues an UPDATE statement.</span></span>

* <span data-ttu-id="54da0-347">`Deleted`: Entita byla označena k odstranění.</span><span class="sxs-lookup"><span data-stu-id="54da0-347">`Deleted`: The entity has been marked for deletion.</span></span> <span data-ttu-id="54da0-348">Metoda `SaveChanges` vydává příkaz DELETE.</span><span class="sxs-lookup"><span data-stu-id="54da0-348">The `SaveChanges` method issues a DELETE statement.</span></span>

* <span data-ttu-id="54da0-349">`Detached`: Entita není sledována kontextem DB.</span><span class="sxs-lookup"><span data-stu-id="54da0-349">`Detached`: The entity isn't being tracked by the DB context.</span></span>

<span data-ttu-id="54da0-350">V aplikaci klasické pracovní plochy se změny stavu obvykle nastavují automaticky.</span><span class="sxs-lookup"><span data-stu-id="54da0-350">In a desktop app, state changes are typically set automatically.</span></span> <span data-ttu-id="54da0-351">Entita je přečtena, jsou provedeny změny a `Modified`stav entity se automaticky změní na .</span><span class="sxs-lookup"><span data-stu-id="54da0-351">An entity is read, changes are made, and the entity state to automatically be changed to `Modified`.</span></span> <span data-ttu-id="54da0-352">Volání `SaveChanges` generuje příkaz SQL UPDATE, který aktualizuje pouze změněné vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="54da0-352">Calling `SaveChanges` generates a SQL UPDATE statement that updates only the changed properties.</span></span>

<span data-ttu-id="54da0-353">Ve webové aplikaci, `DbContext` která čte entitu a zobrazuje data, je uvolněna po vykreslení stránky.</span><span class="sxs-lookup"><span data-stu-id="54da0-353">In a web app, the `DbContext` that reads an entity and displays the data is disposed after a page is rendered.</span></span> <span data-ttu-id="54da0-354">Při volání `OnPostAsync` metody stránky je nový webový požadavek a s novou `DbContext`instancí .</span><span class="sxs-lookup"><span data-stu-id="54da0-354">When a page's `OnPostAsync` method is called, a new web request is made and with a new instance of the `DbContext`.</span></span> <span data-ttu-id="54da0-355">Opětovné čtení entity v tomto novém kontextu simuluje zpracování plochy.</span><span class="sxs-lookup"><span data-stu-id="54da0-355">Re-reading the entity in that new context simulates desktop processing.</span></span>

## <a name="update-the-delete-page"></a><span data-ttu-id="54da0-356">Aktualizace stránky Odstranit</span><span class="sxs-lookup"><span data-stu-id="54da0-356">Update the Delete page</span></span>

<span data-ttu-id="54da0-357">V této části je přidán kód k implementaci vlastní `SaveChanges` chybové zprávy při volání nezdaří.</span><span class="sxs-lookup"><span data-stu-id="54da0-357">In this section, code is added to implement a custom error message when the call to `SaveChanges` fails.</span></span> <span data-ttu-id="54da0-358">Přidejte řetězec, který bude obsahovat možné chybové zprávy:</span><span class="sxs-lookup"><span data-stu-id="54da0-358">Add a string to contain possible error messages:</span></span>

[!code-csharp[](intro/samples/cu21/Pages/Students/Delete.cshtml.cs?name=snippet1&highlight=12)]

<span data-ttu-id="54da0-359">Nahraďte metodu `OnGetAsync` následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="54da0-359">Replace the `OnGetAsync` method with the following code:</span></span>

[!code-csharp[](intro/samples/cu21/Pages/Students/Delete.cshtml.cs?name=snippet_OnGetAsync&highlight=1,9,17-20)]

<span data-ttu-id="54da0-360">Předchozí kód obsahuje volitelný `saveChangesError`parametr .</span><span class="sxs-lookup"><span data-stu-id="54da0-360">The preceding code contains the optional parameter `saveChangesError`.</span></span> <span data-ttu-id="54da0-361">`saveChangesError`označuje, zda byla metoda volána po selhání odstranění objektu studenta.</span><span class="sxs-lookup"><span data-stu-id="54da0-361">`saveChangesError` indicates whether the method was called after a failure to delete the student object.</span></span> <span data-ttu-id="54da0-362">Operace odstranění může selhat z důvodu přechodných problémů se sítí.</span><span class="sxs-lookup"><span data-stu-id="54da0-362">The delete operation might fail because of transient network problems.</span></span> <span data-ttu-id="54da0-363">Přechodné síťové chyby jsou pravděpodobnější v cloudu.</span><span class="sxs-lookup"><span data-stu-id="54da0-363">Transient network errors are more likely in the cloud.</span></span> <span data-ttu-id="54da0-364">`saveChangesError`je false, když `OnGetAsync` je stránka Delete volána z ui.</span><span class="sxs-lookup"><span data-stu-id="54da0-364">`saveChangesError`is false when the Delete page `OnGetAsync` is called from the UI.</span></span> <span data-ttu-id="54da0-365">Když `OnGetAsync` je `OnPostAsync` volána (protože operace `saveChangesError` odstranění se nezdařilo), parametr je true.</span><span class="sxs-lookup"><span data-stu-id="54da0-365">When `OnGetAsync` is called by `OnPostAsync` (because the delete operation failed), the `saveChangesError` parameter is true.</span></span>

### <a name="the-delete-pages-onpostasync-method"></a><span data-ttu-id="54da0-366">Metoda Odstranit stránky OnPostAsync</span><span class="sxs-lookup"><span data-stu-id="54da0-366">The Delete pages OnPostAsync method</span></span>

<span data-ttu-id="54da0-367">`OnPostAsync` Nahraďte následující kód:</span><span class="sxs-lookup"><span data-stu-id="54da0-367">Replace the `OnPostAsync` with the following code:</span></span>

[!code-csharp[](intro/samples/cu21/Pages/Students/Delete.cshtml.cs?name=snippet_OnPostAsync)]

<span data-ttu-id="54da0-368">Předchozí kód načte vybranou entitu [Remove](/dotnet/api/microsoft.entityframeworkcore.dbcontext.remove#Microsoft_EntityFrameworkCore_DbContext_Remove_System_Object_) a pak zavolá metodu `Deleted`Remove a nastaví stav entity na .</span><span class="sxs-lookup"><span data-stu-id="54da0-368">The preceding code retrieves the selected entity, then calls the [Remove](/dotnet/api/microsoft.entityframeworkcore.dbcontext.remove#Microsoft_EntityFrameworkCore_DbContext_Remove_System_Object_) method to set the entity's status to `Deleted`.</span></span> <span data-ttu-id="54da0-369">Při `SaveChanges` volání je generován příkaz SQL DELETE.</span><span class="sxs-lookup"><span data-stu-id="54da0-369">When `SaveChanges` is called, a SQL DELETE command is generated.</span></span> <span data-ttu-id="54da0-370">Pokud `Remove` selže:</span><span class="sxs-lookup"><span data-stu-id="54da0-370">If `Remove` fails:</span></span>

* <span data-ttu-id="54da0-371">Db výjimka je zachycena.</span><span class="sxs-lookup"><span data-stu-id="54da0-371">The DB exception is caught.</span></span>
* <span data-ttu-id="54da0-372">Metoda Delete `OnGetAsync` pages je `saveChangesError=true`volána pomocí .</span><span class="sxs-lookup"><span data-stu-id="54da0-372">The Delete pages `OnGetAsync` method is called with `saveChangesError=true`.</span></span>

### <a name="update-the-delete-razor-page"></a><span data-ttu-id="54da0-373">Aktualizace stránky Odstranit břitvu</span><span class="sxs-lookup"><span data-stu-id="54da0-373">Update the Delete Razor Page</span></span>

<span data-ttu-id="54da0-374">Přidejte následující zvýrazněnou chybovou zprávu na stránku Odstranit holicí strojek.</span><span class="sxs-lookup"><span data-stu-id="54da0-374">Add the following highlighted error message to the Delete Razor Page.</span></span>
<!--
[!code-cshtml[](intro/samples/cu21/Pages/Students/Delete.cshtml?name=snippet&highlight=11)]
-->
[!code-cshtml[](intro/samples/cu21/Pages/Students/Delete.cshtml?range=1-13&highlight=10)]

<span data-ttu-id="54da0-375">Test Delete.</span><span class="sxs-lookup"><span data-stu-id="54da0-375">Test Delete.</span></span>

## <a name="common-errors"></a><span data-ttu-id="54da0-376">Běžné chyby</span><span class="sxs-lookup"><span data-stu-id="54da0-376">Common errors</span></span>

<span data-ttu-id="54da0-377">Studenti / Index nebo jiné odkazy nefungují:</span><span class="sxs-lookup"><span data-stu-id="54da0-377">Students/Index or other links don't work:</span></span>

<span data-ttu-id="54da0-378">Ověřte, že `@page` stránka Razor obsahuje správnou direktivu.</span><span class="sxs-lookup"><span data-stu-id="54da0-378">Verify the Razor Page contains the correct `@page` directive.</span></span> <span data-ttu-id="54da0-379">Například Stránka Žiletka Studentů/Index by **neměla** obsahovat šablonu trasy:</span><span class="sxs-lookup"><span data-stu-id="54da0-379">For example, The Students/Index Razor Page should **not** contain a route template:</span></span>

```cshtml
@page "{id:int}"
```

<span data-ttu-id="54da0-380">Každá stránka Razor `@page` musí obsahovat direktivu.</span><span class="sxs-lookup"><span data-stu-id="54da0-380">Each Razor Page must include the `@page` directive.</span></span>



## <a name="additional-resources"></a><span data-ttu-id="54da0-381">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="54da0-381">Additional resources</span></span>

* [<span data-ttu-id="54da0-382">Verze tohoto kurzu pro YouTube</span><span class="sxs-lookup"><span data-stu-id="54da0-382">YouTube version of this tutorial</span></span>](https://www.youtube.com/watch?v=K4X1MT2jt6o)

> [!div class="step-by-step"]
> <span data-ttu-id="54da0-383">[Předchozí](xref:data/ef-rp/intro)
> [další](xref:data/ef-rp/sort-filter-page)</span><span class="sxs-lookup"><span data-stu-id="54da0-383">[Previous](xref:data/ef-rp/intro)
[Next](xref:data/ef-rp/sort-filter-page)</span></span>

::: moniker-end
