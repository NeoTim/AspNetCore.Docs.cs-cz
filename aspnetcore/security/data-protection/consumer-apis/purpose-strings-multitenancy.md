---
title: "Účel řetězců v ASP.NET Core"
author: rick-anderson
description: "Tento dokument popisuje účel řetězec hierarchie a víceklientský ve vztahu k ochrany dat ASP.NET Core rozhraní API."
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/consumer-apis/purpose-strings-multitenancy
ms.openlocfilehash: e7b08df32069cf1243630accda82eb6250594c53
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/24/2018
---
# <a name="purpose-hierarchy-and-multi-tenancy-in-aspnet-core"></a><span data-ttu-id="d3431-103">Účel hierarchie a víceklientský v ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d3431-103">Purpose hierarchy and multi-tenancy in ASP.NET Core</span></span>

<span data-ttu-id="d3431-104">Protože `IDataProtector` implicitně je také `IDataProtectionProvider`, účely dají se propojit.</span><span class="sxs-lookup"><span data-stu-id="d3431-104">Since an `IDataProtector` is also implicitly an `IDataProtectionProvider`, purposes can be chained together.</span></span> <span data-ttu-id="d3431-105">V tomto smyslu `provider.CreateProtector([ "purpose1", "purpose2" ])` je ekvivalentní `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span><span class="sxs-lookup"><span data-stu-id="d3431-105">In this sense, `provider.CreateProtector([ "purpose1", "purpose2" ])` is equivalent to `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span></span>

<span data-ttu-id="d3431-106">To umožňuje některé zajímavé hierarchické vztahy prostřednictvím systému ochrany dat.</span><span class="sxs-lookup"><span data-stu-id="d3431-106">This allows for some interesting hierarchical relationships through the data protection system.</span></span> <span data-ttu-id="d3431-107">V dřívějších příkladu [Contoso.Messaging.SecureMessage](purpose-strings.md#data-protection-contoso-purpose), můžete volat komponentu SecureMessage `provider.CreateProtector("Contoso.Messaging.SecureMessage")` jednou počáteční a mezipaměti výsledek do privátního `_myProvide` pole.</span><span class="sxs-lookup"><span data-stu-id="d3431-107">In the earlier example of [Contoso.Messaging.SecureMessage](purpose-strings.md#data-protection-contoso-purpose), the SecureMessage component can call `provider.CreateProtector("Contoso.Messaging.SecureMessage")` once up-front and cache the result into a private `_myProvide` field.</span></span> <span data-ttu-id="d3431-108">Budoucí ochrany mohou být vytvořeny prostřednictvím volání `_myProvider.CreateProtector("User: username")`, a tato ochrana se použije pro zabezpečení jednotlivých zpráv.</span><span class="sxs-lookup"><span data-stu-id="d3431-108">Future protectors can then be created via calls to `_myProvider.CreateProtector("User: username")`, and these protectors would be used for securing the individual messages.</span></span>

<span data-ttu-id="d3431-109">To může také překlopit.</span><span class="sxs-lookup"><span data-stu-id="d3431-109">This can also be flipped.</span></span> <span data-ttu-id="d3431-110">Zvažte jednu logickou aplikaci, které hostitele více klientů (systém správy obsahu zdá se, že přiměřené) a každý klient můžete nakonfigurovat vlastní ověřování a stavu systému správy.</span><span class="sxs-lookup"><span data-stu-id="d3431-110">Consider a single logical application which hosts multiple tenants (a CMS seems reasonable), and each tenant can be configured with its own authentication and state management system.</span></span> <span data-ttu-id="d3431-111">Aplikace zastřešující má jednoho hlavní zprostředkovatele, a volá `provider.CreateProtector("Tenant 1")` a `provider.CreateProtector("Tenant 2")` poskytnout vlastní izolované řez systému ochrany dat každého klienta.</span><span class="sxs-lookup"><span data-stu-id="d3431-111">The umbrella application has a single master provider, and it calls `provider.CreateProtector("Tenant 1")` and `provider.CreateProtector("Tenant 2")` to give each tenant its own isolated slice of the data protection system.</span></span> <span data-ttu-id="d3431-112">Klienti potom může odvozena vlastní jednotlivých ochrany na základě svých vlastních potřeb, ale bez ohledu na to, jak pevného snaží uživatel nemůže vytvořit ochrany, které jsou v konfliktu s žádným jiným klientem v systému.</span><span class="sxs-lookup"><span data-stu-id="d3431-112">The tenants could then derive their own individual protectors based on their own needs, but no matter how hard they try they cannot create protectors which collide with any other tenant in the system.</span></span> <span data-ttu-id="d3431-113">Graficky to je reprezentována jako níže.</span><span class="sxs-lookup"><span data-stu-id="d3431-113">Graphically, this is represented as below.</span></span>

![Pro účely více klientů](purpose-strings-multitenancy/_static/purposes-multi-tenancy.png)

>[!WARNING]
> <span data-ttu-id="d3431-115">Předpokladem zastřešující ovládací prvky aplikace, které rozhraní API jsou k dispozici pro jednotlivé klienty a že klienti nelze spustit libovolný kód na serveru.</span><span class="sxs-lookup"><span data-stu-id="d3431-115">This assumes the umbrella application controls which APIs are available to individual tenants and that tenants cannot execute arbitrary code on the server.</span></span> <span data-ttu-id="d3431-116">Pokud klienta můžete spustit libovolný kód, privátní reflexe pro přerušení izolace záruky, které může fungovat, nebo může jenom číst materiál hlavního klíče přímo a odvodí ať podklíče chtějí mít.</span><span class="sxs-lookup"><span data-stu-id="d3431-116">If a tenant can execute arbitrary code, they could perform private reflection to break the isolation guarantees, or they could just read the master keying material directly and derive whatever subkeys they desire.</span></span>

<span data-ttu-id="d3431-117">Systém ochrany dat ve skutečnosti používá řazení víceklientský ve výchozím nastavení se na pole.</span><span class="sxs-lookup"><span data-stu-id="d3431-117">The data protection system actually uses a sort of multi-tenancy in its default out-of-the-box configuration.</span></span> <span data-ttu-id="d3431-118">Ve výchozím nastavení je jejich obsah uložen ve složce profilu uživatele účet pracovního procesu (nebo registru pro identity fondu aplikací služby IIS).</span><span class="sxs-lookup"><span data-stu-id="d3431-118">By default master keying material is stored in the worker process account's user profile folder (or the registry, for IIS application pool identities).</span></span> <span data-ttu-id="d3431-119">Ale je ve skutečnosti poměrně společné pro jeden účet použít ke spuštění více aplikací, a proto by tyto aplikace skončili sdílení hlavní Forward.</span><span class="sxs-lookup"><span data-stu-id="d3431-119">But it's actually fairly common to use a single account to run multiple applications, and thus all these applications would end up sharing the master keying material.</span></span> <span data-ttu-id="d3431-120">Chcete-li tento problém vyřešit, systému ochrany dat automaticky vloží identifikátor jedinečný každou aplikaci jako první prvek v řetězu celkové účel.</span><span class="sxs-lookup"><span data-stu-id="d3431-120">To solve this, the data protection system automatically inserts a unique-per-application identifier as the first element in the overall purpose chain.</span></span> <span data-ttu-id="d3431-121">Tento implicitní účel slouží k [izolovat jednotlivých aplikací](xref:security/data-protection/configuration/overview#per-application-isolation) jeden z druhého tak, že efektivně považuje každou aplikaci, jak vypadá jedinečný klienta v rámci systému a proces tvorby ochrana stejný jako na obrázku výše.</span><span class="sxs-lookup"><span data-stu-id="d3431-121">This implicit purpose serves to [isolate individual applications](xref:security/data-protection/configuration/overview#per-application-isolation) from one another by effectively treating each application as a unique tenant within the system, and the protector creation process looks identical to the image above.</span></span>
