---
title: Ochrana dat ASP.NET Core
author: rick-anderson
description: Další informace o konceptu ochranu dat a principy návrhu rozhraní API ASP.NET Core Data Protection.
ms.author: riande
ms.date: 10/14/2016
uid: security/data-protection/introduction
ms.openlocfilehash: 29a2bbef6f2fd9b61541173af143926ca82bfad7
ms.sourcegitcommit: 3ca527f27c88cfc9d04688db5499e372fbc2c775
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/17/2018
ms.locfileid: "39095692"
---
# <a name="aspnet-core-data-protection"></a><span data-ttu-id="15e0e-103">Ochrana dat ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="15e0e-103">ASP.NET Core Data Protection</span></span>

<span data-ttu-id="15e0e-104">Webové aplikace často potřebují ukládat citlivá data.</span><span class="sxs-lookup"><span data-stu-id="15e0e-104">Web applications often need to store security-sensitive data.</span></span> <span data-ttu-id="15e0e-105">Windows poskytuje rozhraní DPAPI pro desktopové aplikace, ale to není vhodná pro webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="15e0e-105">Windows provides DPAPI for desktop applications but this is unsuitable for web applications.</span></span> <span data-ttu-id="15e0e-106">Zásobník ochrany dat ASP.NET Core poskytují jednoduché a snadno se používá API kryptografické vývojáři mohou využít k ochraně dat, včetně správu a rotaci klíčů.</span><span class="sxs-lookup"><span data-stu-id="15e0e-106">The ASP.NET Core data protection stack provide a simple, easy to use cryptographic API a developer can use to protect data, including key management and rotation.</span></span>

<span data-ttu-id="15e0e-107">Zásobník ochrany dat ASP.NET Core je navržená sloužící jako dlouhodobé náhrada za &lt;machineKey&gt; element v technologii ASP.NET 1.x – 4.x.</span><span class="sxs-lookup"><span data-stu-id="15e0e-107">The ASP.NET Core data protection stack is designed to serve as the long-term replacement for the &lt;machineKey&gt; element in ASP.NET 1.x - 4.x.</span></span> <span data-ttu-id="15e0e-108">Bylo navrženo řeší řadu nedostatků starý kryptografický zásobníku současně jako out-of-the-box řešení pro většinu případů použití, které jsou pravděpodobně dojde k moderní aplikace.</span><span class="sxs-lookup"><span data-stu-id="15e0e-108">It was designed to address many of the shortcomings of the old cryptographic stack while providing an out-of-the-box solution for the majority of use cases modern applications are likely to encounter.</span></span>

## <a name="problem-statement"></a><span data-ttu-id="15e0e-109">Popis problému</span><span class="sxs-lookup"><span data-stu-id="15e0e-109">Problem statement</span></span>

<span data-ttu-id="15e0e-110">Příkaz celkový problém může stručně uvedeny v jedné větě: je potřeba zachovat důvěryhodné informace pro pozdější načtení, ale není důvěřovat mechanismus trvalosti.</span><span class="sxs-lookup"><span data-stu-id="15e0e-110">The overall problem statement can be succinctly stated in a single sentence: I need to persist trusted information for later retrieval, but I don't trust the persistence mechanism.</span></span> <span data-ttu-id="15e0e-111">V podmínkách web to může být napsán jako "Potřebuji round-trip důvěryhodného stavu pomocí nedůvěryhodného klienta."</span><span class="sxs-lookup"><span data-stu-id="15e0e-111">In web terms, this might be written as "I need to round-trip trusted state via an untrusted client."</span></span>

<span data-ttu-id="15e0e-112">Canonical příkladem tohoto je soubor cookie pro ověřování nebo nosný token.</span><span class="sxs-lookup"><span data-stu-id="15e0e-112">The canonical example of this is an authentication cookie or bearer token.</span></span> <span data-ttu-id="15e0e-113">Generuje server "Jsem Groot a mít oprávnění xyz" token a předá ho do klienta.</span><span class="sxs-lookup"><span data-stu-id="15e0e-113">The server generates an "I am Groot and have xyz permissions" token and hands it to the client.</span></span> <span data-ttu-id="15e0e-114">V některé budoucí datum nabídne klientovi tento token zpět na server, ale je nutné nějaký druh ujištění, že klient nebyl založených na zfalšovaných token.</span><span class="sxs-lookup"><span data-stu-id="15e0e-114">At some future date the client will present that token back to the server, but the server needs some kind of assurance that the client hasn't forged the token.</span></span> <span data-ttu-id="15e0e-115">Proto první požadavek: pravosti (označovaný také jako</span><span class="sxs-lookup"><span data-stu-id="15e0e-115">Thus the first requirement: authenticity (a.k.a.</span></span> <span data-ttu-id="15e0e-116">integritu, kontroly pravopisu proti).</span><span class="sxs-lookup"><span data-stu-id="15e0e-116">integrity, tamper-proofing).</span></span>

<span data-ttu-id="15e0e-117">Protože trvalého stavu je důvěryhodný pro server, Očekáváme, že tento stav může obsahovat informace, které jsou specifické pro provozní prostředí.</span><span class="sxs-lookup"><span data-stu-id="15e0e-117">Since the persisted state is trusted by the server, we anticipate that this state might contain information that's specific to the operating environment.</span></span> <span data-ttu-id="15e0e-118">To může být ve tvaru cestu k souboru, oprávnění, popisovač nebo jiných nepřímý odkaz nebo některé jiné části data specifická pro server.</span><span class="sxs-lookup"><span data-stu-id="15e0e-118">This could be in the form of a file path, a permission, a handle or other indirect reference, or some other piece of server-specific data.</span></span> <span data-ttu-id="15e0e-119">Tyto informace obecně by neměl být poskytnuty nedůvěryhodného klienta.</span><span class="sxs-lookup"><span data-stu-id="15e0e-119">Such information should generally not be disclosed to an untrusted client.</span></span> <span data-ttu-id="15e0e-120">Proto druhý požadavek: utajení.</span><span class="sxs-lookup"><span data-stu-id="15e0e-120">Thus the second requirement: confidentiality.</span></span>

<span data-ttu-id="15e0e-121">Nakonec od moderních aplikací jsou komponentní, co jsme viděli je, že jednotlivé komponenty se chcete využít tento systém bez ohledu na ostatní součásti v systému.</span><span class="sxs-lookup"><span data-stu-id="15e0e-121">Finally, since modern applications are componentized, what we've seen is that individual components will want to take advantage of this system without regard to other components in the system.</span></span> <span data-ttu-id="15e0e-122">Například pokud komponenta tokenu nosiče používá tento zásobník, měla pracovat bez rušení anti-CSRF mechanismus, které by mohly používat se stejným zásobníkem.</span><span class="sxs-lookup"><span data-stu-id="15e0e-122">For instance, if a bearer token component is using this stack, it should operate without interference from an anti-CSRF mechanism that might also be using the same stack.</span></span> <span data-ttu-id="15e0e-123">Proto poslední požadavek: izolace.</span><span class="sxs-lookup"><span data-stu-id="15e0e-123">Thus the final requirement: isolation.</span></span>

<span data-ttu-id="15e0e-124">Abyste mohli zúžit rozsah, naše požadavky můžete zajišťuje další omezení.</span><span class="sxs-lookup"><span data-stu-id="15e0e-124">We can provide further constraints in order to narrow the scope of our requirements.</span></span> <span data-ttu-id="15e0e-125">Předpokládáme, že jsou všechny služby, které pracují v rámci cryptosystem stejně důvěryhodné a že data nemusí generovat ani spotřebované mimo tyto služby a za naše přímou kontrolu.</span><span class="sxs-lookup"><span data-stu-id="15e0e-125">We assume that all services operating within the cryptosystem are equally trusted and that the data doesn't need to be generated or consumed outside of the services under our direct control.</span></span> <span data-ttu-id="15e0e-126">Kromě toho požadujeme, aby operace jsou co nejrychleji, protože každý požadavek na webovou službu projít cryptosystem jednou nebo vícekrát.</span><span class="sxs-lookup"><span data-stu-id="15e0e-126">Furthermore, we require that operations are as fast as possible since each request to the web service might go through the cryptosystem one or more times.</span></span> <span data-ttu-id="15e0e-127">Díky tomu symetrické šifrování ideální pro náš scénář a asymetrické šifrování jsme získat slevu až do takové čas, který je nezbytný.</span><span class="sxs-lookup"><span data-stu-id="15e0e-127">This makes symmetric cryptography ideal for our scenario, and we can discount asymmetric cryptography until such a time that it's needed.</span></span>

## <a name="design-philosophy"></a><span data-ttu-id="15e0e-128">Filosofie návrhu tříd</span><span class="sxs-lookup"><span data-stu-id="15e0e-128">Design philosophy</span></span>

<span data-ttu-id="15e0e-129">Začali jsme díky identifikaci problémů s existující zásobníku.</span><span class="sxs-lookup"><span data-stu-id="15e0e-129">We started by identifying problems with the existing stack.</span></span> <span data-ttu-id="15e0e-130">Jakmile jsme měli, který jsme názory na šířku existující řešení a dospělo k závěru, že žádné existující řešení úplně měli možností, které jsme chtěli.</span><span class="sxs-lookup"><span data-stu-id="15e0e-130">Once we had that, we surveyed the landscape of existing solutions and concluded that no existing solution quite had the capabilities we sought.</span></span> <span data-ttu-id="15e0e-131">Potom jsme navržené řešení založené na několika hlavní principy.</span><span class="sxs-lookup"><span data-stu-id="15e0e-131">We then engineered a solution based on several guiding principles.</span></span>

* <span data-ttu-id="15e0e-132">Systém by měl nabídnout zjednodušení konfigurace.</span><span class="sxs-lookup"><span data-stu-id="15e0e-132">The system should offer simplicity of configuration.</span></span> <span data-ttu-id="15e0e-133">V ideálním případě by být systém bez nutnosti konfigurace a vývojáři můžou pusťte se do práce.</span><span class="sxs-lookup"><span data-stu-id="15e0e-133">Ideally the system would be zero-configuration and developers could hit the ground running.</span></span> <span data-ttu-id="15e0e-134">V situacích, kdy je potřeba nakonfigurovat konkrétní aspekty (jako jsou klíče úložiště) vývojáři by měl zvážit tyto konkrétní konfigurace maximálně jednoduché.</span><span class="sxs-lookup"><span data-stu-id="15e0e-134">In situations where developers need to configure a specific aspect (such as the key repository), consideration should be given to making those specific configurations simple.</span></span>

* <span data-ttu-id="15e0e-135">Nabízí jednoduché rozhraní API určené uživatelům.</span><span class="sxs-lookup"><span data-stu-id="15e0e-135">Offer a simple consumer-facing API.</span></span> <span data-ttu-id="15e0e-136">Rozhraní API by měla být snadno použitelné správně a obtížně použitelnou nesprávně.</span><span class="sxs-lookup"><span data-stu-id="15e0e-136">The APIs should be easy to use correctly and difficult to use incorrectly.</span></span>

* <span data-ttu-id="15e0e-137">Principy správy klíčů by neměl informace pro vývojáře.</span><span class="sxs-lookup"><span data-stu-id="15e0e-137">Developers shouldn't learn key management principles.</span></span> <span data-ttu-id="15e0e-138">Systém by měl zpracovat algoritmus výběru a životnosti klíče jménem pro vývojáře.</span><span class="sxs-lookup"><span data-stu-id="15e0e-138">The system should handle algorithm selection and key lifetime on the developer's behalf.</span></span> <span data-ttu-id="15e0e-139">Vývojář v ideálním případě měli mít nikdy i přístup k nezpracované materiál klíče.</span><span class="sxs-lookup"><span data-stu-id="15e0e-139">Ideally the developer should never even have access to the raw key material.</span></span>

* <span data-ttu-id="15e0e-140">Klíče by měly být chráněné v klidovém stavu, pokud je to možné.</span><span class="sxs-lookup"><span data-stu-id="15e0e-140">Keys should be protected at rest when possible.</span></span> <span data-ttu-id="15e0e-141">Systém by měl zjistit mechanismus odpovídající výchozí ochranu a použijte ji automaticky.</span><span class="sxs-lookup"><span data-stu-id="15e0e-141">The system should figure out an appropriate default protection mechanism and apply it automatically.</span></span>

<span data-ttu-id="15e0e-142">Pomocí těchto zásad v úvahu Vyvinuli jsme proto představují jednoduchou, [snadno použitelné](xref:security/data-protection/using-data-protection) data protection zásobníku.</span><span class="sxs-lookup"><span data-stu-id="15e0e-142">With these principles in mind we developed a simple, [easy to use](xref:security/data-protection/using-data-protection) data protection stack.</span></span>

<span data-ttu-id="15e0e-143">Ochranu dat ASP.NET Core API nejsou určené především pro neomezenou trvalost důvěrné datových částí.</span><span class="sxs-lookup"><span data-stu-id="15e0e-143">The ASP.NET Core data protection APIs are not primarily intended for indefinite persistence of confidential payloads.</span></span> <span data-ttu-id="15e0e-144">Jiné technologie, jako je [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) a [Azure Rights Management](https://docs.microsoft.com/rights-management/) jsou vhodnější pro scénář neomezené úložiště, a mají možnosti odpovídajícím způsobem silné správu klíčů.</span><span class="sxs-lookup"><span data-stu-id="15e0e-144">Other technologies like [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) and [Azure Rights Management](https://docs.microsoft.com/rights-management/) are more suited to the scenario of indefinite storage, and they have correspondingly strong key management capabilities.</span></span> <span data-ttu-id="15e0e-145">Ale nutné dodat, není nic zakazují vývojář pro dlouhodobou ochranu důvěrných dat pomocí data protection API ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="15e0e-145">That said, there's nothing prohibiting a developer from using the ASP.NET Core data protection APIs for long-term protection of confidential data.</span></span>

## <a name="audience"></a><span data-ttu-id="15e0e-146">Cílová skupina</span><span class="sxs-lookup"><span data-stu-id="15e0e-146">Audience</span></span>

<span data-ttu-id="15e0e-147">Systém ochrany dat je rozdělena do pěti hlavní balíčky.</span><span class="sxs-lookup"><span data-stu-id="15e0e-147">The data protection system is divided into five main packages.</span></span> <span data-ttu-id="15e0e-148">Tři hlavní oslovovat; cílové různé aspekty těchto rozhraní API</span><span class="sxs-lookup"><span data-stu-id="15e0e-148">Various aspects of these APIs target three main audiences;</span></span>

1. <span data-ttu-id="15e0e-149">[Přehled rozhraní API příjemců](xref:security/data-protection/consumer-apis/overview) cílit na vývojáři aplikace a rozhraní framework.</span><span class="sxs-lookup"><span data-stu-id="15e0e-149">The [Consumer APIs Overview](xref:security/data-protection/consumer-apis/overview) target application and framework developers.</span></span>

   <span data-ttu-id="15e0e-150">"Nechci se nyní Další informace o tom, jak funguje zásobníku nebo jeho konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="15e0e-150">"I don't want to learn about how the stack operates or about how it's configured.</span></span> <span data-ttu-id="15e0e-151">Jednoduše chci provést některé operace v jednoduché způsobem nejvíce s velkou pravděpodobností používání rozhraní API úspěšně."</span><span class="sxs-lookup"><span data-stu-id="15e0e-151">I simply want to perform some operation in as simple a manner as possible with high probability of using the APIs successfully."</span></span>

2. <span data-ttu-id="15e0e-152">[Rozhraní API pro konfiguraci](xref:security/data-protection/configuration/overview) cílit na vývojáře aplikací a správce systému.</span><span class="sxs-lookup"><span data-stu-id="15e0e-152">The [configuration APIs](xref:security/data-protection/configuration/overview) target application developers and system administrators.</span></span>

   <span data-ttu-id="15e0e-153">"Potřebuji systém ochrany dat říct, že Moje prostředí vyžaduje jiné než výchozí cesty nebo nastavení."</span><span class="sxs-lookup"><span data-stu-id="15e0e-153">"I need to tell the data protection system that my environment requires non-default paths or settings."</span></span>

3. <span data-ttu-id="15e0e-154">Rozšiřitelnost vývojáři cílové rozhraní API starosti implementace vlastních zásad.</span><span class="sxs-lookup"><span data-stu-id="15e0e-154">The extensibility APIs target developers in charge of implementing custom policy.</span></span> <span data-ttu-id="15e0e-155">Použití těchto rozhraní API by omezena na výjimečné situace a zkušenosti vývojáře používající zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="15e0e-155">Usage of these APIs would be limited to rare situations and experienced, security aware developers.</span></span>

   <span data-ttu-id="15e0e-156">"Potřebuji nahradit celý komponenty v rámci systému, protože mám stane skutečně jedinečná chování požadavky.</span><span class="sxs-lookup"><span data-stu-id="15e0e-156">"I need to replace an entire component within the system because I have truly unique behavioral requirements.</span></span> <span data-ttu-id="15e0e-157">Souhlasím s posíláním další uncommonly použít části plochy rozhraní API k vytvoření modulu plug-in, který splňuje mé požadavky."</span><span class="sxs-lookup"><span data-stu-id="15e0e-157">I am willing to learn uncommonly-used parts of the API surface in order to build a plugin that fulfills my requirements."</span></span>

## <a name="package-layout"></a><span data-ttu-id="15e0e-158">Rozložení balíčku</span><span class="sxs-lookup"><span data-stu-id="15e0e-158">Package Layout</span></span>

<span data-ttu-id="15e0e-159">Zásobník ochrany dat se skládá z pěti balíčky.</span><span class="sxs-lookup"><span data-stu-id="15e0e-159">The data protection stack consists of five packages.</span></span>

* <span data-ttu-id="15e0e-160">Microsoft.AspNetCore.DataProtection.Abstractions obsahuje základní IDataProtectionProvider a IDataProtector rozhraní.</span><span class="sxs-lookup"><span data-stu-id="15e0e-160">Microsoft.AspNetCore.DataProtection.Abstractions contains the basic IDataProtectionProvider and IDataProtector interfaces.</span></span> <span data-ttu-id="15e0e-161">Obsahuje také užitečné rozšiřující metody, které vám můžou pomoct práci s těmito typy (například přetížení IDataProtector.Protect).</span><span class="sxs-lookup"><span data-stu-id="15e0e-161">It also contains useful extension methods that can assist working with these types (e.g., overloads of IDataProtector.Protect).</span></span> <span data-ttu-id="15e0e-162">V části příjemce rozhraní pro další informace.</span><span class="sxs-lookup"><span data-stu-id="15e0e-162">See the consumer interfaces section for more information.</span></span> <span data-ttu-id="15e0e-163">Pokud někomu jinému zodpovídá za vytvoření instance systému ochrany dat a jsou jednoduše používat rozhraní API, budete chtít odkaz Microsoft.AspNetCore.DataProtection.Abstractions.</span><span class="sxs-lookup"><span data-stu-id="15e0e-163">If somebody else is responsible for instantiating the data protection system and you are simply consuming the APIs, you'll want to reference Microsoft.AspNetCore.DataProtection.Abstractions.</span></span>

* <span data-ttu-id="15e0e-164">Microsoft.AspNetCore.DataProtection obsahuje základní implementaci systému ochrany dat, včetně základních kryptografických operací, správu klíčů, konfigurace a rozšíření.</span><span class="sxs-lookup"><span data-stu-id="15e0e-164">Microsoft.AspNetCore.DataProtection contains the core implementation of the data protection system, including the core cryptographic operations, key management, configuration, and extensibility.</span></span> <span data-ttu-id="15e0e-165">Pokud jste za vytvoření instance systému ochrany dat (například zvýšení ho IServiceCollection) nebo úpravě nebo rozšiřování své chování, budete chtít odkaz Microsoft.AspNetCore.DataProtection.</span><span class="sxs-lookup"><span data-stu-id="15e0e-165">If you're responsible for instantiating the data protection system (e.g., adding it to an IServiceCollection) or modifying or extending its behavior, you'll want to reference Microsoft.AspNetCore.DataProtection.</span></span>

* <span data-ttu-id="15e0e-166">Microsoft.AspNetCore.DataProtection.Extensions obsahuje další rozhraní API vývojáři můžou být užitečné, ale které nepatří do balíčku core.</span><span class="sxs-lookup"><span data-stu-id="15e0e-166">Microsoft.AspNetCore.DataProtection.Extensions contains additional APIs which developers might find useful but which don't belong in the core package.</span></span> <span data-ttu-id="15e0e-167">Například tento balíček obsahuje jednoduché "vytvořit instanci systém odkazuje na konkrétní úložiště klíčů adresář se žádné nastavení injektáž závislostí" rozhraní API (Další informace).</span><span class="sxs-lookup"><span data-stu-id="15e0e-167">For instance, this package contains a simple "instantiate the system pointing at a specific key storage directory with no dependency injection setup" API (more info).</span></span> <span data-ttu-id="15e0e-168">Také obsahuje rozšiřující metody pro omezení životnosti chráněných datových částí (Další informace).</span><span class="sxs-lookup"><span data-stu-id="15e0e-168">It also contains extension methods for limiting the lifetime of protected payloads (more info).</span></span>

* <span data-ttu-id="15e0e-169">Microsoft.AspNetCore.DataProtection.SystemWeb lze nainstalovat do stávající aplikace ASP.NET 4.x přesměrovat její &lt;machineKey&gt; operace místo toho použít nový zásobník ochrany dat.</span><span class="sxs-lookup"><span data-stu-id="15e0e-169">Microsoft.AspNetCore.DataProtection.SystemWeb can be installed into an existing ASP.NET 4.x application to redirect its &lt;machineKey&gt; operations to instead use the new data protection stack.</span></span> <span data-ttu-id="15e0e-170">Zobrazit [kompatibility](xref:security/data-protection/compatibility/replacing-machinekey#compatibility-replacing-machinekey) Další informace.</span><span class="sxs-lookup"><span data-stu-id="15e0e-170">See [compatibility](xref:security/data-protection/compatibility/replacing-machinekey#compatibility-replacing-machinekey) for more information.</span></span>

* <span data-ttu-id="15e0e-171">Microsoft.AspNetCore.Cryptography.KeyDerivation poskytuje implementaci pro hashování rutina PBKDF2 hesel a mohou být využívána systémy, které je potřeba zpracovat uživatelská hesla zabezpečeně.</span><span class="sxs-lookup"><span data-stu-id="15e0e-171">Microsoft.AspNetCore.Cryptography.KeyDerivation provides an implementation of the PBKDF2 password hashing routine and can be used by systems which need to handle user passwords securely.</span></span> <span data-ttu-id="15e0e-172">Zobrazit [hodnoty Hash hesla](xref:security/data-protection/consumer-apis/password-hashing) Další informace.</span><span class="sxs-lookup"><span data-stu-id="15e0e-172">See [Hash passwords](xref:security/data-protection/consumer-apis/password-hashing) for more information.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="15e0e-173">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="15e0e-173">Additional resources</span></span>

<xref:host-and-deploy/web-farm>
