---
title: Filtry v ASP.NET Core
author: ardalis
description: Zjistěte, jak fungují filtry a jejich použití v aplikaci ASP.NET MVC jádra.
manager: wpickett
ms.author: tdykstra
ms.date: 12/12/2016
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: mvc/controllers/filters
ms.openlocfilehash: 7a857bc60500985c9b0547dc0d7e372e987a9099
ms.sourcegitcommit: d45d766504c2c5aad2453f01f089bc6b696b5576
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/30/2018
---
# <a name="filters-in-aspnet-core"></a><span data-ttu-id="d1a2a-103">Filtry v ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d1a2a-103">Filters in ASP.NET Core</span></span>

<span data-ttu-id="d1a2a-104">Podle [tní Dykstra](https://github.com/tdykstra/) a [Steve Smith](https://ardalis.com/)</span><span class="sxs-lookup"><span data-stu-id="d1a2a-104">By [Tom Dykstra](https://github.com/tdykstra/) and [Steve Smith](https://ardalis.com/)</span></span>

<span data-ttu-id="d1a2a-105">*Filtry* v aplikaci ASP.NET MVC základní umožňují spustit kód před nebo po určité fáze v kanálu zpracování požadavků.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-105">*Filters* in ASP.NET Core MVC allow you to run code before or after certain stages in the request processing pipeline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d1a2a-106">Toto téma neobsahuje **není** platí pro stránky Razor.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-106">This topic does **not** apply to Razor Pages.</span></span> <span data-ttu-id="d1a2a-107">ASP.NET Core 2.1 preview a novější podporuje `IPageFilter` a `IAsyncPageFilter` pro stránky Razor.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-107">ASP.NET Core 2.1 preview and later supports `IPageFilter` and `IAsyncPageFilter` for Razor Pages.</span></span>

 <span data-ttu-id="d1a2a-108">Integrované filtry popisovač úlohy, jako je například autorizace (brání přístupu k prostředkům, které uživatel není oprávněn), zajistíte, že všechny požadavky používat protokol HTTPS a reakce na ukládání do mezipaměti (krátká smyčka kanál požadavku k vrácení odpovědi v mezipaměti).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-108">Built-in filters handle tasks such as authorization (preventing access to resources a user isn't authorized for), ensuring that all requests use HTTPS, and response caching (short-circuiting the request pipeline to return a cached response).</span></span> 

<span data-ttu-id="d1a2a-109">Můžete vytvořit vlastní filtry pro zpracování mezi vyjímání otázky pro vaši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-109">You can create custom filters to handle cross-cutting concerns for your application.</span></span> <span data-ttu-id="d1a2a-110">Kdykoliv budete chtít vyhnout duplikování kód napříč akce, jsou filtry řešení.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-110">Anytime you want to avoid duplicating code across actions, filters are the solution.</span></span> <span data-ttu-id="d1a2a-111">Můžete například konsolidovat kód ve filtru výjimek pro zpracování chyb.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-111">For example, you can consolidate error handling code in a exception filter.</span></span>

<span data-ttu-id="d1a2a-112">[Zobrazení nebo stažení ukázky z webu GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-112">[View or download sample from GitHub](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span></span>

## <a name="how-do-filters-work"></a><span data-ttu-id="d1a2a-113">Jak filtry funguje?</span><span class="sxs-lookup"><span data-stu-id="d1a2a-113">How do filters work?</span></span>

<span data-ttu-id="d1a2a-114">Filtry se spouští v rámci *kanál vyvolání akce MVC*, která se někdy označují jako *filtru kanálu*.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-114">Filters run within the *MVC action invocation pipeline*, sometimes referred to as the *filter pipeline*.</span></span>  <span data-ttu-id="d1a2a-115">Filtr kanálu spustí po MVC vybere akci provést.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-115">The filter pipeline runs after MVC selects the action to execute.</span></span>

![Další Middleware, směrování Middleware, výběr akce a kanál vyvolání akce MVC zpracování žádosti.](filters/_static/filter-pipeline-1.png)

### <a name="filter-types"></a><span data-ttu-id="d1a2a-118">Typy filtrů</span><span class="sxs-lookup"><span data-stu-id="d1a2a-118">Filter types</span></span>

<span data-ttu-id="d1a2a-119">Jednotlivých typů filtrů se spustí v různých fáze v kanálu filtru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-119">Each filter type is executed at a different stage in the filter pipeline.</span></span>

* <span data-ttu-id="d1a2a-120">[Filtry autorizace](#authorization-filters) spouští jako první a slouží k určení, zda je aktuální uživatel oprávnění pro aktuální požadavek.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-120">[Authorization filters](#authorization-filters) run first and are used to determine whether the current user is authorized for the current request.</span></span> <span data-ttu-id="d1a2a-121">Pokud požadavek není autorizovaný se může krátká smyčka kanálu.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-121">They can short-circuit the pipeline if a request is unauthorized.</span></span> 

* <span data-ttu-id="d1a2a-122">[Filtry prostředků](#resource-filters) jsou první, má požadavek zpracovat po autorizaci.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-122">[Resource filters](#resource-filters) are the first to handle a request after authorization.</span></span>  <span data-ttu-id="d1a2a-123">Mohou spouštět kód před rest kanálu filtru, a po dokončení zbytek kanálu.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-123">They can run code before the rest of the filter pipeline, and after the rest of the pipeline has completed.</span></span> <span data-ttu-id="d1a2a-124">Jsou užitečná implementovat ukládání do mezipaměti nebo jinak krátká smyčka filtru kanálu z důvodů výkonu.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-124">They're useful to implement caching or otherwise short-circuit the filter pipeline for performance reasons.</span></span> <span data-ttu-id="d1a2a-125">Vzhledem k tomu, že se spustit před navázáním modelu, jsou užitečná pro všechny položky, které potřebuje k ovlivnění vazby modelu.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-125">Since they run before model binding, they're useful for anything that needs to influence model binding.</span></span>

* <span data-ttu-id="d1a2a-126">[Filtry akcí](#action-filters) můžete spustit kód bezprostředně před a po volání metody jednotlivé akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-126">[Action filters](#action-filters) can run code immediately before and after an individual action method is called.</span></span> <span data-ttu-id="d1a2a-127">Můžete se použít k manipulaci s argumenty předávané do akce a výsledku vrácený z akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-127">They can be used to manipulate the arguments passed into an action and the result returned from the action.</span></span>

* <span data-ttu-id="d1a2a-128">[Filtry výjimek](#exception-filters) lze použít globální zásady neošetřených výjimek, které udělat předtím, než nic byla zapsána na text odpovědi.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-128">[Exception filters](#exception-filters) are used to apply global policies to unhandled exceptions that occur before anything has been written to the response body.</span></span>

* <span data-ttu-id="d1a2a-129">[Vést filtry](#result-filters) můžete spustit kód bezprostředně před a po provedení výsledky jednotlivé akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-129">[Result filters](#result-filters) can run code immediately before and after the execution of individual action results.</span></span> <span data-ttu-id="d1a2a-130">Tyto spustit jenom v případě, že byl úspěšně proveden metody akce a jsou užitečné pro logiku, která musí obklopit zobrazení nebo formátování provádění.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-130">They run only when the action method has executed successfully and are useful for logic that must surround view or formatter execution.</span></span>

<span data-ttu-id="d1a2a-131">Následující diagram znázorňuje interakci tyto typy filtrů v kanálu filtru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-131">The following diagram shows how these filter types interact in the filter pipeline.</span></span>

![Filtry autorizace, filtry prostředků, vazby modelu, filtry akce, provádění akce a akce výsledek převodu, filtry výjimek, filtry výsledků a výsledek spuštění zpracování žádosti.](filters/_static/filter-pipeline-2.png)

## <a name="implementation"></a><span data-ttu-id="d1a2a-134">Implementace</span><span class="sxs-lookup"><span data-stu-id="d1a2a-134">Implementation</span></span>

<span data-ttu-id="d1a2a-135">Filtry podporují synchronní a asynchronní implementace prostřednictvím různých rozhraní definice.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-135">Filters support both synchronous and asynchronous implementations through different interface definitions.</span></span> <span data-ttu-id="d1a2a-136">Vyberte buď synchronizace nebo asynchronní variant v závislosti na druhu úlohy, kterou je třeba provést.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-136">Choose either the sync or async variant depending on the kind of task you need to perform.</span></span> 

<span data-ttu-id="d1a2a-137">Synchronní filtry, které můžete spustit kód před a po jejich fáze kanálu definovat na*fáze*zpracování a na*fáze*provést metody.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-137">Synchronous filters that can run code both before and after their pipeline stage define On*Stage*Executing and On*Stage*Executed methods.</span></span> <span data-ttu-id="d1a2a-138">Například `OnActionExecuting` je volána před zavolání metody akce a `OnActionExecuted` je volána po metodě akce vrátí.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-138">For example, `OnActionExecuting` is called before the action method is called, and `OnActionExecuted` is called after the action method returns.</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Filters/SampleActionFilter.cs?&name=snippet1)]

<span data-ttu-id="d1a2a-139">Asynchronní filtry definovat jeden na*fáze*ExecutionAsync metoda.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-139">Asynchronous filters define a single On*Stage*ExecutionAsync method.</span></span> <span data-ttu-id="d1a2a-140">Tato metoda přebírá *FilterType*ExecutionDelegate delegáta, který provede fáze kanálu se filtr.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-140">This method takes a *FilterType*ExecutionDelegate delegate which executes the filter's pipeline stage.</span></span> <span data-ttu-id="d1a2a-141">Například `ActionExecutionDelegate` volání metody akce a může spustit kód před a po jeho volání.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-141">For example, `ActionExecutionDelegate` calls the action method, and you can execute code before and after you call it.</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Filters/SampleAsyncActionFilter.cs?highlight=6,8-10,13)]

<span data-ttu-id="d1a2a-142">Můžete implementovat rozhraní pro několik fází filtru do jedné třídy.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-142">You can implement interfaces for multiple filter stages in a single class.</span></span> <span data-ttu-id="d1a2a-143">Například [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) abstraktní třída implementuje obě `IActionFilter` a `IResultFilter`, a také jejich ekvivalenty asynchronní.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-143">For example, the [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) abstract class implements both `IActionFilter` and `IResultFilter`, as well as their async equivalents.</span></span>

> [!NOTE]
> <span data-ttu-id="d1a2a-144">Implementace **buď** synchronní nebo asynchronní verzi rozhraní filtru, nikoli oba dva.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-144">Implement **either** the synchronous or the async version of a filter interface, not both.</span></span> <span data-ttu-id="d1a2a-145">Rozhraní framework zkontroluje nejprve Pokud filtr implementuje rozhraní asynchronní, a pokud ano, který volá.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-145">The framework checks first to see if the filter implements the async interface, and if so, it calls that.</span></span> <span data-ttu-id="d1a2a-146">Pokud tomu tak není, volá metodu nebo metody rozhraní synchronní.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-146">If not, it calls the synchronous interface's method(s).</span></span> <span data-ttu-id="d1a2a-147">Pokud byste chtěli implementovat obě rozhraní na jednu třídu, by volá asynchronní metody.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-147">If you were to implement both interfaces on one class, only the async method would be called.</span></span> <span data-ttu-id="d1a2a-148">Při používání abstraktních tříd jako [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) by se mělo přepsat pouze metodu synchronní nebo asynchronní metody pro každý typ filtru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-148">When using abstract classes like [ActionFilterAttribute](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionfilterattribute) you would override only the synchronous methods or the async method for each filter type.</span></span>

### <a name="ifilterfactory"></a><span data-ttu-id="d1a2a-149">IFilterFactory</span><span class="sxs-lookup"><span data-stu-id="d1a2a-149">IFilterFactory</span></span>

<span data-ttu-id="d1a2a-150">`IFilterFactory` implementuje `IFilter`.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-150">`IFilterFactory` implements `IFilter`.</span></span> <span data-ttu-id="d1a2a-151">Proto `IFilterFactory` instanci SQL lze použít jako `IFilter` instance kdekoli v kanálu filtru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-151">Therefore, an `IFilterFactory` instance can be used as an `IFilter` instance anywhere in the filter pipeline.</span></span> <span data-ttu-id="d1a2a-152">Když rozhraní připraví vyvolání filtr, pokusí se vysílat `IFilterFactory`.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-152">When the framework prepares to invoke the filter, it attempts to cast it to an `IFilterFactory`.</span></span> <span data-ttu-id="d1a2a-153">Pokud tento přetypování úspěšné, `CreateInstance` metoda je volána k vytvoření `IFilter` instance, která bude volána.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-153">If that cast succeeds, the `CreateInstance` method is called to create the `IFilter` instance that will be invoked.</span></span> <span data-ttu-id="d1a2a-154">To umožňuje návrh s velmi flexibilní, protože kanál přesné filtru nemusí být explicitně nastaveno při spuštění aplikace.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-154">This provides a very flexible design, since the precise filter pipeline doesn't need to be set explicitly when the application starts.</span></span>

<span data-ttu-id="d1a2a-155">Můžete implementovat `IFilterFactory` na vlastní atribut implementace jako další postup pro vytvoření filtrů:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-155">You can implement `IFilterFactory` on your own attribute implementations as another approach to creating filters:</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Filters/AddHeaderWithFactoryAttribute.cs?name=snippet_IFilterFactory&highlight=1,4,5,6,7)]

### <a name="built-in-filter-attributes"></a><span data-ttu-id="d1a2a-156">Integrovaný filtr atributy</span><span class="sxs-lookup"><span data-stu-id="d1a2a-156">Built-in filter attributes</span></span>

<span data-ttu-id="d1a2a-157">Rozhraní framework zahrnuje integrované filtry na základě atributů, můžete podtřídami a přizpůsobit.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-157">The framework includes built-in attribute-based filters that you can subclass and customize.</span></span> <span data-ttu-id="d1a2a-158">Například následující filtr výsledků přidá hlavičku odpovědi.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-158">For example, the following Result filter adds a header to the response.</span></span>

<a name="add-header-attribute"></a>

[!code-csharp[](./filters/sample/src/FiltersSample/Filters/AddHeaderAttribute.cs?highlight=5,16)]

<span data-ttu-id="d1a2a-159">Atributy Povolit filtry tak, aby přijímal argumenty, jak je znázorněno v příkladu nahoře.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-159">Attributes allow filters to accept arguments, as shown in the example above.</span></span> <span data-ttu-id="d1a2a-160">By přidat tento atribut do metody kontroler nebo akce a zadejte název a hodnotu záhlaví HTTP:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-160">You would add this attribute to a controller or action method and specify the name and value of the HTTP header:</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Controllers/SampleController.cs?name=snippet_AddHeader&highlight=1)]

<span data-ttu-id="d1a2a-161">Výsledkem `Index` akce jsou uvedeny níže – hlavičky odpovědi jsou zobrazené na vpravo dole.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-161">The result of the `Index` action is shown below - the response headers are displayed on the bottom right.</span></span>

![Vývojáře nástroje Microsoft Edge zobrazující hlavičky odpovědi, včetně Autor Steve Smith @ardalis](filters/_static/add-header.png)

<span data-ttu-id="d1a2a-163">Některé z rozhraní filtru mít odpovídající atributy, které můžete použít jako základní třídy pro vlastní implementace.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-163">Several of the filter interfaces have corresponding attributes that can be used as base classes for custom implementations.</span></span>

<span data-ttu-id="d1a2a-164">Atributy filtru:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-164">Filter attributes:</span></span>

* `ActionFilterAttribute`
* `ExceptionFilterAttribute`
* `ResultFilterAttribute`
* `FormatFilterAttribute`
* `ServiceFilterAttribute`
* `TypeFilterAttribute`

<span data-ttu-id="d1a2a-165">`TypeFilterAttribute` a `ServiceFilterAttribute` jsou vysvětleny [dále v tomto článku](#dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-165">`TypeFilterAttribute` and `ServiceFilterAttribute` are explained [later in this article](#dependency-injection).</span></span>

## <a name="filter-scopes-and-order-of-execution"></a><span data-ttu-id="d1a2a-166">Oborů filtru a pořadí provádění</span><span class="sxs-lookup"><span data-stu-id="d1a2a-166">Filter scopes and order of execution</span></span>

<span data-ttu-id="d1a2a-167">Filtr lze přidat do tohoto kanálu v některém z tři *obory*.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-167">A filter can be added to the pipeline at one of three *scopes*.</span></span> <span data-ttu-id="d1a2a-168">Pomocí atributu můžete přidat filtr k určité metodě akce nebo třídy kontroleru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-168">You can add a filter to a particular action method or to a controller class by using an attribute.</span></span> <span data-ttu-id="d1a2a-169">Nebo můžete zaregistrovat filtr globálně (pro všechny kontrolery a akce) přidejte jej do `MvcOptions.Filters` kolekce v `ConfigureServices` metoda v `Startup` – třída:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-169">Or you can register a filter globally (for all controllers and actions) by adding it to the `MvcOptions.Filters` collection in the `ConfigureServices` method in the `Startup` class:</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Startup.cs?name=snippet_ConfigureServices&highlight=5-8)]

### <a name="default-order-of-execution"></a><span data-ttu-id="d1a2a-170">Výchozí pořadí provádění</span><span class="sxs-lookup"><span data-stu-id="d1a2a-170">Default order of execution</span></span>

<span data-ttu-id="d1a2a-171">Pokud je pro konkrétní fáze kanálu více filtrů, obor Určuje výchozí pořadí spuštění filtrů.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-171">When there are multiple filters for a particular stage of the pipeline, scope determines the default order of filter execution.</span></span>  <span data-ttu-id="d1a2a-172">Globální filtry obklopit třída filtrů, které pak obklopit metoda filtry.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-172">Global filters surround class filters, which in turn surround method filters.</span></span> <span data-ttu-id="d1a2a-173">To je někdy označuje jako "Ruština panenky" vnoření jako každé zvýšení rozsahu zabalená kolem předchozí oboru, jako je [vnoření panenky](https://wikipedia.org/wiki/Matryoshka_doll).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-173">This is sometimes referred to as "Russian doll" nesting, as each increase in scope is wrapped around the previous scope, like a [nesting doll](https://wikipedia.org/wiki/Matryoshka_doll).</span></span> <span data-ttu-id="d1a2a-174">Toto chování žádoucí přepsání obecně získáte bez nutnosti explicitně určit řazení.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-174">You generally get the desired overriding behavior without having to explicitly determine ordering.</span></span>

<span data-ttu-id="d1a2a-175">V důsledku této vnoření *po* spuštění kódu filtrů v obráceném pořadí, než *před* kódu.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-175">As a result of this nesting, the *after* code of filters runs in the reverse order of the *before* code.</span></span> <span data-ttu-id="d1a2a-176">Pořadí vypadá takto:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-176">The sequence looks like this:</span></span>

* <span data-ttu-id="d1a2a-177">*Před* kód filtry, které jsou použity globálně</span><span class="sxs-lookup"><span data-stu-id="d1a2a-177">The *before* code of filters applied globally</span></span>
  * <span data-ttu-id="d1a2a-178">*Před* kód filtry u řadiče</span><span class="sxs-lookup"><span data-stu-id="d1a2a-178">The *before* code of filters applied to controllers</span></span>
    * <span data-ttu-id="d1a2a-179">*Před* kód filtry u metody akce</span><span class="sxs-lookup"><span data-stu-id="d1a2a-179">The *before* code of filters applied to action methods</span></span>
    * <span data-ttu-id="d1a2a-180">*Po* kód filtry u metody akce</span><span class="sxs-lookup"><span data-stu-id="d1a2a-180">The *after* code of filters applied to action methods</span></span>
  * <span data-ttu-id="d1a2a-181">*Po* kód filtry u řadiče</span><span class="sxs-lookup"><span data-stu-id="d1a2a-181">The *after* code of filters applied to controllers</span></span>
* <span data-ttu-id="d1a2a-182">*Po* kód filtry, které jsou použity globálně</span><span class="sxs-lookup"><span data-stu-id="d1a2a-182">The *after* code of filters applied globally</span></span>
  
<span data-ttu-id="d1a2a-183">Tady je příklad, který znázorňuje pořadí, ve které filtru se nazývají metody pro synchronní filtrů akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-183">Here's an example that illustrates the order in which filter methods are called for synchronous Action filters.</span></span>

| <span data-ttu-id="d1a2a-184">Pořadí</span><span class="sxs-lookup"><span data-stu-id="d1a2a-184">Sequence</span></span> | <span data-ttu-id="d1a2a-185">Obor filtru</span><span class="sxs-lookup"><span data-stu-id="d1a2a-185">Filter scope</span></span> | <span data-ttu-id="d1a2a-186">Filter – metoda</span><span class="sxs-lookup"><span data-stu-id="d1a2a-186">Filter method</span></span> |
|:--------:|:------------:|:-------------:|
| <span data-ttu-id="d1a2a-187">1</span><span class="sxs-lookup"><span data-stu-id="d1a2a-187">1</span></span> | <span data-ttu-id="d1a2a-188">Globální</span><span class="sxs-lookup"><span data-stu-id="d1a2a-188">Global</span></span> | `OnActionExecuting` |
| <span data-ttu-id="d1a2a-189">2</span><span class="sxs-lookup"><span data-stu-id="d1a2a-189">2</span></span> | <span data-ttu-id="d1a2a-190">Řadiče</span><span class="sxs-lookup"><span data-stu-id="d1a2a-190">Controller</span></span> | `OnActionExecuting` |
| <span data-ttu-id="d1a2a-191">3</span><span class="sxs-lookup"><span data-stu-id="d1a2a-191">3</span></span> | <span data-ttu-id="d1a2a-192">Metoda</span><span class="sxs-lookup"><span data-stu-id="d1a2a-192">Method</span></span> | `OnActionExecuting` |
| <span data-ttu-id="d1a2a-193">4</span><span class="sxs-lookup"><span data-stu-id="d1a2a-193">4</span></span> | <span data-ttu-id="d1a2a-194">Metoda</span><span class="sxs-lookup"><span data-stu-id="d1a2a-194">Method</span></span> | `OnActionExecuted` |
| <span data-ttu-id="d1a2a-195">5</span><span class="sxs-lookup"><span data-stu-id="d1a2a-195">5</span></span> | <span data-ttu-id="d1a2a-196">Řadiče</span><span class="sxs-lookup"><span data-stu-id="d1a2a-196">Controller</span></span> | `OnActionExecuted` |
| <span data-ttu-id="d1a2a-197">6</span><span class="sxs-lookup"><span data-stu-id="d1a2a-197">6</span></span> | <span data-ttu-id="d1a2a-198">Globální</span><span class="sxs-lookup"><span data-stu-id="d1a2a-198">Global</span></span> | `OnActionExecuted` |

<span data-ttu-id="d1a2a-199">Toto pořadí ukazuje, že je metoda filtr vnořených ve filtru řadiče a filtr řadiče vnořen v rámci globálních filtrů.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-199">This sequence shows that the method filter is nested within the controller filter, and the controller filter is nested within the global filter.</span></span> <span data-ttu-id="d1a2a-200">Pro něj jiný způsob, pokud jste uvnitř filtr asynchronní adresy na*fáze*ExecutionAsync metoda všechny filtry náročnější oboru spustit, když kódu v zásobníku.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-200">To put it another way, if you're inside an async filter's On*Stage*ExecutionAsync method, all of the filters with a tighter scope run while your code is on the stack.</span></span>

> [!NOTE]
> <span data-ttu-id="d1a2a-201">Každý řadič, která dědí z `Controller` základní třída zahrnuje `OnActionExecuting` a `OnActionExecuted` metody.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-201">Every controller that inherits from the `Controller` base class includes `OnActionExecuting` and `OnActionExecuted` methods.</span></span> <span data-ttu-id="d1a2a-202">Tyto metody zabalení používající filtry pro danou akci: `OnActionExecuting` je volána před provedením filtry, a `OnActionExecuted` je volána po všechny filtry.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-202">These methods wrap the filters that run for a given action:  `OnActionExecuting` is called before any of the filters, and `OnActionExecuted` is called after all of the filters.</span></span>

### <a name="overriding-the-default-order"></a><span data-ttu-id="d1a2a-203">Přepsání výchozího pořadí</span><span class="sxs-lookup"><span data-stu-id="d1a2a-203">Overriding the default order</span></span>

<span data-ttu-id="d1a2a-204">Můžete přepsat výchozí pořadí provádění implementací `IOrderedFilter`.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-204">You can override the default sequence of execution by implementing `IOrderedFilter`.</span></span> <span data-ttu-id="d1a2a-205">Toto rozhraní zpřístupní `Order` vlastnost, která má přednost před oboru k určení pořadí zpracování.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-205">This interface exposes an `Order` property that takes precedence over scope to determine the order of execution.</span></span> <span data-ttu-id="d1a2a-206">Filtr s nižší `Order` bude mít hodnotu jeho *před* kód spustit před filtru s vyšší hodnotou `Order`.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-206">A filter with a lower `Order` value will have its *before* code executed before that of a filter with a higher value of `Order`.</span></span> <span data-ttu-id="d1a2a-207">Filtr s nižší `Order` bude mít hodnotu jeho *po* kód provést, po který filtr s vyšším `Order` hodnotu.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-207">A filter with a lower `Order` value will have its *after* code executed after that of a filter with a higher `Order` value.</span></span> <span data-ttu-id="d1a2a-208">Můžete nastavit `Order` vlastnost pomocí parametr konstruktoru:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-208">You can set the `Order` property by using a constructor parameter:</span></span>

```csharp
[MyFilter(Name = "Controller Level Attribute", Order=1)]
```

<span data-ttu-id="d1a2a-209">Pokud máte stejné 3 filtrů akce uvedené v předchozí příklad ale sadu `Order` vlastnost řadiče a globální filtry na 1 a 2 v uvedeném pořadí, pořadí provádění by být změněn na opačný.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-209">If you have the same 3 Action filters shown in the preceding example but set the `Order` property of the controller and global filters to 1 and 2 respectively, the order of execution would be reversed.</span></span>

| <span data-ttu-id="d1a2a-210">Pořadí</span><span class="sxs-lookup"><span data-stu-id="d1a2a-210">Sequence</span></span> | <span data-ttu-id="d1a2a-211">Obor filtru</span><span class="sxs-lookup"><span data-stu-id="d1a2a-211">Filter scope</span></span> | <span data-ttu-id="d1a2a-212">`Order` Vlastnost</span><span class="sxs-lookup"><span data-stu-id="d1a2a-212">`Order` property</span></span> | <span data-ttu-id="d1a2a-213">Filter – metoda</span><span class="sxs-lookup"><span data-stu-id="d1a2a-213">Filter method</span></span> |
|:--------:|:------------:|:-----------------:|:-------------:|
| <span data-ttu-id="d1a2a-214">1</span><span class="sxs-lookup"><span data-stu-id="d1a2a-214">1</span></span> | <span data-ttu-id="d1a2a-215">Metoda</span><span class="sxs-lookup"><span data-stu-id="d1a2a-215">Method</span></span> | <span data-ttu-id="d1a2a-216">0</span><span class="sxs-lookup"><span data-stu-id="d1a2a-216">0</span></span> | `OnActionExecuting` |
| <span data-ttu-id="d1a2a-217">2</span><span class="sxs-lookup"><span data-stu-id="d1a2a-217">2</span></span> | <span data-ttu-id="d1a2a-218">Řadiče</span><span class="sxs-lookup"><span data-stu-id="d1a2a-218">Controller</span></span> | <span data-ttu-id="d1a2a-219">1</span><span class="sxs-lookup"><span data-stu-id="d1a2a-219">1</span></span>  | `OnActionExecuting` |
| <span data-ttu-id="d1a2a-220">3</span><span class="sxs-lookup"><span data-stu-id="d1a2a-220">3</span></span> | <span data-ttu-id="d1a2a-221">Globální</span><span class="sxs-lookup"><span data-stu-id="d1a2a-221">Global</span></span> | <span data-ttu-id="d1a2a-222">2</span><span class="sxs-lookup"><span data-stu-id="d1a2a-222">2</span></span>  | `OnActionExecuting` |
| <span data-ttu-id="d1a2a-223">4</span><span class="sxs-lookup"><span data-stu-id="d1a2a-223">4</span></span> | <span data-ttu-id="d1a2a-224">Globální</span><span class="sxs-lookup"><span data-stu-id="d1a2a-224">Global</span></span> | <span data-ttu-id="d1a2a-225">2</span><span class="sxs-lookup"><span data-stu-id="d1a2a-225">2</span></span>  | `OnActionExecuted` |
| <span data-ttu-id="d1a2a-226">5</span><span class="sxs-lookup"><span data-stu-id="d1a2a-226">5</span></span> | <span data-ttu-id="d1a2a-227">Řadiče</span><span class="sxs-lookup"><span data-stu-id="d1a2a-227">Controller</span></span> | <span data-ttu-id="d1a2a-228">1</span><span class="sxs-lookup"><span data-stu-id="d1a2a-228">1</span></span>  | `OnActionExecuted` |
| <span data-ttu-id="d1a2a-229">6</span><span class="sxs-lookup"><span data-stu-id="d1a2a-229">6</span></span> | <span data-ttu-id="d1a2a-230">Metoda</span><span class="sxs-lookup"><span data-stu-id="d1a2a-230">Method</span></span> | <span data-ttu-id="d1a2a-231">0</span><span class="sxs-lookup"><span data-stu-id="d1a2a-231">0</span></span>  | `OnActionExecuted` |

<span data-ttu-id="d1a2a-232">`Order` Vlastnost trumfy oboru při určení pořadí, ve kterém budou spouštět filtry.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-232">The `Order` property trumps scope when determining the order in which filters will run.</span></span> <span data-ttu-id="d1a2a-233">Filtry jsou seřazeny nejprve podle pořadí a oboru se používá k přerušení ties.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-233">Filters are sorted first by order, then scope is used to break ties.</span></span> <span data-ttu-id="d1a2a-234">Všechny z předdefinovaných filtrů implementovat `IOrderedFilter` a nastavte výchozí `Order` hodnotu na 0, takže obor určuje pořadí, pokud nastavíte `Order` na hodnotu nula.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-234">All of the built-in filters implement `IOrderedFilter` and set the default `Order` value to 0, so scope determines order unless you set `Order` to a non-zero value.</span></span>

## <a name="cancellation-and-short-circuiting"></a><span data-ttu-id="d1a2a-235">Zrušení a krátký circuiting</span><span class="sxs-lookup"><span data-stu-id="d1a2a-235">Cancellation and short circuiting</span></span>

<span data-ttu-id="d1a2a-236">Může krátká smyčka kanálu filtru v libovolném bodě nastavením `Result` vlastnost `context` zadaný parametr metodu filtru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-236">You can short-circuit the filter pipeline at any point by setting the `Result` property on the `context` parameter provided to the filter method.</span></span> <span data-ttu-id="d1a2a-237">Filtr prostředků pro instanci nebude zbytek kanálu spuštěn.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-237">For instance, the following Resource filter prevents the rest of the pipeline from executing.</span></span>

<a name="short-circuiting-resource-filter"></a>

[!code-csharp[](./filters/sample/src/FiltersSample/Filters/ShortCircuitingResourceFilterAttribute.cs?highlight=12,13,14,15)]

<span data-ttu-id="d1a2a-238">V následujícím kódu jak `ShortCircuitingResourceFilter` a `AddHeader` cílový filtr `SomeResource` metody akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-238">In the following code, both the `ShortCircuitingResourceFilter` and the `AddHeader` filter target the `SomeResource` action method.</span></span> <span data-ttu-id="d1a2a-239">Ale protože `ShortCircuitingResourceFilter` spustí první (vzhledem k tomu, že je filtr zdroje a `AddHeader` je filtr akce) a zkratům zbytek kanálu, `AddHeader` filtru nikdy běží `SomeResource` akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-239">However, because the `ShortCircuitingResourceFilter` runs first (because it's a Resource Filter and `AddHeader` is an Action Filter) and short-circuits the rest of the pipeline, the `AddHeader` filter never runs for the `SomeResource` action.</span></span> <span data-ttu-id="d1a2a-240">Toto chování by být stejné Pokud oba filtry, které byly použity na úrovni metody akce, zadaný `ShortCircuitingResourceFilter` spustil první (z důvodu jeho typ filtru nebo explicitní použití `Order` vlastnost, pro instanci).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-240">This behavior would be the same if both filters were applied at the action method level, provided the `ShortCircuitingResourceFilter` ran first (because of its filter type, or explicit use of `Order` property, for instance).</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Controllers/SampleController.cs?name=snippet_AddHeader&highlight=1,9)]

## <a name="dependency-injection"></a><span data-ttu-id="d1a2a-241">Vkládání závislostí</span><span class="sxs-lookup"><span data-stu-id="d1a2a-241">Dependency injection</span></span>

<span data-ttu-id="d1a2a-242">Filtry je možné přidat podle typu nebo instance.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-242">Filters can be added by type or by instance.</span></span> <span data-ttu-id="d1a2a-243">Pokud chcete přidat instance, tato instance se použije pro každý požadavek.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-243">If you add an instance, that instance will be used for every request.</span></span> <span data-ttu-id="d1a2a-244">Pokud přidáte typu, bude typ aktivované, což znamená, vytvoří se instance pro každý požadavek, a všechny závislosti konstruktor vyplní podle [vkládání závislostí](../../fundamentals/dependency-injection.md) (DI).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-244">If you add a type, it will be type-activated, meaning an instance will be created for each request and any constructor dependencies will be populated by [dependency injection](../../fundamentals/dependency-injection.md) (DI).</span></span> <span data-ttu-id="d1a2a-245">Přidání filtru podle typu je ekvivalentní `filters.Add(new TypeFilterAttribute(typeof(MyFilter)))`.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-245">Adding a filter by type is equivalent to `filters.Add(new TypeFilterAttribute(typeof(MyFilter)))`.</span></span>

<span data-ttu-id="d1a2a-246">Filtry, které jsou implementovány jako atributy a přidat přímo do třídy kontroleru nebo metody akce nemohou mít závislosti konstruktor poskytované [vkládání závislostí](../../fundamentals/dependency-injection.md) (DI).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-246">Filters that are implemented as attributes and added directly to controller classes or action methods cannot have constructor dependencies provided by [dependency injection](../../fundamentals/dependency-injection.md) (DI).</span></span> <span data-ttu-id="d1a2a-247">Je to proto, že atributy musí mít své konstruktor parametry zadané, kde uplatňují.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-247">This is because attributes must have their constructor parameters supplied where they're applied.</span></span> <span data-ttu-id="d1a2a-248">Jedná se o omezení o fungování atributy.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-248">This is a limitation of how attributes work.</span></span>

<span data-ttu-id="d1a2a-249">Pokud vaše filtrů závislosti, které potřebujete získat přístup z DI, existuje několik podporované přístupů.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-249">If your filters have dependencies that you need to access from DI, there are several supported approaches.</span></span> <span data-ttu-id="d1a2a-250">Vašemu filtru můžete použít pro třídu nebo akce metoda pomocí jedné z následujících akcí:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-250">You can apply your filter to a class or action method using one of the following:</span></span>

* `ServiceFilterAttribute`
* `TypeFilterAttribute`
* <span data-ttu-id="d1a2a-251">`IFilterFactory` na vaše atribut provedena.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-251">`IFilterFactory` implemented on your attribute</span></span>

> [!NOTE]
> <span data-ttu-id="d1a2a-252">Závislostí, které chcete získat z DI je protokolovacího nástroje.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-252">One dependency you might want to get from DI is a logger.</span></span> <span data-ttu-id="d1a2a-253">Však vyhnout se vytváření a použití filtrů výhradně pro účely protokolování, protože [funkce protokolování vestavěnou architekturou](xref:fundamentals/logging/index) již poskytnout co potřebujete.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-253">However, avoid creating and using filters purely for logging purposes, since the [built-in framework logging features](xref:fundamentals/logging/index) may already provide what you need.</span></span> <span data-ttu-id="d1a2a-254">Pokud se chystáte přidat protokolování do filtry, měli zaměřit na obchodní domény obavy nebo chování, které jsou specifické pro filtr, než akce MVC nebo dalších událostí, framework.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-254">If you're going to add logging to your filters, it should focus on business domain concerns or behavior specific to your filter, rather than MVC actions or other framework events.</span></span>

### <a name="servicefilterattribute"></a><span data-ttu-id="d1a2a-255">ServiceFilterAttribute</span><span class="sxs-lookup"><span data-stu-id="d1a2a-255">ServiceFilterAttribute</span></span>

<span data-ttu-id="d1a2a-256">A `ServiceFilter` načte z DI instance filtru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-256">A `ServiceFilter` retrieves an instance of the filter from DI.</span></span> <span data-ttu-id="d1a2a-257">Přidejte filtr do kontejneru v `ConfigureServices`a v odkazovat `ServiceFilter` atribut</span><span class="sxs-lookup"><span data-stu-id="d1a2a-257">You add the filter to the container in `ConfigureServices`, and reference it in a `ServiceFilter` attribute</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Startup.cs?name=snippet_ConfigureServices&highlight=11)]

[!code-csharp[](../../mvc/controllers/filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_ServiceFilter&highlight=1)]

<span data-ttu-id="d1a2a-258">Pomocí `ServiceFilter` bez registrace výsledky typu filtru výjimku:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-258">Using `ServiceFilter` without registering the filter type results in an exception:</span></span>

```
System.InvalidOperationException: No service for type
'FiltersSample.Filters.AddHeaderFilterWithDI' has been registered.
```

<span data-ttu-id="d1a2a-259">`ServiceFilterAttribute` implementuje `IFilterFactory`, který zpřístupňuje jedné metody pro vytvoření `IFilter` instance.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-259">`ServiceFilterAttribute` implements `IFilterFactory`, which exposes a single method for creating an `IFilter` instance.</span></span> <span data-ttu-id="d1a2a-260">U `ServiceFilterAttribute`, `IFilterFactory` rozhraní `CreateInstance` je implementovat metodu načtení zadaného typu z kontejneru služby (DI).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-260">In the case of `ServiceFilterAttribute`, the `IFilterFactory` interface's `CreateInstance` method is implemented to load the specified type from the services container (DI).</span></span>

### <a name="typefilterattribute"></a><span data-ttu-id="d1a2a-261">TypeFilterAttribute</span><span class="sxs-lookup"><span data-stu-id="d1a2a-261">TypeFilterAttribute</span></span>

<span data-ttu-id="d1a2a-262">`TypeFilterAttribute` je velmi podobné `ServiceFilterAttribute` (a také implementuje `IFilterFactory`), ale jeho typ není vyřešit přímo z DI kontejneru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-262">`TypeFilterAttribute` is very similar to `ServiceFilterAttribute` (and also implements `IFilterFactory`), but its type isn't resolved directly from the DI container.</span></span> <span data-ttu-id="d1a2a-263">Místo toho vytvoří typ pomocí `Microsoft.Extensions.DependencyInjection.ObjectFactory`.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-263">Instead, it instantiates the type by using `Microsoft.Extensions.DependencyInjection.ObjectFactory`.</span></span>

<span data-ttu-id="d1a2a-264">Vzhledem k tomuto rozdílu typy, které jsou odkazovány pomocí `TypeFilterAttribute` nepotřebují být registrováno v kontejneru, nejdřív (ale budou mít pořád závislé splnil kontejnerem).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-264">Because of this difference, types that are referenced using the `TypeFilterAttribute` don't need to be registered with the container first (but they will still have their dependencies fulfilled by the container).</span></span> <span data-ttu-id="d1a2a-265">Navíc `TypeFilterAttribute` může volitelně přijmout argumenty konstruktoru pro daný typ nejistá.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-265">Also, `TypeFilterAttribute` can optionally accept constructor arguments for the type in question.</span></span> <span data-ttu-id="d1a2a-266">Následující příklad ukazuje, jak předat argumenty typu pomocí `TypeFilterAttribute`:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-266">The following example demonstrates how to pass arguments to a type using `TypeFilterAttribute`:</span></span>

[!code-csharp[](../../mvc/controllers/filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_TypeFilter&highlight=1,2)]

<span data-ttu-id="d1a2a-267">Pokud máte filtr, který nevyžaduje žádné argumenty, ale který má konstruktor závislosti, které musí být vyplněna podle DI, můžete použít vlastní atribut s názvem na třídy a metody místo `[TypeFilter(typeof(FilterType))]`).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-267">If you have a filter that doesn't require any arguments, but which has constructor dependencies that need to be filled by DI, you can use your own named attribute on classes and methods instead of `[TypeFilter(typeof(FilterType))]`).</span></span> <span data-ttu-id="d1a2a-268">Filtr ukazuje, jak to lze provést:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-268">The following filter shows how this can be implemented:</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Filters/SampleActionFilterAttribute.cs?name=snippet_TypeFilterAttribute&highlight=1,3,7)]

<span data-ttu-id="d1a2a-269">Tento filtr lze použít na třídy nebo metody pomocí `[SampleActionFilter]` syntaxe, místo nutnosti použít `[TypeFilter]` nebo `[ServiceFilter]`.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-269">This filter can be applied to classes or methods using the `[SampleActionFilter]` syntax, instead of having to use `[TypeFilter]` or `[ServiceFilter]`.</span></span>

## <a name="authorization-filters"></a><span data-ttu-id="d1a2a-270">Filtry autorizace</span><span class="sxs-lookup"><span data-stu-id="d1a2a-270">Authorization filters</span></span>

<span data-ttu-id="d1a2a-271">*Filtry autorizace* řízení přístupu k metody akce a jsou první filtry, které mají být provedeny v rámci kanálu filtru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-271">*Authorization filters* control access to action methods and are the first filters to be executed within the filter pipeline.</span></span> <span data-ttu-id="d1a2a-272">Mají pouze před metoda, na rozdíl od většiny filtry, které podporují před a po metody.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-272">They have only a before method, unlike most filters that support before and after methods.</span></span> <span data-ttu-id="d1a2a-273">Filtr autorizace by měl zapisovat pouze pokud vytváříte vlastní framework autorizace.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-273">You should only write a custom authorization filter if you are writing your own authorization framework.</span></span> <span data-ttu-id="d1a2a-274">Dáváte přednost konfigurace zásad autorizace nebo zápis vlastní zásady autorizace přes psaní vlastního filtru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-274">Prefer configuring your authorization policies or writing a custom authorization policy over writing a custom filter.</span></span> <span data-ttu-id="d1a2a-275">Integrovaný filtr implementace právě zodpovídá za volání autorizace systému.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-275">The built-in filter implementation is just responsible for calling the authorization system.</span></span>

<span data-ttu-id="d1a2a-276">Všimněte si, že by neměl throw výjimky v rámci filtry autorizace, vzhledem k tomu, že nic zpracuje výjimku (filtry výjimek nebude zpracování je).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-276">Note that you shouldn't throw exceptions within authorization filters, since nothing will handle the exception (exception filters won't handle them).</span></span> <span data-ttu-id="d1a2a-277">Místo toho vydala výzvu nebo jiný způsob, jak najít.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-277">Instead, issue a challenge or find another way.</span></span>

<span data-ttu-id="d1a2a-278">Další informace o [autorizace](../../security/authorization/index.md).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-278">Learn more about [Authorization](../../security/authorization/index.md).</span></span>

## <a name="resource-filters"></a><span data-ttu-id="d1a2a-279">Filtry prostředků</span><span class="sxs-lookup"><span data-stu-id="d1a2a-279">Resource filters</span></span>

<span data-ttu-id="d1a2a-280">*Filtry prostředků* implementovat buď `IResourceFilter` nebo `IAsyncResourceFilter` rozhraní a jejich spuštění zabalí většinu kanálu filtru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-280">*Resource filters* implement either the `IResourceFilter` or `IAsyncResourceFilter` interface, and their execution wraps most of the filter pipeline.</span></span> <span data-ttu-id="d1a2a-281">(Jenom [filtry autorizace](#authorization-filters) spustit před sebou.) Prostředek filtry jsou obzvláště užitečné, pokud potřebujete krátká smyčka většinu práce, který provádí požadavek.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-281">(Only [Authorization filters](#authorization-filters) run before them.) Resource filters are especially useful if you need to short-circuit most of the work a request is doing.</span></span> <span data-ttu-id="d1a2a-282">Například se můžete vyhnout ukládání do mezipaměti filtr Pokud odpovědi v mezipaměti zbytek kanálu.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-282">For example, a caching filter can avoid the rest of the pipeline if the response is already in the cache.</span></span>

<span data-ttu-id="d1a2a-283">[Krátké circuiting filtr zdroje](#short-circuiting-resource-filter) uvedena výše je příkladem filtr zdroje.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-283">The [short circuiting resource filter](#short-circuiting-resource-filter) shown earlier is one example of a resource filter.</span></span> <span data-ttu-id="d1a2a-284">Dalším příkladem je [DisableFormValueModelBindingAttribute](https://github.com/aspnet/Entropy/blob/rel/1.1.1/samples/Mvc.FileUpload/Filters/DisableFormValueModelBindingAttribute.cs), která brání vazby modelu z přístupu k datům formuláře.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-284">Another example is [DisableFormValueModelBindingAttribute](https://github.com/aspnet/Entropy/blob/rel/1.1.1/samples/Mvc.FileUpload/Filters/DisableFormValueModelBindingAttribute.cs), which prevents model binding from accessing the form data.</span></span> <span data-ttu-id="d1a2a-285">Je užitečné v případě, pokud víte, že se chystáte přijímat nahrávání velkých souborů a chcete zabránit formuláře načítán do paměti.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-285">It's useful for cases where you know that you're going to receive large file uploads and want to prevent the form from being read into memory.</span></span>

## <a name="action-filters"></a><span data-ttu-id="d1a2a-286">Filtry akcí</span><span class="sxs-lookup"><span data-stu-id="d1a2a-286">Action filters</span></span>

<span data-ttu-id="d1a2a-287">*Filtry akcí* implementovat buď `IActionFilter` nebo `IAsyncActionFilter` rozhraní a jejich spuštění obklopuje provádění metody akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-287">*Action filters* implement either the `IActionFilter` or `IAsyncActionFilter` interface, and their execution surrounds the execution of action methods.</span></span>

<span data-ttu-id="d1a2a-288">Zde je ukázka filtr akce:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-288">Here's a sample action filter:</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Filters/SampleActionFilter.cs?name=snippet_ActionFilter)]

<span data-ttu-id="d1a2a-289">[ActionExecutingContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutingcontext) poskytuje následujících vlastností:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-289">The [ActionExecutingContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutingcontext) provides the following properties:</span></span>

* <span data-ttu-id="d1a2a-290">`ActionArguments` – umožňuje pracovat s vstupů pro akci.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-290">`ActionArguments` - lets you manipulate the inputs to the action.</span></span>
* <span data-ttu-id="d1a2a-291">`Controller` – umožňuje pracovat s instance kontroleru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-291">`Controller` - lets you manipulate the controller instance.</span></span> 
* <span data-ttu-id="d1a2a-292">`Result` -nastavení zkratům provádění metody akce a filtrů následné akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-292">`Result` - setting this short-circuits execution of the action method and subsequent action filters.</span></span> <span data-ttu-id="d1a2a-293">Došlo k výjimce také zabrání spuštění metody akce a následné filtry, ale je považován za selhání místo úspěšný výsledek.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-293">Throwing an exception also prevents execution of the action method and subsequent filters, but is treated as a failure instead of a successful result.</span></span>

<span data-ttu-id="d1a2a-294">[ActionExecutedContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutedcontext) poskytuje `Controller` a `Result` plus následující vlastnosti:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-294">The [ActionExecutedContext](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.mvc.filters.actionexecutedcontext) provides `Controller` and `Result` plus the following properties:</span></span>

* <span data-ttu-id="d1a2a-295">`Canceled` -bude hodnota true, pokud provádění akce byla zkratována jiný filtr.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-295">`Canceled` - will be true if the action execution was short-circuited by another filter.</span></span>
* <span data-ttu-id="d1a2a-296">`Exception` -bude obsahovat hodnotu null, pokud akci nebo filtr následné akce došlo k výjimce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-296">`Exception` - will be non-null if the action or a subsequent action filter threw an exception.</span></span> <span data-ttu-id="d1a2a-297">Nastavení této vlastnosti na hodnotu null, efektivně 'zpracovává' výjimku, a `Result` bude proveden, jako kdyby se vrátil metody akce normálně.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-297">Setting this property to null effectively 'handles' an exception, and `Result` will be executed as if it were returned from the action method normally.</span></span>

<span data-ttu-id="d1a2a-298">Pro `IAsyncActionFilter`, volání `ActionExecutionDelegate` provede všechny následné akce filtry a metoda akce vrací `ActionExecutedContext`.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-298">For an `IAsyncActionFilter`, a call to the `ActionExecutionDelegate` executes any subsequent action filters and the action method, returning an `ActionExecutedContext`.</span></span> <span data-ttu-id="d1a2a-299">Krátká smyčka, přiřaďte `ActionExecutingContext.Result` na některé výsledek instance a nemůžete volat `ActionExecutionDelegate`.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-299">To short-circuit, assign `ActionExecutingContext.Result` to some result instance and don't call the `ActionExecutionDelegate`.</span></span>

<span data-ttu-id="d1a2a-300">Rozhraní framework poskytuje abstraktní `ActionFilterAttribute` , ke kterým můžete podtřídy.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-300">The framework provides an abstract `ActionFilterAttribute` that you can subclass.</span></span> 

<span data-ttu-id="d1a2a-301">Filtr akce můžete automaticky ověřit stav modelu a vrátí případné chyby, pokud stav je neplatný:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-301">You can use an action filter to automatically validate model state and return any errors if the state is invalid:</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Filters/ValidateModelAttribute.cs)]

<span data-ttu-id="d1a2a-302">`OnActionExecuted` Metoda spustí po metody akce a může zobrazit a pracovat s výsledky akce prostřednictvím `ActionExecutedContext.Result` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-302">The `OnActionExecuted` method runs after the action method and can see and manipulate the results of the action through the `ActionExecutedContext.Result` property.</span></span> <span data-ttu-id="d1a2a-303">`ActionExecutedContext.Canceled` bude nastavena na hodnotu true, pokud provádění akce byla zkratována jiný filtr.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-303">`ActionExecutedContext.Canceled` will be set to true if the action execution was short-circuited by another filter.</span></span> <span data-ttu-id="d1a2a-304">`ActionExecutedContext.Exception` bude být nastavená na hodnotu jinou hodnotu než null, pokud akci nebo filtr následné akce došlo k výjimce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-304">`ActionExecutedContext.Exception` will be set to a non-null value if the action or a subsequent action filter threw an exception.</span></span> <span data-ttu-id="d1a2a-305">Nastavení `ActionExecutedContext.Exception` na hodnotu null, efektivně 'zpracovává' výjimku a `ActionExectedContext.Result` bude proveden pak jako v případě, že ho byly obvykle vrátila z metody akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-305">Setting `ActionExecutedContext.Exception` to null effectively 'handles' an exception, and `ActionExectedContext.Result` will then be executed as if it were returned from the action method normally.</span></span>

## <a name="exception-filters"></a><span data-ttu-id="d1a2a-306">Filtry výjimek</span><span class="sxs-lookup"><span data-stu-id="d1a2a-306">Exception filters</span></span>

<span data-ttu-id="d1a2a-307">*Filtry výjimek* implementovat buď `IExceptionFilter` nebo `IAsyncExceptionFilter` rozhraní.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-307">*Exception filters* implement either the `IExceptionFilter` or `IAsyncExceptionFilter` interface.</span></span> <span data-ttu-id="d1a2a-308">Jejich lze použít k implementaci běžných Chyba při zpracování zásady pro aplikace.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-308">They can be used to implement common error handling policies for an app.</span></span> 

<span data-ttu-id="d1a2a-309">Filtr výjimek následující ukázka používá vlastní vývojáře chyba zobrazení si můžete zobrazit podrobnosti o výjimkách, ke kterým dochází, když je aplikace v vývoj:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-309">The following sample exception filter uses a custom developer error view to display details about exceptions that occur when the application is in development:</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Filters/CustomExceptionFilterAttribute.cs?name=snippet_ExceptionFilter&highlight=1,14)]

<span data-ttu-id="d1a2a-310">Filtry výjimek nemají dvě události (pro před a po) – jenom implementovat `OnException` (nebo `OnExceptionAsync`).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-310">Exception filters don't have two events (for before and after) - they only implement `OnException` (or `OnExceptionAsync`).</span></span> 

<span data-ttu-id="d1a2a-311">Filtry výjimek zpracování neošetřených výjimek, které se vyskytují ve vytváření řadiče [model vazby](../models/model-binding.md), filtrů Akce nebo metody akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-311">Exception filters handle unhandled exceptions that occur in controller creation, [model binding](../models/model-binding.md), action filters, or action methods.</span></span> <span data-ttu-id="d1a2a-312">Jejich nezachytí výjimky, které se vyskytují v prostředku filtry, filtry výsledků nebo MVC výsledek spuštění.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-312">They won't catch exceptions that occur in Resource filters, Result filters, or MVC Result execution.</span></span>

<span data-ttu-id="d1a2a-313">Ke zpracování výjimky, nastavte `ExceptionContext.ExceptionHandled` vlastnost na hodnotu true nebo zápisu odpovědi.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-313">To handle an exception, set the `ExceptionContext.ExceptionHandled` property to true or write a response.</span></span> <span data-ttu-id="d1a2a-314">To zastaví šíření výjimky.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-314">This stops propagation of the exception.</span></span> <span data-ttu-id="d1a2a-315">Všimněte si, že filtr výjimek nelze zapnout výjimku do "ÚSPĚCH".</span><span class="sxs-lookup"><span data-stu-id="d1a2a-315">Note that an Exception filter can't turn an exception into a "success".</span></span> <span data-ttu-id="d1a2a-316">Pouze filtr akce můžete udělat.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-316">Only an Action filter can do that.</span></span>

> [!NOTE]
> <span data-ttu-id="d1a2a-317">V technologii ASP.NET Core 1.1, odpověď neposílají, pokud jste nastavili `ExceptionHandled` na hodnotu true **a** zápisu odpovědi.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-317">In ASP.NET Core 1.1, the response isn't sent if you set `ExceptionHandled` to true **and** write a response.</span></span> <span data-ttu-id="d1a2a-318">V tomto scénáři ASP.NET Core 1.0 odeslání odpovědi a ASP.NET Core 1.1.2 vrátí 1.0 chování.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-318">In that scenario, ASP.NET Core 1.0 does send the response, and ASP.NET Core 1.1.2 will return to the 1.0 behavior.</span></span> <span data-ttu-id="d1a2a-319">Další informace najdete v tématu [vydání #5594](https://github.com/aspnet/Mvc/issues/5594) v úložišti GitHub.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-319">For more information, see [issue #5594](https://github.com/aspnet/Mvc/issues/5594) in the GitHub repository.</span></span> 

<span data-ttu-id="d1a2a-320">Filtry výjimek jsou vhodné pro soutisku výjimky, které se vyskytují v akce MVC, jsou ale není tak účinná jako chyba zpracování middleware.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-320">Exception filters are good for trapping exceptions that occur within MVC actions, but they're not as flexible as error handling middleware.</span></span> <span data-ttu-id="d1a2a-321">Dáváte přednost middleware pro obecné případ a použít filtry, pouze pokud potřebujete udělat zpracování chyb *jinak* podle MVC akci, která jste vybrali.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-321">Prefer middleware for the general case, and use filters only where you need to do error handling *differently* based on which MVC action was chosen.</span></span> <span data-ttu-id="d1a2a-322">Aplikace může mít například metody akce pro obě rozhraní API koncových bodů a zobrazení nebo HTML.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-322">For example, your app might have action methods for both API endpoints and for views/HTML.</span></span> <span data-ttu-id="d1a2a-323">Koncové body rozhraní API může vrátí informace o chybě formátu JSON, zatímco akce na základě zobrazení může vrátit chybovou stránku ve formátu HTML.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-323">The API endpoints could return error information as JSON, while the view-based actions could return an error page as HTML.</span></span>

<span data-ttu-id="d1a2a-324">Rozhraní framework poskytuje abstraktní `ExceptionFilterAttribute` , ke kterým můžete podtřídy.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-324">The framework provides an abstract `ExceptionFilterAttribute` that you can subclass.</span></span> 

## <a name="result-filters"></a><span data-ttu-id="d1a2a-325">Filtry výsledků</span><span class="sxs-lookup"><span data-stu-id="d1a2a-325">Result filters</span></span>

<span data-ttu-id="d1a2a-326">*Vést filtry* implementovat buď `IResultFilter` nebo `IAsyncResultFilter` rozhraní a jejich spuštění obklopuje provádění výsledky akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-326">*Result filters* implement either the `IResultFilter` or `IAsyncResultFilter` interface, and their execution surrounds the execution of action results.</span></span> 

<span data-ttu-id="d1a2a-327">Tady je příklad výsledek filtr, který přidá hlavičku protokolu HTTP.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-327">Here's an example of a Result filter that adds an HTTP header.</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Filters/LoggingAddHeaderFilter.cs?name=snippet_ResultFilter)]

<span data-ttu-id="d1a2a-328">Typ výsledku spouštěna, závisí na dotyčném akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-328">The kind of result being executed depends on the action in question.</span></span> <span data-ttu-id="d1a2a-329">Akce MVC vrací zobrazení by mělo zahrnovat všechny razor zpracování v rámci `ViewResult` spouštěna.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-329">An MVC action returning a view would include all razor processing as part of the `ViewResult` being executed.</span></span> <span data-ttu-id="d1a2a-330">Metody rozhraní API může provést některé serializace jako součást spuštění výsledku.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-330">An API method might perform some serialization as part of the execution of the result.</span></span> <span data-ttu-id="d1a2a-331">Další informace o [výsledky akce](actions.md)</span><span class="sxs-lookup"><span data-stu-id="d1a2a-331">Learn more about [action results](actions.md)</span></span>

<span data-ttu-id="d1a2a-332">Filtry výsledků jsou pro úspěšné výsledky - spustit pouze když akce nebo filtrů akce vytvoří výsledek akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-332">Result filters are only executed for successful results - when the action or action filters produce an action result.</span></span> <span data-ttu-id="d1a2a-333">Filtry výsledků nejsou spustit, když filtry výjimek zpracování výjimky.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-333">Result filters are not executed when exception filters handle an exception.</span></span>

<span data-ttu-id="d1a2a-334">`OnResultExecuting` Metoda může krátká smyčka – spouštění výsledek akce a následné výsledek filtry nastavením `ResultExecutingContext.Cancel` na hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-334">The `OnResultExecuting` method can short-circuit execution of the action result and subsequent result filters by setting `ResultExecutingContext.Cancel` to true.</span></span> <span data-ttu-id="d1a2a-335">By měl obvykle zapisovat do objektu odpovědi při krátká smyčka, aby nedošlo ke generování prázdnou odpověď.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-335">You should generally write to the response object when short-circuiting to avoid generating an empty response.</span></span> <span data-ttu-id="d1a2a-336">Došlo k výjimce také zabrání spuštění výsledku akce a následné filtry, ale bude považována za selhání místo úspěšný výsledek.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-336">Throwing an exception will also prevent execution of the action result and subsequent filters, but will be treated as a failure instead of a successful result.</span></span>

<span data-ttu-id="d1a2a-337">Když `OnResultExecuted` metoda spustí, odpověď pravděpodobně byl odeslán do klienta a nelze změnit další (Pokud byla vyvolána výjimka).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-337">When the `OnResultExecuted` method runs, the response has likely been sent to the client and cannot be changed further (unless an exception was thrown).</span></span> <span data-ttu-id="d1a2a-338">`ResultExecutedContext.Canceled` bude nastavena na hodnotu true, pokud provádění výsledek akce se zkratována jiný filtr.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-338">`ResultExecutedContext.Canceled` will be set to true if the action result execution was short-circuited by another filter.</span></span>

<span data-ttu-id="d1a2a-339">`ResultExecutedContext.Exception` bude být nastavená na hodnotu jinou hodnotu než null, pokud výsledek akce nebo filtr následné výsledků došlo k výjimce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-339">`ResultExecutedContext.Exception` will be set to a non-null value if the action result or a subsequent result filter threw an exception.</span></span> <span data-ttu-id="d1a2a-340">Nastavení `Exception` na hodnotu null efektivně zpracovává výjimku a brání výjimky z se znovu vyvolány podle MVC později v kanálu.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-340">Setting `Exception` to null effectively 'handles' an exception and prevents the exception from being rethrown by MVC later in the pipeline.</span></span> <span data-ttu-id="d1a2a-341">Pokud jste zpracování výjimek v filtr výsledků, nemusí být možné zapisovat data do odpovědi.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-341">When you're handling an exception in a result filter, you might not be able to write any data to the response.</span></span> <span data-ttu-id="d1a2a-342">Pokud výsledek akce, vyvolá partway prostřednictvím jejího provádění a hlavičky již byly vyprázdněny klientovi, neexistuje žádný spolehlivý mechanismus odeslat kód chyby.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-342">If the action result throws partway through its execution, and the headers have already been flushed to the client, there's no reliable mechanism to send a failure code.</span></span>

<span data-ttu-id="d1a2a-343">Pro `IAsyncResultFilter` volání `await next()` na `ResultExecutionDelegate` provede všechny následné výsledek filtry a výsledku akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-343">For an `IAsyncResultFilter` a call to `await next()` on the `ResultExecutionDelegate` executes any subsequent result filters and the action result.</span></span> <span data-ttu-id="d1a2a-344">Krátká smyčka, nastavte `ResultExecutingContext.Cancel` na hodnotu true a nemůžete volat `ResultExectionDelegate`.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-344">To short-circuit, set `ResultExecutingContext.Cancel` to true and don't call the `ResultExectionDelegate`.</span></span>

<span data-ttu-id="d1a2a-345">Rozhraní framework poskytuje abstraktní `ResultFilterAttribute` , ke kterým můžete podtřídy.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-345">The framework provides an abstract `ResultFilterAttribute` that you can subclass.</span></span> <span data-ttu-id="d1a2a-346">[AddHeaderAttribute](#add-header-attribute) třída uvedena výše je příkladem atribut filtru výsledků.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-346">The [AddHeaderAttribute](#add-header-attribute) class shown earlier is an example of a result filter attribute.</span></span>

## <a name="using-middleware-in-the-filter-pipeline"></a><span data-ttu-id="d1a2a-347">Pomocí middleware v kanálu filtru</span><span class="sxs-lookup"><span data-stu-id="d1a2a-347">Using middleware in the filter pipeline</span></span>

<span data-ttu-id="d1a2a-348">Filtry prostředků fungují jako [middleware](xref:fundamentals/middleware/index) v tom, že jejich obklopit provádění všechny položky, která se dodává později v kanálu.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-348">Resource filters work like [middleware](xref:fundamentals/middleware/index) in that they surround the execution of everything that comes later in the pipeline.</span></span> <span data-ttu-id="d1a2a-349">Ale filtry se liší od middleware, že jsou součástí MVC, což znamená, že mají přístup do kontextu MVC a konstrukce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-349">But filters differ from middleware in that they're part of MVC, which means that they have access to MVC context and constructs.</span></span>

<span data-ttu-id="d1a2a-350">V technologii ASP.NET Core 1.1 můžete použít middleware v kanálu filtru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-350">In ASP.NET Core 1.1, you can use middleware in the filter pipeline.</span></span> <span data-ttu-id="d1a2a-351">Můžete chtít udělat, pokud máte komponenta middlewaru, který potřebuje přístup k data směrování MVC nebo ten, který by měly být spuštěny pouze pro určité řadiče nebo akce.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-351">You might want to do that if you have a middleware component that needs access to MVC route data, or one that should run only for certain controllers or actions.</span></span>

<span data-ttu-id="d1a2a-352">Pokud chcete použít jako filtr middleware, vytvoření typu s `Configure` metoda, která určuje middleware, který chcete vložit do kanálu filtru.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-352">To use middleware as a filter, create a type with a `Configure` method that specifies the middleware that you want to inject into the filter pipeline.</span></span> <span data-ttu-id="d1a2a-353">Tady je příklad, který používá lokalizace middleware pro aktuální jazykovou verzi pro žádost o vytvoření:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-353">Here's an example that uses the localization middleware to establish the current culture for a request:</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Filters/LocalizationPipeline.cs?name=snippet_MiddlewareFilter&highlight=3,21)]

<span data-ttu-id="d1a2a-354">Pak můžete použít `MiddlewareFilterAttribute` ke spuštění middleware pro vybrané kontroler nebo akce nebo globálně:</span><span class="sxs-lookup"><span data-stu-id="d1a2a-354">You can then use the `MiddlewareFilterAttribute` to run the middleware for a selected controller or action or globally:</span></span>

[!code-csharp[](./filters/sample/src/FiltersSample/Controllers/HomeController.cs?name=snippet_MiddlewareFilter&highlight=2)]

<span data-ttu-id="d1a2a-355">Filtry middleware ve fázi stejné filtru kanálu jako prostředek filtry, před navázáním modelu a po zbytek kanálu.</span><span class="sxs-lookup"><span data-stu-id="d1a2a-355">Middleware filters run at the same stage of the filter pipeline as Resource filters, before model binding and after the rest of the pipeline.</span></span>

## <a name="next-actions"></a><span data-ttu-id="d1a2a-356">Další akce</span><span class="sxs-lookup"><span data-stu-id="d1a2a-356">Next actions</span></span>

<span data-ttu-id="d1a2a-357">A experimentovat s filtry, [stáhnout, otestovat a upravit ukázku](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span><span class="sxs-lookup"><span data-stu-id="d1a2a-357">To experiment with filters, [download, test and modify the sample](https://github.com/aspnet/Docs/tree/master/aspnetcore/mvc/controllers/filters/sample).</span></span>
