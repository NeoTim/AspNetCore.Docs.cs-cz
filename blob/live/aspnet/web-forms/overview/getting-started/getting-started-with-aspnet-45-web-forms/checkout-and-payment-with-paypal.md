---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal
title: "Najdete v článku věnovaném a platbu se PayPal | Microsoft Docs"
author: Erikre
description: "Tento kurz řady naučit se základy vytváření aplikace webových formulářů ASP.NET pomocí technologie ASP.NET 4.5 a Microsoft Visual Studio Express 2013 pro jsme..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 09/08/2014
ms.topic: article
ms.assetid: 664ec95e-b0c9-4f43-a39f-798d0f2a7e08
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal
msc.type: authoredcontent
ms.openlocfilehash: dd975850a3ed3e7b1746d5123572065675a88656
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/10/2017
---
<a name="checkout-and-payment-with-paypal"></a><span data-ttu-id="c04a6-103">Najdete v článku věnovaném a platbu se PayPal</span><span class="sxs-lookup"><span data-stu-id="c04a6-103">Checkout and Payment with PayPal</span></span>
====================
<span data-ttu-id="c04a6-104">Podle [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="c04a6-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="c04a6-105">[Stáhnout adresář Wingtip Toys ukázkového projektu (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) nebo [stáhnout elektronická kniha (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="c04a6-105">[Download Wingtip Toys Sample Project (C#)](http://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="c04a6-106">Tento kurz řady naučit se základy vytváření aplikace webových formulářů ASP.NET pomocí technologie ASP.NET 4.5 a Microsoft Visual Studio Express 2013 pro Web.</span><span class="sxs-lookup"><span data-stu-id="c04a6-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="c04a6-107">Visual Studio 2013 [projekt pomocí zdrojového kódu C#](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) dispozici je pro tento kurz řady.</span><span class="sxs-lookup"><span data-stu-id="c04a6-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>


<span data-ttu-id="c04a6-108">Tento kurz popisuje, jak upravit adresář Wingtip Toys ukázkovou aplikaci autorizace uživatelů, registrace a platebních pomocí služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-108">This tutorial describes how to modify the Wingtip Toys sample application to include user authorization, registration, and payment using PayPal.</span></span> <span data-ttu-id="c04a6-109">Pouze uživatelé, kteří jsou přihlášení bude mít autorizace, chcete-li zakoupit produkty.</span><span class="sxs-lookup"><span data-stu-id="c04a6-109">Only users who are logged in will have authorization to purchase products.</span></span> <span data-ttu-id="c04a6-110">Šablona projektu webových formulářů ASP.NET 4.5 předdefinované uživatelské registrace funkce již obsahuje většinu co potřebujete.</span><span class="sxs-lookup"><span data-stu-id="c04a6-110">The ASP.NET 4.5 Web Forms project template's built-in user registration functionality already includes much of what you need.</span></span> <span data-ttu-id="c04a6-111">Přidáte funkci PayPal Express Checkout.</span><span class="sxs-lookup"><span data-stu-id="c04a6-111">You will add PayPal Express Checkout functionality.</span></span> <span data-ttu-id="c04a6-112">V tomto kurzu budete používat vývojáře PayPal testovacím prostředí, tak se nepřenesou žádná skutečná fondů.</span><span class="sxs-lookup"><span data-stu-id="c04a6-112">In this tutorial you be using the PayPal developer testing environment, so no actual funds will be transferred.</span></span> <span data-ttu-id="c04a6-113">Na konci tohoto kurzu budete testovat aplikaci tak, že vyberete produktů pro přidání do nákupního košíku, kliknutím na tlačítko ověření a přenosu dat do testování webu PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-113">At the end of the tutorial, you will test the application by selecting products to add to the shopping cart, clicking the checkout button, and transferring data to the PayPal testing web site.</span></span> <span data-ttu-id="c04a6-114">Na PayPal testování webu bude potvrďte vaše informace o přesouvání a platby a pak se vraťte do místní adresář Wingtip Toys ukázkovou aplikaci pro potvrzení a dokončení nákupu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-114">On the PayPal testing web site, you will confirm your shipping and payment information and then return to the local Wingtip Toys sample application to confirm and complete the purchase.</span></span>

<span data-ttu-id="c04a6-115">Existuje několik procesorů zkušeného platebních třetích stran, které specialize v online nákupy, že adresa škálovatelnosti a zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="c04a6-115">There are several experienced third-party payment processors that specialize in online shopping that address scalability and security.</span></span> <span data-ttu-id="c04a6-116">Vývojáři ASP.NET zvažte výhody použití platebních řešení třetí strany před implementací nákupního a nákup řešení.</span><span class="sxs-lookup"><span data-stu-id="c04a6-116">ASP.NET developers should consider the advantages of utilizing a third party payment solution before implementing a shopping and purchasing solution.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="c04a6-117">Ukázkovou aplikaci adresář Wingtip Toys navržena k zobrazí konkrétní ASP.NET konceptů a funkcí, které jsou k dispozici vývojářům webů ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c04a6-117">The Wingtip Toys sample application was designed to shown specific ASP.NET concepts and features available to ASP.NET web developers.</span></span> <span data-ttu-id="c04a6-118">Tato ukázková aplikace nebyla optimalizované pro všechny možné okolnosti týkající se škálovatelnosti a zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="c04a6-118">This sample application was not optimized for all possible circumstances in regard to scalability and security.</span></span>


## <a name="what-youll-learn"></a><span data-ttu-id="c04a6-119">Získáte informace:</span><span class="sxs-lookup"><span data-stu-id="c04a6-119">What you'll learn:</span></span>

- <span data-ttu-id="c04a6-120">Jak omezit přístup na určité stránky ve složce.</span><span class="sxs-lookup"><span data-stu-id="c04a6-120">How to restrict access to specific pages in a folder.</span></span>
- <span data-ttu-id="c04a6-121">Postup vytvoření známé nákupní košík z anonymní nákupní košík.</span><span class="sxs-lookup"><span data-stu-id="c04a6-121">How to create a known shopping cart from an anonymous shopping cart.</span></span>
- <span data-ttu-id="c04a6-122">Postup povolení protokolu SSL pro projekt.</span><span class="sxs-lookup"><span data-stu-id="c04a6-122">How to enable SSL for the project.</span></span>
- <span data-ttu-id="c04a6-123">Postup přidání poskytovatele OAuth do projektu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-123">How to add an OAuth provider to the project.</span></span>
- <span data-ttu-id="c04a6-124">Jak používat služby PayPal Koupit produkty, které používají služby PayPal testovacího prostředí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-124">How to use PayPal to purchase products using the PayPal testing environment.</span></span>
- <span data-ttu-id="c04a6-125">Jak si můžete zobrazit podrobnosti ze služby PayPal v **DetailsView** ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="c04a6-125">How to display details from PayPal in a **DetailsView** control.</span></span>
- <span data-ttu-id="c04a6-126">Postup aktualizace databáze aplikace adresář Wingtip Toys s podrobnostmi získané z PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-126">How to update the database of the Wingtip Toys application with details obtained from PayPal.</span></span>

## <a name="adding-order-tracking"></a><span data-ttu-id="c04a6-127">Přidání pořadí sledování</span><span class="sxs-lookup"><span data-stu-id="c04a6-127">Adding Order Tracking</span></span>

<span data-ttu-id="c04a6-128">V tomto kurzu vytvoříte dva nové třídy sledovat data z pořadí, ve kterém uživatel vytvořil.</span><span class="sxs-lookup"><span data-stu-id="c04a6-128">In this tutorial, you'll create two new classes to track data from the order a user has created.</span></span> <span data-ttu-id="c04a6-129">Třídy bude sledovat data týkající se informace o přesouvání, celkový počet zakoupených a potvrzení platby.</span><span class="sxs-lookup"><span data-stu-id="c04a6-129">The classes will track data regarding shipping information, purchase total, and payment confirmation.</span></span>

### <a name="add-the-order-and-orderdetail-model-classes"></a><span data-ttu-id="c04a6-130">Přidání třídy modelu OrderDetail a pořadí</span><span class="sxs-lookup"><span data-stu-id="c04a6-130">Add the Order and OrderDetail Model Classes</span></span>

<span data-ttu-id="c04a6-131">Dříve v této série kurz definované schéma pro kategorie produktů, a nákupní košík položky tak, že vytvoříte `Category`, `Product`, a `CartItem` třídy v *modely* složky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-131">Earlier in this tutorial series, you defined the schema for categories, products, and shopping cart items by creating the `Category`, `Product`, and `CartItem` classes in the *Models* folder.</span></span> <span data-ttu-id="c04a6-132">Nyní přidejte dva nové třídy definovat schéma pro produkt pořadí a podrobnosti o pořadí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-132">Now you will add two new classes to define the schema for the product order and the details of the order.</span></span>

1. <span data-ttu-id="c04a6-133">V **modely** složky, přidejte novou třídu s názvem *Order.cs*.</span><span class="sxs-lookup"><span data-stu-id="c04a6-133">In the **Models** folder, add a new class named *Order.cs*.</span></span>   
 <span data-ttu-id="c04a6-134">Nový soubor třídy se zobrazí v editoru.</span><span class="sxs-lookup"><span data-stu-id="c04a6-134">The new class file is displayed in the editor.</span></span>
2. <span data-ttu-id="c04a6-135">Ve výchozím kódu nahraďte následujícím textem:</span><span class="sxs-lookup"><span data-stu-id="c04a6-135">Replace the default code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample1.cs)]
3. <span data-ttu-id="c04a6-136">Přidat *OrderDetail.cs* třídy k *modely* složky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-136">Add an *OrderDetail.cs* class to the *Models* folder.</span></span>
4. <span data-ttu-id="c04a6-137">Ve výchozím kódu nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="c04a6-137">Replace the default code with the following code:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample2.cs)]

<span data-ttu-id="c04a6-138">`Order` a `OrderDetail` třídy obsahovat schéma můžete definovat informace o objednávce používá pro nákup a přesouvání.</span><span class="sxs-lookup"><span data-stu-id="c04a6-138">The `Order` and `OrderDetail` classes contain the schema to define the order information used for purchasing and shipping.</span></span>

<span data-ttu-id="c04a6-139">Kromě toho budete muset aktualizovat třídy kontextu databáze, která spravuje tříd entit, který poskytuje přístup k datům do databáze.</span><span class="sxs-lookup"><span data-stu-id="c04a6-139">In addition, you will need to update the database context class that manages the entity classes and that provides data access to the database.</span></span> <span data-ttu-id="c04a6-140">K tomu budete přidávat nově vytvořený pořadí a `OrderDetail` modelu třídy `ProductContext` třídy.</span><span class="sxs-lookup"><span data-stu-id="c04a6-140">To do this, you will add the newly created Order and `OrderDetail` model classes to `ProductContext` class.</span></span>

1. <span data-ttu-id="c04a6-141">V **Průzkumníku řešení**, najít a otevřít *ProductContext.cs* souboru.</span><span class="sxs-lookup"><span data-stu-id="c04a6-141">In **Solution Explorer**, find and open the *ProductContext.cs* file.</span></span>
2. <span data-ttu-id="c04a6-142">Přidejte zvýrazněný kód, který *ProductContext.cs* souboru, jak je uvedeno níže:</span><span class="sxs-lookup"><span data-stu-id="c04a6-142">Add the highlighted code to the *ProductContext.cs* file as shown below:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample3.cs?highlight=14-15)]

<span data-ttu-id="c04a6-143">Jak je uvedeno nahoře v kurzu této série, kód v *ProductContext.cs* přidá soubor `System.Data.Entity` obor názvů tak, aby měli přístup k základním funkcím Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="c04a6-143">As mentioned previously in this tutorial series, the code in the *ProductContext.cs* file adds the `System.Data.Entity` namespace so that you have access to all the core functionality of the Entity Framework.</span></span> <span data-ttu-id="c04a6-144">Tato funkce zahrnuje schopnost dotazovat, vložit, aktualizovat a odstranit data ve spolupráci s objektů se silným typem.</span><span class="sxs-lookup"><span data-stu-id="c04a6-144">This functionality includes the capability to query, insert, update, and delete data by working with strongly typed objects.</span></span> <span data-ttu-id="c04a6-145">Výše uvedený kód `ProductContext` třída přidává přístup k rozhraní Entity Framework pro nově přidaný `Order` a `OrderDetail` třídy.</span><span class="sxs-lookup"><span data-stu-id="c04a6-145">The above code in the `ProductContext` class adds Entity Framework access to the newly added `Order` and `OrderDetail` classes.</span></span>

## <a name="adding-checkout-access"></a><span data-ttu-id="c04a6-146">Přidání přístupu najdete v článku věnovaném</span><span class="sxs-lookup"><span data-stu-id="c04a6-146">Adding Checkout Access</span></span>

<span data-ttu-id="c04a6-147">Ukázkovou aplikaci adresář Wingtip Toys umožňuje anonymním uživatelům ke kontrole a přidat produkty nákupního košíku.</span><span class="sxs-lookup"><span data-stu-id="c04a6-147">The Wingtip Toys sample application allows anonymous users to review and add products to a shopping cart.</span></span> <span data-ttu-id="c04a6-148">Ale při anonymním uživatelům vybrat nákup produkty, které budou přidány do nákupního košíku, se musí přihlásit k webu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-148">However, when anonymous users choose to purchase the products they added to the shopping cart, they must log on to the site.</span></span> <span data-ttu-id="c04a6-149">Jakmile jste přihlášeni, získají přístup k webové aplikace s omezeným přístupem stránek, které zpracovávají rezervaci a proces nákupní.</span><span class="sxs-lookup"><span data-stu-id="c04a6-149">Once they have logged on, they can access the restricted pages of the Web application that handle the checkout and purchase process.</span></span> <span data-ttu-id="c04a6-150">Tyto stránky s omezeným přístupem, jsou součástí *najdete v článku věnovaném* složky aplikace.</span><span class="sxs-lookup"><span data-stu-id="c04a6-150">These restricted pages are contained in the *Checkout* folder of the application.</span></span>

### <a name="add-a-checkout-folder-and-pages"></a><span data-ttu-id="c04a6-151">Přidat složku najdete v článku věnovaném a stránky</span><span class="sxs-lookup"><span data-stu-id="c04a6-151">Add a Checkout Folder and Pages</span></span>

<span data-ttu-id="c04a6-152">Nyní vytvoříte *najdete v článku věnovaném* složku a stránky v něm, který zákazník se zobrazí během procesu checkout.</span><span class="sxs-lookup"><span data-stu-id="c04a6-152">You will now create the *Checkout* folder and the pages in it that the customer will see during the checkout process.</span></span> <span data-ttu-id="c04a6-153">Aktualizujte tyto stránek později v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-153">You will update these pages later in this tutorial.</span></span>

1. <span data-ttu-id="c04a6-154">Klikněte pravým tlačítkem na název projektu (**adresář Wingtip Toys**) v **Průzkumníku řešení** a vyberte **přidejte novou složku**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-154">Right-click the project name (**Wingtip Toys**) in **Solution Explorer** and select **Add a New Folder**.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – nová složka](checkout-and-payment-with-paypal/_static/image1.png)
2. <span data-ttu-id="c04a6-156">Název nové složky *najdete v článku věnovaném*.</span><span class="sxs-lookup"><span data-stu-id="c04a6-156">Name the new folder *Checkout*.</span></span>
3. <span data-ttu-id="c04a6-157">Klikněte pravým tlačítkem myši *najdete v článku věnovaném* složku a potom vyberte **přidat**-&gt;**novou položku**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-157">Right-click the *Checkout* folder and then select **Add**-&gt;**New Item**.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – nová položka](checkout-and-payment-with-paypal/_static/image2.png)
4. <span data-ttu-id="c04a6-159">**Přidat novou položku** se zobrazí dialogové okno.</span><span class="sxs-lookup"><span data-stu-id="c04a6-159">The **Add New Item** dialog box is displayed.</span></span>
5. <span data-ttu-id="c04a6-160">Vyberte **Visual C#**  - &gt; **webové** skupiny šablony na levé straně.</span><span class="sxs-lookup"><span data-stu-id="c04a6-160">Select the **Visual C#** -&gt; **Web** templates group on the left.</span></span> <span data-ttu-id="c04a6-161">Pak v prostředním podokně, vyberte **webové formuláře se stránkou předlohy**a pojmenujte ji *CheckoutStart.aspx*.</span><span class="sxs-lookup"><span data-stu-id="c04a6-161">Then, from the middle pane, select **Web Form with Master Page**and name it *CheckoutStart.aspx*.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – Přidat dialogové okno Nový položky](checkout-and-payment-with-paypal/_static/image3.png)
6. <span data-ttu-id="c04a6-163">Vyberte jako předtím *Site.Master* souboru stránky předlohy.</span><span class="sxs-lookup"><span data-stu-id="c04a6-163">As before, select the *Site.Master* file as the master page.</span></span>
7. <span data-ttu-id="c04a6-164">Přidejte následující další stránky, které chcete *najdete v článku věnovaném* složky pomocí výše uvedených kroků:</span><span class="sxs-lookup"><span data-stu-id="c04a6-164">Add the following additional pages to the *Checkout* folder using the same steps above:</span></span>   

    - <span data-ttu-id="c04a6-165">CheckoutReview.aspx</span><span class="sxs-lookup"><span data-stu-id="c04a6-165">CheckoutReview.aspx</span></span>
    - <span data-ttu-id="c04a6-166">CheckoutComplete.aspx</span><span class="sxs-lookup"><span data-stu-id="c04a6-166">CheckoutComplete.aspx</span></span>
    - <span data-ttu-id="c04a6-167">CheckoutCancel.aspx</span><span class="sxs-lookup"><span data-stu-id="c04a6-167">CheckoutCancel.aspx</span></span>
    - <span data-ttu-id="c04a6-168">CheckoutError.aspx</span><span class="sxs-lookup"><span data-stu-id="c04a6-168">CheckoutError.aspx</span></span>

### <a name="add-a-webconfig-file"></a><span data-ttu-id="c04a6-169">Přidá soubor Web.config</span><span class="sxs-lookup"><span data-stu-id="c04a6-169">Add a Web.config File</span></span>

<span data-ttu-id="c04a6-170">Přidáním nové *Web.config* do souboru *najdete v článku věnovaném* složky, bude možné omezit přístup na všechny stránky obsažené ve složce.</span><span class="sxs-lookup"><span data-stu-id="c04a6-170">By adding a new *Web.config* file to the *Checkout* folder, you will be able to restrict access to all the pages contained in the folder.</span></span>

1. <span data-ttu-id="c04a6-171">Klikněte pravým tlačítkem myši *najdete v článku věnovaném* složky a vyberte **přidat**  - &gt; **novou položku**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-171">Right-click the *Checkout* folder and select **Add** -&gt; **New Item**.</span></span>  
 <span data-ttu-id="c04a6-172">**Přidat novou položku** se zobrazí dialogové okno.</span><span class="sxs-lookup"><span data-stu-id="c04a6-172">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="c04a6-173">Vyberte **Visual C#**  - &gt; **webové** skupiny šablony na levé straně.</span><span class="sxs-lookup"><span data-stu-id="c04a6-173">Select the **Visual C#** -&gt; **Web** templates group on the left.</span></span> <span data-ttu-id="c04a6-174">Pak v prostředním podokně, vyberte **soubor webové konfigurace**, přijměte výchozí název *Web.config*a potom vyberte **přidat**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-174">Then, from the middle pane, select **Web Configuration File**, accept the default name of *Web.config*, and then select **Add**.</span></span>
3. <span data-ttu-id="c04a6-175">Nahradit existující obsah XML *Web.config* soubor s následující:</span><span class="sxs-lookup"><span data-stu-id="c04a6-175">Replace the existing XML content in the *Web.config* file with the following:</span></span>  

    [!code-xml[Main](checkout-and-payment-with-paypal/samples/sample4.xml)]
4. <span data-ttu-id="c04a6-176">Uložit *Web.config* souboru.</span><span class="sxs-lookup"><span data-stu-id="c04a6-176">Save the *Web.config* file.</span></span>

<span data-ttu-id="c04a6-177">*Web.config* souboru Určuje, že všechny neznámé uživatele webové aplikace musí odepřen přístup na stránky součástí *najdete v článku věnovaném* složky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-177">The *Web.config* file specifies that all unknown users of the Web application must be denied access to the pages contained in the *Checkout* folder.</span></span> <span data-ttu-id="c04a6-178">Ale pokud je uživatel zaregistrován účtu a je přihlášen, se bude známé uživatele a bude mít přístup k stránky v *najdete v článku věnovaném* složky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-178">However, if the user has registered an account and is logged on, they will be a known user and will have access to the pages in the *Checkout* folder.</span></span>

<span data-ttu-id="c04a6-179">Je důležité si uvědomit, že konfigurace ASP.NET odpovídá hierarchii, kde každý *Web.config* soubor aplikuje nastavení konfigurace do složky, která je v a na všechny podřízené adresáře pod ním.</span><span class="sxs-lookup"><span data-stu-id="c04a6-179">It's important to note that ASP.NET configuration follows a hierarchy, where each *Web.config* file applies configuration settings to the folder that it is in and to all of the child directories below it.</span></span>

<a id="SSLWebForms"></a>
## <a name="enable-ssl-for-the-project"></a><span data-ttu-id="c04a6-180">Povolit protokol SSL pro projekt</span><span class="sxs-lookup"><span data-stu-id="c04a6-180">Enable SSL for the Project</span></span>

 <span data-ttu-id="c04a6-181">Vrstvy SSL (Secure Sockets) je protokol definované umožnit webové servery a klienty webového bezpečněji komunikovat prostřednictvím šifrování.</span><span class="sxs-lookup"><span data-stu-id="c04a6-181">Secure Sockets Layer (SSL) is a protocol defined to allow Web servers and Web clients to communicate more securely through the use of encryption.</span></span> <span data-ttu-id="c04a6-182">Pokud není používá protokol SSL, data odesílaná mezi klientem a serverem je otevřená a můžou paketu sledování toku dat ve každý, kdo má fyzický přístup k síti.</span><span class="sxs-lookup"><span data-stu-id="c04a6-182">When SSL is not used, data sent between the client and server is open to packet sniffing by anyone with physical access to the network.</span></span> <span data-ttu-id="c04a6-183">Kromě toho několik společných schémat ověřování nejsou zabezpečené přes prostý HTTP.</span><span class="sxs-lookup"><span data-stu-id="c04a6-183">Additionally, several common authentication schemes are not secure over plain HTTP.</span></span> <span data-ttu-id="c04a6-184">Základní ověřování a ověřování pomocí formulářů vyslat nezašifrované přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="c04a6-184">In particular, Basic authentication and forms authentication send unencrypted credentials.</span></span> <span data-ttu-id="c04a6-185">Aby bylo zabezpečené, musí tyto schémat ověřování používat protokol SSL.</span><span class="sxs-lookup"><span data-stu-id="c04a6-185">To be secure, these authentication schemes must use SSL.</span></span> 

1. <span data-ttu-id="c04a6-186">V **Průzkumníku řešení**, klikněte na tlačítko **Northwind** projektu a potom stiskněte klávesu **F4** zobrazíte **vlastnosti** okno.</span><span class="sxs-lookup"><span data-stu-id="c04a6-186">In **Solution Explorer**, click the **WingtipToys** project, then press **F4** to display the **Properties** window.</span></span>
2. <span data-ttu-id="c04a6-187">Změna **SSL povoleno** k `true`.</span><span class="sxs-lookup"><span data-stu-id="c04a6-187">Change **SSL Enabled** to `true`.</span></span>
3. <span data-ttu-id="c04a6-188">Kopírování **SSL URL** , kterou můžete použít později.</span><span class="sxs-lookup"><span data-stu-id="c04a6-188">Copy the **SSL URL** so you can use it later.</span></span>   
 <span data-ttu-id="c04a6-189">Adresa URL SSL bude `https://localhost:44300/` Pokud jste už vytvořili webů SSL (jak je znázorněno níže).</span><span class="sxs-lookup"><span data-stu-id="c04a6-189">The SSL URL will be `https://localhost:44300/` unless you've previously created SSL Web Sites (as shown below).</span></span>   
    <span data-ttu-id="c04a6-190">![Vlastnosti projektu](checkout-and-payment-with-paypal/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c04a6-190">![Project Properties](checkout-and-payment-with-paypal/_static/image4.png)</span></span>
4. <span data-ttu-id="c04a6-191">V **Průzkumníku řešení**, klikněte pravým tlačítkem **Northwind** projektu a klikněte na tlačítko **vlastnosti**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-191">In **Solution Explorer**, right click the **WingtipToys** project and click **Properties**.</span></span>
5. <span data-ttu-id="c04a6-192">V levé kartě klikněte na **webové**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-192">In the left tab, click **Web**.</span></span>
6. <span data-ttu-id="c04a6-193">Změna **adresa Url projektu** používat **SSL URL** který jste předtím uložili.</span><span class="sxs-lookup"><span data-stu-id="c04a6-193">Change the **Project Url** to use the **SSL URL** that you saved earlier.</span></span>   
    <span data-ttu-id="c04a6-194">![Vlastnosti webového projektu](checkout-and-payment-with-paypal/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="c04a6-194">![Project Web Properties](checkout-and-payment-with-paypal/_static/image5.png)</span></span>
7. <span data-ttu-id="c04a6-195">Uložit stránky stisknutím kláves **CTRL + S**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-195">Save the page by pressing **CTRL+S**.</span></span>
8. <span data-ttu-id="c04a6-196">Stiskněte klávesu **Ctrl + F5** ke spuštění aplikace.</span><span class="sxs-lookup"><span data-stu-id="c04a6-196">Press **Ctrl+F5** to run the application.</span></span> <span data-ttu-id="c04a6-197">Visual Studio se zobrazí možnost vyhnete se upozornění týkající se SSL.</span><span class="sxs-lookup"><span data-stu-id="c04a6-197">Visual Studio will display an option to allow you to avoid SSL warnings.</span></span>
9. <span data-ttu-id="c04a6-198">Klikněte na tlačítko **Ano** důvěřovat certifikátu SSL služby IIS Express a pokračujte.</span><span class="sxs-lookup"><span data-stu-id="c04a6-198">Click **Yes** to trust the IIS Express SSL certificate and continue.</span></span>   
    <span data-ttu-id="c04a6-199">![Podrobnosti o certifikátu SSL služby IIS Express](checkout-and-payment-with-paypal/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="c04a6-199">![IIS Express SSL certificate details](checkout-and-payment-with-paypal/_static/image6.png)</span></span>  
 <span data-ttu-id="c04a6-200">Zobrazí se upozornění zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="c04a6-200">A Security Warning is displayed.</span></span>
10. <span data-ttu-id="c04a6-201">Klikněte na tlačítko **Ano** k instalaci certifikátu do vašeho místního hostitele.</span><span class="sxs-lookup"><span data-stu-id="c04a6-201">Click **Yes** to install the certificate to your localhost.</span></span>   
    <span data-ttu-id="c04a6-202">![Dialogové okno upozornění zabezpečení](checkout-and-payment-with-paypal/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c04a6-202">![Security Warning dialog box](checkout-and-payment-with-paypal/_static/image7.png)</span></span>  
 <span data-ttu-id="c04a6-203">Zobrazí se okno prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="c04a6-203">The browser window will be displayed.</span></span>

<span data-ttu-id="c04a6-204">Teď můžete snadno otestujte webovou aplikaci místně pomocí protokolu SSL.</span><span class="sxs-lookup"><span data-stu-id="c04a6-204">You can now easily test your Web application locally using SSL.</span></span>

<a id="OAuthWebForms"></a>
## <a name="add-an-oauth-20-provider"></a><span data-ttu-id="c04a6-205">Přidání poskytovatele OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="c04a6-205">Add an OAuth 2.0 Provider</span></span>

<span data-ttu-id="c04a6-206">Webové formuláře ASP.NET poskytuje rozšířené možnosti pro členství a ověřování.</span><span class="sxs-lookup"><span data-stu-id="c04a6-206">ASP.NET Web Forms provides enhanced options for membership and authentication.</span></span> <span data-ttu-id="c04a6-207">Patří mezi ně OAuth.</span><span class="sxs-lookup"><span data-stu-id="c04a6-207">These enhancements include OAuth.</span></span> <span data-ttu-id="c04a6-208">OAuth je otevřený protokol, který umožňuje zabezpečenou autorizaci v jednoduché a standardní metody z webových, mobilních a desktopových aplikací.</span><span class="sxs-lookup"><span data-stu-id="c04a6-208">OAuth is an open protocol that allows secure authorization in a simple and standard method from web, mobile, and desktop applications.</span></span> <span data-ttu-id="c04a6-209">Šablony webových formulářů ASP.NET používá ke zveřejnění Facebook, Twitter, Google a Microsoft jako zprostředkovatele ověřování OAuth.</span><span class="sxs-lookup"><span data-stu-id="c04a6-209">The ASP.NET Web Forms template uses OAuth to expose Facebook, Twitter, Google and Microsoft as authentication providers.</span></span> <span data-ttu-id="c04a6-210">I když tento kurz používá jako zprostředkovatel ověřování Google pouze, můžete snadno upravit kód, který použije žádného z poskytovatelů.</span><span class="sxs-lookup"><span data-stu-id="c04a6-210">Although this tutorial uses only Google as the authentication provider, you can easily modify the code to use any of the providers.</span></span> <span data-ttu-id="c04a6-211">Kroky pro implementaci jiní poskytovatelé jsou velmi podobné kroky, které se zobrazí v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-211">The steps to implement other providers are very similar to the steps you will see in this tutorial.</span></span>

<span data-ttu-id="c04a6-212">Kromě ověřování bude tento kurz také pomocí rolí k implementaci autorizace.</span><span class="sxs-lookup"><span data-stu-id="c04a6-212">In addition to authentication, the tutorial will also use roles to implement authorization.</span></span> <span data-ttu-id="c04a6-213">Pouze na uživatele, přidání do `canEdit` nebude moci měnit data role (vytvořit, upravit nebo odstranit kontakty).</span><span class="sxs-lookup"><span data-stu-id="c04a6-213">Only those users you add to the `canEdit` role will be able to change data (create, edit, or delete contacts).</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="c04a6-214">Aplikace Windows Live přijímají pouze za provozu adresu URL pro funkčního webu, tak pro testování přihlášení nemůžete použít adresu URL místního webu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-214">Windows Live applications only accept a live URL for a working website, so you cannot use a local website URL for testing logins.</span></span>


<span data-ttu-id="c04a6-215">Následující postup vám umožní přidat zprostředkovatele ověřování Google.</span><span class="sxs-lookup"><span data-stu-id="c04a6-215">The following steps will allow you to add a Google authentication provider.</span></span>

1. <span data-ttu-id="c04a6-216">Otevřete *aplikace\_Start\Startup.Auth.cs* souboru.</span><span class="sxs-lookup"><span data-stu-id="c04a6-216">Open the *App\_Start\Startup.Auth.cs* file.</span></span>
2. <span data-ttu-id="c04a6-217">Odeberte komentář znaky z `app.UseGoogleAuthentication()` metoda tak, že metoda zobrazí jako následuje:</span><span class="sxs-lookup"><span data-stu-id="c04a6-217">Remove the comment characters from the `app.UseGoogleAuthentication()` method so that the method appears as follows:</span></span> 

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample5.cs)]
3. <span data-ttu-id="c04a6-218">Přejděte na [konzole pro vývojáře Google](https://console.developers.google.com/).</span><span class="sxs-lookup"><span data-stu-id="c04a6-218">Navigate to the [Google Developers Console](https://console.developers.google.com/).</span></span> <span data-ttu-id="c04a6-219">Musíte se také k přihlášení pomocí účtu Google developer e-mailu (gmail.com).</span><span class="sxs-lookup"><span data-stu-id="c04a6-219">You will also need to sign-in with your Google developer email account (gmail.com).</span></span> <span data-ttu-id="c04a6-220">Pokud nemáte účet Google, vyberte **vytvoření účtu** odkaz.</span><span class="sxs-lookup"><span data-stu-id="c04a6-220">If you do not have a Google account, select the **Create an account** link.</span></span>   
 <span data-ttu-id="c04a6-221">V dalším kroku se zobrazí **konzole pro vývojáře Google**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-221">Next, you'll see the **Google Developers Console**.</span></span>   
    <span data-ttu-id="c04a6-222">![Konzole pro vývojáře Google](checkout-and-payment-with-paypal/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="c04a6-222">![Google Developers Console](checkout-and-payment-with-paypal/_static/image8.png)</span></span>
4. <span data-ttu-id="c04a6-223">Klikněte **vytvoření projektu** tlačítko a zadejte název projektu a ID (můžete použít výchozí hodnoty).</span><span class="sxs-lookup"><span data-stu-id="c04a6-223">Click the **Create Project** button and enter a project name and ID (you can use the default values).</span></span> <span data-ttu-id="c04a6-224">Potom klikněte **políčko smlouvy** a **vytvořit** tlačítko.</span><span class="sxs-lookup"><span data-stu-id="c04a6-224">Then, click the **agreement checkbox** and the **Create** button.</span></span>  

    ![Google – nový projekt](checkout-and-payment-with-paypal/_static/image9.png)

 <span data-ttu-id="c04a6-226">Během pár sekund se vytvoří nový projekt a prohlížeč zobrazí stránku pro nové projekty.</span><span class="sxs-lookup"><span data-stu-id="c04a6-226">In a few seconds the new project will be created and your browser will display the new projects page.</span></span>
5. <span data-ttu-id="c04a6-227">V levé kartě klikněte na **rozhraní API &amp; auth**a potom klikněte na **pověření**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-227">In the left tab, click **APIs &amp; auth**, and then click **Credentials**.</span></span>
6. <span data-ttu-id="c04a6-228">Klikněte **vytvořit nové ID klienta** pod **OAuth**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-228">Click the **Create New Client ID** under **OAuth**.</span></span>   
 <span data-ttu-id="c04a6-229">**Vytvořit ID klienta** zobrazí se dialogové okno.</span><span class="sxs-lookup"><span data-stu-id="c04a6-229">The **Create Client ID** dialog will be displayed.</span></span>   
    <span data-ttu-id="c04a6-230">![Google - vytvořit ID klienta](checkout-and-payment-with-paypal/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c04a6-230">![Google - Create Client ID](checkout-and-payment-with-paypal/_static/image10.png)</span></span>
7. <span data-ttu-id="c04a6-231">V **vytvořit ID klienta** dialogové okno, ponechte výchozí **webové aplikace** pro typ aplikace.</span><span class="sxs-lookup"><span data-stu-id="c04a6-231">In the **Create Client ID** dialog, keep the default **Web application** for the application type.</span></span>
8. <span data-ttu-id="c04a6-232">Nastavte **oprávnění zdroje JavaScript** na adresu URL SSL, který jste použili v tomto kurzu (`https://localhost:44300/` Pokud jste vytvořili další projekty SSL).</span><span class="sxs-lookup"><span data-stu-id="c04a6-232">Set the **Authorized JavaScript Origins** to the SSL URL you used earlier in this tutorial (`https://localhost:44300/` unless you've created other SSL projects).</span></span>   
 <span data-ttu-id="c04a6-233">Tato adresa URL je zdrojem pro vaši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="c04a6-233">This URL is the origin for your application.</span></span> <span data-ttu-id="c04a6-234">Tato ukázka se pouze zadejte testovací adresu URL místního hostitele.</span><span class="sxs-lookup"><span data-stu-id="c04a6-234">For this sample, you will only enter the localhost test URL.</span></span> <span data-ttu-id="c04a6-235">Můžete však zadat více adres URL pro účet pro místního hostitele a provozu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-235">However, you can enter multiple URLs to account for localhost and production.</span></span>
9. <span data-ttu-id="c04a6-236">Nastavte **oprávnění identifikátor URI pro přesměrování** pro následující:</span><span class="sxs-lookup"><span data-stu-id="c04a6-236">Set the **Authorized Redirect URI** to the following:</span></span> 

    [!code-html[Main](checkout-and-payment-with-paypal/samples/sample6.html)]

 <span data-ttu-id="c04a6-237">Tato hodnota je identifikátor URI tohoto ASP.NET OAuth uživatelům komunikovat se serverem google OAuth.</span><span class="sxs-lookup"><span data-stu-id="c04a6-237">This value is the URI that ASP.NET OAuth users to communicate with the google OAuth server.</span></span> <span data-ttu-id="c04a6-238">Mějte na paměti, adresu URL SSL jste použili výše ( `https://localhost:44300/` Pokud jste vytvořili další projekty SSL).</span><span class="sxs-lookup"><span data-stu-id="c04a6-238">Remember the SSL URL you used above (    `https://localhost:44300/` unless you've created other SSL projects).</span></span>
10. <span data-ttu-id="c04a6-239">Klikněte **vytvořit ID klienta** tlačítko.</span><span class="sxs-lookup"><span data-stu-id="c04a6-239">Click the **Create Client ID** button.</span></span>
11. <span data-ttu-id="c04a6-240">V levé nabídce konzoly Google vývojáře, klikněte na tlačítko **souhlasu obrazovky** položky nabídky, nastavte vaše e-mailovou adresu a název produktu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-240">On the left menu of the Google Developers Console, click the **Consent screen** menu item, then set your email address and product name.</span></span> <span data-ttu-id="c04a6-241">Pokud jste vyplnili formulář, klikněte na tlačítko **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-241">When you have completed the form, click **Save**.</span></span>
12. <span data-ttu-id="c04a6-242">Klikněte **rozhraní API** položky nabídky, přejděte dolů a klikněte na **vypnout** vedle položky **rozhraní API Google +**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-242">Click the **APIs** menu item, scroll down and click the **off** button next to **Google+ API**.</span></span>   
 <span data-ttu-id="c04a6-243">Přijetí této možnosti povolíte rozhraní API Google +.</span><span class="sxs-lookup"><span data-stu-id="c04a6-243">Accepting this option will enable the Google+ API.</span></span>
13. <span data-ttu-id="c04a6-244">Také musíte aktualizovat **Microsoft.Owin** balíček NuGet verzi 3.0.0.</span><span class="sxs-lookup"><span data-stu-id="c04a6-244">You must also update the **Microsoft.Owin** NuGet package to version 3.0.0.</span></span>   
 <span data-ttu-id="c04a6-245">Z **nástroje** nabídce vyberte možnost **Správce balíčků NuGet** a pak vyberte **spravovat balíčky NuGet pro řešení**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-245">From the **Tools** menu, select **NuGet Package Manager** and then select **Manage NuGet Packages for Solution**.</span></span>  
 <span data-ttu-id="c04a6-246">Z **spravovat balíčky NuGet** oken, najít a aktualizace **Microsoft.Owin** balíček verze 3.0.0.</span><span class="sxs-lookup"><span data-stu-id="c04a6-246">From the **Manage NuGet Packages** window, find and update the **Microsoft.Owin** package to version 3.0.0.</span></span>
14. <span data-ttu-id="c04a6-247">V sadě Visual Studio, aktualizovat `UseGoogleAuthentication` metodu *Startup.Auth.cs* stránky tak, že kopírování a vkládání **ID klienta** a **tajný klíč klienta** do metody.</span><span class="sxs-lookup"><span data-stu-id="c04a6-247">In Visual Studio, update the `UseGoogleAuthentication` method of the *Startup.Auth.cs* page by copying and pasting the **Client ID** and **Client Secret** into the method.</span></span> <span data-ttu-id="c04a6-248">**ID klienta** a **tajný klíč klienta** hodnoty zobrazené níže jsou příklady a nebude fungovat.</span><span class="sxs-lookup"><span data-stu-id="c04a6-248">The **Client ID** and **Client Secret** values shown below are samples and will not work.</span></span> 

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample7.cs?highlight=64-65)]
15. <span data-ttu-id="c04a6-249">Stiskněte klávesu **CTRL + F5** sestavení a spuštění aplikace.</span><span class="sxs-lookup"><span data-stu-id="c04a6-249">Press **CTRL+F5** to build and run the application.</span></span> <span data-ttu-id="c04a6-250">Klikněte **přihlásit** odkaz.</span><span class="sxs-lookup"><span data-stu-id="c04a6-250">Click the **Log in** link.</span></span>
16. <span data-ttu-id="c04a6-251">V části **přihlásit pomocí jiné služby**, klikněte na tlačítko **Google**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-251">Under **Use another service to log in**, click **Google**.</span></span>  
    <span data-ttu-id="c04a6-252">![Přihlásit se](checkout-and-payment-with-paypal/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="c04a6-252">![Log in](checkout-and-payment-with-paypal/_static/image11.png)</span></span>
17. <span data-ttu-id="c04a6-253">Pokud potřebujete k zadání přihlašovacích údajů, budete přesměrováni na web google, kde bude zadejte svoje přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="c04a6-253">If you need to enter your credentials, you will be redirected to the google site where you will enter your credentials.</span></span>  
    ![Google - přihlášení](checkout-and-payment-with-paypal/_static/image12.png)
18. <span data-ttu-id="c04a6-255">Po zadání přihlašovacích údajů, zobrazí se výzva k udělit oprávnění k webové aplikaci, kterou jste právě vytvořili.</span><span class="sxs-lookup"><span data-stu-id="c04a6-255">After you enter your credentials, you will be prompted to give permissions to the web application you just created.</span></span>  
    ![Účet služby výchozí projekt](checkout-and-payment-with-paypal/_static/image13.png)
19. <span data-ttu-id="c04a6-257">Klikněte na tlačítko **přijmout**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-257">Click **Accept**.</span></span> <span data-ttu-id="c04a6-258">Teď můžete bude přesměrován zpět na **zaregistrovat** stránky **Northwind** aplikace, kde můžete zaregistrovat účet služby Google.</span><span class="sxs-lookup"><span data-stu-id="c04a6-258">You will now be redirected back to the **Register** page of the **WingtipToys** application where you can register your Google account.</span></span>  
    <span data-ttu-id="c04a6-259">![Zaregistrujte se pomocí vašeho účtu Google](checkout-and-payment-with-paypal/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="c04a6-259">![Register with your Google Account](checkout-and-payment-with-paypal/_static/image14.png)</span></span>
20. <span data-ttu-id="c04a6-260">Máte možnost změny názvu registrace místní e-mailu, který se používá pro váš účet z Gmailu, ale chcete obecně zachovat výchozí e-mailový alias (to znamená, ten, který jste použili pro ověřování).</span><span class="sxs-lookup"><span data-stu-id="c04a6-260">You have the option of changing the local email registration name used for your Gmail account, but you generally want to keep the default email alias (that is, the one you used for authentication).</span></span> <span data-ttu-id="c04a6-261">Klikněte na tlačítko **přihlásit** jako v příkladu nahoře.</span><span class="sxs-lookup"><span data-stu-id="c04a6-261">Click **Log in** as shown above.</span></span>

### <a name="modifying-login-functionality"></a><span data-ttu-id="c04a6-262">Úpravy funkce přihlášení</span><span class="sxs-lookup"><span data-stu-id="c04a6-262">Modifying Login Functionality</span></span>

<span data-ttu-id="c04a6-263">Jak jsme uvedli v řadě tento kurz mnoho funkcí registrace uživatele byl zahrnut v šabloně webových formulářů ASP.NET ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="c04a6-263">As previously mentioned in this tutorial series, much of the user registration functionality has been included in the ASP.NET Web Forms template by default.</span></span> <span data-ttu-id="c04a6-264">Nyní bude upravit výchozí *Login.aspx* a *Register.aspx* stránky k volání `MigrateCart` metoda.</span><span class="sxs-lookup"><span data-stu-id="c04a6-264">Now you will modify the default *Login.aspx* and *Register.aspx* pages to call the `MigrateCart` method.</span></span> <span data-ttu-id="c04a6-265">`MigrateCart` Metoda přidruží anonymní nákupní košík nově přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="c04a6-265">The `MigrateCart` method associates a newly logged in user with an anonymous shopping cart.</span></span> <span data-ttu-id="c04a6-266">Přidružení uživatele a nákupní košík, bude moci udržovat nákupní košík uživatele mezi návštěvy adresář Wingtip Toys ukázkovou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="c04a6-266">By associating the user and shopping cart, the Wingtip Toys sample application will be able to maintain the shopping cart of the user between visits.</span></span>

1. <span data-ttu-id="c04a6-267">V **Průzkumníku řešení**, najít a otevřít *účtu* složky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-267">In **Solution Explorer**, find and open the *Account* folder.</span></span>
2. <span data-ttu-id="c04a6-268">Úprava kódu stránky s názvem *Login.aspx.cs* zahrnout kód zvýrazněných v žlutý, tak, aby se následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="c04a6-268">Modify the code-behind page named *Login.aspx.cs* to include the code highlighted in yellow, so that it appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample8.cs?highlight=41-43)]
3. <span data-ttu-id="c04a6-269">Uložit *Login.aspx.cs* souboru.</span><span class="sxs-lookup"><span data-stu-id="c04a6-269">Save the *Login.aspx.cs* file.</span></span>

<span data-ttu-id="c04a6-270">Teď, můžete ignorovat upozornění, že je k dispozici žádné definice `MigrateCart` metoda.</span><span class="sxs-lookup"><span data-stu-id="c04a6-270">For now, you can ignore the warning that there is no definition for the `MigrateCart` method.</span></span> <span data-ttu-id="c04a6-271">Budete přidávat ho trochu později v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-271">You will be adding it a bit later in this tutorial.</span></span>

<span data-ttu-id="c04a6-272">*Login.aspx.cs* souboru kódu na pozadí podporuje metodu přihlášení.</span><span class="sxs-lookup"><span data-stu-id="c04a6-272">The *Login.aspx.cs* code-behind file supports a LogIn method.</span></span> <span data-ttu-id="c04a6-273">Zkontrolováním stránku Login.aspx uvidíte, že tato stránka obsahuje tlačítko "Přihlášení" který po klikněte na tlačítko aktivační události `LogIn` obslužné rutiny na modelu code-behind.</span><span class="sxs-lookup"><span data-stu-id="c04a6-273">By inspecting the Login.aspx page, you'll see that this page includes a "Log in" button that when click triggers the `LogIn` handler on the code-behind.</span></span>

<span data-ttu-id="c04a6-274">Když `Login` metodu *Login.aspx.cs* nazývá novou instanci třídy nákupní košík s názvem `usersShoppingCart` je vytvořena.</span><span class="sxs-lookup"><span data-stu-id="c04a6-274">When the `Login` method on the *Login.aspx.cs* is called, a new instance of the shopping cart named `usersShoppingCart` is created.</span></span> <span data-ttu-id="c04a6-275">ID nákupní košík (GUID) je načíst a nastavit na `cartId` proměnné.</span><span class="sxs-lookup"><span data-stu-id="c04a6-275">The ID of the shopping cart (a GUID) is retrieved and set to the `cartId` variable.</span></span> <span data-ttu-id="c04a6-276">Potom, `MigrateCart` metoda je volána, předávání i `cartId` a název přihlášeného uživatele k této metodě.</span><span class="sxs-lookup"><span data-stu-id="c04a6-276">Then, the `MigrateCart` method is called, passing both the `cartId` and the name of the logged-in user to this method.</span></span> <span data-ttu-id="c04a6-277">Při migraci nákupní košík identifikátor GUID použít k identifikaci anonymní nákupní košík se nahradí uživatelské jméno.</span><span class="sxs-lookup"><span data-stu-id="c04a6-277">When the shopping cart is migrated, the GUID used to identify the anonymous shopping cart is replaced with the user name.</span></span>

<span data-ttu-id="c04a6-278">Kromě úpravy *Login.aspx.cs* souboru kódu na migraci nákupní košík, když se uživatel přihlásí, musíte také upravit *souboru kódu Register.aspx.cs* k migraci nákupní košík Když uživatel vytvoří nový účet a přihlásí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-278">In addition to modifying the *Login.aspx.cs* code-behind file to migrate the shopping cart when the user logs in, you must also modify the *Register.aspx.cs code-behind file* to migrate the shopping cart when the user creates a new account and logs in.</span></span>

1. <span data-ttu-id="c04a6-279">V *účet* složku, otevřete soubor modelu code-behind s názvem *Register.aspx.cs*.</span><span class="sxs-lookup"><span data-stu-id="c04a6-279">In the *Account* folder, open the code-behind file named *Register.aspx.cs*.</span></span>
2. <span data-ttu-id="c04a6-280">Upravte soubor kódu zahrnutím kód v žlutý, tak, aby se následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="c04a6-280">Modify the code-behind file by including the code in yellow, so that it appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample9.cs?highlight=28-32)]
3. <span data-ttu-id="c04a6-281">Uložit *Register.aspx.cs* souboru.</span><span class="sxs-lookup"><span data-stu-id="c04a6-281">Save the *Register.aspx.cs* file.</span></span> <span data-ttu-id="c04a6-282">Ještě jednou ignorovat upozornění o `MigrateCart` metoda.</span><span class="sxs-lookup"><span data-stu-id="c04a6-282">Once again, ignore the warning about the `MigrateCart` method.</span></span>

<span data-ttu-id="c04a6-283">Všimněte si, že kód, můžete používat ve `CreateUser_Click` obslužné rutiny události je velmi podobný kódu, kterou jste použili v `LogIn` metoda.</span><span class="sxs-lookup"><span data-stu-id="c04a6-283">Notice that the code you used in the `CreateUser_Click` event handler is very similar to the code you used in the `LogIn` method.</span></span> <span data-ttu-id="c04a6-284">Pokud uživatel zaregistruje nebo přihlášení k webu, volání `MigrateCart` metoda budou provedeny.</span><span class="sxs-lookup"><span data-stu-id="c04a6-284">When the user registers or logs in to the site, a call to the `MigrateCart` method will be made.</span></span>

## <a name="migrating-the-shopping-cart"></a><span data-ttu-id="c04a6-285">Migrace nákupní košík</span><span class="sxs-lookup"><span data-stu-id="c04a6-285">Migrating the Shopping Cart</span></span>

<span data-ttu-id="c04a6-286">Teď, když máte proces přihlášení a registrace aktualizované, můžete přidat kód pro migraci nákupní košík pomocí `MigrateCart` metoda.</span><span class="sxs-lookup"><span data-stu-id="c04a6-286">Now that you have the log-in and registration process updated, you can add the code to migrate the shopping cart using the `MigrateCart` method.</span></span>

1. <span data-ttu-id="c04a6-287">V **Průzkumníku řešení**, Najít *logiku* složky a otevřete *ShoppingCartActions.cs* soubor třídy.</span><span class="sxs-lookup"><span data-stu-id="c04a6-287">In **Solution Explorer**, find the *Logic* folder and open the *ShoppingCartActions.cs* class file.</span></span>
2. <span data-ttu-id="c04a6-288">Přidejte kód zvýrazněných v žlutý existující kód v *ShoppingCartActions.cs* souboru, tak, aby kód *ShoppingCartActions.cs* soubor vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="c04a6-288">Add the code highlighted in yellow to the existing code in the *ShoppingCartActions.cs* file, so that the code in the *ShoppingCartActions.cs* file appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample10.cs?highlight=215-224)]

<span data-ttu-id="c04a6-289">`MigrateCart` Metoda používá existující cartId k nalezení nákupní košík uživatele.</span><span class="sxs-lookup"><span data-stu-id="c04a6-289">The `MigrateCart` method uses the existing cartId to find the shopping cart of the user.</span></span> <span data-ttu-id="c04a6-290">V dalším kroku kód projde všechny nákupní košík položky a nahradí `CartId` vlastnost (zadané `CartItem` schématu) s názvem přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="c04a6-290">Next, the code loops through all the shopping cart items and replaces the `CartId` property (as specified by the `CartItem` schema) with the logged-in user name.</span></span>

### <a name="updating-the-database-connection"></a><span data-ttu-id="c04a6-291">Aktualizace připojení k databázi</span><span class="sxs-lookup"><span data-stu-id="c04a6-291">Updating the Database Connection</span></span>

<span data-ttu-id="c04a6-292">Použijete-li tento kurz pomocí **předem** adresář Wingtip Toys ukázkové aplikace, musíte znovu vytvořit výchozí databáze členství.</span><span class="sxs-lookup"><span data-stu-id="c04a6-292">If you are following this tutorial using the **prebuilt** Wingtip Toys sample application, you must recreate the default membership database.</span></span> <span data-ttu-id="c04a6-293">Změnou výchozí připojovací řetězec databáze členství vytvoří se při příštím spuštění aplikace.</span><span class="sxs-lookup"><span data-stu-id="c04a6-293">By modifying the default connection string, the membership database will be created the next time the application runs.</span></span>

1. <span data-ttu-id="c04a6-294">Otevřete *Web.config* souboru v kořenovém adresáři projektu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-294">Open the *Web.config* file at the root of the project.</span></span>
2. <span data-ttu-id="c04a6-295">Výchozí připojovací řetězec aktualizujte tak, aby se následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="c04a6-295">Update the default connection string so that it appears as follows:</span></span>   

    [!code-xml[Main](checkout-and-payment-with-paypal/samples/sample11.xml)]

<a id="PayPalWebForms"></a>
## <a name="integrating-paypal"></a><span data-ttu-id="c04a6-296">Integrace služby PayPal</span><span class="sxs-lookup"><span data-stu-id="c04a6-296">Integrating PayPal</span></span>

<span data-ttu-id="c04a6-297">PayPal je založené na webu fakturace platforma, která přijímá plateb podle online obchodníků.</span><span class="sxs-lookup"><span data-stu-id="c04a6-297">PayPal is a web-based billing platform that accepts payments by online merchants.</span></span> <span data-ttu-id="c04a6-298">V tomto kurzu dále vysvětluje, jak integrovat funkce Express najdete v článku věnovaném PayPal pro do vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="c04a6-298">This tutorial next explains how to integrate PayPal's Express Checkout functionality into your application.</span></span> <span data-ttu-id="c04a6-299">Rychlé Checkout umožňuje zákazníkům použít PayPal platit pro položky, které jste přidali k jejich nákupní košík.</span><span class="sxs-lookup"><span data-stu-id="c04a6-299">Express Checkout allows your customers to use PayPal to pay for the items they have added to their shopping cart.</span></span>

### <a name="create-paylpal-test-accounts"></a><span data-ttu-id="c04a6-300">Vytvoření účtů PaylPal testu</span><span class="sxs-lookup"><span data-stu-id="c04a6-300">Create PaylPal Test Accounts</span></span>

<span data-ttu-id="c04a6-301">Použít PayPal testovacím prostředí, musíte vytvořit a ověřit test vývojářského účtu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-301">To use the PayPal testing environment, you must create and verify a developer test account.</span></span> <span data-ttu-id="c04a6-302">Testovací účet vývojáře použije k vytvoření kupujících testovací účet a testovací účet prodejce.</span><span class="sxs-lookup"><span data-stu-id="c04a6-302">You will use the developer test account to create a buyer test account and a seller test account.</span></span> <span data-ttu-id="c04a6-303">Přihlašovací údaje vývojář testovací účtu také umožní adresář Wingtip Toys ukázkovou aplikaci pro přístup k testovacím prostředí PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-303">The developer test account credentials also will allow the Wingtip Toys sample application to access the PayPal testing environment.</span></span>

1. <span data-ttu-id="c04a6-304">V prohlížeči přejděte na vývojáře PayPal testování webu:</span><span class="sxs-lookup"><span data-stu-id="c04a6-304">In a browser, navigate to the PayPal developer testing site:</span></span>   
    [<span data-ttu-id="c04a6-305">https://Developer.PayPal.com</span><span class="sxs-lookup"><span data-stu-id="c04a6-305">https://developer.paypal.com</span></span>](https://developer.paypal.com/)
2. <span data-ttu-id="c04a6-306">Pokud nemáte účet služby PayPal pro vývojáře, vytvořit nový účet kliknutím na tlačítko **zaregistrovat**a následující kroky registrace.</span><span class="sxs-lookup"><span data-stu-id="c04a6-306">If you don't have a PayPal developer account, create a new account by clicking **Sign Up**and following the sign up steps.</span></span> <span data-ttu-id="c04a6-307">Pokud máte stávající účet vývojáře PayPal, přihlaste se kliknutím na **protokolu v**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-307">If you have an existing PayPal developer account, sign in by clicking **Log In**.</span></span> <span data-ttu-id="c04a6-308">Budete potřebovat vývojářského účtu PayPal otestovat vzorovou aplikaci adresář Wingtip Toys později v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-308">You will need your PayPal developer account to test the Wingtip Toys sample application later in this tutorial.</span></span>
3. <span data-ttu-id="c04a6-309">Pokud jste právě zaregistrovali do služby pro vývojářského účtu PayPal, musíte ověřit vývojářského účtu PayPal s PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-309">If you have just signed up for your PayPal developer account, you may need to verify your PayPal developer account with PayPal.</span></span> <span data-ttu-id="c04a6-310">Pomocí následujících kroků, které PayPal posílat e-mailový účet, můžete ověřit váš účet.</span><span class="sxs-lookup"><span data-stu-id="c04a6-310">You can verify your account by following the steps that PayPal sent to your email account.</span></span> <span data-ttu-id="c04a6-311">Jakmile si ověříte vývojářského účtu PayPal, přihlaste se zpět k vývojáře PayPal testování webu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-311">Once you have verified your PayPal developer account, log back into the PayPal developer testing site.</span></span>
4. <span data-ttu-id="c04a6-312">Poté, co jste přihlášení k webu pro vývojáře PayPal s vývojářský účet služby PayPal, že potřebujete vytvořit účet služby PayPal kupujících testu, pokud to neuděláte již mít jeden.</span><span class="sxs-lookup"><span data-stu-id="c04a6-312">After you are logged in to the PayPal developer site with your PayPal developer account you need to create a PayPal buyer test account if you don't already have one.</span></span> <span data-ttu-id="c04a6-313">Chcete vytvořit účet testovací kupujících na webu služby PayPal, klikněte na tlačítko **aplikace** a pak klikněte **izolovaného prostoru účty**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-313">To create a buyer test account, on the PayPal site click the **Applications** tab and then click **Sandbox accounts**.</span></span>   
 <span data-ttu-id="c04a6-314">**Izolovaného testovací účty** stránky se zobrazí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-314">The **Sandbox test accounts** page is shown.</span></span>   

    > [!NOTE] 
    > 
    > <span data-ttu-id="c04a6-315">Web PayPal Developer již poskytuje obchodní testovací účet.</span><span class="sxs-lookup"><span data-stu-id="c04a6-315">The PayPal Developer site already provides a merchant test account.</span></span>

    ![Najdete v článku věnovaném a platbu se PayPal – izolovaného testovací účty](checkout-and-payment-with-paypal/_static/image15.png)
5. <span data-ttu-id="c04a6-317">Na stránce izolovaného testovací účty, klikněte na **vytvořit účet**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-317">On the Sandbox test accounts page, click **Create Account**.</span></span>
6. <span data-ttu-id="c04a6-318">Na **vytvořit testovací účet** možnost kupující zkušební účet e-mail a heslo podle svého výběru.</span><span class="sxs-lookup"><span data-stu-id="c04a6-318">On the **Create test account** page choose a buyer test account email and password of your choice.</span></span>   

    > [!NOTE] 
    > 
    > <span data-ttu-id="c04a6-319">Budete potřebovat kupujících e-mailové adresy a hesla k testování adresář Wingtip Toys ukázkovou aplikaci na konci tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-319">You will need the buyer email addresses and password to test the Wingtip Toys sample application at the end of this tutorial.</span></span>

    ![Najdete v článku věnovaném a platbu se PayPal – izolovaného testovací účty](checkout-and-payment-with-paypal/_static/image16.png)
7. <span data-ttu-id="c04a6-321">Kliknutím na vytvořit testovací účet kupujících **vytvořit účet** tlačítko.</span><span class="sxs-lookup"><span data-stu-id="c04a6-321">Create the buyer test account by clicking the **Create Account** button.</span></span>  
 <span data-ttu-id="c04a6-322">**Izolovaného testovací účty** zobrazí se stránka.</span><span class="sxs-lookup"><span data-stu-id="c04a6-322">The **Sandbox Test accounts** page is displayed.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – PaylPal účty](checkout-and-payment-with-paypal/_static/image17.png)
8. <span data-ttu-id="c04a6-324">Na **izolovaného testovací účty** klikněte na tlačítko **zprostředkovatel** e-mailový účet.</span><span class="sxs-lookup"><span data-stu-id="c04a6-324">On the **Sandbox test accounts** page, click the **facilitator** email account.</span></span>  
    <span data-ttu-id="c04a6-325">**Profil** a **oznámení** zobrazí možnosti.</span><span class="sxs-lookup"><span data-stu-id="c04a6-325">**Profile** and **Notification** options appear.</span></span>
9. <span data-ttu-id="c04a6-326">Vyberte **profil** možnost a potom klikněte na **rozhraní API pověření** zobrazíte vaše přihlašovací údaje rozhraní API pro obchodní testovací účet.</span><span class="sxs-lookup"><span data-stu-id="c04a6-326">Select the **Profile** option, then click **API credentials** to view your API credentials for the merchant test account.</span></span>
10. <span data-ttu-id="c04a6-327">TEST API přihlašovací údaje zkopírujte do poznámkového bloku.</span><span class="sxs-lookup"><span data-stu-id="c04a6-327">Copy the TEST API credentials to notepad.</span></span>

<span data-ttu-id="c04a6-328">Zobrazené klasické rozhraní API testu pověření (uživatelské jméno, heslo a podpis) provádět volání rozhraní API z ukázkové aplikace adresář Wingtip Toys budete muset PayPal testovacím prostředí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-328">You will need your displayed Classic TEST API credentials (Username, Password, and Signature) to make API calls from the Wingtip Toys sample application to the PayPal testing environment.</span></span> <span data-ttu-id="c04a6-329">V dalším kroku přidáte přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="c04a6-329">You will add the credentials in the next step.</span></span>

### <a name="add-paypal-class-and-api-credentials"></a><span data-ttu-id="c04a6-330">Přidat PayPal třídy a rozhraní API pověření</span><span class="sxs-lookup"><span data-stu-id="c04a6-330">Add PayPal Class and API Credentials</span></span>

<span data-ttu-id="c04a6-331">Umístíte většinu kódu PayPal do jediné třídy.</span><span class="sxs-lookup"><span data-stu-id="c04a6-331">You will place the majority of the PayPal code into a single class.</span></span> <span data-ttu-id="c04a6-332">Tato třída obsahuje metody, používaný ke komunikaci s PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-332">This class contains the methods used to communicate with PayPal.</span></span> <span data-ttu-id="c04a6-333">Navíc přidáte přihlašovacích údajů služby PayPal pro tuto třídu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-333">Also, you will add your PayPal credentials to this class.</span></span>

1. <span data-ttu-id="c04a6-334">V adresář Wingtip Toys ukázkovou aplikaci v sadě Visual Studio, klikněte pravým tlačítkem **logiku** složku a potom vyberte **přidat**  - &gt; **novou položku**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-334">In the Wingtip Toys sample application within Visual Studio, right-click the **Logic** folder and then select **Add** -&gt; **New Item**.</span></span>   
 <span data-ttu-id="c04a6-335">**Přidat novou položku** se zobrazí dialogové okno.</span><span class="sxs-lookup"><span data-stu-id="c04a6-335">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="c04a6-336">V části **Visual C#** z **nainstalovaná** podokna na levé straně vyberte **kód**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-336">Under **Visual C#** from the **Installed** pane on the left, select **Code**.</span></span>
3. <span data-ttu-id="c04a6-337">V prostředním podokně, vyberte **třída**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-337">From the middle pane, select **Class**.</span></span> <span data-ttu-id="c04a6-338">Název tato nová třída **PayPalFunctions.cs**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-338">Name this new class **PayPalFunctions.cs**.</span></span>
4. <span data-ttu-id="c04a6-339">Klikněte na tlačítko **přidat**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-339">Click **Add**.</span></span>  
 <span data-ttu-id="c04a6-340">Nový soubor třídy se zobrazí v editoru.</span><span class="sxs-lookup"><span data-stu-id="c04a6-340">The new class file is displayed in the editor.</span></span>
5. <span data-ttu-id="c04a6-341">Ve výchozím kódu nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="c04a6-341">Replace the default code with the following code:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample12.cs)]
6. <span data-ttu-id="c04a6-342">Přidejte obchodní API pověření (uživatelské jméno, heslo a podpis), zobrazené v tomto kurzu tak, aby mohla provést volání funkce PayPal testovacího prostředí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-342">Add the Merchant API credentials (Username, Password, and Signature) that you displayed earlier in this tutorial so that you can make function calls to the PayPal testing environment.</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample13.cs)]

> [!NOTE] 
> 
> <span data-ttu-id="c04a6-343">V této ukázkové aplikaci jednoduše přidáváte přihlašovací údaje do souboru C# (.cs).</span><span class="sxs-lookup"><span data-stu-id="c04a6-343">In this sample application you are simply adding credentials to a C# file (.cs).</span></span> <span data-ttu-id="c04a6-344">Ale v implementované řešení, měli byste zvážit šifrování přihlašovacích údajů v konfiguračním souboru.</span><span class="sxs-lookup"><span data-stu-id="c04a6-344">However, in a implemented solution, you should consider encrypting your credentials in a configuration file.</span></span>


<span data-ttu-id="c04a6-345">Třída NVPAPICaller obsahuje většinu funkcí služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-345">The NVPAPICaller class contains the majority of the PayPal functionality.</span></span> <span data-ttu-id="c04a6-346">Kód ve třídě, poskytuje metody, třeba změnit testu zakoupit od PayPal testovacího prostředí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-346">The code in the class provides the methods needed to make a test purchase from the PayPal testing environment.</span></span> <span data-ttu-id="c04a6-347">Následující tři služby PayPal funkce slouží k nákupech:</span><span class="sxs-lookup"><span data-stu-id="c04a6-347">The following three PayPal functions are used to make purchases:</span></span>

- <span data-ttu-id="c04a6-348">`SetExpressCheckout`funkce</span><span class="sxs-lookup"><span data-stu-id="c04a6-348">`SetExpressCheckout` function</span></span>
- <span data-ttu-id="c04a6-349">`GetExpressCheckoutDetails`funkce</span><span class="sxs-lookup"><span data-stu-id="c04a6-349">`GetExpressCheckoutDetails` function</span></span>
- <span data-ttu-id="c04a6-350">`DoExpressCheckoutPayment`funkce</span><span class="sxs-lookup"><span data-stu-id="c04a6-350">`DoExpressCheckoutPayment` function</span></span>

<span data-ttu-id="c04a6-351">`ShortcutExpressCheckout` Metoda shromažďuje testovací informace a produktu podrobnosti o nákupu z nákupní košík a volání `SetExpressCheckout` funkce PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-351">The `ShortcutExpressCheckout` method collects the test purchase information and product details from the shopping cart and calls the `SetExpressCheckout` PayPal function.</span></span> <span data-ttu-id="c04a6-352">`GetCheckoutDetails` Metoda potvrdí podrobnosti o nákupu a volání `GetExpressCheckoutDetails` PayPal funkce před provedením testovací nákupu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-352">The `GetCheckoutDetails` method confirms purchase details and calls the `GetExpressCheckoutDetails` PayPal function before making the test purchase.</span></span> <span data-ttu-id="c04a6-353">`DoCheckoutPayment` Metoda dokončení nákupu testů z testovacího prostředí voláním `DoExpressCheckoutPayment` funkce PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-353">The `DoCheckoutPayment` method completes the test purchase from the testing environment by calling the `DoExpressCheckoutPayment` PayPal function.</span></span> <span data-ttu-id="c04a6-354">Zbývající kód podporuje PayPal metody a procesu, jako je například kódování řetězce, dekódování řetězců, zpracování pole a určit, přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="c04a6-354">The remaining code supports the PayPal methods and process, such as encoding strings, decoding strings, processing arrays, and determining credentials.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="c04a6-355">PayPal umožňuje zahrnout podrobnosti o volitelné nákupu na základě [specifikace rozhraní API služby PayPal pro](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&amp;content_ID=developer/e_howto_api_nvp_r_SetExpressCheckout).</span><span class="sxs-lookup"><span data-stu-id="c04a6-355">PayPal allows you to include optional purchase details based on [PayPal's API specification](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&amp;content_ID=developer/e_howto_api_nvp_r_SetExpressCheckout).</span></span> <span data-ttu-id="c04a6-356">Tím, že rozšíří kód na adresář Wingtip Toys ukázkovou aplikaci, můžete zahrnout lokalizace podrobnosti, popisy produktu, daň, služba číslo zákazníka, jakož i další volitelné pole.</span><span class="sxs-lookup"><span data-stu-id="c04a6-356">By extending the code in the Wingtip Toys sample application, you can include localization details, product descriptions, tax, a customer service number, as well as many other optional fields.</span></span>


<span data-ttu-id="c04a6-357">Všimněte si, že vrátit a zrušit adresy URL, které jsou určené v **ShortcutExpressCheckout** metoda používat číslo portu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-357">Notice that the return and cancel URLs that are specified in the **ShortcutExpressCheckout** method use a port number.</span></span>

[!code-html[Main](checkout-and-payment-with-paypal/samples/sample14.html)]

<span data-ttu-id="c04a6-358">Při aplikaci Visual Web Developer spuštění webového projektu pomocí protokolu SSL, běžně port 44300 se používá pro webový server.</span><span class="sxs-lookup"><span data-stu-id="c04a6-358">When Visual Web Developer runs a web project using SSL, commonly the port 44300 is used for the web server.</span></span> <span data-ttu-id="c04a6-359">Jako v příkladu nahoře, číslo portu je 44300.</span><span class="sxs-lookup"><span data-stu-id="c04a6-359">As shown above, the port number is 44300.</span></span> <span data-ttu-id="c04a6-360">Při spuštění aplikace zobrazí jiné číslo portu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-360">When you run the application, you could see a different port number.</span></span> <span data-ttu-id="c04a6-361">Port číslo musí být správně nastavena v kódu, aby bylo možné úspěšně spouštět ukázkovou aplikaci adresář Wingtip Toys na konci tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-361">Your port number needs to be correctly set in the code so that you can successful run the Wingtip Toys sample application at the end of this tutorial.</span></span> <span data-ttu-id="c04a6-362">V další části tohoto kurzu vysvětluje, jak načíst číslo portu místního hostitele a aktualizace třídy PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-362">The next section of this tutorial explains how to retrieve the local host port number and update the PayPal class.</span></span>

### <a name="update-the-localhost-port-number-in-the-paypal-class"></a><span data-ttu-id="c04a6-363">Aktualizovat číslo portu LocalHost ve třídě PayPal</span><span class="sxs-lookup"><span data-stu-id="c04a6-363">Update the LocalHost Port Number in the PayPal Class</span></span>

<span data-ttu-id="c04a6-364">Ukázkovou aplikaci adresář Wingtip Toys uzavře produkty tak, že přejdete na web služby PayPal testování a návrat k místní instanci ukázkové aplikace adresář Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="c04a6-364">The Wingtip Toys sample application purchases products by navigating to the PayPal testing site and returning to your local instance of the Wingtip Toys sample application.</span></span> <span data-ttu-id="c04a6-365">Aby bylo možné používat PayPal vrátit na správnou adresu URL, je třeba zadat číslo portu místně spuštění ukázkové aplikace v kódu PayPal uvedených výše.</span><span class="sxs-lookup"><span data-stu-id="c04a6-365">In order to have PayPal return to the correct URL, you need to specify the port number of the locally running sample application in the PayPal code mentioned above.</span></span>

1. <span data-ttu-id="c04a6-366">Klikněte pravým tlačítkem na název projektu (**Northwind**) v **Průzkumníku řešení** a vyberte **vlastnosti**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-366">Right-click the project name (**WingtipToys**) in **Solution Explorer** and select **Properties**.</span></span>
2. <span data-ttu-id="c04a6-367">V levém sloupci, vyberte **webové** kartě.</span><span class="sxs-lookup"><span data-stu-id="c04a6-367">In the left column, select the **Web** tab.</span></span>
3. <span data-ttu-id="c04a6-368">Načtení číslo portu od **adresa Url projektu** pole.</span><span class="sxs-lookup"><span data-stu-id="c04a6-368">Retrieve the port number from the **Project Url** box.</span></span>
4. <span data-ttu-id="c04a6-369">V případě potřeby aktualizovat `returnURL` a `cancelURL` ve třídě, PayPal (`NVPAPICaller`) v *PayPalFunctions.cs* souboru číslo portu webové aplikace:</span><span class="sxs-lookup"><span data-stu-id="c04a6-369">If needed, update the `returnURL` and `cancelURL` in the PayPal class (`NVPAPICaller`) in the *PayPalFunctions.cs* file to use the port number of your web application:</span></span>   

    [!code-html[Main](checkout-and-payment-with-paypal/samples/sample15.html?highlight=1-2)]

<span data-ttu-id="c04a6-370">Kód, který jste přidali teď bude odpovídat očekávané port pro místní webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="c04a6-370">Now the code that you added will match the expected port for your local Web application.</span></span> <span data-ttu-id="c04a6-371">PayPal bude moct vrátit na správnou adresu URL na místním počítači.</span><span class="sxs-lookup"><span data-stu-id="c04a6-371">PayPal will be able to return to the correct URL on your local machine.</span></span>

### <a name="add-the-paypal-checkout-button"></a><span data-ttu-id="c04a6-372">Přidat tlačítko PayPal ověření</span><span class="sxs-lookup"><span data-stu-id="c04a6-372">Add the PayPal Checkout Button</span></span>

<span data-ttu-id="c04a6-373">Teď, když primární funkce PayPal byly přidány k ukázkové aplikaci, můžete začít přidávat značek a kódu potřebných k volání tyto funkce.</span><span class="sxs-lookup"><span data-stu-id="c04a6-373">Now that the primary PayPal functions have been added to the sample application, you can begin adding the markup and code needed to call these functions.</span></span> <span data-ttu-id="c04a6-374">Nejprve je nutné přidat tlačítko ověření, který uživatel uvidí na stránce nákupní košík.</span><span class="sxs-lookup"><span data-stu-id="c04a6-374">First, you must add the checkout button that the user will see on the shopping cart page.</span></span>

1. <span data-ttu-id="c04a6-375">Otevřete *ShoppingCart.aspx* souboru.</span><span class="sxs-lookup"><span data-stu-id="c04a6-375">Open the *ShoppingCart.aspx* file.</span></span>
2. <span data-ttu-id="c04a6-376">Posuňte se do spodní části souboru a najít `<!--Checkout Placeholder -->` komentář.</span><span class="sxs-lookup"><span data-stu-id="c04a6-376">Scroll to the bottom of the file and find the `<!--Checkout Placeholder -->` comment.</span></span>
3. <span data-ttu-id="c04a6-377">Nahraďte komentář s `ImageButton` řídit tak, aby označit až je nahrazena následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="c04a6-377">Replace the comment with an `ImageButton` control so that the mark up is replaced as follows:</span></span>  

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample16.aspx)]
4. <span data-ttu-id="c04a6-378">V *ShoppingCart.aspx.cs* souboru po `UpdateBtn_Click` obslužné rutiny události u konce souboru, přidejte `CheckOutBtn_Click` obslužné rutiny události:</span><span class="sxs-lookup"><span data-stu-id="c04a6-378">In the *ShoppingCart.aspx.cs* file, after the `UpdateBtn_Click` event handler near the end of the file, add the `CheckOutBtn_Click` event handler:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample17.cs)]
5. <span data-ttu-id="c04a6-379">Také v *ShoppingCart.aspx.cs* soubor, přidejte odkaz na `CheckoutBtn`tak, aby tlačítko Nový image odkazuje následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="c04a6-379">Also in the *ShoppingCart.aspx.cs* file, add a reference to the `CheckoutBtn`, so that the new image button is referenced as follows:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample18.cs?highlight=18)]
6. <span data-ttu-id="c04a6-380">Uložte změny do obou *ShoppingCart.aspx* souboru a *ShoppingCart.aspx.cs* souboru.</span><span class="sxs-lookup"><span data-stu-id="c04a6-380">Save your changes to both the *ShoppingCart.aspx* file and the *ShoppingCart.aspx.cs* file.</span></span>
7. <span data-ttu-id="c04a6-381">V nabídce vyberte **ladění**-&gt;**sestavení Northwind**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-381">From the menu, select **Debug**-&gt;**Build WingtipToys**.</span></span>  
 <span data-ttu-id="c04a6-382">Projekt bude znovu vytvořen s nově přidaný **ImageButton** ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="c04a6-382">The project will be rebuilt with the newly added **ImageButton** control.</span></span>

### <a name="send-purchase-details-to-paypal"></a><span data-ttu-id="c04a6-383">Poslat podrobnosti o nákupu PayPal</span><span class="sxs-lookup"><span data-stu-id="c04a6-383">Send Purchase Details to PayPal</span></span>

<span data-ttu-id="c04a6-384">Když uživatel klikne **najdete v článku věnovaném** tlačítko na stránce nákupní košík (*ShoppingCart.aspx*), budou brzy procesu nákupu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-384">When the user clicks the **Checkout** button on the shopping cart page (*ShoppingCart.aspx*), they'll begin the purchase process.</span></span> <span data-ttu-id="c04a6-385">Následující kód zavolá funkci první PayPal potřebné k nákupu produkty.</span><span class="sxs-lookup"><span data-stu-id="c04a6-385">The following code calls the first PayPal function needed to purchase products.</span></span>

1. <span data-ttu-id="c04a6-386">Z *najdete v článku věnovaném* složku, otevřete soubor modelu code-behind s názvem *CheckoutStart.aspx.cs*.</span><span class="sxs-lookup"><span data-stu-id="c04a6-386">From the *Checkout* folder, open the code-behind file named *CheckoutStart.aspx.cs*.</span></span>   
 <span data-ttu-id="c04a6-387">Ujistěte se, že otevřete soubor kódu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-387">Be sure to open the code-behind file.</span></span>
2. <span data-ttu-id="c04a6-388">Nahraďte stávající kód s následujícími službami:</span><span class="sxs-lookup"><span data-stu-id="c04a6-388">Replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample19.cs)]

<span data-ttu-id="c04a6-389">Když uživatel aplikace klepne **najdete v článku věnovaném** bude tlačítko na nákupní košík stránce v prohlížeči přejděte na *CheckoutStart.aspx* stránky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-389">When the user of the application clicks the **Checkout** button on the shopping cart page, the browser will navigate to the *CheckoutStart.aspx* page.</span></span> <span data-ttu-id="c04a6-390">Když *CheckoutStart.aspx* stránky zatížení, `ShortcutExpressCheckout` metoda je volána.</span><span class="sxs-lookup"><span data-stu-id="c04a6-390">When the *CheckoutStart.aspx* page loads, the `ShortcutExpressCheckout` method is called.</span></span> <span data-ttu-id="c04a6-391">Uživatel se v tomto okamžiku přenese na testování webu PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-391">At this point, the user is transferred to the PayPal testing web site.</span></span> <span data-ttu-id="c04a6-392">Na webu služby PayPal uživatel zadá své přihlašovací údaje služby PayPal, zkontroluje podrobnosti o nákupu, přijímá PayPal smlouvy a vrátí na adresář Wingtip Toys ukázkovou aplikaci kde `ShortcutExpressCheckout` metoda dokončí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-392">On the PayPal site, the user enters their PayPal credentials, reviews the purchase details, accepts the PayPal agreement and returns to the Wingtip Toys sample application where the `ShortcutExpressCheckout` method completes.</span></span> <span data-ttu-id="c04a6-393">Při `ShortcutExpressCheckout` je metoda dokončena, přesměruje uživatele *CheckoutReview.aspx* stránku zadanou v `ShortcutExpressCheckout` metoda.</span><span class="sxs-lookup"><span data-stu-id="c04a6-393">When the `ShortcutExpressCheckout` method is complete, it will redirect the user to the *CheckoutReview.aspx* page specified in the `ShortcutExpressCheckout` method.</span></span> <span data-ttu-id="c04a6-394">To umožňuje uživateli zkontrolujte podrobnosti o pořadí z v rámci ukázkové aplikace adresář Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="c04a6-394">This allows the user to review the order details from within the Wingtip Toys sample application.</span></span>

### <a name="review-order-details"></a><span data-ttu-id="c04a6-395">Zkontrolujte podrobnosti o objednávce</span><span class="sxs-lookup"><span data-stu-id="c04a6-395">Review Order Details</span></span>

<span data-ttu-id="c04a6-396">Po návratu z PayPal, *CheckoutReview.aspx* stránky adresář Wingtip Toys ukázkové aplikace zobrazí podrobnosti o pořadí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-396">After returning from PayPal, the *CheckoutReview.aspx* page of the Wingtip Toys sample application displays the order details.</span></span> <span data-ttu-id="c04a6-397">Tato stránka umožňuje uživatelům zkontrolujte podrobnosti o pořadí před nákupem produkty.</span><span class="sxs-lookup"><span data-stu-id="c04a6-397">This page allows the user to review the order details before purchasing the products.</span></span> <span data-ttu-id="c04a6-398">*CheckoutReview.aspx* stránky musí být vytvořeny následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="c04a6-398">The *CheckoutReview.aspx* page must be created as follows:</span></span>

1. <span data-ttu-id="c04a6-399">V *najdete v článku věnovaném* složku, otevřete stránku s názvem *CheckoutReview.aspx*.</span><span class="sxs-lookup"><span data-stu-id="c04a6-399">In the *Checkout* folder, open the page named *CheckoutReview.aspx*.</span></span>
2. <span data-ttu-id="c04a6-400">Nahraďte stávající značky s následujícími službami:</span><span class="sxs-lookup"><span data-stu-id="c04a6-400">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample20.aspx)]
3. <span data-ttu-id="c04a6-401">Otevřít stránku kódu s názvem *CheckoutReview.aspx.cs* a existujícího kódu nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="c04a6-401">Open the code-behind page named *CheckoutReview.aspx.cs* and replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample21.cs)]

<span data-ttu-id="c04a6-402">**DetailsView** řízení slouží k zobrazení podrobností o pořadí, které bylo vrácené PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-402">The **DetailsView** control is used to display the order details that have been returned from PayPal.</span></span> <span data-ttu-id="c04a6-403">Také ve výše uvedeném kódu uloží pořadí podrobnosti do databáze adresář Wingtip Toys jako `OrderDetail` objektu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-403">Also, the above code saves the order details to the Wingtip Toys database as an `OrderDetail` object.</span></span> <span data-ttu-id="c04a6-404">Když uživatel klikne na **dokončení pořadí** tlačítka, bude přesměrován na *CheckoutComplete.aspx* stránky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-404">When the user clicks on the **Complete Order** button, they are redirected to the *CheckoutComplete.aspx* page.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="c04a6-405">**Tip**</span><span class="sxs-lookup"><span data-stu-id="c04a6-405">**Tip**</span></span>
> 
> <span data-ttu-id="c04a6-406">Ve značkách *CheckoutReview.aspx* stránky, Všimněte si, že `<ItemStyle>` značky je lze změnit styl položky v rámci **DetailsView** ovládací prvek v dolní části stránky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-406">In the markup of the *CheckoutReview.aspx* page, notice that the `<ItemStyle>` tag is used to change the style of the items within the **DetailsView** control near the bottom of the page.</span></span> <span data-ttu-id="c04a6-407">Pomocí zobrazení stránky v **zobrazení návrhu** (výběrem **návrhu** v levém dolním rohu Visual Studio), pak výběrem **DetailsView** řízení a výběr  **Inteligentní značky** (na ikonu šipky v horní části napravo od ovládacího prvku), nebudete moci zobrazit **Úkoly DetailsView**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-407">By viewing the page in **Design View** (by selecting **Design** at the lower left corner of Visual Studio), then selecting the **DetailsView** control, and selecting the **Smart Tag** (the arrow icon at the top right of the control), you will be able to see the **DetailsView Tasks**.</span></span>
> 
> ![Najdete v článku věnovaném a platbu se PayPal – upravit pole](checkout-and-payment-with-paypal/_static/image18.png)
> 
> <span data-ttu-id="c04a6-409">Výběrem **upravit pole**, **pole** se zobrazí dialogové okno.</span><span class="sxs-lookup"><span data-stu-id="c04a6-409">By selecting **Edit Fields**, the **Fields** dialog box will appear.</span></span> <span data-ttu-id="c04a6-410">V tomto dialogovém jednoduše můžete kontrolovat vizuálních vlastností, jako například **ItemStyle**, z **DetailsView** ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="c04a6-410">In this dialog box you can easily control the visual properties, such as **ItemStyle**, of the **DetailsView** control.</span></span>
> 
> ![Najdete v článku věnovaném a platbu se PayPal – dialogové okno pole](checkout-and-payment-with-paypal/_static/image19.png)


### <a name="complete-purchase"></a><span data-ttu-id="c04a6-412">Dokončení nákupu</span><span class="sxs-lookup"><span data-stu-id="c04a6-412">Complete Purchase</span></span>

<span data-ttu-id="c04a6-413">*CheckoutComplete.aspx* stránky umožňuje nákupu od společnosti PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-413">*CheckoutComplete.aspx* page makes the purchase from PayPal.</span></span> <span data-ttu-id="c04a6-414">Jak je uvedeno nahoře, uživatel musí kliknout na **dokončení pořadí** tlačítko předtím, než bude aplikace přejděte do *CheckoutComplete.aspx* stránky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-414">As mentioned above, the user must click on the **Complete Order** button before the application will navigate to the *CheckoutComplete.aspx* page.</span></span>

1. <span data-ttu-id="c04a6-415">V *najdete v článku věnovaném* složku, otevřete stránku s názvem *CheckoutComplete.aspx*.</span><span class="sxs-lookup"><span data-stu-id="c04a6-415">In the *Checkout* folder, open the page named *CheckoutComplete.aspx*.</span></span>
2. <span data-ttu-id="c04a6-416">Nahraďte stávající značky s následujícími službami:</span><span class="sxs-lookup"><span data-stu-id="c04a6-416">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample22.aspx)]
3. <span data-ttu-id="c04a6-417">Otevřít stránku kódu s názvem *CheckoutComplete.aspx.cs* a existujícího kódu nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="c04a6-417">Open the code-behind page named *CheckoutComplete.aspx.cs* and replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample23.cs)]

<span data-ttu-id="c04a6-418">Když *CheckoutComplete.aspx* načtení stránky `DoCheckoutPayment` metoda je volána.</span><span class="sxs-lookup"><span data-stu-id="c04a6-418">When the *CheckoutComplete.aspx* page is loaded, the `DoCheckoutPayment` method is called.</span></span> <span data-ttu-id="c04a6-419">Jak už bylo zmíněno dříve, `DoCheckoutPayment` Metoda dokončení nákupu z testovacího prostředí PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-419">As mentioned earlier, the `DoCheckoutPayment` method completes the purchase from the PayPal testing environment.</span></span> <span data-ttu-id="c04a6-420">Po dokončení nákupu pořadí, PayPal *CheckoutComplete.aspx* stránka zobrazuje platební transakce `ID` odběrateli.</span><span class="sxs-lookup"><span data-stu-id="c04a6-420">Once PayPal has completed the purchase of the order, the *CheckoutComplete.aspx* page displays a payment transaction `ID` to the purchaser.</span></span>

### <a name="handle-cancel-purchase"></a><span data-ttu-id="c04a6-421">Popisovač Storno nákupu</span><span class="sxs-lookup"><span data-stu-id="c04a6-421">Handle Cancel Purchase</span></span>

<span data-ttu-id="c04a6-422">Pokud se uživatel rozhodne zrušit nákup, budete přesměrováni na *CheckoutCancel.aspx* stránky, kde uvidí, že byla zrušena jejich pořadí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-422">If the user decides to cancel the purchase, they will be directed to the *CheckoutCancel.aspx* page where they will see that their order has been cancelled.</span></span>

1. <span data-ttu-id="c04a6-423">Otevřete stránku s názvem *CheckoutCancel.aspx* v *najdete v článku věnovaném* složky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-423">Open the page named *CheckoutCancel.aspx* in the *Checkout* folder.</span></span>
2. <span data-ttu-id="c04a6-424">Nahraďte stávající značky s následujícími službami:</span><span class="sxs-lookup"><span data-stu-id="c04a6-424">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample24.aspx)]

### <a name="handle-purchase-errors"></a><span data-ttu-id="c04a6-425">Zpracování chyb nákupu</span><span class="sxs-lookup"><span data-stu-id="c04a6-425">Handle Purchase Errors</span></span>

<span data-ttu-id="c04a6-426">Zpracování chyb během procesu nákupu pomocí *CheckoutError.aspx* stránky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-426">Errors during the purchase process will be handled by the *CheckoutError.aspx* page.</span></span> <span data-ttu-id="c04a6-427">Kódu z *CheckoutStart.aspx* stránky, *CheckoutReview.aspx* stránky a *CheckoutComplete.aspx* stránka bude každý přesměrovat  *CheckoutError.aspx* stránky, pokud dojde k chybě.</span><span class="sxs-lookup"><span data-stu-id="c04a6-427">The code-behind of the *CheckoutStart.aspx* page, the *CheckoutReview.aspx* page, and the *CheckoutComplete.aspx* page will each redirect to the *CheckoutError.aspx* page if an error occurs.</span></span>

1. <span data-ttu-id="c04a6-428">Otevřete stránku s názvem *CheckoutError.aspx* v *najdete v článku věnovaném* složky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-428">Open the page named *CheckoutError.aspx* in the *Checkout* folder.</span></span>
2. <span data-ttu-id="c04a6-429">Nahraďte stávající značky s následujícími službami:</span><span class="sxs-lookup"><span data-stu-id="c04a6-429">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample25.aspx)]

<span data-ttu-id="c04a6-430">*CheckoutError.aspx* stránky se zobrazí podrobnosti o chybě, když dojde k chybě během procesu najdete v článku věnovaném.</span><span class="sxs-lookup"><span data-stu-id="c04a6-430">The *CheckoutError.aspx* page is displayed with the error details when an error occurs during the checkout process.</span></span>

## <a name="running-the-application"></a><span data-ttu-id="c04a6-431">Spuštění aplikace</span><span class="sxs-lookup"><span data-stu-id="c04a6-431">Running the Application</span></span>

<span data-ttu-id="c04a6-432">Spusťte aplikaci najdete v tom, jak zakoupit produkty.</span><span class="sxs-lookup"><span data-stu-id="c04a6-432">Run the application to see how to purchase products.</span></span> <span data-ttu-id="c04a6-433">Všimněte si, že budete používat v PayPal testovacím prostředí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-433">Note that you will be running in the PayPal testing environment.</span></span> <span data-ttu-id="c04a6-434">Žádný skutečný peníze se vyměňují.</span><span class="sxs-lookup"><span data-stu-id="c04a6-434">No actual money is being exchanged.</span></span>

1. <span data-ttu-id="c04a6-435">Zajistěte, aby všechny vaše soubory jsou uloženy v sadě Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c04a6-435">Make sure all your files are saved in Visual Studio.</span></span>
2. <span data-ttu-id="c04a6-436">Otevřete webový prohlížeč a přejděte do [https://developer.paypal.com](https://developer.paypal.com/).</span><span class="sxs-lookup"><span data-stu-id="c04a6-436">Open a Web browser and navigate to [https://developer.paypal.com](https://developer.paypal.com/).</span></span>
3. <span data-ttu-id="c04a6-437">Přihlášení pomocí vývojářského účtu PayPal, kterou jste vytvořili dříve v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-437">Login with your PayPal developer account that you created earlier in this tutorial.</span></span>  
 <span data-ttu-id="c04a6-438">Pro izolovaný prostor PayPal pro vývojáře, musíte být přihlášení v [https://developer.paypal.com](https://developer.paypal.com/) k testování express checkout.</span><span class="sxs-lookup"><span data-stu-id="c04a6-438">For PayPal's developer sandbox, you need to be logged in at [https://developer.paypal.com](https://developer.paypal.com/) to test express checkout.</span></span> <span data-ttu-id="c04a6-439">To platí jenom pro společnosti PayPal izolovaného prostoru testování nechcete za provozu prostředí společnosti PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-439">This only applies to PayPal's sandbox testing, not to PayPal's live environment.</span></span>
4. <span data-ttu-id="c04a6-440">V sadě Visual Studio, stiskněte klávesu **F5** ke spuštění ukázkové aplikace adresář Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="c04a6-440">In Visual Studio, press **F5** to run the Wingtip Toys sample application.</span></span>  
 <span data-ttu-id="c04a6-441">Po znovu sestaví databáze, bude v prohlížeči otevřít a zobrazit *Default.aspx* stránky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-441">After the database rebuilds, the browser will open and show the *Default.aspx* page.</span></span>
5. <span data-ttu-id="c04a6-442">Přidejte tři různé produkty do nákupního košíku výběrem kategorie produktů, jako je například "Aut" a potom kliknutím na **přidat do košíku** vedle každého produktu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-442">Add three different products to the shopping cart by selecting the product category, such as "Cars" and then clicking **Add to Cart** next to each product.</span></span>  
 <span data-ttu-id="c04a6-443">Nákupní košík se zobrazí na produkt, který jste vybrali.</span><span class="sxs-lookup"><span data-stu-id="c04a6-443">The shopping cart will display the product you have selected.</span></span>
6. <span data-ttu-id="c04a6-444">Klikněte **PayPal** tlačítko checkout.</span><span class="sxs-lookup"><span data-stu-id="c04a6-444">Click the **PayPal** button to checkout.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – košíku](checkout-and-payment-with-paypal/_static/image20.png)

 <span data-ttu-id="c04a6-446">Rezervování bude vyžadovat, že máte účet uživatele pro ukázkovou aplikaci adresář Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="c04a6-446">Checking out will require that you have a user account for the Wingtip Toys sample application.</span></span>
7. <span data-ttu-id="c04a6-447">Klikněte **Google** odkaz na pravé straně stránky se přihlásit existující e-mailový účet gmail.com.</span><span class="sxs-lookup"><span data-stu-id="c04a6-447">Click the **Google** link on the right of the page to log in with an existing gmail.com email account.</span></span>  
 <span data-ttu-id="c04a6-448">Pokud nemáte účet gmail.com, můžete vytvořit jeden pro testování v [www.gmail.com](https://www.gmail.com/). Můžete také standardní místní účet kliknutím na tlačítko "Register".</span><span class="sxs-lookup"><span data-stu-id="c04a6-448">If you do not have a gmail.com account, you can create one for testing purposes at [www.gmail.com](https://www.gmail.com/). You can also use a standard local account by clicking "Register".</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – přihlášení](checkout-and-payment-with-paypal/_static/image21.png)
8. <span data-ttu-id="c04a6-450">Přihlaste se pomocí vaší gmail účet a heslo.</span><span class="sxs-lookup"><span data-stu-id="c04a6-450">Sign in with your gmail account and password.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – Gmail přihlášení](checkout-and-payment-with-paypal/_static/image22.png)
9. <span data-ttu-id="c04a6-452">Klikněte na tlačítko **přihlásit** tlačítko zaregistrovat adresář Wingtip Toys ukázkové aplikace uživatelské jméno účtu z gmailu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-452">Click the **Log in** button to register your gmail account with your Wingtip Toys sample application user name.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – registrace účtu](checkout-and-payment-with-paypal/_static/image23.png)
10. <span data-ttu-id="c04a6-454">Na test webu PayPal přidat vaše **kupující** e-mailovou adresu a heslo, které jste vytvořili dříve v tomto kurzu a pak klikněte na **protokolu v** tlačítko.</span><span class="sxs-lookup"><span data-stu-id="c04a6-454">On the PayPal test site, add your **buyer** email address and password that you created earlier in this tutorial, then click the **Log In** button.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – PayPal přihlášení](checkout-and-payment-with-paypal/_static/image24.png)
11. <span data-ttu-id="c04a6-456">Souhlas s PayPal zásad a klikněte na **Agree a pokračovat** tlačítko.</span><span class="sxs-lookup"><span data-stu-id="c04a6-456">Agree to the PayPal policy and click the **Agree and Continue** button.</span></span>  
 <span data-ttu-id="c04a6-457">Všimněte si, že je tato stránka jenom zobrazí při prvním použití tohoto účtu PayPal.</span><span class="sxs-lookup"><span data-stu-id="c04a6-457">Note that this page is only displayed the first time you use this PayPal account.</span></span> <span data-ttu-id="c04a6-458">Znovu Všimněte si, že toto je účet test se vyměňují žádné skutečné peníze.</span><span class="sxs-lookup"><span data-stu-id="c04a6-458">Again note that this is a test account, no real money is exchanged.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – PayPal zásad](checkout-and-payment-with-paypal/_static/image25.png)
12. <span data-ttu-id="c04a6-460">Zkontrolujte informace o objednávce na PayPal testování prostředí kontrolní stránku a klikněte na tlačítko **pokračovat**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-460">Review the order information on the PayPal testing environment review page and click **Continue**.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – kontrola informací](checkout-and-payment-with-paypal/_static/image26.png)
13. <span data-ttu-id="c04a6-462">Na *CheckoutReview.aspx* zkontrolujte velikost pořadí a zobrazit adresu generovaného přesouvání.</span><span class="sxs-lookup"><span data-stu-id="c04a6-462">On the *CheckoutReview.aspx* page, verify the order amount and view the generated shipping address.</span></span> <span data-ttu-id="c04a6-463">Potom klikněte **dokončení pořadí** tlačítko.</span><span class="sxs-lookup"><span data-stu-id="c04a6-463">Then, click the **Complete Order** button.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – Zkontrolujte pořadí](checkout-and-payment-with-paypal/_static/image27.png)
14. <span data-ttu-id="c04a6-465">**CheckoutComplete.aspx** se zobrazí stránka s ID platebních transakcí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-465">The **CheckoutComplete.aspx** page is displayed with a payment transaction ID.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – najdete v článku věnovaném dokončení](checkout-and-payment-with-paypal/_static/image28.png)

<a id="ReviewDBWebForms"></a>
## <a name="reviewing-the-database"></a><span data-ttu-id="c04a6-467">Kontrola databáze</span><span class="sxs-lookup"><span data-stu-id="c04a6-467">Reviewing the Database</span></span>

<span data-ttu-id="c04a6-468">Kontrolou aktualizovaná data v databázi adresář Wingtip Toys ukázkové aplikace po spuštění aplikace zobrazí se aplikace úspěšně zaznamenávají nákupu produkty.</span><span class="sxs-lookup"><span data-stu-id="c04a6-468">By reviewing the updated data in the Wingtip Toys sample application database after running the application, you can see that the application successfully recorded the purchase of the products.</span></span>

<span data-ttu-id="c04a6-469">Si můžete prohlédnout data obsažená v *Wingtiptoys.mdf* soubor databáze pomocí **Průzkumník databáze** okno (**Průzkumníka serveru** oken v sadě Visual Studio) jako jste to udělali v tento kurz řady.</span><span class="sxs-lookup"><span data-stu-id="c04a6-469">You can inspect the data contained in the *Wingtiptoys.mdf* database file by using the **Database Explorer** window (**Server Explorer** window in Visual Studio) as you did earlier in this tutorial series.</span></span>

1. <span data-ttu-id="c04a6-470">Zavřete okno prohlížeče, pokud je stále otevřen.</span><span class="sxs-lookup"><span data-stu-id="c04a6-470">Close the browser window if it is still open.</span></span>
2. <span data-ttu-id="c04a6-471">V sadě Visual Studio, vyberte **zobrazit všechny soubory** v horní části ikonu **Průzkumníku řešení** umožňují rozšířit **aplikace\_Data** složky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-471">In Visual Studio, select the **Show All Files** icon at the top of **Solution Explorer** to allow you to expand the **App\_Data** folder.</span></span>
3. <span data-ttu-id="c04a6-472">Rozbalte **aplikace\_Data** složky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-472">Expand the **App\_Data** folder.</span></span>  
 <span data-ttu-id="c04a6-473">Je nutné vybrat **zobrazit všechny soubory** ikonu složky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-473">You may need to select the **Show All Files** icon for the folder.</span></span>
4. <span data-ttu-id="c04a6-474">Klikněte pravým tlačítkem myši *Wingtiptoys.mdf* souboru databáze a vyberte **otevřete**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-474">Right-click the *Wingtiptoys.mdf* database file and select **Open**.</span></span>  
    <span data-ttu-id="c04a6-475">**V Průzkumníku serveru** se zobrazí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-475">**Server Explorer** is displayed.</span></span>
5. <span data-ttu-id="c04a6-476">Rozbalte **tabulky** složky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-476">Expand the **Tables** folder.</span></span>
6. <span data-ttu-id="c04a6-477">Klikněte pravým tlačítkem myši **objednávky**tabulky a vyberte **zobrazit Data tabulky**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-477">Right-click the **Orders**table and select **Show Table Data**.</span></span>  
 <span data-ttu-id="c04a6-478">**Objednávky** tabulka se zobrazí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-478">The **Orders** table is displayed.</span></span>
7. <span data-ttu-id="c04a6-479">Zkontrolujte **PaymentTransactionID** sloupec pro potvrzení úspěšné transakce.</span><span class="sxs-lookup"><span data-stu-id="c04a6-479">Review the **PaymentTransactionID** column to confirm successful transactions.</span></span> 

    ![Najdete v článku věnovaném a platbu se PayPal – zkontrolujte databáze](checkout-and-payment-with-paypal/_static/image29.png)
8. <span data-ttu-id="c04a6-481">Zavřít **objednávky** okno tabulky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-481">Close the **Orders** table window.</span></span>
9. <span data-ttu-id="c04a6-482">V Průzkumníku serveru, klikněte pravým tlačítkem myši **Rozpis objednávek** tabulky a vyberte **zobrazit Data tabulky**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-482">In the Server Explorer, right-click the **OrderDetails** table and select **Show Table Data**.</span></span>
10. <span data-ttu-id="c04a6-483">Zkontrolujte `OrderId` a `Username` hodnoty ve **Rozpis objednávek** tabulky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-483">Review the `OrderId` and `Username` values in the **OrderDetails** table.</span></span> <span data-ttu-id="c04a6-484">Všimněte si, že tyto hodnoty odpovídat `OrderId` a `Username` hodnoty, které jsou součástí **objednávky** tabulky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-484">Note that these values match the `OrderId` and `Username` values included in the **Orders** table.</span></span>
11. <span data-ttu-id="c04a6-485">Zavřít **Rozpis objednávek** okno tabulky.</span><span class="sxs-lookup"><span data-stu-id="c04a6-485">Close the **OrderDetails** table window.</span></span>
12. <span data-ttu-id="c04a6-486">Klikněte pravým tlačítkem na soubor databáze adresář Wingtip Toys (*Wingtiptoys.mdf*) a vyberte **ukončení připojení**.</span><span class="sxs-lookup"><span data-stu-id="c04a6-486">Right-click the Wingtip Toys database file (*Wingtiptoys.mdf*) and select **Close Connection**.</span></span>
13. <span data-ttu-id="c04a6-487">Pokud se nezobrazí **Průzkumníku řešení** okně klikněte na tlačítko **Průzkumníku řešení** v dolní části **Průzkumníka serveru** okno zobrazíte **Průzkumníku řešení**  znovu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-487">If you do not see the **Solution Explorer** window, click **Solution Explorer** at the bottom of the **Server Explorer** window to show the **Solution Explorer** again.</span></span>

## <a name="summary"></a><span data-ttu-id="c04a6-488">Souhrn</span><span class="sxs-lookup"><span data-stu-id="c04a6-488">Summary</span></span>

<span data-ttu-id="c04a6-489">V tomto kurzu jste přidali pořadí a schémata podrobností pořadí sledování nákup produktů.</span><span class="sxs-lookup"><span data-stu-id="c04a6-489">In this tutorial you added order and order detail schemas to track the purchase of products.</span></span> <span data-ttu-id="c04a6-490">Také integrované funkce služby PayPal na adresář Wingtip Toys ukázkovou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="c04a6-490">You also integrated PayPal functionality into the Wingtip Toys sample application.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="c04a6-491">Další prostředky</span><span class="sxs-lookup"><span data-stu-id="c04a6-491">Additional Resources</span></span>

<span data-ttu-id="c04a6-492">[Přehled konfigurace technologie ASP.NET](https://msdn.microsoft.com/library/ms178683(v=vs.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="c04a6-492">[ASP.NET Configuration Overview](https://msdn.microsoft.com/library/ms178683(v=vs.100).aspx)</span></span>  
[<span data-ttu-id="c04a6-493">Nasazení aplikace zabezpečení rozhraní ASP.NET Web Forms členství, OAuth a databáze SQL Azure App Service</span><span class="sxs-lookup"><span data-stu-id="c04a6-493">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[<span data-ttu-id="c04a6-494">Microsoft Azure – bezplatná zkušební verze</span><span class="sxs-lookup"><span data-stu-id="c04a6-494">Microsoft Azure - Free Trial</span></span>](https://azure.microsoft.com/pricing/free-trial/)

## <a name="disclaimer"></a><span data-ttu-id="c04a6-495">Právní omezení</span><span class="sxs-lookup"><span data-stu-id="c04a6-495">Disclaimer</span></span>

<span data-ttu-id="c04a6-496">Tento kurz obsahuje ukázkový kód.</span><span class="sxs-lookup"><span data-stu-id="c04a6-496">This tutorial contains sample code.</span></span> <span data-ttu-id="c04a6-497">Takové ukázkový kód je poskytován "tak, jak je" bez záruky jakéhokoli druhu.</span><span class="sxs-lookup"><span data-stu-id="c04a6-497">Such sample code is provided "as is" without warranty of any kind.</span></span> <span data-ttu-id="c04a6-498">Podle toho společnost Microsoft nezaručuje, přesnost, integritu nebo kvalitu ukázkový kód.</span><span class="sxs-lookup"><span data-stu-id="c04a6-498">Accordingly, Microsoft does not guarantee the accuracy, integrity, or quality of the sample code.</span></span> <span data-ttu-id="c04a6-499">Souhlasíte s tím, že používáte ukázkový kód na vlastní nebezpečí.</span><span class="sxs-lookup"><span data-stu-id="c04a6-499">You agree to use the sample code at your own risk.</span></span> <span data-ttu-id="c04a6-500">Za žádných okolností bude Microsoft za vám žádným způsobem žádné ukázkový kód, obsah, včetně, ale nikoli výhradně, všechny chyby nebo opomenutí v jakékoli ukázkový kód, obsah, nebo ke ztrátě nebo poškození jakéhokoli druhu vzniklých v důsledku použití jakékoli ukázkový kód.</span><span class="sxs-lookup"><span data-stu-id="c04a6-500">Under no circumstances will Microsoft be liable to you in any way for any sample code, content, including but not limited to, any errors or omissions in any sample code, content, or any loss or damage of any kind incurred as a result of the use of any sample code.</span></span> <span data-ttu-id="c04a6-501">Tímto upozorněni a souhlasí s tím zbavuje odpovědnosti, uložit a uložení neškodné z a proti ztrátě všechny deklarace identity ke ztrátě, poškození nebo poškození jakéhokoli druhu včetně bez omezení, ty způsobené nebo vzniklých materiál, který účtování, Microsoft přenášet, použijte nebo spoléhají na mimo jiné včetně názory vyjádřené v něm.</span><span class="sxs-lookup"><span data-stu-id="c04a6-501">You are hereby notified and do hereby agree to indemnify, save and hold Microsoft harmless from and against any and all loss, claims of loss, injury or damage of any kind including, without limitation, those occasioned by or arising from material that you post, transmit, use or rely on including, but not limited to, the views expressed therein.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="c04a6-502">[Předchozí](shopping-cart.md)
[další](membership-and-administration.md)</span><span class="sxs-lookup"><span data-stu-id="c04a6-502">[Previous](shopping-cart.md)
[Next](membership-and-administration.md)</span></span>
